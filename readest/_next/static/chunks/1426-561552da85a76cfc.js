"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1426],{4177:(e,t,n)=>{n.d(t,{tG:()=>a,pf:()=>u,tI:()=>z,EC:()=>T,A3:()=>w,NQ:()=>h});let a={UNAUTHORIZED:"Unauthorized",DEEPL_API_ERROR:"DeepL API Error",DAILY_QUOTA_EXCEEDED:"Daily Quota Exceeded",INTERNAL_SERVER_ERROR:"Internal Server Error"},r="translations",s={},l={},o=()=>new Promise((e,t)=>{if(!window.indexedDB){console.warn("IndexedDB not supported. Using in-memory cache only."),t(Error("IndexedDB not supported"));return}let n=indexedDB.open("TranslationCache",1);n.onerror=e=>{console.error("IndexedDB error:",e),t(Error("Could not open IndexedDB"))},n.onsuccess=t=>{e(t.target.result)},n.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(r)){let e=t.createObjectStore(r,{keyPath:"key"});e.createIndex("provider","provider",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}}),i=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t,n=await o(),a=n.transaction(r,"readonly"),s=a.objectStore(r);if(e.onlyLoadProviders&&e.onlyLoadProviders.length>0){let t=e.onlyLoadProviders.map(e=>new Promise(t=>{let n=s.index("provider").getAll(e);n.onsuccess=()=>{t(n.result)},n.onerror=()=>{t([])}})),n=(await Promise.all(t)).flat();c(n,e)}else(t=s.getAll()).onsuccess=()=>{let n=t.result;c(n,e)},t.onerror=e=>{console.error("Error loading cache from IndexedDB:",e)};a.oncomplete=()=>{n.close()}}catch(e){console.error("Failed to load cache from IndexedDB:",e)}},c=(e,t)=>{let n=e;if(t.maxAge){let e=Date.now()-t.maxAge;n=n.filter(t=>t.timestamp>=e)}t.onlyLoadLanguages&&(t.onlyLoadLanguages.source&&t.onlyLoadLanguages.source.length>0&&(n=n.filter(e=>t.onlyLoadLanguages.source.includes(e.sourceLang))),t.onlyLoadLanguages.target&&t.onlyLoadLanguages.target.length>0&&(n=n.filter(e=>t.onlyLoadLanguages.target.includes(e.targetLang)))),t.maxEntries&&n.length>t.maxEntries&&(n.sort((e,t)=>t.timestamp-e.timestamp),n=n.slice(0,t.maxEntries)),n.forEach(e=>{s[e.key]=e.translation,l[e.key]=e.timestamp})},d=(e,t,n,a)=>"".concat(a,":").concat(t,":").concat(n,":").concat(e),u=async(e,t,n,a)=>{if(!(null==e?void 0:e.trim()))return null;let i=d(e,t,n,a);if(s[i])return s[i];try{let e=await o(),t=e.transaction(r,"readonly"),n=t.objectStore(r).get(i);return new Promise(a=>{n.onsuccess=()=>{let e=n.result;e?(s[i]=e.translation,l[i]=e.timestamp,a(e.translation)):a(null)},n.onerror=()=>{a(null)},t.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error accessing IndexedDB:",e),null}},h=async(e,t,n,a,i)=>{if(!(null==e?void 0:e.trim())||!t)return;let c=d(e,n,a,i),u=Date.now();s[c]=t,l[c]=u;try{let s=await o(),l=s.transaction(r,"readwrite");return l.objectStore(r).put({key:c,translation:t,timestamp:u,provider:i,sourceLang:n,targetLang:a,originalText:e}),new Promise((e,t)=>{l.oncomplete=()=>{s.close(),e()},l.onerror=e=>{console.error("Error storing in IndexedDB:",e),t(Error("Failed to store in IndexedDB"))}})}catch(e){console.error("Error accessing IndexedDB:",e)}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxAge:t,maxEntries:n,maxSizeInBytes:a,dryRun:i=!1}=e;if(!t&&!n&&!a)return 0;try{let e=await o(),c=e.transaction(r,i?"readonly":"readwrite"),d=c.objectStore(r),u=d.getAll();return new Promise(r=>{u.onsuccess=()=>{let e=u.result,o=[];if(t){let n=Date.now()-t,a=e.filter(e=>e.timestamp<n);o.push(...a)}if(n&&e.length>n){let t=[...e].sort((e,t)=>e.timestamp-t.timestamp).slice(0,e.length-n),a=new Set(o.map(e=>e.key));t.forEach(e=>{a.has(e.key)||o.push(e)})}if(a){let t=0;if(e.forEach(e=>{let n=JSON.stringify(e);t+=n.length}),t>a){let n=e.filter(e=>!o.some(t=>t.key===e.key)).sort((e,t)=>e.timestamp-t.timestamp),r=t-a,s=new Set(o.map(e=>e.key));for(let e of n){if(r<=0)break;if(!s.has(e.key)){let t=JSON.stringify(e),n=2*t.length;o.push(e),s.add(e.key),r-=n}}}}let c=o.length;!i&&c>0&&o.forEach(e=>{d.delete(e.key),delete s[e.key],delete l[e.key]}),r(c)},u.onerror=()=>{r(0)},c.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error pruning cache:",e),0}},p=null;(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{preload:t=!0,preloadOptions:n={maxAge:6048e5,maxEntries:1e3},autoPrune:a=!0,pruneInterval:r=36e5,pruneOptions:s={maxAge:2592e6,maxEntries:1e4,maxSizeInBytes:0xa00000}}=e;t&&await i(n);let l=null;return a&&(await m(s),l=window.setInterval(async()=>{await m(s)},r)),()=>{null!==l&&clearInterval(l)}})().then(e=>{p=e}),window.addEventListener("beforeunload",()=>{p&&p()});let g={zh:e=>e.replace(/--/g,"⸺").replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1"),es:e=>e.replace(/\?([A-ZÁÉÍÓÚÑÜ])/g,"? $1").replace(/\!([A-ZÁÉÍÓÚÑÜ])/g,"! $1"),fr:e=>e.replace(/\s+([!?:;])/g," $1").replace(/([!?:;])\s+/g,"$1 "),ja:e=>e.replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1")},f=e=>e.replace(/\s+/g," ").replace(/\s+([.,!?;:])/g,"$1").trim();function w(e,t){let n=function(e){let t=g[e.split("-")[0].toLowerCase()];return t?e=>t(f(e)):f}(t);return e.map(n)}var y=n(69921),v=n(50981),x=n(28039),b=n(40965),E=n(21013);let L=(0,y.L1)()+"/deepl/translate",S={name:"deepl",label:(0,v.Gg)("DeepL"),authRequired:!0,quotaExceeded:!1,translate:async function(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=S.authRequired,o={"Content-Type":"application/json"},i="free";if(r&&(i=(0,x.l3)(r),o.Authorization="Bearer ".concat(r)),l&&!r)throw Error("Authentication token is required for DeepL translation");let c=JSON.stringify({text:e,source_lang:t.toUpperCase(),target_lang:n.toUpperCase(),use_cache:s}),d=b.Vz[i];try{let t=await fetch(L,{method:"POST",headers:o,body:c});if(!t.ok){let e=await t.json();if(e&&e.error&&e.error===a.DAILY_QUOTA_EXCEEDED)throw(0,E.Q)(d),S.quotaExceeded=!0,Error(a.DAILY_QUOTA_EXCEEDED);throw Error("Translation failed with status ".concat(t.status))}let n=await t.json();if(!n||!n.translations)throw Error("Invalid response from translation service");return e.map((e,t)=>{var a;if(!(null==e?void 0:e.trim().length))return e;let r=null==(a=n.translations)?void 0:a[t];return(null==r?void 0:r.daily_usage)&&((0,E.Q)(r.daily_usage),S.quotaExceeded=n.daily_usage>=d),(null==r?void 0:r.text)||e})}catch(e){throw e}}};var A=n(67915),k=n(80913);let j=null,D=async()=>{let e=Date.now();if(j&&j.expiresAt>e)return j.token;try{let t=(0,y.uO)()?A.h:window.fetch,n=await t("https://edge.microsoft.com/translate/auth",{method:"GET",headers:{"User-Agent":"Mozilla/5.0"}});if(!n.ok)throw Error("Failed to get auth token: ".concat(n.status));let a=await n.text();return j={token:a,expiresAt:e+48e4},a}catch(e){throw console.error("Error getting Microsoft translation auth token:",e),e}},I={name:"azure",label:(0,v.Gg)("Azure Translator"),translate:async(e,t,n)=>{if(!e.length)return[];let a=[],r=t?(0,k.dv)(t.toLowerCase()):"",s=(0,k.dv)(n.toLowerCase()),l=e.map(async(e,t)=>{if(!(null==e?void 0:e.trim().length)){a[t]=e;return}let n=new URLSearchParams({to:s,"api-version":"3.0"});r&&"auto"!==r&&n.append("from",r);let l=await D(),o=(0,y.uO)()?A.h:window.fetch,i=await o("".concat("https://api-edge.cognitive.microsofttranslator.com/translate","?").concat(n.toString()),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify([{Text:e}])});if(!i.ok)throw Error("Translation failed with status ".concat(i.status));let c=await i.json();Array.isArray(c)&&c.length>0&&c[0].translations?a[t]=c[0].translations[0].text||e:a[t]=e});return await Promise.all(l),a}},N={name:"google",label:(0,v.Gg)("Google Translate"),translate:async(e,t,n)=>{if(!e.length)return[];let a=[],r=e.map(async(e,r)=>{if(!(null==e?void 0:e.trim().length)){a[r]=e;return}let s=new URL("https://translate.googleapis.com/translate_a/single");s.searchParams.append("client","gtx"),s.searchParams.append("dt","t"),s.searchParams.append("sl",t.toLowerCase()||"auto"),s.searchParams.append("tl",n.toLowerCase()),s.searchParams.append("q",e);let l=(0,y.uO)()?A.h:window.fetch,o=await l(s.toString());if(!o.ok)throw Error("Translation failed with status ".concat(o.status));let i=await o.json();if(Array.isArray(i)&&Array.isArray(i[0])){let t=i[0].filter(e=>Array.isArray(e)&&e[0]).map(e=>e[0]).join("");a[r]=t||e}else a[r]=e});return await Promise.all(r),a}};function C(e,t){if(e!==t.name)throw Error('Translator name "'.concat(e,'" does not match implementation name "').concat(t.name,'"'));return t}let _=C("deepl",S),P=[_,C("azure",I),C("google",N)],z=e=>P.find(t=>t.name===e),T=()=>P},15574:(e,t,n)=>{n.d(t,{D:()=>c});var a=n(84574),r=n(57597),s=n(98335),l=n(20517),o=n(71997),i=n(58068);let c=function(){let{systemUIVisible:e=!0,appThemeColor:t="base-100"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{appService:n}=(0,r.D)(),{settings:c}=(0,l.C)(),{themeColor:d,isDarkMode:u,showSystemUI:h,dismissSystemUI:m,updateAppTheme:p,setStatusBarHeight:g}=(0,s.C)();(0,a.useEffect)(()=>{p(t),(null==n?void 0:n.isMobileApp)&&(e?h():m(),(0,i.Mp)({visible:e,darkMode:u})),(null==n?void 0:n.isAndroidApp)&&(0,i.ZA)().then(e=>{e.height&&e.height>0&&g(e.height/window.devicePixelRatio)})},[n,u]),(0,a.useEffect)(()=>{var e,t;let n=null!=(t=null==(e=c.globalReadSettings)?void 0:e.customThemes)?t:[];n.forEach(e=>{(0,o.PL)(e)}),localStorage.setItem("customThemes",JSON.stringify(n))},[c]),(0,a.useEffect)(()=>{let e=u?"dark":"light";document.documentElement.setAttribute("data-theme","".concat(d,"-").concat(e)),document.documentElement.style.setProperty("color-scheme",e)},[d,u])}},20517:(e,t,n)=>{n.d(t,{C:()=>a});let a=(0,n(75972).v)(e=>({settings:{},isFontLayoutSettingsDialogOpen:!1,isFontLayoutSettingsGlobal:!0,setSettings:t=>e({settings:t}),saveSettings:async(e,t)=>{let n=await e.getAppService();await n.saveSettings(t)},setFontLayoutSettingsDialogOpen:t=>e({isFontLayoutSettingsDialogOpen:t}),setFontLayoutSettingsGlobal:t=>e({isFontLayoutSettingsGlobal:t})}))},20627:(e,t,n)=>{n.d(t,{m:()=>i});var a=n(84574),r=n(46450),s=n(4177),l=n(66763),o=n(78549);function i(){let{provider:e="deepl",sourceLang:t="AUTO",targetLang:n="EN",enablePolishing:i=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=(0,o.B)(),{token:d}=(0,r.A)(),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(e),[g,f]=(0,a.useState)(()=>(0,s.tI)(e)),[w]=(0,a.useState)(()=>(0,s.EC)());return(0,a.useEffect)(()=>{h(!1)},[e,t,n]),(0,a.useEffect)(()=>{let t=(0,s.EC)().filter(e=>(!e.authRequired||!!d)&&!e.quotaExceeded),n=(t.find(t=>t.name===e)||t[0]).name;f((0,s.tI)(n)),p(n)},[e]),{translate:(0,a.useCallback)(async(e,a)=>{var r;let o=(null==a?void 0:a.source)||t,u=(null==a?void 0:a.target)||n,g=null!=(r=null==a?void 0:a.useCache)&&r;if(0===e.length||e.every(e=>!(null==e?void 0:e.trim())))return e;let f=[],y=[];if(await Promise.all(e.map(async(e,t)=>{(null==e?void 0:e.trim())&&(await (0,s.pf)(e,o,u,m)||(f.push(e),y.push(t)))})),0===f.length){let t=await Promise.all(e.map(e=>(0,s.pf)(e,o,u,m).then(t=>t||e)));return i?(0,s.A3)(t,u):t}h(!0);try{let t=w.find(e=>e.name===m);if(!t)throw Error("No translator found for provider: ".concat(m));let n=await t.translate(f,o,u,d,g);await Promise.all(f.map(async(e,t)=>(0,s.NQ)(e,n[t]||"",o,u,m)));let a=[...e];return y.forEach((e,t)=>{a[e]=n[t]||""}),await Promise.all(a.map(async(t,n)=>{if(!y.includes(n)){let t=e[n];if(!(null==t?void 0:t.trim()))return;let r=await (0,s.pf)(t,o,u,m);r&&(a[n]=r)}})),h(!1),i?(0,s.A3)(a,u):a}catch(e){throw e instanceof Error&&e.message.includes(s.tG.DAILY_QUOTA_EXCEEDED)&&(l.I.dispatch("toast",{message:c("Daily translation quota reached. Select another translate service to proceed."),type:"error"}),p("azure")),h(!1),e instanceof Error?e:Error(String(e))}},[m,t,n,g,d]),translator:g,translators:w,loading:u}}},21013:(e,t,n)=>{n.d(t,{Q:()=>r,z:()=>s});let a="translationDailyUsage",r=(e,t)=>{{let n=t||new Date().toISOString().split("T")[0];localStorage.setItem(a,JSON.stringify({[n]:e}))}},s=e=>{{let t=e||new Date().toISOString().split("T")[0],n=localStorage.getItem(a);if(n){let e=JSON.parse(n);if(e[t])return e[t]}}return null}},25470:(e,t,n)=>{n.d(t,{D:()=>r,n:()=>s});var a=n(78296);let r=e=>{let t=(0,a.Ub)({maxWidth:480}),n=(0,a.Ub)({minWidth:481,maxWidth:1024});return t||n?1.25*e:e},s=()=>r(20)},28039:(e,t,n)=>{n.d(t,{Bg:()=>u,Fk:()=>m,iD:()=>h,l3:()=>c,r2:()=>d});var a=n(88744),r=n(2675),s=n(40965),l=n(69921),o=n(21013),i=n(79336);let c=e=>((0,a.s)(e)||{}).plan||"free",d=e=>{let t=(0,a.s)(e)||{},n=t.plan||"free",r=t.storage_usage_bytes||0,l=parseInt(i.env.NEXT_PUBLIC_STORAGE_FIXED_QUOTA||"0")||s.zW[n]||s.zW.free;return{plan:n,usage:r,quota:l}},u=e=>{let t=((0,a.s)(e)||{}).plan||"free",n=(0,o.z)()||0,r=s.Vz[t];return{plan:t,usage:n,quota:r}},h=async()=>{var e,t,n;if((0,l.hx)())return null!=(t=localStorage.getItem("token"))?t:null;let{data:a}=await r.ND.auth.getSession();return null!=(n=null==a||null==(e=a.session)?void 0:e.access_token)?n:null},m=async()=>{var e,t,n,a,s;if((0,l.hx)())return null!=(a=JSON.parse(null!=(n=localStorage.getItem("user"))?n:"{}").id)?a:null;let{data:o}=await r.ND.auth.getSession();return null!=(s=null==o||null==(t=o.session)||null==(e=t.user)?void 0:e.id)?s:null}},44625:(e,t,n)=>{n.d(t,{HG:()=>L,Y0:()=>A,mL:()=>S});var a=n(62574),r=n(3073),s=n(40379),l=n.n(s),o=n(25143),i=n(57597),c=n(84574),d=n(54599),u=n(5404),h=n(70627),m=n(67915),p=n(20627),g=n(78549),f=n(38012),w=n(83090),y=n(58068),v=n(50981),x=n(40965),b=n(80239),E=n(64466);let L=e=>{var t;let{version:n}=e,s=(0,g.B)(),[E,L]=(0,c.useState)("EN"),{translate:S}=(0,p.m)({provider:"azure",sourceLang:"AUTO",targetLang:E}),{appService:A}=(0,i.D)(),k=(0,f.useSearchParams)(),j=b.rE,D=null!=(t=null!=n?n:null==k?void 0:k.get("version"))?t:"",[I,N]=(0,c.useState)(null),[C,_]=(0,c.useState)(!1),[P,z]=(0,c.useState)(D),[T,B]=(0,c.useState)([]),[R,O]=(0,c.useState)(null),[K,U]=(0,c.useState)(null),[M,q]=(0,c.useState)(!1),[H,Y]=(0,c.useState)(null);(0,c.useEffect)(()=>{L((0,v.JK)())},[]),(0,c.useEffect)(()=>{let e=async()=>{let e=await (0,u.z)();e&&N(e)},t=async()=>{let e=await (0,m.h)(x.GM),t=await e.json();if(l().gt(t.version,b.rE)){var n;let e=(0,d.zJ)(),a=null==(n=t.platforms["aarch64"===e?"android-arm64":"android-universal"])?void 0:n.url,r=null==A?void 0:A.fs.getPrefix("Cache"),s="".concat(r,"/Readest_").concat(t.version,"_").concat("aarch64"===e?"arm64":"universal",".apk");N({currentVersion:b.rE,version:t.version,date:t.date,body:t.notes,downloadAndInstall:async e=>{await new Promise(async(t,n)=>{let r=0,l=0;await (0,w.e2)(a,s,n=>{e&&(!l&&n.total?e({event:"Started",data:{contentLength:l=n.total}}):r>0&&n.progress===n.total&&(console.log("APK downloaded to",s),null==e||e({event:"Finished"}),setTimeout(()=>{t()},1e3)),e({event:"Progress",data:{chunkLength:n.progress-r}}),r=n.progress)}).catch(e=>{console.error("Download failed:",e),n(e)})});let t=await (0,y.Ed)({path:s});t.success?console.log("APK installed successfully"):console.error("Failed to install APK:",t.error)}})}};(async()=>{let n=(0,d.NW)();["macos","windows","linux"].includes(n)?e():"android"===n&&t()})()},[]),(0,c.useEffect)(()=>{let e=async(e,t)=>{try{let n=await (0,m.h)(x.V6),a=(await n.json()).releases;return Object.entries(a).filter(n=>{let[a]=n;return l().gt(a,e)&&l().lte(a,t)}).sort((e,t)=>{let[n]=e,[a]=t;return l().rcompare(n,a)}).map(e=>{let[t,n]=e;return{version:t,date:new Date(n.date).toDateString(),notes:n.notes}})}catch(e){return console.error("Failed to fetch changelog:",e),[]}},t=e=>e.split(/(?:^|\s)\d+\.\s/).map(e=>e.trim()).filter(e=>e.length>0),n=async n=>{z(n.version);let a=await e(j,n.version);if(0===a.length){var r;a=[{version:n.version,date:new Date(n.date).toDateString(),notes:t(null!=(r=n.body)?r:"")}]}for(let e of a)try{e.notes=await S(e.notes,{useCache:!0})}catch(e){console.log("Failed to translate changelog:",e)}B(a)};I&&n(I)},[I]),(0,c.useEffect)(()=>{_(!0)},[]);let F=async()=>{var e;if(!I)return;let t=0,n=0,a=0;O(0),q(!0),await (null==(e=I.downloadAndInstall)?void 0:e.call(I,e=>{switch(e.event){case"Started":U(n=e.data.contentLength);break;case"Progress":Y(t+=e.data.chunkLength),O(Math.floor(t/n*100)),t-a>=1048576&&(console.log("downloaded ".concat(t," bytes from ").concat(n)),a=t);break;case"Finished":console.log("download finished"),O(100)}})),console.log("package installed"),(null==A?void 0:A.isAndroidApp)||await (0,h.b)()};return C&&P?(0,a.jsx)("div",{className:"bg-base-100 flex min-h-screen justify-center",children:(0,a.jsxs)("div",{className:"flex w-full max-w-2xl flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-center gap-4 sm:flex-row sm:items-start",children:[(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(o.default,{src:"/icon.png",alt:"Logo",className:"h-20 w-20",width:64,height:64})}),(0,a.jsxs)("div",{className:"text-base-content flex-grow text-sm",children:[(0,a.jsx)("h2",{className:"mb-4 text-center font-bold sm:text-start",children:s("A new version of Readest is Available!")}),(0,a.jsx)("p",{className:"mb-2",children:s("Readest {{newVersion}} is available (installed version {{currentVersion}}).",{newVersion:P,currentVersion:j})}),(0,a.jsx)("p",{className:"mb-2",children:s("Download and install now?")}),(0,a.jsxs)("div",{className:"flex w-full flex-row items-center justify-end gap-4",children:[null!==R&&(0,a.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,a.jsx)("progress",{className:"progress my-1 h-4 w-full",value:R,max:"100"}),(0,a.jsx)("p",{className:"text-base-content/75 flex items-center justify-center text-sm",children:R<100?s("Downloading {{downloaded}} of {{contentLength}}",{downloaded:H?"".concat(Math.floor(H/1024/1024)," MB"):"0 MB",contentLength:K?"".concat(Math.floor(K/1024/1024)," MB"):"0 MB"}):s("Download finished")})]}),(0,a.jsx)("div",{className:"card-actions",children:(0,a.jsx)("button",{className:(0,r.A)("btn btn-warning text-base-100 px-6 font-bold",(!I||M)&&"btn-disabled"),onClick:F,children:s("DOWNLOAD & INSTALL")})})]})]})]}),(0,a.jsxs)("div",{className:"text-base-content text-sm",children:[(0,a.jsx)("h3",{className:"mb-2 font-bold",children:s("Changelog:")}),(0,a.jsx)("div",{className:"bg-base-300 mb-4 rounded-lg px-4 pb-2 pt-4",children:T.length>0?T.map(e=>(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h4",{className:"mb-2 font-bold",children:[e.version," (",e.date,")"]}),(0,a.jsx)("ul",{className:"list-disc space-y-1 ps-6 text-sm",children:e.notes.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]},e.version)):(0,a.jsxs)("div",{className:"flex h-56 w-full flex-col gap-4",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-28"}),(0,a.jsx)("div",{className:"skeleton h-4 w-full"}),(0,a.jsx)("div",{className:"skeleton h-4 w-full"})]})})]})]})}):null},S=(e,t)=>{let n=document.getElementById("updater_window");if(n){let a=new CustomEvent("setDialogVisibility",{detail:{visible:e,newVersion:t}});n.dispatchEvent(a)}},A=()=>{let e=(0,g.B)(),[t,n]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{let e=e=>{let{visible:t,newVersion:a}=e.detail;s(t),a&&n(a)},t=document.getElementById("updater_window");return t&&t.addEventListener("setDialogVisibility",e),()=>{t&&t.removeEventListener("setDialogVisibility",e)}},[]),(0,a.jsx)(E.A,{id:"updater_window",isOpen:r,title:e("Software Update"),onClose:()=>s(!1),boxClassName:"sm:!w-[80%] sm:h-auto",children:(0,a.jsx)(L,{version:null!=t?t:void 0})})}},57597:(e,t,n)=>{n.d(t,{D:()=>i,L:()=>o});var a=n(62574),r=n(84574),s=n(69921);let l=(0,r.createContext)(void 0),o=e=>{let{children:t}=e,[n]=(0,r.useState)(s.Ay),[o,i]=(0,r.useState)(null);return r.useEffect(()=>{n.getAppService().then(e=>i(e)),window.addEventListener("error",e=>"ResizeObserver loop limit exceeded"===e.message&&(e.stopImmediatePropagation(),e.preventDefault(),!0))},[n]),(0,a.jsx)(l.Provider,{value:{envConfig:n,appService:o},children:t})},i=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useEnv must be used within EnvProvider");return e}},58068:(e,t,n)=>{n.d(t,{Ed:()=>l,LB:()=>u,Mp:()=>o,S$:()=>d,ZA:()=>i,i1:()=>s,ot:()=>h,ov:()=>r});var a=n(7269);async function r(e){return await (0,a.lA)("plugin:native-bridge|copy_uri_to_path",{payload:e})}async function s(e){await (0,a.lA)("plugin:native-bridge|use_background_audio",{payload:e})}async function l(e){return await (0,a.lA)("plugin:native-bridge|install_package",{payload:e})}async function o(e){return await (0,a.lA)("plugin:native-bridge|set_system_ui_visibility",{payload:e})}async function i(){return await (0,a.lA)("plugin:native-bridge|get_status_bar_height")}let c=null;async function d(){if(c)return c;let e=await (0,a.lA)("plugin:native-bridge|get_sys_fonts_list");return c=e,e}async function u(e){await (0,a.lA)("plugin:native-bridge|intercept_keys",{payload:e})}async function h(e){await (0,a.lA)("plugin:native-bridge|lock_screen_orientation",{payload:e})}},64466:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(62574),r=n(3073),s=n(84574),l=n(90045),o=n(57597),i=n(83703),c=n(98335),d=n(85376),u=n(25470),h=n(45016),m=n(91225),p=n(66763);let g=e=>{let{id:t,isOpen:n,children:g,snapHeight:f,header:w,title:y,className:v,bgClassName:x,boxClassName:b,contentClassName:E,onClose:L}=e,{appService:S}=(0,o.D)(),{systemUIVisible:A,statusBarHeight:k}=(0,c.C)(),{acquireBackKeyInterception:j,releaseBackKeyInterception:D}=(0,d.A)(),[I,N]=(0,s.useState)(!f),[C]=(0,s.useState)(()=>"rtl"===(0,m.A)()),_=(0,s.useRef)(null),P=(0,u.D)(22),z=window.innerWidth<640,T=e=>{if(e instanceof CustomEvent){if("Back"===e.detail.keyName)return L(),!0}else"Escape"===e.key&&L();return!1};(0,s.useEffect)(()=>{if(n)return N(!f),window.addEventListener("keydown",T),(null==S?void 0:S.isAndroidApp)&&(j(),p.I.onSync("native-key-down",T)),()=>{window.removeEventListener("keydown",T),(null==S?void 0:S.isAndroidApp)&&(D(),p.I.offSync("native-key-down",T))}},[n]);let{handleDragStart:B}=(0,i.i)(e=>{if(!z||!_.current)return;let t=_.current.querySelector(".modal-box"),n=_.current.querySelector(".overlay"),a=e.clientY/window.innerHeight,r=Math.max(0,Math.min(1,a));t&&n&&(t.style.height="100%",t.style.transform="translateY(".concat(100*r,"%)"),n.style.opacity="".concat(1-a),N(e.clientY<44),t.style.transition="padding-top 0.3s ease-out")},e=>{if(!z||!_.current)return;let t=_.current.querySelector(".modal-box"),n=_.current.querySelector(".overlay");if(!t||!n)return;let a=f?1-f+.2:.5;if(e.velocity>.5||e.velocity>=0&&e.clientY>=window.innerHeight*a){let a=.15/Math.max(e.velocity,.5);t.style.height="100%",t.style.transition="transform ".concat(a,"s ease-out"),t.style.transform="translateY(100%)",n.style.transition="opacity ".concat(a,"s ease-out"),n.style.opacity="0",L(),setTimeout(()=>{t.style.transform="translateY(0%)"},300)}else f&&e.clientY>window.innerHeight*(f?1-f-.2:.5)&&e.clientY<window.innerHeight*a?(n.style.transition="opacity 0.3s ease-out",n.style.opacity="".concat(1-f),t.style.height="".concat(100*f,"%"),t.style.bottom="0",t.style.transition="transform 0.3s ease-out",t.style.transform=""):(N(!0),t.style.height="100%",t.style.transition="transform 0.3s ease-out",t.style.transform="translateY(0%)",n.style.opacity="0");(null==S?void 0:S.hasHaptics)&&(0,h._q)("medium")});return(0,a.jsxs)("dialog",{ref:_,id:null!=t?t:"dialog",open:n,className:(0,r.A)("modal sm:min-w-90 z-50 h-full w-full !items-start !bg-transparent sm:w-full sm:!items-center",v),dir:C?"rtl":void 0,children:[(0,a.jsx)("div",{className:(0,r.A)("overlay fixed inset-0 z-10 bg-black/50 sm:bg-black/20",x),onClick:L}),(0,a.jsxs)("div",{className:(0,r.A)("modal-box settings-content absolute z-20 flex flex-col rounded-none rounded-tl-2xl rounded-tr-2xl p-0 sm:rounded-2xl","h-full max-h-full w-full max-w-full",window.innerWidth<window.innerHeight?"sm:h-[50%] sm:w-3/4":"sm:h-[65%] sm:w-1/2 sm:max-w-[600px]",b),style:{paddingTop:(null==S?void 0:S.hasSafeAreaInset)&&I?"max(env(safe-area-inset-top), ".concat(A?k:0,"px)"):"0px",...(null==S?void 0:S.isMobile)?{height:f?"".concat(100*f,"%"):"100%",bottom:0}:{}},children:[(0,a.jsx)("div",{className:(0,r.A)("drag-handle h-10 max-h-10 min-h-10 w-full cursor-row-resize items-center justify-center","transition-padding-top flex duration-300 ease-out sm:hidden"),onMouseDown:B,onTouchStart:B,children:(0,a.jsx)("div",{className:"bg-base-content/50 h-1 w-10 rounded-full"})}),(0,a.jsx)("div",{className:"dialog-header bg-base-100 sticky top-1 z-10 flex items-center justify-between px-4",children:w||(0,a.jsxs)("div",{className:"flex h-11 w-full items-center justify-between",children:[(0,a.jsx)("button",{tabIndex:-1,onClick:L,className:"btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden",children:C?(0,a.jsx)(l.ree,{size:P}):(0,a.jsx)(l.VR3,{size:P})}),(0,a.jsx)("div",{className:"z-15 pointer-events-none absolute inset-0 flex h-11 items-center justify-center",children:(0,a.jsx)("span",{className:"line-clamp-1 text-center font-bold",children:null!=y?y:""})}),(0,a.jsx)("button",{tabIndex:-1,onClick:L,className:"bg-base-300/65 btn btn-ghost btn-circle ml-auto hidden h-6 min-h-6 w-6 focus:outline-none sm:flex",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})}),(0,a.jsx)("div",{className:(0,r.A)("text-base-content my-2 flex-grow overflow-y-auto px-6 sm:px-[10%]",E),children:g})]})]})}},66763:(e,t,n)=>{n.d(t,{I:()=>s});var a=n(84648);class r{on(e,t){this.asyncListeners.has(e)||this.asyncListeners.set(e,new Set),this.asyncListeners.get(e).add(t)}off(e,t){var n;null==(n=this.asyncListeners.get(e))||n.delete(t)}async dispatch(e,t){let n=this.asyncListeners.get(e);if(n){let a=new CustomEvent(e,{detail:t});for(let e of n)await e(a)}}onSync(e,t){this.syncListeners.has(e)||this.syncListeners.set(e,[]),this.syncListeners.get(e).push(t)}offSync(e,t){let n=this.syncListeners.get(e);n&&this.syncListeners.set(e,n.filter(e=>e!==t))}dispatchSync(e,t){let n=this.syncListeners.get(e);if(n){let a=new CustomEvent(e,{detail:t});for(let e of[...n].reverse())if(e(a))return!0}return!1}constructor(){(0,a._)(this,"syncListeners",void 0),(0,a._)(this,"asyncListeners",void 0),this.syncListeners=new Map,this.asyncListeners=new Map}}let s=new r},72645:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(62574),r=n(3073);n(84574);var s=n(78549);let l=e=>{let{loading:t}=e,n=(0,s.B)();return t?(0,a.jsxs)("div",{className:(0,r.A)("absolute left-1/2 -translate-x-1/2 transform text-center","top-4 pt-[calc(env(safe-area-inset-top)+64px)]"),role:"status",children:[(0,a.jsx)("span",{className:"loading loading-dots loading-lg"}),(0,a.jsx)("span",{className:"hidden",children:n("Loading...")})]}):null}},80239:e=>{e.exports={rE:"0.9.55"}},80913:(e,t,n)=>{n.d(t,{GV:()=>l,R1:()=>i,UT:()=>a,dv:()=>s,zp:()=>r});let a=e=>RegExp("[\\p{Script=Han}\\p{Script=Hiragana}\\p{Script=Katakana}\\p{Script=Hangul}]","u").test(null!=e?e:""),r=e=>!!e&&["zh","ja","ko"].includes(e.split("-")[0].toLowerCase()),s=e=>({en:"en-US",fr:"fr-FR",de:"de-DE",es:"es-ES",it:"it-IT",ja:"ja-JP",ko:"ko-KR",pt:"pt-PT",ar:"ar-SA",nl:"nl-NL",pl:"pl-PL",tr:"tr-TR",id:"id-ID",ru:"ru-RU",uk:"uk-UA",zh:"zh-Hans","zh-hans":"zh-Hans","zh-hant":"zh-Hant"})[e]||e,l=e=>{let t={"zh-CN":"zh-Hans","zh-TW":"zh-Hant","zh-HK":"zh-Hant"};return e.startsWith("zh")?t[e]||"zh-Hans":t[e]||e.split("-")[0].toLowerCase()},o=e=>e?e.split("-")[0].toLowerCase():"",i=(e,t)=>!!e&&!!t&&o(e)===o(t)},83090:(e,t,n)=>{n.d(t,{B6:()=>s,Bq:()=>l,WC:()=>r,e2:()=>o});var a=n(7269);let r=(e,t,n)=>new Promise((a,r)=>{let s=Date.now(),l=new XMLHttpRequest;l.open("PUT",t,!0),l.upload.onprogress=e=>{n&&e.lengthComputable&&n({progress:e.loaded,total:e.total,transferSpeed:e.loaded/((Date.now()-s)/1e3)})},l.onload=()=>{l.status>=200&&l.status<300?a():r(Error("Upload failed with status ".concat(l.status)))},l.onerror=()=>r(Error("Upload failed")),l.send(e)}),s=async(e,t)=>{let n=await fetch(e);if(!n.ok)throw Error("File download failed");let a=n.headers.get("Content-Length");if(!a)throw Error("Cannot track progress: Content-Length missing");let r=parseInt(a,10),s=0,l=n.body.getReader(),o=[],i=Date.now();for(;;){let{done:e,value:n}=await l.read();if(e)break;o.push(n),s+=n.length,t&&t({progress:s,total:r,transferSpeed:s/((Date.now()-i)/1e3)})}return new Blob(o)},l=async(e,t,n,r,s)=>{let l=new Uint32Array(1);window.crypto.getRandomValues(l);let o=l[0],i=new a.c3;return r&&(i.onmessage=r),await (0,a.lA)("upload_file",{id:o,url:e,filePath:t,method:n,headers:null!=s?s:{},onProgress:i})},o=async(e,t,n,r,s)=>{let l=new Uint32Array(1);window.crypto.getRandomValues(l);let o=l[0],i=new a.c3;n&&(i.onmessage=n),await (0,a.lA)("download_file",{id:o,url:e,filePath:t,headers:null!=r?r:{},onProgress:i,body:s})}},83703:(e,t,n)=>{n.d(t,{i:()=>r});var a=n(84574);let r=(e,t)=>{let n=(0,a.useRef)(!1),r=(0,a.useRef)(0),s=(0,a.useRef)(0),l=(0,a.useRef)(0),o=(0,a.useRef)(0),i=(0,a.useRef)(0);return{handleDragStart:(0,a.useCallback)(a=>{n.current=!0,"touches"in a?(s.current=a.touches[0].clientY,r.current=a.touches[0].clientX):(s.current=a.clientY,r.current=a.clientX),i.current=performance.now();let c=t=>{if(n.current){let n=0,a=0,r=0,s=0;if("touches"in t&&t.touches.length>0){let e=t.touches[0];r=e.clientX,s=e.clientY}else r=t.clientX,s=t.clientY;n=r-l.current,a=s-o.current,l.current=r,o.current=s,e({clientX:r,clientY:s,deltaX:n,deltaY:a})}},d=e=>{n.current=!1;let a=0,l=0,o=0,u=0,h=performance.now()-i.current;if("touches"in e){let t=e.changedTouches[0];o=t.clientX,u=t.clientY}else o=e.clientX,u=e.clientY;a=o-r.current;let m=(l=u-s.current)/h;t&&t({velocity:m,deltaT:h,clientX:o,clientY:u,deltaX:a,deltaY:l}),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",d)};window.addEventListener("mousemove",c,{passive:!0}),window.addEventListener("mouseup",d),window.addEventListener("touchmove",c,{passive:!0}),window.addEventListener("touchend",d)},[e,t])}}},85376:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(75972),r=n(58068),s=n(66763);let l=e=>"VolumeUp"===e||"VolumeDown"===e?s.I.dispatch("native-key-down",{keyName:e}):"Back"===e&&s.I.dispatchSync("native-key-down",{keyName:e}),o=(0,a.v)((e,t)=>({volumeKeysIntercepted:!1,backKeyIntercepted:!1,volumeKeysInterceptionCount:0,backKeyInterceptionCount:0,acquireVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:n}=t();0==n&&(window.onNativeKeyDown=l,(0,r.LB)({volumeKeys:!0}),e({volumeKeysIntercepted:!0})),e({volumeKeysInterceptionCount:n+1})},releaseVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:n}=t();n<=1?((0,r.LB)({volumeKeys:!1}),e({volumeKeysIntercepted:!1,volumeKeysInterceptionCount:0})):e({volumeKeysInterceptionCount:n-1})},acquireBackKeyInterception:()=>{let{backKeyInterceptionCount:n}=t();0==n&&(window.onNativeKeyDown=l,(0,r.LB)({backKey:!0}),e({backKeyIntercepted:!0})),e({backKeyInterceptionCount:n+1})},releaseBackKeyInterception:()=>{let{backKeyInterceptionCount:n}=t();n<=1?((0,r.LB)({backKey:!1}),e({backKeyIntercepted:!1,backKeyInterceptionCount:0})):e({backKeyInterceptionCount:n-1})}}))},91225:(e,t,n)=>{n.d(t,{A:()=>s,i:()=>r});var a=n(50981);let r=e=>{if(!e)return"auto";let t=new Set(["ar","he","fa","ur","dv","ps","sd","yi"]),n=e.split("-")[0].toLowerCase();return t.has(n)?"rtl":"auto"},s=()=>r((0,a.gl)())}}]);