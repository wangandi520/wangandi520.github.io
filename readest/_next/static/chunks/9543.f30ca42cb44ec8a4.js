"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9543],{19543:(t,e,i)=>{i.d(e,{TTS:()=>A});var n=i(96261),l=i(89657),r=i(49033),a=i(19780),s=i(25842);let h={XML:"http://www.w3.org/XML/1998/namespace",SSML:"http://www.w3.org/2001/10/synthesis"},o=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),u=t=>{var e;return t.lang||(null==t||null==(e=t.getAttributeNS)?void 0:e.call(t,h.XML,"lang"))||(t.parentElement?u(t.parentElement):null)},c=t=>{var e;return(null==t||null==(e=t.getAttributeNS)?void 0:e.call(t,h.XML,"lang"))||(t.parentElement?c(t.parentElement):null)},_=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"word",i=new Intl.Segmenter(t,{granularity:e}),n="word"===e;return function*(t,e){let l=t.join("").replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," "),r=0,a=-1,s=0,h=Array.from(i.segment(l)),o=[];for(let t=0;t<h.length;t++){var u;let e=h[t],i=h[t+1],n=e.segment.trim(),l=null==i||null==(u=i.segment)?void 0:u.trim(),r=/(?:^|\s)([A-Z][a-z]{1,5})\.$/.test(n),a=/^[A-Z]/.test(l||"");if(r&&a){let n={index:e.index,segment:e.segment+((null==i?void 0:i.segment)||""),isWordLike:!0};o.push(n),t++}else o.push(e)}for(let{index:i,segment:h,isWordLike:u}of o){if(n&&!u)continue;for(;s<=i;)s+=t[++a].length;let o=a,c=i-(s-t[a].length),_=i+h.length-1;if(_<l.length)for(;s<=_;)s+=t[++a].length;let d=a,m=_-(s-t[a].length)+1;yield[(r++).toString(),e(o,c,d,m)]}}},d=(t,e)=>{let i=document.implementation.createDocument(h.SSML,"speak"),{lang:n}=e;n&&i.documentElement.setAttributeNS(h.XML,"lang",n);let l=(t,e,n)=>{let r;if(!t)return;if(3===t.nodeType)return i.createTextNode(t.textContent);if(4===t.nodeType)return i.createCDATASection(t.textContent);if(1!==t.nodeType)return;let a=t.nodeName.toLowerCase();"foliate-mark"===a?(r=i.createElementNS(h.SSML,"mark")).setAttribute("name",t.dataset.name):"br"===a?r=i.createElementNS(h.SSML,"break"):("em"===a||"strong"===a)&&(r=i.createElementNS(h.SSML,"emphasis"));let s=t.lang||t.getAttributeNS(h.XML,"lang");s&&(r||(r=i.createElementNS(h.SSML,"lang")),r.setAttributeNS(h.XML,"lang",s));let o=t.getAttributeNS(h.SSML,"alphabet")||n;if(!r){let e=t.getAttributeNS(h.SSML,"ph");e&&(r=i.createElementNS(h.SSML,"phoneme"),o&&r.setAttribute("alphabet",o),r.setAttribute("ph",e))}r||(r=e);let u=t.firstChild;for(;u;){let t=l(u,r,o);t&&r!==t&&r.append(t),u=u.nextSibling}return r};return l(t.firstChild,i.documentElement,e.alphabet),i},m=(t,e,i)=>{let n=u(t.commonAncestorContainer),l=c(t.commonAncestorContainer),r=_(n,i),a=t.cloneContents(),s=[...e(t,r)];for(let[t,i]of[...e(a,r)]){let e=document.createElement("foliate-mark");e.dataset.name=t,i.insertNode(e)}return{entries:s,ssml:d(a,{lang:n,alphabet:l})}},g=t=>!t.toString().trim();var f=new WeakMap,p=new WeakMap,S=new WeakMap,v=new WeakMap;class b{current(){if((0,n._)(this,f)[(0,n._)(this,S)])return(0,n._)(this,v).call(this,(0,n._)(this,f)[(0,n._)(this,S)])}first(){if((0,n._)(this,f)[0])return(0,r._)(this,S,0),(0,n._)(this,v).call(this,(0,n._)(this,f)[0])}prev(){let t=(0,n._)(this,S)-1;if((0,n._)(this,f)[t])return(0,r._)(this,S,t),(0,n._)(this,v).call(this,(0,n._)(this,f)[t])}next(){let t=(0,n._)(this,S)+1;if((0,n._)(this,f)[t])return(0,r._)(this,S,t),(0,n._)(this,v).call(this,(0,n._)(this,f)[t]);for(;;){let{done:e,value:i}=(0,n._)(this,p).next();if(e)break;if((0,n._)(this,f).push(i),(0,n._)(this,f)[t])return(0,r._)(this,S,t),(0,n._)(this,v).call(this,(0,n._)(this,f)[t])}}find(t){let e=(0,n._)(this,f).findIndex(e=>t(e));if(e>-1)return(0,r._)(this,S,e),(0,n._)(this,v).call(this,(0,n._)(this,f)[e]);for(;;){let{done:e,value:i}=(0,n._)(this,p).next();if(e)break;if((0,n._)(this,f).push(i),t(i))return(0,r._)(this,S,(0,n._)(this,f).length-1),(0,n._)(this,v).call(this,i)}}constructor(t,e=t=>t){(0,l._)(this,f,{writable:!0,value:[]}),(0,l._)(this,p,{writable:!0,value:void 0}),(0,l._)(this,S,{writable:!0,value:-1}),(0,l._)(this,v,{writable:!0,value:void 0}),(0,r._)(this,p,t),(0,r._)(this,v,e)}}var w=new WeakMap,M=new WeakMap,k=new WeakMap,N=new WeakMap,E=new WeakSet,L=new WeakSet;class A{start(){var t;(0,r._)(this,k,null);let[e]=null!=(t=(0,n._)(this,w).first())?t:[];return e?(0,a._)(this,L,x).call(this,e,t=>(0,a._)(this,E,T).call(this,t,(0,n._)(this,k))):this.next()}resume(){var t;let[e]=null!=(t=(0,n._)(this,w).current())?t:[];return e?(0,a._)(this,L,x).call(this,e,t=>(0,a._)(this,E,T).call(this,t,(0,n._)(this,k))):this.next()}prev(t){var e;(0,r._)(this,k,null);let[i,l]=null!=(e=(0,n._)(this,w).prev())?e:[];return t&&l&&this.highlight(l.cloneRange()),(0,a._)(this,L,x).call(this,i)}next(t){var e;(0,r._)(this,k,null);let[i,l]=null!=(e=(0,n._)(this,w).next())?e:[];return t&&l&&this.highlight(l.cloneRange()),(0,a._)(this,L,x).call(this,i)}from(t){let e;(0,r._)(this,k,null);let[i]=(0,n._)(this,w).find(e=>0>=t.compareBoundaryPoints(Range.END_TO_START,e));for(let[i,l]of(0,n._)(this,M).entries())if(0>=t.compareBoundaryPoints(Range.START_TO_START,l)){e=i;break}return(0,a._)(this,L,x).call(this,i,t=>(0,a._)(this,E,T).call(this,t,e))}setMark(t){let e=(0,n._)(this,M).get(t);if(e)return(0,r._)(this,k,t),this.highlight(e.cloneRange()),e}constructor(t,e,i,n){(0,s._)(this,E),(0,s._)(this,L),(0,l._)(this,w,{writable:!0,value:void 0}),(0,l._)(this,M,{writable:!0,value:void 0}),(0,l._)(this,k,{writable:!0,value:void 0}),(0,l._)(this,N,{writable:!0,value:new XMLSerializer}),this.doc=t,this.highlight=i,(0,r._)(this,w,new b(function*(t){var e,i;let n,l=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);for(let e=l.nextNode();e;e=l.nextNode()){let i=e.tagName.toLowerCase();o.has(i)&&(n&&(n.setEndBefore(e),g(n)||(yield n)),(n=t.createRange()).setStart(e,0))}n||(n=t.createRange()).setStart(null!=(e=t.body.firstChild)?e:t.body,0),n.setEndAfter(null!=(i=t.body.lastChild)?i:t.body),g(n)||(yield n)}(t),t=>{let{entries:i,ssml:l}=m(t,e,n);return(0,r._)(this,M,new Map(i)),[l,t]}))}}function T(t,e){return e?t.querySelector('mark[name="'.concat(CSS.escape(e),'"')):null}function x(t,e){var i,l,r;if(!t)return;if(!e)return(0,n._)(this,N).serializeToString(t);let a=document.implementation.createDocument(h.SSML,"speak");a.documentElement.replaceWith(a.importNode(t.documentElement,!0));let s=null==(i=e(a))?void 0:i.previousSibling;for(;s;){let t=null!=(r=s.previousSibling)?r:null==(l=s.parentNode)?void 0:l.previousSibling;s.parentNode.removeChild(s),s=t}return(0,n._)(this,N).serializeToString(a)}}}]);