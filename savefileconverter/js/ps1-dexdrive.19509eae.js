"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[119],{2074:function(e,t,a){a.d(t,{Z:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("b-form-group",{scopedSlots:e._u([{key:"default",fn:function({ariaDescribedby:a}){return[t("b-form-radio-group",{staticClass:"radio-buttons",attrs:{options:e.options,"aria-describedby":a,buttons:"","button-variant":"outline-info"},model:{value:e.valueLocal,callback:function(t){e.valueLocal=t},expression:"valueLocal"}})]}}])})},i=[],n={name:"IndividualSavesOrMemoryCardSelector",props:{value:{type:String,default:null},individualSavesText:{type:String,default:"Individual saves"},memoryCardText:{type:String,default:"Memory card"}},model:{prop:"value",event:"change"},computed:{valueLocal:{get(){return this.value},set(e){this.$emit("change",e)}}},data(){return{options:[{value:"individual-saves",text:this.individualSavesText},{value:"memory-card",text:this.memoryCardText}]}}},s=n,o=a(1001),l=(0,o.Z)(s,r,i,!1,null,"725c0d84",null),c=l.exports},7784:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertPs1DexDrive")],1)},i=[],n=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("DexDrive")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.gme)",acceptExtension:".gme",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readDexDriveSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.dexDriveSaveData,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq&&"individual-saves"===this.individualSavesOrMemoryCard?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.individualSavesOrMemoryCardText))]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",["individual-saves"===this.individualSavesOrMemoryCard?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!0,helpText:"The filename for an individual save contains important information that the game needs to find this save data. Please do not modify it after downloading the save."},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1),t("individual-saves-or-memory-card-selector",{attrs:{value:this.individualSavesOrMemoryCard,individualSavesText:this.individualSavesText,memoryCardText:this.memoryCardText},on:{change:function(t){return e.changeIndividualSavesOrMemoryCard(t)}}})],1):t("div",["individual-saves"===this.individualSavesOrMemoryCard?t("div",[t("input-file",{ref:"inputFileEmulator",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0},on:{load:function(t){return e.readEmulatorSaveData(t)}}})],1):t("div",[t("input-file",{ref:"inputFileEmulatorMemcard",attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.mcr)",acceptExtension:".mcr",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readEmulatorMemcardSaveData(t)}}})],1),t("individual-saves-or-memory-card-selector",{attrs:{value:this.individualSavesOrMemoryCard,individualSavesText:this.individualSavesText,memoryCardText:this.memoryCardText},on:{change:function(t){return e.changeIndividualSavesOrMemoryCard(t)}}}),t("file-list",{attrs:{display:null!==this.dexDriveSaveData,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"ps1-dexdrive-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=ps1"}},[e._v("copy save files to and from a PS1 memory card")]),e._v("? ")],1),t("div",{staticClass:"help"},[e._v(" Help: how do IÂ "),t("b-link",{attrs:{href:"https://github.com/ShendoXT/memcardrex/releases"}},[e._v("copy files to and from my DexDrive")]),e._v("? ")],1)])],1)],1)],1)},s=[],o=a(3162),l=a(3313),c=a(1044),u=a(2405),d=a(5482),v=a(1302),m=a(2074),h=a(7327),f=(a(7658),a(3408),a(4590),a(3462),a(3767),a(8585),a(8696),a(5847));const D=3904,p="123-456-STD",S="US-ASCII",y=22,g=38,F="utf8",x=64,w=256;function b(e){return x+e*w}function C(e){const t=[],a=new TextDecoder(F);for(let r=0;r<f.Z.NUM_BLOCKS;r+=1){const i=b(r),n=e.slice(i,i+w);t.push(l.Z.trimNull(a.decode(n)).trim())}return t}class M{static createFromDexDriveData(e){return new M(e)}static createFromMemoryCardData(e,t){const a=f.Z.createFromPs1MemcardData(e),r=a.getSaveFiles().map((e=>({...e,comment:t})));return M.createFromSaveFiles(r)}static createFromSaveFiles(e){const t=f.Z.createFromSaveFiles(e),a=new ArrayBuffer(D),r=new Uint8Array(a),i=new TextEncoder(S),n=new TextEncoder(F),s=Array.from({length:f.Z.NUM_BLOCKS},(()=>null)),o=t.getSaveFiles().map(((t,a)=>({...t,comment:e[a].comment})));o.forEach((e=>{s[e.startingBlock]=e.comment})),r.fill(0),r.set(i.encode(p),0),r[18]=1,r[20]=1,r[21]=77;for(let l=0;l<f.Z.NUM_BLOCKS;l+=1){const e=t.getDirectoryFrame(l),a=new Uint8Array(e),i=a[f.Z.DIRECTORY_FRAME_AVAILABLE_OFFSET],o=a[f.Z.DIRECTORY_FRAME_NEXT_BLOCK_OFFSET];if(r[y+l]=i,r[g+l]=o,null!==s[l]){const e=n.encode(s[l]).slice(0,w);r.set(e,b(l))}}const c=l.Z.concatArrayBuffers([a,t.getArrayBuffer()]);return M.createFromDexDriveData(c)}constructor(e){this.arrayBuffer=e;let t=e.slice(0,D),a=e.slice(D);try{l.Z.checkMagic(t,0,p,S)}catch(i){if(e.byteLength===f.Z.TOTAL_SIZE)t=l.Z.getFilledArrayBuffer(D,0),a=e;else if(e.byteLength!==D+f.Z.TOTAL_SIZE)throw new Error("This does not appear to be a PS1 DexDrive file")}const r=C(t);this.memoryCard=f.Z.createFromPs1MemcardData(a),this.saveFiles=this.memoryCard.getSaveFiles().map((e=>({...e,comment:r[e.startingBlock]})))}getSaveFiles(){return this.saveFiles}getMemoryCard(){return this.memoryCard}getArrayBuffer(){return this.arrayBuffer}}(0,h.Z)(M,"NUM_BLOCKS",f.Z.NUM_BLOCKS);var T={name:"ConvertPs1DexDrive",data(){return{dexDriveSaveData:null,errorMessage:null,inputFilename:null,outputFilename:null,conversionDirection:"convertToRaw",selectedSaveData:null,individualSavesOrMemoryCard:"memory-card",individualSavesText:"Individual saves",memoryCardText:"Raw/emulator"}},components:{ConversionDirection:d.Z,InputFile:c.Z,OutputFilename:u.Z,FileList:v.Z,IndividualSavesOrMemoryCardSelector:m.Z},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData;return!this.dexDriveSaveData||0===this.dexDriveSaveData.getSaveFiles().length||!e||!this.outputFilename},individualSavesOrMemoryCardText(){return"individual-saves"===this.individualSavesOrMemoryCard?this.individualSavesText:this.memoryCardText}},methods:{changeIndividualSavesOrMemoryCard(e){this.individualSavesOrMemoryCard!==e&&(this.individualSavesOrMemoryCard=e,"convertToFormat"===this.conversionDirection?(this.selectedSaveData=null,this.dexDriveSaveData=null,this.outputFilename=null,this.$refs.inputFileEmulator&&this.$refs.inputFileEmulator.reset(),this.$refs.inputFileEmulatorMemcard&&this.$refs.inputFileEmulatorMemcard.reset()):"individual-saves"===e?null===this.selectedSaveData&&this.changeSelectedSaveData(0):(null!==this.inputFilename&&(this.outputFilename=l.Z.changeFilenameExtension(this.inputFilename,"mcr")),this.selectedSaveData=null))},getFileListNames(){return null!==this.dexDriveSaveData&&null!==this.dexDriveSaveData.getSaveFiles()?this.dexDriveSaveData.getSaveFiles().map((e=>({displayText:`${e.description} (${e.regionName})`}))):null},changeConversionDirection(e){this.conversionDirection=e,this.dexDriveSaveData=null,this.errorMessage=null,this.inputFilename=null,this.outputFilename=null,this.selectedSaveData=null,this.individualSavesOrMemoryCard="memory-card"},changeSelectedSaveData(e){null!==e&&(null!==this.dexDriveSaveData&&this.dexDriveSaveData.getSaveFiles().length>0?(this.selectedSaveData=e,this.outputFilename=this.dexDriveSaveData.getSaveFiles()[this.selectedSaveData].filename,this.changeIndividualSavesOrMemoryCard("individual-saves")):(this.selectedSaveData=null,this.outputFilename=null))},readDexDriveSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=e.filename;try{this.dexDriveSaveData=M.createFromDexDriveData(e.arrayBuffer),this.individualSavesOrMemoryCard=null,this.changeIndividualSavesOrMemoryCard("memory-card")}catch(t){this.errorMessage="File appears to not be in the correct format",this.dexDriveSaveData=null,this.selectedSaveData=null}},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=null;try{const t=e.map((e=>({filename:e.filename,rawData:e.arrayBuffer,comment:"Created with savefileconverter.com"})));this.dexDriveSaveData=M.createFromSaveFiles(t),this.dexDriveSaveData.getSaveFiles().length>0?this.outputFilename=`${l.Z.convertDescriptionToFilename(this.dexDriveSaveData.getSaveFiles()[0].description)}.gme`:this.outputFilename="output.gme"}catch(t){this.errorMessage=t.message,this.dexDriveSaveData=null,this.selectedSaveData=null}},readEmulatorMemcardSaveData(e){this.errorMessage=null,this.selectedSaveData=null,this.inputFilename=e.filename,this.outputFilename=l.Z.changeFilenameExtension(e.filename,"gme");try{this.dexDriveSaveData=M.createFromMemoryCardData(e.arrayBuffer,"Created with savefileconverter.com"),this.changeIndividualSavesOrMemoryCard("memory-card")}catch(t){this.errorMessage="File appears to not be in the correct format",this.dexDriveSaveData=null,this.selectedSaveData=null}},convertFile(){let e=null;e="convertToRaw"===this.conversionDirection?"individual-saves"===this.individualSavesOrMemoryCard?this.dexDriveSaveData.getSaveFiles()[this.selectedSaveData].rawData:this.dexDriveSaveData.getMemoryCard().getArrayBuffer():this.dexDriveSaveData.getArrayBuffer();const t=new Blob([e],{type:"application/octet-stream"});(0,o.saveAs)(t,this.outputFilename)}}},_=T,A=a(1001),E=(0,A.Z)(_,n,s,!1,null,"3a77c970",null),Z=E.exports,O={name:"Ps1DexDriveView",components:{ConvertPs1DexDrive:Z}},B=O,U=(0,A.Z)(B,r,i,!1,null,null,null),I=U.exports},5847:function(e,t,a){a.d(t,{Z:function(){return N}});var r=a(7327),i=(a(3408),a(4590),a(3462),a(3767),a(8585),a(8696),a(7658),a(3313));const n="US-ASCII",s=15,o=8192,l=128,c=!0,u="MC",d=0,v=8,m=65535,h=10,f=20,D="US-ASCII",p=4,S=160,y=81,g=82,F=83,x=255,w="SC",b=4,C=64,M="shift-jis";function T(e){const t=e.charAt(0);if("B"===t){const t=e.charAt(1);if("I"===t)return"Japan";if("A"===t)return"North America";if("E"===t)return"Europe"}return"Unknown region"}function _(e){return e.replace(/[\uff01-\uff5e]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/\u3000/g," ")}function A(e,t){const a=l+t*l;return e.slice(a,a+l)}function E(e,t){const a=o*t;return e.slice(a,a+o)}function Z(e){if(i.Z.checkMagic(e.rawData,0,w,n),e.rawData.byteLength<=0)throw new Error(`File ${e.filename} does not contain any data`);if(e.rawData.byteLength%o!==0)throw new Error(`File ${e.filename} size must be a multiple of ${o} bytes`)}function O(e){const t=new Uint8Array(e);return t.reduce(((e,t)=>e^t))}function B(e,t){return t.encode(e).slice(0,f)}function U(){const e=new ArrayBuffer(l),t=new Uint8Array(e);return t.fill(0),t[0]=u.charCodeAt(0),t[1]=u.charCodeAt(1),t[l-1]=O(e),e}function I(){const e=new ArrayBuffer(l),t=new Uint8Array(e),a=new DataView(e);return t.fill(0),a.setUint8(d,S),a.setUint16(v,m,c),a.setUint8(l-1,O(e)),e}function L(){return new ArrayBuffer(o)}function R(){const e=new ArrayBuffer(l),t=new Uint8Array(e),a=new DataView(e);return t.fill(0),a.setUint8(d+0,x),a.setUint8(d+1,x),a.setUint8(d+2,x),a.setUint8(d+3,x),a.setUint16(v,m,c),e}function k(){const e=new ArrayBuffer(l),t=new Uint8Array(e);return t.fill(0),e}function $(e,t,a){const r=e.rawData.byteLength/o;let i=!1,n=0;r>=2&&(i=!0,n=r-2);const s=[];let u=t;{const t=k(),i=new Uint8Array(t),n=new DataView(t),o=B(e.filename,a);n.setUint8(d,y),n.setUint32(p,e.rawData.byteLength,c),n.setUint16(v,r>1?u+1:m,c),i.set(o,h),n.setUint8(l-1,O(t)),s.push(t)}for(let o=0;o<n;o+=1){u+=1;const e=k(),t=new DataView(e);t.setUint8(d,g),t.setUint16(v,u+1,c),t.setUint8(l-1,O(e)),s.push(e)}if(i){const e=k(),t=new DataView(e);t.setUint8(d,F),t.setUint16(v,m,c),t.setUint8(l-1,O(e)),s.push(e)}const f=[];for(let l=0;l<r;l+=1)f.push(e.rawData.slice(l*o,(l+1)*o));return{directoryFrames:s,saveBlocks:f}}class N{static encodeFilename(e,t){return B(e,t)}static createFromPs1MemcardData(e){return new N(e)}static createFromSaveFiles(e){e.forEach((e=>Z(e)));const t=e.reduce(((e,t)=>e+t.filesize));if(t>s*o)throw new Error(`Total size of files is ${t} bytes (${t/o} blocks) but max size is ${s*o} bytes (${s} blocks)`);const a=[],r=[],n=new TextEncoder(D);a.push(U()),e.forEach((e=>{const t=$(e,a.length-1,n);a.push(...t.directoryFrames),r.push(...t.saveBlocks)}));while(a.length<s+1)a.push(I()),r.push(L());while(a.length<o/l)a.push(R());const c=i.Z.concatArrayBuffers(a);r.unshift(c);const u=i.Z.concatArrayBuffers(r);return new N(u)}constructor(e){this.arrayBuffer=e;const t=e.slice(0,o),a=e.slice(o,o*(s+1));i.Z.checkMagic(t,0,u,n);const r=new TextDecoder(D),l=new TextDecoder(M);this.saveFiles=[];for(let o=0;o<s;o+=1){let e=A(t,o),s=new DataView(e);const u=s.getUint8(d);if((240&u)!==S&&u!==x&&u===y){const u=i.Z.trimNull(r.decode(e.slice(h,h+f))),d=T(u),D=s.getUint32(p,c),S=[E(a,o)];i.Z.checkMagic(S[0],0,w,n);const y=_(i.Z.trimNull(l.decode(S[0].slice(b,b+C))));let g=s.getUint16(v,c);while(g!==m)S.push(E(a,g)),e=A(t,g),s=new DataView(e),g=s.getUint16(v,c);const F=i.Z.concatArrayBuffers(S);if(F.byteLength!==D)throw new Error(`Save file appears to be corrupted: expected file ${y} to be ${D} bytes, but was actually ${F.byteLength} bytes`);this.saveFiles.push({startingBlock:o,filename:u,regionName:d,description:y,rawData:F})}}}getDirectoryFrame(e){const t=this.arrayBuffer.slice(0,o);return A(t,e)}getSaveFiles(){return this.saveFiles}getArrayBuffer(){return this.arrayBuffer}}(0,r.Z)(N,"NUM_BLOCKS",s),(0,r.Z)(N,"FRAME_SIZE",l),(0,r.Z)(N,"TOTAL_SIZE",(s+1)*o),(0,r.Z)(N,"DIRECTORY_FRAME_AVAILABLE_OFFSET",d),(0,r.Z)(N,"DIRECTORY_FRAME_NEXT_BLOCK_OFFSET",v),(0,r.Z)(N,"DIRECTORY_FRAME_FIRST_LINK_BLOCK",y)},7327:function(e,t,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function n(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)}function s(e,t,a){return t=n(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return s}})}}]);