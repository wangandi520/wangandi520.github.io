"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7216],{27216:(e,t,i)=>{i.r(t),i.d(t,{Paginator:()=>C});let r=e=>new Promise(t=>setTimeout(t,e)),s=(e,t,i)=>{let r;return(...s)=>{let n=i&&!r;r&&clearTimeout(r),r=setTimeout(()=>{r=null,i||e(...s)},t),n&&e(...s)}},n=(e,t,i)=>i*(t-e)+e,o=e=>1-(1-e)*(1-e),a=(e,t,i,r,s)=>new Promise(o=>{let a,l=h=>{a??=h;let c=Math.min(1,(h-a)/i);s(n(e,t,r(c))),c<1?requestAnimationFrame(l):o()};requestAnimationFrame(l)}),l=e=>{if(!e?.collapsed)return e;let{endOffset:t,endContainer:i}=e;if(1===i.nodeType){let e=i.childNodes[t];return e?.nodeType===1?e:i}if(t+1<i.length)e.setEnd(i,t+1);else{if(!(t>1))return i.parentNode;e.setStart(i,t-1)}return e},h=(e,t,i,r=i)=>{let s=e.createRange();return s.setStart(t,i),s.setEnd(t,r),s},c=(e,t,i,r=0,s=t.nodeValue.length)=>{if(s-r==1)return 0>i(h(e,t,r),h(e,t,s))?r:s;let n=Math.floor(r+(s-r)/2),o=i(h(e,t,r,n),h(e,t,n,s));return o<0?c(e,t,i,r,n):o>0?c(e,t,i,n,s):n},{SHOW_ELEMENT:d,SHOW_TEXT:u,SHOW_CDATA_SECTION:m,FILTER_ACCEPT:g,FILTER_REJECT:p,FILTER_SKIP:v}=NodeFilter,f=d|u|m,y=e=>{let t=1/0,i=-1/0,r=1/0,s=-1/0;for(let n of e.getClientRects())r=Math.min(r,n.left),t=Math.min(t,n.top),i=Math.max(i,n.right),s=Math.max(s,n.bottom);return new DOMRect(r,t,i-r,s-t)},x=(e,t,i,r)=>{let s=e.createTreeWalker(e.body,f,{acceptNode:s=>{let n=s.localName?.toLowerCase();if("script"===n||"style"===n)return p;if(1===s.nodeType){let{left:e,right:n}=r(s.getBoundingClientRect());if(n<t||e>i)return p;if(e>=t&&n<=i)return g}else{if(!s.nodeValue?.trim())return v;let n=e.createRange();n.selectNodeContents(s);let{left:o,right:a}=r(n.getBoundingClientRect());if(a>=t&&o<=i)return g}return v}}),n=[];for(let e=s.nextNode();e;e=s.nextNode())n.push(e);let o=n[0]??e.body,a=n[n.length-1]??o,l=1===o.nodeType?0:c(e,o,(e,i)=>{let s=r(y(e)),n=r(y(i));return s.right<t&&n.left>t?0:n.left>t?-1:1}),h=1===a.nodeType?0:c(e,a,(e,t)=>{let s=r(y(e)),n=r(y(t));return s.right<i&&n.left>i?0:n.left>i?-1:1}),d=e.createRange();return d.setStart(o,l),d.setEnd(a,h),d},w=e=>{let t=document.createRange();return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.collapsed},b=(e,t)=>{let i;if(e.startContainer?i=e.cloneRange():e.nodeType&&(i=document.createRange()).selectNode(e),i){let e=i.startContainer.ownerDocument.defaultView.getSelection();e&&(e.removeAllRanges(),-1===t?i.collapse(!0):1===t&&i.collapse(),e.addRange(i))}},T=e=>{let{defaultView:t}=e,{writingMode:i,direction:r}=t.getComputedStyle(e.body);return{vertical:"vertical-rl"===i||"vertical-lr"===i,rtl:"rtl"===e.body.dir||"rtl"===r||"rtl"===e.documentElement.dir}},E=e=>{let t=e.defaultView.getComputedStyle(e.body);return"rgba(0, 0, 0, 0)"===t.backgroundColor&&"none"===t.backgroundImage?e.defaultView.getComputedStyle(e.documentElement).background:t.background},k=(e,t)=>Array.from({length:e},()=>{let e=document.createElement("div"),i=document.createElement("div");return e.append(i),i.setAttribute("part",t),e}),S=(e,t)=>{let{style:i}=e;for(let[e,r]of Object.entries(t))i.setProperty(e,r,"important")};class z{#e=new ResizeObserver(()=>this.expand());#t=document.createElement("div");#i=document.createElement("iframe");#r=document.createRange();#s;#n=!1;#o=!1;#a=!0;#l;#h={};constructor({container:e,onExpand:t}){this.container=e,this.onExpand=t,this.#i.setAttribute("part","filter"),this.#t.append(this.#i),Object.assign(this.#t.style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(this.#i.style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),this.#i.setAttribute("sandbox","allow-same-origin allow-scripts"),this.#i.setAttribute("scrolling","no")}get element(){return this.#t}get document(){return this.#i.contentDocument}async load(e,t,i,r){if("string"!=typeof e)throw Error(`${e} is not string`);return new Promise(s=>{this.#i.addEventListener("load",()=>{let e=this.document;i?.(e),this.#i.style.display="block";let{vertical:t,rtl:n}=T(e);this.docBackground=E(e),e.body.style.background="none";let o=this.docBackground;this.#i.style.display="none",this.#n=t,this.#o=n,this.#r.selectNodeContents(e.body);let a=r?.({vertical:t,rtl:n,background:o});this.#i.style.display="block",this.render(a),this.#e.observe(e.body),e.fonts.ready.then(()=>this.expand()),s()},{once:!0}),t?this.#i.srcdoc=t:this.#i.src=e})}render(e){e&&this.document&&(this.#a="scrolled"!==e.flow,this.#h=e,this.#a?this.columnize(e):this.scrolled(e))}scrolled({margin:e,gap:t,columnWidth:i}){let r=this.#n,s=this.document;S(s.documentElement,{"box-sizing":"border-box",padding:r?`${1.5*e}px ${t}px`:`0 ${t}px`,"column-width":"auto",height:"auto",width:"auto"}),S(s.body,{[r?"max-height":"max-width"]:`${i}px`,margin:"auto"}),this.setImageSize(),this.expand()}columnize({width:e,height:t,margin:i,gap:r,columnWidth:s}){let n=this.#n;this.#l=n?t:e;let o=this.document;S(o.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(s)}px`,"column-gap":n?`${i}px`:`${r}px`,"column-fill":"auto",...n?{width:`${e}px`}:{height:`${t}px`},padding:n?`${i/2}px ${r}px`:`0 ${r/2}px`,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced"}),S(o.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){let{width:e,height:t,margin:i}=this.#h,r=this.#n,s=this.document;for(let n of s.body.querySelectorAll("img, svg, video")){let{maxHeight:o,maxWidth:a}=s.defaultView.getComputedStyle(n);S(n,{"max-height":r?"none"!==o&&"0px"!==o?o:"100%":`${t-2*i}px`,"max-width":r?`${e-2*i}px`:"none"!==a&&"0px"!==a?a:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}expand(){let{documentElement:e}=this.document;if(this.#a){let t=this.#n?"height":"width",i=this.#n?"width":"height",r=this.#r.getBoundingClientRect(),s=e.getBoundingClientRect(),n=Math.ceil(((this.#n?0:this.#o?s.right-r.right:r.left-s.left)+r[t])/this.#l)*this.#l;this.#t.style.padding="0",this.#i.style[t]=`${n}px`,this.#t.style[t]=`${n+2*this.#l}px`,this.#i.style[i]="100%",this.#t.style[i]="100%",e.style[t]=`${this.#l}px`,this.#s&&(this.#s.element.style.margin="0",this.#s.element.style.left=this.#n?"0":`${this.#l}px`,this.#s.element.style.top=this.#n?`${this.#l}px`:"0",this.#s.element.style[t]=`${n}px`,this.#s.redraw())}else{let t=this.#n?"width":"height",i=this.#n?"height":"width",r=e.getBoundingClientRect()[t],{margin:s,gap:n}=this.#h,o=this.#n?`0 ${n}px`:`${s}px 0`;this.#t.style.padding=o,this.#i.style[t]=`${r}px`,this.#t.style[t]=`${r}px`,this.#i.style[i]="100%",this.#t.style[i]="100%",this.#s&&(this.#s.element.style.margin=o,this.#s.element.style.left="0",this.#s.element.style.top="0",this.#s.element.style[t]=`${r}px`,this.#s.redraw())}this.onExpand()}set overlayer(e){this.#s=e,this.#t.append(e.element)}get overlayer(){return this.#s}destroy(){this.document&&this.#e.unobserve(this.document.body)}}class C extends HTMLElement{static observedAttributes=["flow","gap","margin","max-inline-size","max-block-size","max-column-count"];#c=this.attachShadow({mode:"open"});#e=new ResizeObserver(()=>this.render());#d;#u;#m;#g;#p;#v;#n=!1;#o=!1;#f=0;#y=-1;#x=0;#w=!1;#b=!1;#T;#E=new WeakMap;#k=matchMedia("(prefers-color-scheme: dark)");#S;#z;#C;#_;#R;constructor(){super(),this.#c.innerHTML=`<style>
        :host {
            display: block;
            container-type: size;
        }
        :host, #top {
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #top {
            --_gap: 7%;
            --_margin: 48px;
            --_max-inline-size: 720px;
            --_max-block-size: 1440px;
            --_max-column-count: 2;
            --_max-column-count-portrait: 1;
            --_max-column-count-spread: var(--_max-column-count);
            --_half-gap: calc(var(--_gap) / 2);
            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            --_max-height: var(--_max-block-size);
            display: grid;
            grid-template-columns:
                minmax(var(--_half-gap), 1fr)
                var(--_half-gap)
                minmax(0, calc(var(--_max-width) - var(--_gap)))
                var(--_half-gap)
                minmax(var(--_half-gap), 1fr);
            grid-template-rows:
                minmax(var(--_margin), 1fr)
                minmax(0, var(--_max-height))
                minmax(var(--_margin), 1fr);
            &.vertical {
                --_max-column-count-spread: var(--_max-column-count-portrait);
                --_max-width: var(--_max-block-size);
                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            }
            @container (orientation: portrait) {
                & {
                    --_max-column-count-spread: var(--_max-column-count-portrait);
                }
                &.vertical {
                    --_max-column-count-spread: var(--_max-column-count);
                }
            }
        }
        #background {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
        }
        #container {
            grid-column: 2 / 5;
            grid-row: 2;
            overflow: hidden;
        }
        :host([flow="scrolled"]) #container {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            overflow: auto;
        }
        #header {
            grid-column: 3 / 4;
            grid-row: 1;
        }
        #footer {
            grid-column: 3 / 4;
            grid-row: 3;
            align-self: end;
        }
        #header, #footer {
            display: grid;
            height: var(--_margin);
        }
        :is(#header, #footer) > * {
            display: flex;
            align-items: center;
            min-width: 0;
        }
        :is(#header, #footer) > * > * {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            text-align: center;
            font-size: .75em;
            opacity: .6;
        }
        </style>
        <div id="top">
            <div id="background" part="filter"></div>
            <div id="header"></div>
            <div id="container" part="container"></div>
            <div id="footer"></div>
        </div>
        `,this.#d=this.#c.getElementById("top"),this.#u=this.#c.getElementById("background"),this.#m=this.#c.getElementById("container"),this.#g=this.#c.getElementById("header"),this.#p=this.#c.getElementById("footer"),this.#e.observe(this.#m),this.#m.addEventListener("scroll",()=>this.dispatchEvent(new Event("scroll"))),this.#m.addEventListener("scroll",s(()=>{this.scrolled&&(this.#w?this.#w=!1:this.#M("scroll"))},250));let e={passive:!1};this.addEventListener("touchstart",this.#P.bind(this),e),this.addEventListener("touchmove",this.#A.bind(this),e),this.addEventListener("touchend",this.#B.bind(this)),this.addEventListener("load",({detail:{doc:t}})=>{t.addEventListener("touchstart",this.#P.bind(this),e),t.addEventListener("touchmove",this.#A.bind(this),e),t.addEventListener("touchend",this.#B.bind(this))}),this.addEventListener("relocate",({detail:e})=>{"selection"===e.reason?b(this.#x,0):"navigation"===e.reason&&(1===this.#x?b(e.range,1):"number"==typeof this.#x?b(e.range,-1):b(this.#x,-1))});let t=s((e,t)=>{if(!t.rangeCount)return;let i=t.getRangeAt(0),r=w(t);r&&0>i.compareBoundaryPoints(Range.START_TO_START,e)?this.prev():!r&&i.compareBoundaryPoints(Range.END_TO_END,e)>0&&this.next()},700);this.addEventListener("load",({detail:{doc:e}})=>{let i=!1;e.addEventListener("pointerdown",()=>i=!0),e.addEventListener("pointerup",()=>i=!1);let r=!1;e.addEventListener("keydown",()=>r=!0),e.addEventListener("keyup",()=>r=!1),e.addEventListener("selectionchange",()=>{if(this.scrolled)return;let s=this.#R;if(!s)return;let n=e.getSelection();if(n.rangeCount){if(!i&&i&&"Range"===n.type)t(s,n);else if(r){let e=n.getRangeAt(0).cloneRange();w(n)||e.collapse(),this.#L(e)}}}),e.addEventListener("focusin",e=>{if(this.scrolled)return null;this.#m&&this.#m.contains(e.target)&&requestAnimationFrame(()=>this.#L(e.target))})}),this.#S=()=>{this.#v&&this.#$(this.#v.docBackground,this.columnCount)},this.#k.addEventListener("change",this.#S)}attributeChangedCallback(e,t,i){switch(e){case"flow":this.render();break;case"gap":case"margin":case"max-block-size":case"max-column-count":case"max-inline-size":this.#d.style.setProperty("--_"+e,i),this.render()}}open(e){this.bookDir=e.dir,this.sections=e.sections,e.transformTarget?.addEventListener("data",({detail:e})=>{"text/css"===e.type&&(e.data=Promise.resolve(e.data).then(e=>e.replace(/(?<=[{\s;])-epub-/gi,"").replace(/page-break-(after|before|inside)\s*:/gi,(e,t)=>`-webkit-column-break-${t}:`).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,(e,t,i)=>`break-${t}: ${i??""}column`)))})}#V(){return this.#v&&(this.#v.destroy(),this.#m.removeChild(this.#v.element)),this.#v=new z({container:this,onExpand:()=>this.#L(this.#x)}),this.#m.append(this.#v.element),this.#v}#$(e,t){let i=this.#v?.document;if(!i)return;let r=i.defaultView.getComputedStyle(i.documentElement),s=r.getPropertyValue("--theme-bg-color"),n="dark"===r.getPropertyValue("color-scheme");if(e&&s){let t=e.split(/\s(?=(?:url|rgb|hsl|#[0-9a-fA-F]{3,6}))/);n&&(t[0]=s),e=t.join(" ")}/cover.*fixed|fixed.*cover/.test(e)&&(e=e.replace("cover","auto 100%").replace("fixed","")),this.#u.innerHTML="",this.#u.style.display="grid",this.#u.style.gridTemplateColumns=`repeat(${t}, 1fr)`;for(let i=0;i<t;i++){let t=document.createElement("div");t.style.background=e,t.style.width="100%",t.style.height="100%",this.#u.appendChild(t)}}#I({vertical:e,rtl:t,background:i}){this.#n=e,this.#o=t,this.#d.classList.toggle("vertical",e);let{width:r,height:s}=this.#m.getBoundingClientRect(),n=e?s:r,o=getComputedStyle(this.#d),a=parseFloat(o.getPropertyValue("--_max-inline-size")),l=parseInt(o.getPropertyValue("--_max-column-count-spread")),h=parseFloat(o.getPropertyValue("--_margin"));this.#f=h;let c=parseFloat(o.getPropertyValue("--_gap"))/100,d=-c/(c-1)*n,u=this.getAttribute("flow");if("scrolled"===u)return this.setAttribute("dir",e?"rtl":"ltr"),this.#d.style.padding="0",this.heads=null,this.feet=null,this.#g.replaceChildren(),this.#p.replaceChildren(),{flow:u,margin:h,gap:d,columnWidth:a};let m=Math.min(l,Math.ceil(n/a)),g=e?n/m-h:n/m-d;this.setAttribute("dir",t?"rtl":"ltr"),this.columnCount=m,this.#$(i,this.columnCount);let p=e?Math.min(2,Math.ceil(r/a)):m,v={gridTemplateColumns:`repeat(${p}, 1fr)`,gap:`${d}px`,direction:"rtl"===this.bookDir?"rtl":"ltr"};Object.assign(this.#g.style,v),Object.assign(this.#p.style,v);let f=k(p,"head"),y=k(p,"foot");return this.heads=f.map(e=>e.children[0]),this.feet=y.map(e=>e.children[0]),this.#g.replaceChildren(...f),this.#p.replaceChildren(...y),{height:s,width:r,margin:h,gap:d,columnWidth:g}}render(){this.#v&&(this.#v.render(this.#I({vertical:this.#n,rtl:this.#o,background:this.#v.docBackground})),this.#L(this.#x))}get scrolled(){return"scrolled"===this.getAttribute("flow")}get scrollProp(){let{scrolled:e}=this;return this.#n?e?"scrollLeft":"scrollTop":e?"scrollTop":"scrollLeft"}get sideProp(){let{scrolled:e}=this;return this.#n?e?"width":"height":e?"height":"width"}get size(){return this.#m.getBoundingClientRect()[this.sideProp]}get viewSize(){return this.#v&&this.#v.element?this.#v.element.getBoundingClientRect()[this.sideProp]:0}get start(){return Math.abs(this.#m[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}get containerPosition(){return this.#m[this.scrollProp]}set containerPosition(e){this.#m[this.scrollProp]=e}scrollBy(e,t){let i=this.#n?t:e,[r,s,n]=this.#z,o=this.#o;this.containerPosition=Math.max(o?r-n:r-s,Math.min(o?r+s:r+n,this.containerPosition+i))}snap(e,t){let i=this.#n?t:e,[r,s,n]=this.#z,{start:o,end:a,pages:l,size:h}=this,c=Math.abs(r)-s,d=Math.abs(r)+n,u=i*(this.#o?-h:h),m=Math.floor(Math.max(c,Math.min(d,(o+a)/2+(isNaN(u)?0:u)))/h);this.#N(m,"snap").then(()=>{let e=m<=0?-1:m>=l-1?1:null;if(e)return this.#j({index:this.#F(e),anchor:e<0?()=>1:()=>0})})}#P(e){let t=e.changedTouches[0];this.#C={x:t?.screenX,y:t?.screenY,t:e.timeStamp,vx:0,xy:0}}#A(e){let t=this.#C;if(t.pinched||(t.pinched=globalThis.visualViewport.scale>1,this.scrolled||t.pinched))return;if(e.touches.length>1){this.#_&&e.preventDefault();return}let i=this.#v?.document,r=i?.getSelection();if(r&&r.rangeCount>0&&!r.isCollapsed)return;e.preventDefault();let s=e.changedTouches[0],n=s.screenX,o=s.screenY,a=t.x-n,l=t.y-o,h=e.timeStamp-t.t;t.x=n,t.y=o,t.t=e.timeStamp,t.vx=a/h,t.vy=l/h,this.#_=!0,Math.abs(a)>=Math.abs(l)?this.scrollBy(a,0):Math.abs(l)>Math.abs(a)&&this.scrollBy(0,l)}#B(){this.#_=!1,this.scrolled||requestAnimationFrame(()=>{1===globalThis.visualViewport.scale&&this.snap(this.#C.vx,this.#C.vy)})}#O(){if(this.scrolled){let e=this.viewSize,t=this.#f;return this.#n?({left:i,right:r})=>({left:e-r-t,right:e-i-t}):({top:e,bottom:i})=>({left:e+t,right:i+t})}let e=this.pages*this.size;return this.#o?({left:t,right:i})=>({left:e-i,right:e-t}):this.#n?({top:e,bottom:t})=>({left:e,right:t}):e=>e}async #D(e,t){if(this.scrolled){let i=this.#O()(e).left-this.#f;return"selection"===t&&this.start<i&&i<this.start+this.size?this.#Q(this.start,t):this.#Q(i,t)}let i=this.#O()(e).left;return this.#N(Math.floor(i/this.size)+(this.#o?-1:1),t)}async #Q(e,t,i){let{size:r}=this;if(this.containerPosition===e){this.#z=[e,this.atStart?0:r,this.atEnd?0:r],this.#M(t);return}if(this.scrolled&&this.#n&&(e=-e),("snap"===t||i)&&this.hasAttribute("animated"))return a(this.containerPosition,e,300,o,e=>this.containerPosition=e).then(()=>{this.#z=[e,this.atStart?0:r,this.atEnd?0:r],this.#M(t)});this.containerPosition=e,this.#z=[e,this.atStart?0:r,this.atEnd?0:r],this.#M(t)}async #N(e,t,i){let r=this.size*(this.#o?-e:e);return this.#Q(r,t,i)}async scrollToAnchor(e,t){return this.#L(e,t?"selection":"navigation")}async #L(e,t="anchor"){this.#x=e;let i=l(e)?.getClientRects?.();if(i){let e=Array.from(i).find(e=>e.width>0&&e.height>0)||i[0];if(!e)return;await this.#D(e,t);return}if(this.scrolled)return void await this.#Q(e*this.viewSize,t);let{pages:r}=this;if(!r)return;let s=Math.round(e*(r-2-1));await this.#N(s+1,t)}#q(){if(this.scrolled)return x(this.#v.document,this.start+this.#f,this.end-this.#f,this.#O());let e=this.#o?-this.size:this.size;return x(this.#v.document,this.start-e,this.end-e,this.#O())}#M(e){let t=this.#q();this.#R=t,"selection"!==e&&"navigation"!==e&&"anchor"!==e?this.#x=t:this.#w=!0;let i={reason:e,range:t,index:this.#y};if(this.scrolled)i.fraction=this.start/this.viewSize;else if(this.pages>0){let{page:e,pages:t}=this;this.#g.style.visibility=e>1?"visible":"hidden",i.fraction=(e-1)/(t-2),i.size=1/(t-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:i}))}async #G(e){let{index:t,src:i,data:r,anchor:s,onLoad:n,select:o}=await e;this.#y=t;let a=this.#v?.document?.hasFocus();if(i){let e=this.#V(),s=this.#I.bind(this);await e.load(i,r,e=>{if(e.head){let t=e.createElement("style");e.head.prepend(t);let i=e.createElement("style");e.head.append(i),this.#E.set(e,[t,i])}n?.({doc:e,index:t})},s),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:e.document,index:t,attach:t=>e.overlayer=t}})),this.#v=e}await this.scrollToAnchor(("function"==typeof s?s(this.#v.document):s)??0,o),a&&this.focusView()}#H(e){return e>=0&&e<=this.sections.length-1}async #j({index:e,anchor:t,select:i}){if(e===this.#y)await this.#G({index:e,anchor:t,select:i});else{let r=this.#y,s=e=>{this.sections[r]?.unload?.(),this.setStyles(this.#T),this.dispatchEvent(new CustomEvent("load",{detail:e}))};await this.#G(Promise.resolve(this.sections[e].load()).then(async r=>{let n=await this.sections[e].loadContent?.();return{index:e,src:r,data:n,anchor:t,onLoad:s,select:i}}).catch(t=>(console.warn(t),console.warn(Error(`Failed to load section ${e}`)),{})))}}async goTo(e){if(this.#b)return;let t=await e;if(this.#H(t.index))return this.#j(t)}#W(e){if(!this.#v)return!0;if(this.scrolled)return this.start>0?this.#Q(Math.max(0,this.start-(e??this.size)),null,!0):!this.atStart;if(this.atStart)return;let t=this.page-1;return this.#N(t,"page",!0).then(()=>t<=0)}#X(e){if(!this.#v)return!0;if(this.scrolled)return this.viewSize-this.end>2?this.#Q(Math.min(this.viewSize,e?this.start+e:this.end),null,!0):!this.atEnd;if(this.atEnd)return;let t=this.page+1,i=this.pages;return this.#N(t,"page",!0).then(()=>t>=i-1)}get atStart(){return null==this.#F(-1)&&this.page<=1}get atEnd(){return null==this.#F(1)&&this.page>=this.pages-2}#F(e){for(let t=this.#y+e;this.#H(t);t+=e)if(this.sections[t]?.linear!=="no")return t}async #Y(e,t){if(this.#b)return;this.#b=!0;let i=-1===e,s=await (i?this.#W(t):this.#X(t));s&&await this.#j({index:this.#F(e),anchor:i?()=>1:()=>0}),(s||!this.hasAttribute("animated"))&&await r(100),this.#b=!1}async prev(e){return await this.#Y(-1,e)}async next(e){return await this.#Y(1,e)}prevSection(){return this.goTo({index:this.#F(-1)})}nextSection(){return this.goTo({index:this.#F(1)})}firstSection(){let e=this.sections.findIndex(e=>"no"!==e.linear);return this.goTo({index:e})}lastSection(){let e=this.sections.findLastIndex(e=>"no"!==e.linear);return this.goTo({index:e})}getContents(){return this.#v?[{index:this.#y,overlayer:this.#v.overlayer,doc:this.#v.document}]:[]}setStyles(e){this.#T=e;let t=this.#E.get(this.#v?.document);if(!t)return;let[i,r]=t;if(Array.isArray(e)){let[t,s]=e;i.textContent=t,r.textContent=s}else r.textContent=e;requestAnimationFrame(()=>{this.#$(this.#v.docBackground,this.columnCount)}),this.#v?.document?.fonts?.ready?.then(()=>this.#v.expand())}focusView(){this.#v.document.defaultView.focus()}destroy(){this.#e.unobserve(this),this.#v.destroy(),this.#v=null,this.sections[this.#y]?.unload?.(),this.#k.removeEventListener("change",this.#S)}}customElements.define("foliate-paginator",C)}}]);