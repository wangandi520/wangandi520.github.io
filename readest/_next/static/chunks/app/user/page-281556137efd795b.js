(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1584],{4172:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return o},getImageProps:function(){return l}});let r=s(21466),a=s(99376),i=s(40348),n=r._(s(36228));function l(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let o=i.Image},7269:(e,t,s)=>{"use strict";s.d(t,{$c:()=>c,FW:()=>m,c3:()=>u,ch:()=>f,lA:()=>h,yw:()=>d});var r,a,i,n,l,o=s(56337);let c="__TAURI_TO_IPC_KEY__";function d(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}class u{constructor(e){r.set(this,void 0),a.set(this,0),i.set(this,[]),n.set(this,void 0),(0,o.G)(this,r,e||(()=>{}),"f"),this.id=d(e=>{let t=e.index;if("end"in e)return void(t==(0,o.g)(this,a,"f")?this.cleanupCallback():(0,o.G)(this,n,t,"f"));let s=e.message;if(t==(0,o.g)(this,a,"f")){for((0,o.g)(this,r,"f").call(this,s),(0,o.G)(this,a,(0,o.g)(this,a,"f")+1,"f");(0,o.g)(this,a,"f")in(0,o.g)(this,i,"f");){let e=(0,o.g)(this,i,"f")[(0,o.g)(this,a,"f")];(0,o.g)(this,r,"f").call(this,e),delete(0,o.g)(this,i,"f")[(0,o.g)(this,a,"f")],(0,o.G)(this,a,(0,o.g)(this,a,"f")+1,"f")}(0,o.g)(this,a,"f")===(0,o.g)(this,n,"f")&&this.cleanupCallback()}else(0,o.g)(this,i,"f")[t]=s})}cleanupCallback(){Reflect.deleteProperty(window,`_${this.id}`)}set onmessage(e){(0,o.G)(this,r,e,"f")}get onmessage(){return(0,o.g)(this,r,"f")}[(r=new WeakMap,a=new WeakMap,i=new WeakMap,n=new WeakMap,c)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[c]()}}async function h(e,t={},s){return window.__TAURI_INTERNALS__.invoke(e,t,s)}function f(e,t="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(e,t)}class m{get rid(){return(0,o.g)(this,l,"f")}constructor(e){l.set(this,void 0),(0,o.G)(this,l,e,"f")}async close(){return h("plugin:resources|close",{rid:this.rid})}}l=new WeakMap},8783:(e,t,s)=>{"use strict";s.d(t,{v:()=>a});var r=s(28039);let a=async(e,t)=>{let s=await (0,r.iD)();if(!s)throw Error("Not authenticated");let a={...t.headers,Authorization:"Bearer ".concat(s)},i=await fetch(e,{...t,headers:a});if(!i.ok){let e=await i.json();throw console.error("Error:",e.error||i.statusText),Error(e.error||"Request failed")}return i}},10719:(e,t,s)=>{Promise.resolve().then(s.bind(s,34581))},15574:(e,t,s)=>{"use strict";s.d(t,{D:()=>c});var r=s(84574),a=s(57597),i=s(98335),n=s(20517),l=s(71997),o=s(58068);let c=function(){let{systemUIVisible:e=!0,appThemeColor:t="base-100"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{appService:s}=(0,a.D)(),{settings:c}=(0,n.C)(),{themeColor:d,isDarkMode:u,showSystemUI:h,dismissSystemUI:f,updateAppTheme:m,setStatusBarHeight:g}=(0,i.C)();(0,r.useEffect)(()=>{m(t),(null==s?void 0:s.isMobileApp)&&(e?h():f(),(0,o.Mp)({visible:e,darkMode:u})),(null==s?void 0:s.isAndroidApp)&&(0,o.ZA)().then(e=>{e.height&&e.height>0&&g(e.height/window.devicePixelRatio)})},[s,u]),(0,r.useEffect)(()=>{var e,t;let s=null!=(t=null==(e=c.globalReadSettings)?void 0:e.customThemes)?t:[];s.forEach(e=>{(0,l.PL)(e)}),localStorage.setItem("customThemes",JSON.stringify(s))},[c]),(0,r.useEffect)(()=>{let e=u?"dark":"light";document.documentElement.setAttribute("data-theme","".concat(d,"-").concat(e)),document.documentElement.style.setProperty("color-scheme",e)},[d,u])}},18631:(e,t,s)=>{"use strict";s.d(t,{w:()=>i});var r=s(75972),a=s(7269);let i=(0,r.v)((e,t)=>({appService:void 0,isTrafficLightVisible:!1,shouldShowTrafficLight:!1,initializeTrafficLightStore:t=>{e({appService:t,isTrafficLightVisible:t.hasTrafficLight,shouldShowTrafficLight:t.hasTrafficLight})},setTrafficLightVisibility:async t=>{let{getCurrentWindow:r}=await Promise.resolve().then(s.bind(s,88330)),i=r();e({isTrafficLightVisible:!await i.isFullscreen()&&t,shouldShowTrafficLight:t}),(0,a.lA)("set_traffic_lights",{visible:t,x:10,y:22})},initializeTrafficLightListeners:async()=>{let{getCurrentWindow:r}=await Promise.resolve().then(s.bind(s,88330)),a=r(),i=await a.listen("will-enter-fullscreen",()=>{e({isTrafficLightVisible:!1})}),n=await a.listen("will-exit-fullscreen",()=>{let{shouldShowTrafficLight:s}=t();e({isTrafficLightVisible:s})});e({unlistenEnterFullScreen:i,unlistenExitFullScreen:n})},cleanupTrafficLightListeners:()=>{let{unlistenEnterFullScreen:s,unlistenExitFullScreen:r}=t();s&&s(),r&&r(),e({unlistenEnterFullScreen:void 0,unlistenExitFullScreen:void 0})}}))},20517:(e,t,s)=>{"use strict";s.d(t,{C:()=>r});let r=(0,s(75972).v)(e=>({settings:{},isFontLayoutSettingsDialogOpen:!1,isFontLayoutSettingsGlobal:!0,setSettings:t=>e({settings:t}),saveSettings:async(e,t)=>{let s=await e.getAppService();await s.saveSettings(t)},setFontLayoutSettingsDialogOpen:t=>e({isFontLayoutSettingsDialogOpen:t}),setFontLayoutSettingsGlobal:t=>e({isFontLayoutSettingsGlobal:t})}))},20867:(e,t,s)=>{"use strict";s.d(t,{y:()=>l});var r=s(62574),a=s(3073),i=s(84574),n=s(66763);let l=()=>{let[e,t]=(0,i.useState)(""),s=(0,i.useRef)("info"),l=(0,i.useRef)(5e3),o=(0,i.useRef)(""),c=(0,i.useRef)(null),d={info:"toast-info toast-center toast-middle",success:"toast-success toast-top toast-end",warning:"toast-warning toast-top toast-end",error:"toast-error toast-top toast-end"};(0,i.useEffect)(()=>(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>t(""),l.current),()=>{c.current&&clearTimeout(c.current)}),[e]);let u=async e=>{let{message:r,type:a="info",timeout:i,className:n=""}=e.detail;t(r),s.current=a,i&&(l.current=i),o.current=n};return(0,i.useEffect)(()=>(n.I.on("toast",u),()=>{n.I.off("toast",u)}),[]),e&&(0,r.jsx)("div",{className:(0,a.A)("toast toast-center toast-middle z-50 w-auto max-w-screen-sm",d[s.current],d[s.current].includes("toast-top")&&"pt-[calc(44px+env(safe-area-inset-top))]"),children:(0,r.jsx)("div",{className:(0,a.A)("alert flex items-center justify-center",{info:"alert-primary border-base-300",success:"alert-success border-0",warning:"alert-warning border-0",error:"alert-error border-0"}[s.current]),children:(0,r.jsx)("span",{className:(0,a.A)("max-h-[50vh] min-w-32","overflow-y-auto text-center","info"===s.current?"max-w-[80vw]":"max-w-80 whitespace-normal break-words",o.current),children:e.split("\n").map((e,t)=>(0,r.jsxs)(i.Fragment,{children:[e||(0,r.jsx)(r.Fragment,{children:"\xa0"}),(0,r.jsx)("br",{})]},t))})})})}},21013:(e,t,s)=>{"use strict";s.d(t,{Q:()=>a,z:()=>i});let r="translationDailyUsage",a=(e,t)=>{{let s=t||new Date().toISOString().split("T")[0];localStorage.setItem(r,JSON.stringify({[s]:e}))}},i=e=>{{let t=e||new Date().toISOString().split("T")[0],s=localStorage.getItem(r);if(s){let e=JSON.parse(s);if(e[t])return e[t]}}return null}},25143:(e,t,s)=>{"use strict";s.d(t,{default:()=>a.a});var r=s(4172),a=s.n(r)},26266:(e,t,s)=>{"use strict";s.d(t,{V:()=>l});var r=s(84574),a=s(46450),i=s(28039),n=s(78549);let l=()=>{let e=(0,n.B)(),{token:t,user:s}=(0,a.A)(),[l,o]=(0,r.useState)([]),[c,d]=(0,r.useState)("free");return(0,r.useEffect)(()=>{if(!s||!t)return;let r=(0,i.l3)(t),a=(0,i.r2)(t),n={name:e("Storage"),tooltip:e("{{percentage}}% of Cloud Storage Used.",{percentage:Math.round(a.usage/a.quota*100)}),used:Math.round(a.usage/1024/1024),total:Math.round(a.quota/1024/1024),unit:"MB"},l=(0,i.Bg)(t),c={name:e("Translation Characters"),tooltip:e("{{percentage}}% of Daily Translation Characters Used.",{percentage:Math.round(l.usage/l.quota*100)}),used:Math.round(l.usage/1024),total:Math.round(l.quota/1024),unit:"K"};d(r),o([n,c])},[t]),{quotas:l,userPlan:c}}},28039:(e,t,s)=>{"use strict";s.d(t,{Bg:()=>u,Fk:()=>f,iD:()=>h,l3:()=>c,r2:()=>d});var r=s(88744),a=s(2675),i=s(40965),n=s(69921),l=s(21013),o=s(79336);let c=e=>((0,r.s)(e)||{}).plan||"free",d=e=>{let t=(0,r.s)(e)||{},s=t.plan||"free",a=t.storage_usage_bytes||0,n=parseInt(o.env.NEXT_PUBLIC_STORAGE_FIXED_QUOTA||"0")||i.zW[s]||i.zW.free;return{plan:s,usage:a,quota:n}},u=e=>{let t=((0,r.s)(e)||{}).plan||"free",s=(0,l.z)()||0,a=i.Vz[t];return{plan:t,usage:s,quota:a}},h=async()=>{var e,t,s;if((0,n.hx)())return null!=(t=localStorage.getItem("token"))?t:null;let{data:r}=await a.ND.auth.getSession();return null!=(s=null==r||null==(e=r.session)?void 0:e.access_token)?s:null},f=async()=>{var e,t,s,r,i;if((0,n.hx)())return null!=(r=JSON.parse(null!=(s=localStorage.getItem("user"))?s:"{}").id)?r:null;let{data:l}=await a.ND.auth.getSession();return null!=(i=null==l||null==(t=l.session)||null==(e=t.user)?void 0:e.id)?i:null}},29353:(e,t,s)=>{"use strict";s.d(t,{Lj:()=>f,YF:()=>c,_Y:()=>l,c_:()=>m,tP:()=>h,tQ:()=>u,u5:()=>o,wm:()=>d});var r=s(88330),a=s(19806),i=s(70627),n=s(66763);let l=async()=>{let e=(0,r.getCurrentWindow)(),t=await e.scaleFactor(),s=await e.outerPosition();return{x:s.x/t,y:s.y/t}},o=async()=>{(0,r.getCurrentWindow)().minimize()},c=async()=>{let e=(0,r.getCurrentWindow)();await e.isFullscreen()?(await e.setFullscreen(!1),await e.unmaximize()):(0,r.getCurrentWindow)().toggleMaximize()},d=async()=>{(0,r.getCurrentWindow)().close()},u=async e=>(0,r.getCurrentWindow)().listen(a.es.WINDOW_CLOSE_REQUESTED,async()=>{await e(),console.log("exit app"),await (0,i.N)(0)}),h=async()=>{let e=(0,r.getCurrentWindow)(),t=await e.isFullscreen();await e.isMaximized()?await e.unmaximize():await e.setFullscreen(!t)},f=async e=>{let t=(0,r.getCurrentWindow)();await t.setAlwaysOnTop(e)},m=async()=>{await n.I.dispatch("quit-app"),await (0,i.N)(0)}},34581:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var r=s(62574),a=s(3073),i=s(84574),n=s(38012),l=s(90863),o=s(23511),c=s(57597),d=s(46450),u=s(15574),h=s(26266),f=s(78549),m=s(20517),g=s(18631),p=s(75454),w=s(69921),x=s(28039),v=s(8783);let y=(0,w.L1)()+"/user/delete",b=async()=>{try{if(!await (0,x.Fk)())throw Error("Not authenticated");await (0,v.v)(y,{method:"DELETE"})}catch(e){throw console.error("User deletion failed:",e),Error("User deletion failed")}};var j=s(66763),N=s(20867),S=s(77553),_=s(45322),L=s(57832);let A=()=>{var e,t,s;let w=(0,f.B)(),x=(0,n.useRouter)(),{envConfig:v,appService:y}=(0,c.D)(),{token:A,user:E,logout:C}=(0,d.A)(),{isTrafficLightVisible:T}=(0,g.w)(),{settings:k,setSettings:I,saveSettings:z}=(0,m.C)(),[P,M]=(0,i.useState)(!1),F=(0,i.useRef)(null);(0,u.D)({systemUIVisible:!1});let{quotas:D,userPlan:R}=(0,h.V)(),O=()=>{(0,p.i7)(x)},U=()=>{C(),k.keepLogin=!1,I(k),z(v,k),(0,p.i7)(x)},W=async()=>{try{await b(),U()}catch(e){console.error("Error deleting user:",e),j.I.dispatch("toast",{type:"error",message:w("Failed to delete user. Please try again later.")})}M(!1)},B=e=>{switch(e){case"free":return{name:w("Free Tier"),color:"bg-gray-200 text-gray-800",features:[w("Community Support"),w("DeepL Free Access"),w("Essential Text-to-Speech Voices"),w("Unlimited Offline/Online Reading"),w("Unlimited Cloud Sync Devices"),w("500 MB Cloud Sync Space")]};case"plus":return{name:w("Plus Tier"),color:"bg-blue-200 text-blue-800",features:[w("Includes All Free Tier Benefits"),w("Priority Support"),w("AI Summaries"),w("AI Translations"),w("DeepL Pro Access"),w("Expanded Text-to-Speech Voices"),w("2000 MB Cloud Sync Space")]};case"pro":return{name:w("Pro Tier"),color:"bg-purple-200 text-purple-800",features:[w("Includes All Plus Tier Benefits"),w("Unlimited AI Summaries"),w("Unlimited AI Translations"),w("Unlimited DeepL Pro Access"),w("Advanced AI Tools"),w("Early Feature Access"),w("10 GB Cloud Sync Space")]}}};if(!E||!A)return(0,r.jsx)("div",{className:"mx-auto max-w-4xl px-4 py-8",children:(0,r.jsx)("div",{className:"overflow-hidden rounded-lg shadow-md",children:(0,r.jsx)("div",{className:"flex min-h-[300px] items-center justify-center p-6",children:(0,r.jsx)("div",{className:"text-base-content animate-pulse",children:w("Loading profile...")})})})});let V=(null==E||null==(e=E.user_metadata)?void 0:e.picture)||(null==E||null==(t=E.user_metadata)?void 0:t.avatar_url),G=(null==E||null==(s=E.user_metadata)?void 0:s.full_name)||"-",$=(null==E?void 0:E.email)||"",q=B(R)||B("free");return(0,r.jsxs)("div",{className:(0,a.A)("fixed inset-0 z-0 flex select-none flex-col items-center overflow-y-auto","bg-base-100 border-base-200 border",(null==y?void 0:y.hasSafeAreaInset)&&"pt-[env(safe-area-inset-top)]"),children:[(0,r.jsxs)("div",{ref:F,className:(0,a.A)("fixed flex w-full items-center justify-between py-2 pe-6 ps-4",(null==y?void 0:y.hasTrafficLight)&&"pt-11"),children:[(0,r.jsx)("button",{onClick:O,className:(0,a.A)("btn btn-ghost h-8 min-h-8 w-8 p-0"),children:(0,r.jsx)(l.NEn,{className:"text-base-content"})}),(null==y?void 0:y.hasWindowBar)&&(0,r.jsx)(S.A,{headerRef:F,showMinimize:!T,showMaximize:!T,showClose:!T,onClose:O})]}),(0,r.jsxs)("div",{className:"w-full min-w-60 max-w-4xl px-4 py-10",children:[(0,r.jsx)("div",{className:"bg-base-200 overflow-hidden rounded-lg p-2 shadow-md sm:p-6",children:(0,r.jsxs)("div",{className:"p-2 sm:p-6",children:[(0,r.jsxs)("div",{className:"mb-8 flex flex-col items-center gap-x-6 gap-y-4 md:flex-row md:items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:V?(0,r.jsx)(L.A,{url:V,size:128,DefaultIcon:o.NMe,className:"h-16 w-16 md:h-24 md:w-24",borderClassName:"border-base-100 border-4"}):(0,r.jsx)(o.NMe,{className:"h-16 w-16 md:h-24 md:w-24"})}),(0,r.jsxs)("div",{className:"flex-grow text-center md:text-left",children:[(0,r.jsx)("h2",{className:"text-base-content text-xl font-bold md:text-2xl",children:G}),(0,r.jsx)("p",{className:"text-base-content/60",children:$}),(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)("span",{className:"inline-block rounded-full px-3 py-1 text-sm font-medium ".concat(q.color),children:q.name})})]})]}),(0,r.jsxs)("div",{className:"bg-base-100 mb-8 rounded-lg px-4 py-6",children:[(0,r.jsx)("h3",{className:"text-base-content mb-2 text-lg font-semibold",children:w("Features")}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("ul",{className:"text-base-content/60 grid grid-cols-1 gap-2 md:grid-cols-2",children:q.features.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"mr-2 h-4 w-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e]},t))})})]}),(0,r.jsx)("div",{className:"mb-8 rounded-lg",children:(0,r.jsx)("div",{className:"p-0",children:D&&D.length>0?(0,r.jsx)(_.A,{quotas:D,showProgress:!0,className:"space-y-4",labelClassName:"pl-4 pr-2"}):(0,r.jsx)("div",{className:"h-10 animate-pulse"})})}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row",children:[(0,r.jsx)("button",{onClick:U,className:"w-full rounded-lg bg-gray-200 px-6 py-3 font-medium text-gray-800 transition-colors hover:bg-gray-300 md:w-auto",children:w("Sign Out")}),(0,r.jsx)("button",{onClick:()=>{M(!0)},className:"w-full rounded-lg bg-red-100 px-6 py-3 font-medium text-red-600 transition-colors hover:bg-red-200 md:w-auto",children:w("Delete Account")})]})]})}),P&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-2xl bg-white p-6",children:[(0,r.jsx)("h3",{className:"mb-4 text-xl font-bold text-gray-800",children:w("Delete Your Account?")}),(0,r.jsx)("p",{className:"mb-6 text-gray-600",children:w("This action cannot be undone. All your data in the cloud will be permanently deleted.")}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,r.jsx)("button",{onClick:()=>{M(!1)},className:"flex-1 rounded-lg bg-gray-300 px-4 py-2 font-medium text-gray-800 hover:bg-gray-400",children:w("Cancel")}),(0,r.jsx)("button",{onClick:W,className:"flex-1 rounded-lg bg-red-500 px-4 py-2 font-medium text-white hover:bg-red-600",children:w("Delete Permanently")})]})]})})]}),(0,r.jsx)(N.y,{})]})}},45322:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(62574),a=s(3073);s(84574);let i=e=>{let{quotas:t,showProgress:s,className:i,labelClassName:n}=e;return(0,r.jsx)("div",{className:(0,a.A)("text-base-content w-full rounded-md text-base sm:text-sm",i),children:t.map(e=>{let t=e.used/e.total*100,i="bg-green-500";return t>80?i="bg-red-500":t>50&&(i="bg-yellow-500"),(0,r.jsxs)("div",{className:(0,a.A)("relative w-full overflow-hidden rounded-md",s&&"bg-base-300"),children:[s&&(0,r.jsx)("div",{className:"absolute left-0 top-0 h-full ".concat(i),style:{width:"".concat(t,"%")}}),(0,r.jsxs)("div",{className:(0,a.A)("relative flex items-center justify-between gap-4 p-2",n),children:[(0,r.jsx)("div",{className:"lg:tooltip lg:tooltip-right","data-tip":e.tooltip,children:(0,r.jsx)("span",{className:"truncate",children:e.name})}),(0,r.jsxs)("div",{className:"text-right text-xs",children:[e.used," / ",e.total," ",e.unit]})]})]},e.name)})})}},56337:(e,t,s)=>{"use strict";function r(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}function a(e,t,s,r,a){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,s):a?a.value=s:t.set(e,s),s}s.d(t,{G:()=>a,g:()=>r}),"function"==typeof SuppressedError&&SuppressedError},57597:(e,t,s)=>{"use strict";s.d(t,{D:()=>o,L:()=>l});var r=s(62574),a=s(84574),i=s(69921);let n=(0,a.createContext)(void 0),l=e=>{let{children:t}=e,[s]=(0,a.useState)(i.Ay),[l,o]=(0,a.useState)(null);return a.useEffect(()=>{s.getAppService().then(e=>o(e)),window.addEventListener("error",e=>"ResizeObserver loop limit exceeded"===e.message&&(e.stopImmediatePropagation(),e.preventDefault(),!0))},[s]),(0,r.jsx)(n.Provider,{value:{envConfig:s,appService:l},children:t})},o=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useEnv must be used within EnvProvider");return e}},57832:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(62574),a=s(3073),i=s(25143),n=s(84574);let l=e=>{let{url:t,size:s,className:l,borderClassName:o,DefaultIcon:c}=e,[d,u]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!t)return;let e="avatar_".concat(btoa(t).replace(/[^a-zA-Z0-9]/g,"")),s=localStorage.getItem(e);if(s)return void u(s);(async()=>{try{let s=await fetch(t,{referrerPolicy:"no-referrer"}),r=await s.blob(),a=new FileReader;a.onloadend=()=>{let t=a.result;try{localStorage.setItem(e,t),u(t)}catch(e){console.warn("Failed to cache avatar in localStorage:",e)}},a.readAsDataURL(r)}catch(e){console.error("Failed to cache avatar:",e)}})()},[t]),(0,r.jsx)("div",{className:"relative flex h-full w-full items-center justify-center rounded-full",style:{width:s,height:s},children:t?(0,r.jsxs)("div",{children:[(0,r.jsx)(i.default,{src:d||t,alt:"User Avatar",className:(0,a.A)("rounded-full",l,o),referrerPolicy:"no-referrer",width:s,height:s,onError:e=>{var t;e.target.style.display="none",null==(t=e.target.nextElementSibling)||t.classList.remove("invisible")}}),(0,r.jsx)("div",{className:"invisible absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(c,{className:(0,a.A)("text-neutral-content",l)})})]}):(0,r.jsx)(c,{className:"text-neutral-content",size:s})})}},58068:(e,t,s)=>{"use strict";s.d(t,{Ed:()=>n,LB:()=>u,Mp:()=>l,S$:()=>d,ZA:()=>o,i1:()=>i,ot:()=>h,ov:()=>a});var r=s(7269);async function a(e){return await (0,r.lA)("plugin:native-bridge|copy_uri_to_path",{payload:e})}async function i(e){await (0,r.lA)("plugin:native-bridge|use_background_audio",{payload:e})}async function n(e){return await (0,r.lA)("plugin:native-bridge|install_package",{payload:e})}async function l(e){return await (0,r.lA)("plugin:native-bridge|set_system_ui_visibility",{payload:e})}async function o(){return await (0,r.lA)("plugin:native-bridge|get_status_bar_height")}let c=null;async function d(){if(c)return c;let e=await (0,r.lA)("plugin:native-bridge|get_sys_fonts_list");return c=e,e}async function u(e){await (0,r.lA)("plugin:native-bridge|intercept_keys",{payload:e})}async function h(e){await (0,r.lA)("plugin:native-bridge|lock_screen_orientation",{payload:e})}},66763:(e,t,s)=>{"use strict";s.d(t,{I:()=>i});var r=s(84648);class a{on(e,t){this.asyncListeners.has(e)||this.asyncListeners.set(e,new Set),this.asyncListeners.get(e).add(t)}off(e,t){var s;null==(s=this.asyncListeners.get(e))||s.delete(t)}async dispatch(e,t){let s=this.asyncListeners.get(e);if(s){let r=new CustomEvent(e,{detail:t});for(let e of s)await e(r)}}onSync(e,t){this.syncListeners.has(e)||this.syncListeners.set(e,[]),this.syncListeners.get(e).push(t)}offSync(e,t){let s=this.syncListeners.get(e);s&&this.syncListeners.set(e,s.filter(e=>e!==t))}dispatchSync(e,t){let s=this.syncListeners.get(e);if(s){let r=new CustomEvent(e,{detail:t});for(let e of[...s].reverse())if(e(r))return!0}return!1}constructor(){(0,r._)(this,"syncListeners",void 0),(0,r._)(this,"asyncListeners",void 0),this.syncListeners=new Map,this.asyncListeners=new Map}}let i=new a},75454:(e,t,s)=>{"use strict";s.d(t,{Ad:()=>l,OO:()=>n,YF:()=>i,i7:()=>o}),s(38012);var r=s(69921),a=s(40965);let i=(e,t,s,i)=>{let n=t.join(a.Zk);if((0,r.hx)()&&!(0,r.xx)())e.push("/reader/".concat(n).concat(s?"?".concat(s):""),i);else{let t=new URLSearchParams(s||"");t.set("ids",n),e.push("/reader?".concat(t.toString()),i)}},n=e=>{let t=window.location.pathname,s=window.location.search;e.push("/auth?redirect=".concat(encodeURIComponent("/auth"!==t?t+s:"/")))},l=e=>{e.push("/user")},o=(e,t,s)=>{e.push("/library".concat(t?"?".concat(t):""),s)}},77553:(e,t,s)=>{"use strict";s.d(t,{A:()=>d});var r=s(62574),a=s(3073),i=s(84574),n=s(57597),l=s(29353),o=s(69921);let c=e=>{let{onClick:t,ariaLabel:s,id:a,children:i}=e;return(0,r.jsx)("button",{id:a,onClick:t,className:"window-button text-base-content/85 hover:text-base-content","aria-label":s,children:i})},d=e=>{let{className:t,headerRef:d,showMinimize:u=!0,showMaximize:h=!0,showClose:f=!0,onMinimize:m,onToggleMaximize:g,onClose:p}=e,w=(0,i.useRef)(null),{appService:x}=(0,n.D)(),v=async e=>{let t=e.target;if(t.closest(".btn")||t.closest(".window-button")||t.closest(".dropdown-container")||t.closest(".exclude-title-bar-mousedown"))return;let{getCurrentWindow:r}=await Promise.resolve().then(s.bind(s,88330));1===e.buttons&&(2===e.detail?r().toggleMaximize():r().startDragging())};(0,i.useEffect)(()=>{if(!(0,o.uO)())return;let e=null==d?void 0:d.current;return null==e||e.addEventListener("mousedown",v),()=>{null==e||e.removeEventListener("mousedown",v)}},[]);let y=async()=>{m?m():(0,l.u5)()},b=async()=>{g?g():(0,l.YF)()},j=async()=>{p?p():(0,l.wm)()};return(0,r.jsxs)("div",{ref:w,className:(0,a.A)("window-buttons flex h-8 items-center justify-end space-x-2",f||h||u?"visible":"hidden",t),children:[u&&(null==x?void 0:x.hasWindowBar)&&(0,r.jsx)(c,{onClick:y,ariaLabel:"Minimize",id:"titlebar-minimize",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"currentColor",d:"M20 14H4v-2h16"})})}),h&&(null==x?void 0:x.hasWindowBar)&&(0,r.jsx)(c,{onClick:b,ariaLabel:"Maximize/Restore",id:"titlebar-maximize",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"currentColor",d:"M4 4h16v16H4zm2 4v10h12V8z"})})}),f&&((null==x?void 0:x.hasWindowBar)||p)&&(0,r.jsx)(c,{onClick:j,ariaLabel:"Close",id:"titlebar-close",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})}},84648:(e,t,s)=>{"use strict";function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{_:()=>r})},88744:(e,t,s)=>{"use strict";s.d(t,{s:()=>a});class r extends Error{}function a(e,t){let s;if("string"!=typeof e)throw new r("Invalid token specified: must be a string");t||(t={});let a=+(!0!==t.header),i=e.split(".")[a];if("string"!=typeof i)throw new r(`Invalid token specified: missing part #${a+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return atob(t)}}(i)}catch(e){throw new r(`Invalid token specified: invalid base64 for part #${a+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new r(`Invalid token specified: invalid json for part #${a+1} (${e.message})`)}}r.prototype.name="InvalidTokenError"}},e=>{var t=t=>e(e.s=t);e.O(0,[7412,2848,8375,1029,6261,743,8769,348,1503,1985,426,3125,7358],()=>t(10719)),_N_E=e.O()}]);