"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5796],{5796:(e,t,n)=>{n.d(t,{makeFB2:()=>h});let r=e=>e?e.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",o=e=>r(null==e?void 0:e.textContent),i={XLINK:"http://www.w3.org/1999/xlink",EPUB:"http://www.idpf.org/2007/ops"},l={XML:"application/xml",XHTML:"application/xhtml+xml"},a={strong:["strong","self"],emphasis:["em","self"],style:["span","self"],a:"anchor",strikethrough:["s","self"],sub:["sub","self"],sup:["sup","self"],code:["code","self"],image:"image"},s={epigraph:["blockquote"],subtitle:["h2",a],"text-author":["p",a],date:["p",a],stanza:"stanza"},c={title:["header",{p:["h1",a],"empty-line":["br"]}],epigraph:["blockquote","self"],image:"image",annotation:["aside"],section:["section","self"],p:["p",a],poem:["blockquote",s],subtitle:["h2",a],cite:["blockquote","self"],"empty-line":["br"],table:["table",{tr:["tr",{th:["th",a,["colspan","rowspan","align","valign"]],td:["td",a,["colspan","rowspan","align","valign"]]},["align"]]}],"text-author":["p",a]};s.epigraph.push(c);let u={image:"image",title:["section",{p:["h1",a],"empty-line":["br"]}],epigraph:["section",c],section:["section",c]};class p{getImageSrc(e){let t=e.getAttributeNS(i.XLINK,"href");if(!t)return"data:,";let[,n]=t.split("#");if(!n)return t;let r=this.bins.get(n);return r?"data:".concat(r.getAttribute("content-type"),";base64,").concat(r.textContent):t}image(e){let t=this.doc.createElement("img");return t.alt=e.getAttribute("alt"),t.title=e.getAttribute("title"),t.setAttribute("src",this.getImageSrc(e)),t}anchor(e){let t=this.convert(e,{a:["a",a]});return t.setAttribute("href",e.getAttributeNS(i.XLINK,"href")),"note"===e.getAttribute("type")&&t.setAttributeNS(i.EPUB,"epub:type","noteref"),t}stanza(e){let t=this.convert(e,{stanza:["p",{title:["header",{p:["strong",a],"empty-line":["br"]}],subtitle:["p",a]}]});for(let n of e.children)"v"===n.nodeName&&(t.append(this.doc.createTextNode(n.textContent)),t.append(this.doc.createElement("br")));return t}convert(e,t){if(3===e.nodeType)return this.doc.createTextNode(e.textContent);if(4===e.nodeType)return this.doc.createCDATASection(e.textContent);if(8===e.nodeType)return this.doc.createComment(e.textContent);let n=null==t?void 0:t[e.nodeName];if(!n)return null;if("string"==typeof n)return this[n](e);let[r,o,i]=n,l=this.doc.createElement(r);if(e.id&&(l.id=e.id),l.classList.add(e.nodeName),Array.isArray(i))for(let t of i){let n=e.getAttribute(t);n&&l.setAttribute(t,n)}let a="self"===o?t:o,s=e.firstChild;for(;s;){let e=this.convert(s,a);e&&l.append(e),s=s.nextSibling}return l}constructor(e){this.fb2=e,this.doc=document.implementation.createDocument(i.XHTML,"html"),this.bins=new Map(Array.from(this.fb2.getElementsByTagName("binary"),e=>[e.id,e]))}}let d=async e=>{var t;let n=await e.arrayBuffer(),r=new TextDecoder("utf-8").decode(n),o=new DOMParser,i=o.parseFromString(r,l.XML),a=i.xmlEncoding||(null==(t=r.match(/^<\?xml\s+version\s*=\s*["']1.\d+"\s+encoding\s*=\s*["']([A-Za-z0-9._-]*)["']/))?void 0:t[1]);if(a&&"utf-8"!==a.toLowerCase()){let e=new TextDecoder(a).decode(n);return o.parseFromString(e,l.XML)}return i},m=URL.createObjectURL(new Blob(['\n@namespace epub "http://www.idpf.org/2007/ops";\nbody > img, section > img {\n    display: block;\n    margin: auto;\n}\n.title h1 {\n    text-align: center;\n}\nbody > section > .title, body.notesBodyType > .title {\n    margin: 3em 0;\n}\nbody.notesBodyType > section .title h1 {\n    text-align: start;\n}\nbody.notesBodyType > section .title {\n    margin: 1em 0;\n}\np {\n    text-indent: 1em;\n    margin: 0;\n}\n:not(p) + p, p:first-child {\n    text-indent: 0;\n}\n.poem p {\n    text-indent: 0;\n    margin: 1em 0;\n}\n.text-author, .date {\n    text-align: end;\n}\n.text-author:before {\n    content: "â€”";\n}\ntable {\n    border-collapse: collapse;\n}\ntd, th {\n    padding: .25em;\n}\na[epub|type~="noteref"] {\n    font-size: .75em;\n    vertical-align: super;\n}\nbody:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {\n    margin: 3em 0;\n}\n'],{type:"text/css"})),f=e=>'<?xml version="1.0" encoding="utf-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head><link href="'.concat(m,'" rel="stylesheet" type="text/css"/></head>\n    <body>').concat(e,"</body>\n</html>"),g="data-foliate-id",h=async e=>{let t={},n=await d(e),i=new p(n),a=e=>n.querySelector(e),s=e=>[...n.querySelectorAll(e)],m=e=>{let t=o(e.querySelector("nickname"));if(t)return t;let n=o(e.querySelector("first-name")),r=o(e.querySelector("middle-name")),i=o(e.querySelector("last-name"));return{name:[n,r,i].filter(e=>e).join(" "),sortAs:i?[i,[n,r].filter(e=>e).join(" ")].join(", "):null}},h=e=>{var t;return null!=(t=null==e?void 0:e.getAttribute("value"))?t:o(e)},b=a("title-info annotation");if(t.metadata={title:o(a("title-info book-title")),identifier:o(a("document-info id")),language:o(a("title-info lang")),author:s("title-info author").map(m),translator:s("title-info translator").map(m),contributor:s("document-info author").map(m).concat(s("document-info program-used").map(o)).map(e=>Object.assign("string"==typeof e?{name:e}:e,{role:"bkp"})),publisher:o(a("publish-info publisher")),published:h(a("title-info date")),modified:h(a("document-info date")),description:b?i.convert(b,{annotation:["div",c]}).innerHTML:null,subject:s("title-info genre").map(o)},a("coverpage image")){let e=i.getImageSrc(a("coverpage image"));t.getCover=()=>fetch(e).then(e=>e.blob())}else t.getCover=()=>null;let y=Array.from(n.querySelectorAll("body"),e=>{let t=i.convert(e,{body:["body",u]});return[Array.from(t.children,e=>{let t=[e,...e.querySelectorAll("[id]")].map(e=>e.id);return{el:e,ids:t}}),t]}),x=[],v=y[0][0].map(e=>{let{el:t,ids:n}=e;return{ids:n,titles:Array.from(t.querySelectorAll(":scope > section > .title"),(e,t)=>(e.setAttribute(g,t),{title:o(e),index:t})),el:t}}).concat(y.slice(1).map(e=>{let[t,n]=e,r=t.map(e=>e.ids).flat();return n.classList.add("notesBodyType"),{ids:r,el:n,linear:"no"}})).map(e=>{var t,n;let{ids:o,titles:i,el:a,linear:s}=e,c=f(a.outerHTML),u=new Blob([c],{type:l.XHTML}),p=URL.createObjectURL(u);return x.push(p),{ids:o,title:r(null!=(n=null==(t=a.querySelector(".title, .subtitle, p"))?void 0:t.textContent)?n:a.classList.contains("title")?a.textContent:""),titles:i,load:()=>p,createDocument:()=>new DOMParser().parseFromString(c,l.XHTML),size:u.size-Array.from(a.querySelectorAll("[src]"),e=>{var t,n;return null!=(n=null==(t=e.getAttribute("src"))?void 0:t.length)?n:0}).reduce((e,t)=>e+t,0),linear:s}}),w=new Map;return t.sections=v.map((e,t)=>{let{ids:n,load:r,createDocument:o,size:i,linear:l}=e;for(let e of n)e&&w.set(e,t);return{id:t,load:r,createDocument:o,size:i,linear:l}}),t.toc=v.map((e,t)=>{let{title:n,titles:r}=e,o=t.toString();return{label:n,href:o,subitems:(null==r?void 0:r.length)?r.map(e=>{let{title:t,index:n}=e;return{label:t,href:"".concat(o,"#").concat(n)}}):null}}).filter(e=>e),t.resolveHref=e=>{let[t,n]=e.split("#");return t?{index:Number(t),anchor:e=>e.querySelector("[".concat(g,'="').concat(n,'"]'))}:{index:w.get(n),anchor:e=>e.getElementById(n)}},t.splitTOCHref=e=>{var t,n;return null!=(n=null==e||null==(t=e.split("#"))?void 0:t.map(e=>Number(e)))?n:[]},t.getTOCFragment=(e,t)=>e.querySelector("[".concat(g,'="').concat(t,'"]')),t.destroy=()=>{for(let e of x)URL.revokeObjectURL(e)},t}}}]);