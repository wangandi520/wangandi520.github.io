"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6550],{26550:(e,t,r)=>{r.d(t,{TTS:()=>g});let i={XML:"http://www.w3.org/XML/1998/namespace",SSML:"http://www.w3.org/2001/10/synthesis"},n=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),s=e=>e.lang||e?.getAttributeNS?.(i.XML,"lang")||(e.parentElement?s(e.parentElement):null),a=e=>e?.getAttributeNS?.(i.XML,"lang")||(e.parentElement?a(e.parentElement):null),l=(e="en",t="word")=>{let r=new Intl.Segmenter(e,{granularity:t}),i="word"===t;return function*(e,t){let n=e.join("").replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," "),s=0,a=-1,l=0,h=Array.from(r.segment(n)),o=[];for(let e=0;e<h.length;e++){let t=h[e],r=h[e+1],i=t.segment.trim(),n=r?.segment?.trim(),s=/(?:^|\s)([A-Z][a-z]{1,5})\.$/.test(i),a=/^[A-Z]/.test(n||"");if(s&&a){let i={index:t.index,segment:t.segment+(r?.segment||""),isWordLike:!0};o.push(i),e++}else o.push(t)}for(let{index:r,segment:h,isWordLike:u}of o){if(i&&!u)continue;for(;l<=r;)l+=e[++a].length;let o=a,d=r-(l-e[a].length),g=r+h.length-1;if(g<n.length)for(;l<=g;)l+=e[++a].length;let m=a,f=g-(l-e[a].length)+1;yield[(s++).toString(),t(o,d,m,f)]}}},h=(e,t)=>{let r=document.implementation.createDocument(i.SSML,"speak"),{lang:n}=t;n&&r.documentElement.setAttributeNS(i.XML,"lang",n);let s=(e,t,n)=>{let a;if(!e)return;if(3===e.nodeType)return r.createTextNode(e.textContent);if(4===e.nodeType)return r.createCDATASection(e.textContent);if(1!==e.nodeType)return;let l=e.nodeName.toLowerCase();"foliate-mark"===l?(a=r.createElementNS(i.SSML,"mark")).setAttribute("name",e.dataset.name):"br"===l?a=r.createElementNS(i.SSML,"break"):("em"===l||"strong"===l)&&(a=r.createElementNS(i.SSML,"emphasis"));let h=e.lang||e.getAttributeNS(i.XML,"lang");h&&(a||(a=r.createElementNS(i.SSML,"lang")),a.setAttributeNS(i.XML,"lang",h));let o=e.getAttributeNS(i.SSML,"alphabet")||n;if(!a){let t=e.getAttributeNS(i.SSML,"ph");t&&(a=r.createElementNS(i.SSML,"phoneme"),o&&a.setAttribute("alphabet",o),a.setAttribute("ph",t))}a||(a=t);let u=e.firstChild;for(;u;){let e=s(u,a,o);e&&a!==e&&a.append(e),u=u.nextSibling}return a};return s(e.firstChild,r.documentElement,t.alphabet),r},o=(e,t,r)=>{let i=s(e.commonAncestorContainer),n=a(e.commonAncestorContainer),o=l(i,r),u=e.cloneContents(),d=[...t(e,o)];for(let[e,r]of[...t(u,o)]){let t=document.createElement("foliate-mark");t.dataset.name=e,r.insertNode(t)}return{entries:d,ssml:h(u,{lang:i,alphabet:n})}},u=e=>!e.toString().trim();class d{#e=[];#t;#r=-1;#i;constructor(e,t=e=>e){this.#t=e,this.#i=t}current(){if(this.#e[this.#r])return this.#i(this.#e[this.#r])}first(){if(this.#e[0])return this.#r=0,this.#i(this.#e[0])}prev(){let e=this.#r-1;if(this.#e[e])return this.#r=e,this.#i(this.#e[e])}next(){let e=this.#r+1;if(this.#e[e])return this.#r=e,this.#i(this.#e[e]);for(;;){let{done:t,value:r}=this.#t.next();if(t)break;if(this.#e.push(r),this.#e[e])return this.#r=e,this.#i(this.#e[e])}}find(e){let t=this.#e.findIndex(t=>e(t));if(t>-1)return this.#r=t,this.#i(this.#e[t]);for(;;){let{done:t,value:r}=this.#t.next();if(t)break;if(this.#e.push(r),e(r))return this.#r=this.#e.length-1,this.#i(r)}}}class g{#n;#s;#a;#l=new XMLSerializer;constructor(e,t,r,i){this.doc=e,this.highlight=r,this.#n=new d(function*(e){let t,r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);for(let i=r.nextNode();i;i=r.nextNode()){let r=i.tagName.toLowerCase();n.has(r)&&(t&&(t.setEndBefore(i),u(t)||(yield t)),(t=e.createRange()).setStart(i,0))}t||(t=e.createRange()).setStart(e.body.firstChild??e.body,0),t.setEndAfter(e.body.lastChild??e.body),u(t)||(yield t)}(e),e=>{let{entries:r,ssml:n}=o(e,t,i);return this.#s=new Map(r),[n,e]})}#h(e,t){return t?e.querySelector(`mark[name="${CSS.escape(t)}"`):null}#o(e,t){if(!e)return;if(!t)return this.#l.serializeToString(e);let r=document.implementation.createDocument(i.SSML,"speak");r.documentElement.replaceWith(r.importNode(e.documentElement,!0));let n=t(r)?.previousSibling;for(;n;){let e=n.previousSibling??n.parentNode?.previousSibling;n.parentNode.removeChild(n),n=e}return this.#l.serializeToString(r)}start(){this.#a=null;let[e]=this.#n.first()??[];return e?this.#o(e,e=>this.#h(e,this.#a)):this.next()}resume(){let[e]=this.#n.current()??[];return e?this.#o(e,e=>this.#h(e,this.#a)):this.next()}prev(e){this.#a=null;let[t,r]=this.#n.prev()??[];return e&&r&&this.highlight(r.cloneRange()),this.#o(t)}next(e){this.#a=null;let[t,r]=this.#n.next()??[];return e&&r&&this.highlight(r.cloneRange()),this.#o(t)}from(e){let t;this.#a=null;let[r]=this.#n.find(t=>0>=e.compareBoundaryPoints(Range.END_TO_START,t));for(let[r,i]of this.#s.entries())if(0>=e.compareBoundaryPoints(Range.START_TO_START,i)){t=r;break}return this.#o(r,e=>this.#h(e,t))}setMark(e){let t=this.#s.get(e);if(t)return this.#a=e,this.highlight(t.cloneRange()),t}}}}]);