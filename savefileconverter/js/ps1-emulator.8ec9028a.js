"use strict";(self["webpackChunksave_file_converter"]=self["webpackChunksave_file_converter"]||[]).push([[871],{3222:function(e,t,a){a.r(t),a.d(t,{default:function(){return b}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("ConvertPs1Emulator")],1)},n=[],i=function(){var e=this,t=e._self._c;return t("div",[t("b-container",[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Raw/emulator")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose a file to convert (*.mcr)",acceptExtension:".mcr",leaveRoomForHelpIcon:!1},on:{load:function(t){return e.readMemcardSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.memcardSaveData,files:this.getFileListNames()},on:{change:function(t){return e.changeSelectedSaveData(t)}},model:{value:e.selectedSaveData,callback:function(t){e.selectedSaveData=t},expression:"selectedSaveData"}})],1):t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!1},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1)],1),t("b-col",{attrs:{sm:"12",md:"2",lg:"2",xl:"2","align-self":"start"}},[t("conversion-direction",{attrs:{horizontalLayout:["md","lg","xl"],verticalLayout:["xs","sm"],conversionDirection:this.conversionDirection},on:{change:function(t){return e.changeConversionDirection(t)}}})],1),t("b-col",{attrs:{sm:"12",md:"5","align-self":"start"}},[t("b-row",{attrs:{"no-gutters":"","align-h":"center","align-v":"start"}},[t("b-col",{attrs:{cols:"12"}},[t("b-jumbotron",{class:"md"===e.$mq?"fix-jumbotron":"",attrs:{fluid:"","header-level":e._f("mq")(e.$mq,{xs:5,sm:5,md:5,lg:5,xl:4})},scopedSlots:e._u([{key:"header",fn:function(){return[e._v("Individual saves")]},proxy:!0}])})],1)],1),"convertToRaw"===this.conversionDirection?t("div",[t("output-filename",{attrs:{leaveRoomForHelpIcon:!0,disabled:!0,helpText:"The filename for an individual save contains important information that the game needs to find this save data. Please do not modify it after downloading the save."},model:{value:e.outputFilename,callback:function(t){e.outputFilename=t},expression:"outputFilename"}})],1):t("div",[t("input-file",{attrs:{errorMessage:this.errorMessage,placeholderText:"Choose files to add",leaveRoomForHelpIcon:!1,allowMultipleFiles:!0},on:{load:function(t){return e.readEmulatorSaveData(t)}}}),t("file-list",{attrs:{display:null!==this.memcardSaveData,files:this.getFileListNames(),enabled:!1}})],1)],1)],1),t("b-row",{staticClass:"justify-content-md-center",attrs:{"align-h":"center"}},[t("b-col",{attrs:{cols:"auto",sm:"4",md:"3",lg:"2","align-self":"center"}},[t("b-button",{staticClass:"ps1-emulator-convert-button",attrs:{variant:"success",block:"",disabled:this.convertButtonDisabled},on:{click:function(t){return e.convertFile()}}},[e._v(" Convert! ")])],1)],1),t("b-row",[t("b-col",[t("div",{staticClass:"help"},[e._v(" Help: how can I "),t("router-link",{attrs:{to:"/original-hardware?sort=ps1"}},[e._v("copy save files to and from a PS1 memory card")]),e._v("? ")],1)])],1)],1)],1)},s=[],o=a(3162),l=a(3313),c=a(1044),u=a(2405),m=a(5482),f=a(1302),h=a(5847),v={name:"ConvertPs1Emulator",data(){return{memcardSaveData:null,errorMessage:null,outputFilename:null,conversionDirection:"convertToRaw",selectedSaveData:null}},components:{ConversionDirection:m.Z,InputFile:c.Z,OutputFilename:u.Z,FileList:f.Z},computed:{convertButtonDisabled(){const e="convertToRaw"===this.conversionDirection||null===this.selectedSaveData;return!this.memcardSaveData||0===this.memcardSaveData.getSaveFiles().length||!e||!this.outputFilename}},methods:{getFileListNames(){return null!==this.memcardSaveData&&null!==this.memcardSaveData.getSaveFiles()?this.memcardSaveData.getSaveFiles().map((e=>({displayText:`${e.description} (${e.regionName})`}))):[]},changeConversionDirection(e){this.conversionDirection=e,this.memcardSaveData=null,this.errorMessage=null,this.outputFilename=null,this.selectedSaveData=null},changeSelectedSaveData(e){this.memcardSaveData.getSaveFiles().length>0?(this.selectedSaveData=e,this.outputFilename=this.memcardSaveData.getSaveFiles()[this.selectedSaveData].filename):(this.selectedSaveData=null,this.outputFilename=null)},readMemcardSaveData(e){this.errorMessage=null,this.selectedSaveData=null;try{this.memcardSaveData=h.Z.createFromPs1MemcardData(e.arrayBuffer),this.changeSelectedSaveData(0)}catch(t){this.errorMessage="File appears to not be in the correct format",this.memcardSaveData=null,this.selectedSaveData=null}},readEmulatorSaveData(e){this.errorMessage=null,this.selectedSaveData=null;try{const t=e.map((e=>({filename:e.filename,rawData:e.arrayBuffer})));this.memcardSaveData=h.Z.createFromSaveFiles(t),this.memcardSaveData.getSaveFiles().length>0?this.outputFilename=`${l.Z.convertDescriptionToFilename(this.memcardSaveData.getSaveFiles()[0].description)}.mcr`:this.outputFilename="output.mcr"}catch(t){this.errorMessage=t.message,this.memcardSaveData=null,this.selectedSaveData=null}},convertFile(){const e="convertToRaw"===this.conversionDirection?this.memcardSaveData.getSaveFiles()[this.selectedSaveData].rawData:this.memcardSaveData.getArrayBuffer(),t=new Blob([e],{type:"application/octet-stream"});(0,o.saveAs)(t,this.outputFilename)}}},d=v,p=a(1001),g=(0,p.Z)(d,i,s,!1,null,"17176987",null),D=g.exports,S={name:"Ps1EmulatorView",components:{ConvertPs1Emulator:D}},w=S,y=(0,p.Z)(w,r,n,!1,null,null,null),b=y.exports},5847:function(e,t,a){a.d(t,{Z:function(){return O}});var r=a(7327),n=(a(3408),a(4590),a(3462),a(3767),a(8585),a(8696),a(7658),a(3313));const i="US-ASCII",s=15,o=8192,l=128,c=!0,u="MC",m=0,f=8,h=65535,v=10,d=20,p="US-ASCII",g=4,D=160,S=81,w=82,y=83,b=255,F="SC",A=4,U=64,_="shift-jis";function C(e){const t=e.charAt(0);if("B"===t){const t=e.charAt(1);if("I"===t)return"Japan";if("A"===t)return"North America";if("E"===t)return"Europe"}return"Unknown region"}function E(e){return e.replace(/[\uff01-\uff5e]/g,(e=>String.fromCharCode(e.charCodeAt(0)-65248))).replace(/\u3000/g," ")}function Z(e,t){const a=l+t*l;return e.slice(a,a+l)}function B(e,t){const a=o*t;return e.slice(a,a+o)}function x(e){if(n.Z.checkMagic(e.rawData,0,F,i),e.rawData.byteLength<=0)throw new Error(`File ${e.filename} does not contain any data`);if(e.rawData.byteLength%o!==0)throw new Error(`File ${e.filename} size must be a multiple of ${o} bytes`)}function T(e){const t=new Uint8Array(e);return t.reduce(((e,t)=>e^t))}function M(e,t){return t.encode(e).slice(0,d)}function k(){const e=new ArrayBuffer(l),t=new Uint8Array(e);return t.fill(0),t[0]=u.charCodeAt(0),t[1]=u.charCodeAt(1),t[l-1]=T(e),e}function R(){const e=new ArrayBuffer(l),t=new Uint8Array(e),a=new DataView(e);return t.fill(0),a.setUint8(m,D),a.setUint16(f,h,c),a.setUint8(l-1,T(e)),e}function I(){return new ArrayBuffer(o)}function L(){const e=new ArrayBuffer(l),t=new Uint8Array(e),a=new DataView(e);return t.fill(0),a.setUint8(m+0,b),a.setUint8(m+1,b),a.setUint8(m+2,b),a.setUint8(m+3,b),a.setUint16(f,h,c),e}function $(){const e=new ArrayBuffer(l),t=new Uint8Array(e);return t.fill(0),e}function N(e,t,a){const r=e.rawData.byteLength/o;let n=!1,i=0;r>=2&&(n=!0,i=r-2);const s=[];let u=t;{const t=$(),n=new Uint8Array(t),i=new DataView(t),o=M(e.filename,a);i.setUint8(m,S),i.setUint32(g,e.rawData.byteLength,c),i.setUint16(f,r>1?u+1:h,c),n.set(o,v),i.setUint8(l-1,T(t)),s.push(t)}for(let o=0;o<i;o+=1){u+=1;const e=$(),t=new DataView(e);t.setUint8(m,w),t.setUint16(f,u+1,c),t.setUint8(l-1,T(e)),s.push(e)}if(n){const e=$(),t=new DataView(e);t.setUint8(m,y),t.setUint16(f,h,c),t.setUint8(l-1,T(e)),s.push(e)}const d=[];for(let l=0;l<r;l+=1)d.push(e.rawData.slice(l*o,(l+1)*o));return{directoryFrames:s,saveBlocks:d}}class O{static encodeFilename(e,t){return M(e,t)}static createFromPs1MemcardData(e){return new O(e)}static createFromSaveFiles(e){e.forEach((e=>x(e)));const t=e.reduce(((e,t)=>e+t.filesize));if(t>s*o)throw new Error(`Total size of files is ${t} bytes (${t/o} blocks) but max size is ${s*o} bytes (${s} blocks)`);const a=[],r=[],i=new TextEncoder(p);a.push(k()),e.forEach((e=>{const t=N(e,a.length-1,i);a.push(...t.directoryFrames),r.push(...t.saveBlocks)}));while(a.length<s+1)a.push(R()),r.push(I());while(a.length<o/l)a.push(L());const c=n.Z.concatArrayBuffers(a);r.unshift(c);const u=n.Z.concatArrayBuffers(r);return new O(u)}constructor(e){this.arrayBuffer=e;const t=e.slice(0,o),a=e.slice(o,o*(s+1));n.Z.checkMagic(t,0,u,i);const r=new TextDecoder(p),l=new TextDecoder(_);this.saveFiles=[];for(let o=0;o<s;o+=1){let e=Z(t,o),s=new DataView(e);const u=s.getUint8(m);if((240&u)!==D&&u!==b&&u===S){const u=n.Z.trimNull(r.decode(e.slice(v,v+d))),m=C(u),p=s.getUint32(g,c),D=[B(a,o)];n.Z.checkMagic(D[0],0,F,i);const S=E(n.Z.trimNull(l.decode(D[0].slice(A,A+U))));let w=s.getUint16(f,c);while(w!==h)D.push(B(a,w)),e=Z(t,w),s=new DataView(e),w=s.getUint16(f,c);const y=n.Z.concatArrayBuffers(D);if(y.byteLength!==p)throw new Error(`Save file appears to be corrupted: expected file ${S} to be ${p} bytes, but was actually ${y.byteLength} bytes`);this.saveFiles.push({startingBlock:o,filename:u,regionName:m,description:S,rawData:y})}}}getDirectoryFrame(e){const t=this.arrayBuffer.slice(0,o);return Z(t,e)}getSaveFiles(){return this.saveFiles}getArrayBuffer(){return this.arrayBuffer}}(0,r.Z)(O,"NUM_BLOCKS",s),(0,r.Z)(O,"FRAME_SIZE",l),(0,r.Z)(O,"TOTAL_SIZE",(s+1)*o),(0,r.Z)(O,"DIRECTORY_FRAME_AVAILABLE_OFFSET",m),(0,r.Z)(O,"DIRECTORY_FRAME_NEXT_BLOCK_OFFSET",f),(0,r.Z)(O,"DIRECTORY_FRAME_FIRST_LINK_BLOCK",S)},7327:function(e,t,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){if("object"!==r(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=n(e,"string");return"symbol"===r(t)?t:String(t)}function s(e,t,a){return t=i(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return s}})}}]);