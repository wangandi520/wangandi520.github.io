(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6769],{2675:(e,t,r)=>{"use strict";r.d(t,{ND:()=>i});var s=r(21029),o=r(79336);let a=o.env.NEXT_PUBLIC_SUPABASE_URL||"https://gxkhxxxeapexynpouyjz.supabase.co",n=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4a2h4eHhlYXBleHlucG91eWp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0MzAwNTksImV4cCI6MjA1MDAwNjA1OX0.jhinkQsimQoidsg_U59YD5ROw4PmMJQNKuyXbr4TiQA",i=(0,s.UU)(a,n)},4529:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(62574),o=r(38012),a=r(50843),n=r(46450);function i(){var e;let t=(0,o.useRouter)(),{login:r}=(0,n.A)(),i=new URLSearchParams((window.location.hash||"").slice(1)),l=i.get("access_token"),u=i.get("refresh_token"),c=i.get("type"),g=null!=(e=i.get("next"))?e:"/",h=i.get("error"),m=i.get("error_description"),f=i.get("error_code");return(0,a.m)({accessToken:l,refreshToken:u,type:c,next:g,error:h,errorCode:f,errorDescription:m,login:r,navigate:t.push}),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,s.jsx)("span",{className:"loading loading-infinity loading-xl w-20"})})}},38012:(e,t,r)=>{"use strict";var s=r(72588);r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},46450:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,O:()=>l});var s=r(62574),o=r(84574),a=r(2675),n=r(28091);let i=(0,o.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(()=>localStorage.getItem("token")),[u,c]=(0,o.useState)(()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}});(0,o.useEffect)(()=>{let e=e=>{if(e){console.log("Syncing session");let{access_token:t,refresh_token:r,user:s}=e;localStorage.setItem("token",t),localStorage.setItem("refresh_token",r),localStorage.setItem("user",JSON.stringify(s)),n.Ay.identify(s.id),l(t),c(s)}else console.log("Clearing session"),localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),l(null),c(null)},t=async()=>{try{await a.ND.auth.refreshSession()}catch(t){e(null)}},{data:r}=a.ND.auth.onAuthStateChange((t,r)=>{e(r)});return t(),()=>{null==r||r.subscription.unsubscribe()}},[]);let g=async()=>{console.log("Logging out");try{await a.ND.auth.refreshSession()}catch(e){}finally{await a.ND.auth.signOut(),localStorage.removeItem("token"),localStorage.removeItem("user"),l(null),c(null)}};return(0,s.jsx)(i.Provider,{value:{token:r,user:u,login:(e,t)=>{console.log("Logging in"),l(e),c(t),localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t))},logout:g},children:t})},u=()=>{let e=(0,o.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},50843:(e,t,r)=>{"use strict";r.d(t,{m:()=>o});var s=r(2675);function o(e){let{accessToken:t,refreshToken:r,login:o,navigate:a,type:n,next:i="/",error:l}=e;!async function(){if(l)return a("/auth/error");if(!t||!r)return a("/library");let{error:e}=await s.ND.auth.setSession({access_token:t,refresh_token:r});if(e){console.error("Error setting session:",e),a("/auth/error");return}let{data:{user:u}}=await s.ND.auth.getUser();if(u){if(o(t,u),"recovery"===n)return a("/auth/recovery");a(i)}else console.error("Error fetching user data"),a("/auth/error")}()}},58403:(e,t,r)=>{Promise.resolve().then(r.bind(r,4529))}},e=>{var t=t=>e(e.s=t);e.O(0,[7412,1029,426,3125,7358],()=>t(58403)),_N_E=e.O()}]);