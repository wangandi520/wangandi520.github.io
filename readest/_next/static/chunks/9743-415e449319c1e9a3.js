"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9743],{3189:(e,t,n)=>{n.d(t,{HY:()=>f,Rg:()=>u,u6:()=>h,xb:()=>c});var r,l,i,a,o=n(84648),s=n(47868);null!=(r=Object).groupBy||(r.groupBy=(e,t)=>{let n=Object.create(null),r=0;for(let l of e){let e=t(l,r++);e in n?n[e].push(l):n[e]=[l]}return n}),null!=(l=Map).groupBy||(l.groupBy=(e,t)=>{let n=new Map,r=0;for(let l of e){let e=t(l,r++),i=n.get(e);i?i.push(l):n.set(e,[l])}return n});let f=s,u={EPUB:"epub",PDF:"pdf",MOBI:"mobi",CBZ:"cbz",FB2:"fb2",FBZ:"fbz"};class c{async isZip(){let e=new Uint8Array(await this.file.slice(0,4).arrayBuffer());return 80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]}async isPDF(){let e=new Uint8Array(await this.file.slice(0,5).arrayBuffer());return 37===e[0]&&80===e[1]&&68===e[2]&&70===e[3]&&45===e[4]}async makeZipLoader(){let e=async()=>{let e=Math.min(65536,this.file.size),t=new Uint8Array(await this.file.slice(this.file.size-e,this.file.size).arrayBuffer());for(let e=t.length-22;e>=0;e--)if(80===t[e]&&75===t[e+1]&&5===t[e+2]&&6===t[e+3]){let n=t[e+20]+(t[e+21]<<8),r=e+22,l=t.slice(r,r+n);return new TextDecoder().decode(l)}return null},{configure:t,ZipReader:r,BlobReader:l,TextWriter:i,BlobWriter:a}=await n.e(2363).then(n.bind(n,92363));t({useWebWorkers:!1});let o=new r(new l(this.file)),s=await o.getEntries(),f=new Map(s.map(e=>[e.filename,e])),u=e=>function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),l=1;l<n;l++)r[l-1]=arguments[l];return f.has(t)?e(f.get(t),...r):null},c=u(e=>e.getData?e.getData(new i):null);return{entries:s,loadText:c,loadBlob:u((e,t)=>e.getData?e.getData(new a(t)):null),getSize:e=>{var t,n;return null!=(n=null==(t=f.get(e))?void 0:t.uncompressedSize)?n:0},getComment:e,sha1:void 0}}isCBZ(){return"application/vnd.comicbook+zip"===this.file.type||this.file.name.endsWith(".".concat(u.CBZ))}isFB2(){return"application/x-fictionbook+xml"===this.file.type||this.file.name.endsWith(".".concat(u.FB2))}isFBZ(){return"application/x-zip-compressed-fb2"===this.file.type||this.file.name.endsWith(".fb2.zip")||this.file.name.endsWith(".".concat(u.FBZ))}async open(){let{allowScript:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null,r="EPUB";if(!this.file.size)throw Error("File is empty");if(await this.isZip()){let l=await this.makeZipLoader(),{entries:i}=l;if(this.isCBZ()){let{makeComicBook:e}=await n.e(8531).then(n.bind(n,28531));t=await e(l,this.file),r="CBZ"}else if(this.isFBZ()){let e=i.find(e=>e.filename.endsWith(".".concat(u.FB2))),a=await l.loadBlob((null!=e?e:i[0]).filename),{makeFB2:o}=await n.e(5796).then(n.bind(n,5796));t=await o(a),r="FBZ"}else{let{EPUB:i}=await Promise.all([n.e(4300),n.e(8052)]).then(n.bind(n,44300));t=await new i(l).init({allowScript:e}),r="EPUB"}}else if(await this.isPDF()){let{makePDF:e}=await Promise.all([n.e(8189),n.e(5671)]).then(n.bind(n,38189));t=await e(this.file),r="PDF"}else if(await (await Promise.all([n.e(9867),n.e(3290)]).then(n.bind(n,59867))).isMOBI(this.file)){let e=await n.e(9393).then(n.bind(n,19393)),{MOBI:l}=await Promise.all([n.e(9867),n.e(3290)]).then(n.bind(n,59867));t=await new l({unzlib:e.unzlibSync}).open(this.file),r="MOBI"}else if(this.isFB2()){let{makeFB2:e}=await n.e(5796).then(n.bind(n,5796));t=await e(this.file),r="FB2"}return{book:t,format:r}}constructor(e){(0,o._)(this,"file",void 0),this.file=e}}let h=e=>{let{defaultView:t}=e,{writingMode:n,direction:r}=t.getComputedStyle(e.body);return{vertical:"vertical-rl"===n||"vertical-lr"===n,rtl:"rtl"===e.body.dir||"rtl"===r||"rtl"===e.documentElement.dir}}},45375:(e,t,n)=>{n.d(t,{Pr:()=>i,Xu:()=>l,Yw:()=>a});var r=n(36261);function l(e){return/^[0-9a-f]{32}$/.test(e)}function i(e){return(0,r.md5)(e).slice(0,7)}async function a(e){let t=r.md5.create();for(let n=-1;n<=10;n++){let r=Math.min(e.size,1024<<2*n),l=Math.min(r+1024,e.size);if(r>=e.size)break;let i=e.slice(r,l),a=new Uint8Array(await i.arrayBuffer());t.update(a)}return t.hex()}},47868:(e,t,n)=>{let r;n.r(t),n.d(t,{collapse:()=>B,compare:()=>A,fake:()=>R,fromCalibreHighlight:()=>T,fromCalibrePos:()=>k,fromElements:()=>j,fromRange:()=>P,isCFI:()=>s,joinIndir:()=>h,parse:()=>g,toElement:()=>D,toRange:()=>S});let l=(e,t)=>e.map((e,n,r)=>t(e,n,r)?n:null).filter(e=>null!=e),i=(e,t)=>[-1,...t,e.length].reduce((t,n)=>{var r;let{xs:l,a:i}=t;return{xs:null!=(r=null==l?void 0:l.concat([e.slice(i+1,n)]))?r:[],a:n}},{}).xs,a=(e,t)=>e.slice(0,-1).concat([e[e.length-1].concat(t[0])]).concat(t.slice(1)),o=/\d/,s=/^epubcfi\((.*)\)$/,f=e=>e.replace(/[\^[\](),;=]/g,"^$&"),u=e=>s.test(e)?e:"epubcfi(".concat(e,")"),c=e=>{var t,n;return null!=(n=null==(t=e.match(s))?void 0:t[1])?n:e},h=(r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("!")},function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return"epubcfi(".concat(r(...t.map(e=>{var t,n;return null!=(n=null==(t=e.match(s))?void 0:t[1])?n:e})),")")}),d=e=>{let t=[],n,r,l="",i=e=>(t.push(e),n=null,l=""),a=e=>(l+=e,r=!1);for(let t of Array.from(e.trim()).concat("")){if("^"===t&&!r){r=!0;continue}if("!"===n)i(["!"]);else if(","===n)i([","]);else if("/"===n||":"===n)if(o.test(t)){a(t);continue}else i([n,parseInt(l)]);else if("~"===n)if(o.test(t)||"."===t){a(t);continue}else i(["~",parseFloat(l)]);else if("@"===n){if(":"===t){i(["@",parseFloat(l)]),n="@";continue}if(o.test(t)||"."===t){a(t);continue}i(["@",parseFloat(l)])}else if("["===n){";"!==t||r?","!==t||r?"]"!==t||r?a(t):i(["[",l]):(i(["[",l]),n="["):(i(["[",l]),n=";");continue}else if(null==n?void 0:n.startsWith(";")){"="!==t||r?";"!==t||r?"]"!==t||r?a(t):i([n,l]):(i([n,l]),n=";"):(n=";".concat(l),l="");continue}("/"===t||":"===t||"~"===t||"@"===t||"["===t||"!"===t||","===t)&&(n=t)}return t},p=(e,t)=>l(e,e=>{let[n]=e;return n===t}),m=e=>{let t,n=[];for(let[i,a]of e){if("/"===i)n.push({index:a});else{var r,l;let e=n[n.length-1];if(":"===i)e.offset=a;else if("~"===i)e.temporal=a;else if("@"===i)e.spatial=(null!=(r=e.spatial)?r:[]).concat(a);else if(";s"===i)e.side=a;else if("["===i)if("/"===t&&a)e.id=a;else{e.text=(null!=(l=e.text)?l:[]).concat(a);continue}}t=i}return n},y=e=>i(e,p(e,"!")).map(m),g=e=>{let t=d(c(e)),n=p(t,",");if(!n.length)return y(t);let[r,l,a]=i(t,n).map(y);return{parent:r,start:l,end:a}},w=e=>{var t,n;let{index:r,id:l,offset:i,temporal:a,spatial:o,text:s,side:u}=e,c=u?";s=".concat(u):"";return"/".concat(r)+(l?"[".concat(f(l)).concat(c,"]"):"")+(null!=i&&r%2?":".concat(i):"")+(a?"~".concat(a):"")+(o?"@".concat(o.join(":")):"")+(s||!l&&u?"["+(null!=(n=null==s||null==(t=s.map(f))?void 0:t.join(","))?n:"")+c+"]":"")},v=e=>e.parent?[e.parent,e.start,e.end].map(v).join(","):e.map(e=>e.map(w).join("")).join("!"),b=e=>u(v(e)),B=(e,t)=>"string"==typeof e?b(B(g(e),t)):e.parent?a(e.parent,e[t?"end":"start"]):e,E=(e,t)=>{"string"==typeof e&&(e=g(e)),"string"==typeof t&&(t=g(t)),e=B(e),t=B(t,!0);let n=e[e.length-1],r=t[t.length-1],l=[],i=[],a=[],o=!0,s=Math.max(n.length,r.length);for(let e=0;e<s;e++){let t=n[e],s=r[e];o&&(o=(null==t?void 0:t.index)===(null==s?void 0:s.index)&&!(null==t?void 0:t.offset)&&!(null==s?void 0:s.offset)),o?l.push(t):(t&&i.push(t),s&&a.push(s))}return b({parent:e.slice(0,-1).concat([l]),start:[i],end:[a]})},A=(e,t)=>{if("string"==typeof e&&(e=g(e)),"string"==typeof t&&(t=g(t)),e.start||t.start)return A(B(e),B(t))||A(B(e,!0),B(t,!0));for(let l=0;l<Math.max(e.length,t.length);l++){var n,r;let i=null!=(n=e[l])?n:[],a=null!=(r=t[l])?r:[],o=Math.max(i.length,a.length)-1;for(let e=0;e<=o;e++){let t=i[e],n=a[e];if(!t)return -1;if(!n||t.index>n.index)return 1;if(t.index<n.index)return -1;if(e===o){if(t.offset>n.offset)return 1;if(t.offset<n.offset)return -1}}}return 0},F=e=>{let{nodeType:t}=e;return 3===t||4===t},x=e=>{let{nodeType:t}=e;return 1===t},C=(e,t)=>{let n=Array.from(e.childNodes).filter(e=>F(e)||x(e));return t?n.map(e=>{let n=t(e);return n===NodeFilter.FILTER_REJECT?null:n===NodeFilter.FILTER_SKIP?C(e,t):e}).flat().filter(e=>e):n},I=(e,t)=>{let n=C(e,t).reduce((e,t)=>{let n=e[e.length-1];return n?F(t)?Array.isArray(n)?n.push(t):F(n)?e[e.length-1]=[n,t]:e.push(t):x(n)?e.push(null,t):e.push(t):e.push(t),e},[]);return x(n[0])&&n.unshift("first"),x(n[n.length-1])&&n.push("last"),n.unshift("before"),n.push("after"),n},_=(e,t,n)=>{let{id:r}=t[t.length-1];if(r){let t=e.ownerDocument.getElementById(r);if(t)return{node:t,offset:0}}for(let{index:r}of t){var l,i;let t=e?I(e,n)[r]:null;if("first"===t)return{node:null!=(l=e.firstChild)?l:e};if("last"===t)return{node:null!=(i=e.lastChild)?i:e};if("before"===t)return{node:e,before:!0};if("after"===t)return{node:e,after:!0};e=t}let{offset:a}=t[t.length-1];if(!Array.isArray(e))return{node:e,offset:a};let o=0;for(let t of e){let{length:e}=t.nodeValue;if(o+e>=a)return{node:t,offset:a-o};o+=e}},z=(e,t,n)=>{let{parentNode:r,id:l}=e,i=I(r,n),a=i.findIndex(t=>Array.isArray(t)?t.some(t=>t===e):t===e),o=i[a];if(Array.isArray(o)){let n=0;for(let r of o)if(r===e){n+=t;break}else n+=r.nodeValue.length;t=n}let s={id:l,index:a,offset:t};return(r!==e.ownerDocument.documentElement?z(r,null,n).concat(s):[s]).filter(e=>-1!==e.index)},P=(e,t)=>{let{startContainer:n,startOffset:r,endContainer:l,endOffset:i}=e,a=z(n,r,t);return e.collapsed?b([a]):E([a],[z(l,i,t)])},S=(e,t,n)=>{let r=B(t),l=B(t,!0),i=e.documentElement,a=_(i,r[0],n),o=_(i,l[0],n),s=e.createRange();return a.before?s.setStartBefore(a.node):a.after?s.setStartAfter(a.node):s.setStart(a.node,a.offset),o.before?s.setEndBefore(o.node):o.after?s.setEndAfter(o.node):s.setEnd(o.node,o.offset),s},j=e=>{let t=[],{parentNode:n}=e[0],r=z(n);for(let[l,i]of I(n).entries()){let n=e[t.length];i===n&&t.push(b([r.concat({id:n.id,index:l})]))}return t},D=(e,t)=>_(e.documentElement,B(t)).node,R={fromIndex:e=>u("/6/".concat((e+1)*2)),toIndex:e=>(null==e?void 0:e.at(-1).index)/2-1},k=e=>{let[t]=g(e),n=t.shift();return t.shift(),b([[{index:6},n],t])},T=e=>{let{spine_index:t,start_cfi:n,end_cfi:r}=e,l=R.fromIndex(t)+"!";return E(l+n.slice(2),l+r.slice(2))}},58529:(e,t,n)=>{n.d(t,{iY:()=>A,kY:()=>I,Yq:()=>D,v7:()=>k,qq:()=>S,ud:()=>z,QK:()=>R,Ef:()=>_,t7:()=>E,jk:()=>Z,is:()=>M,fM:()=>C,An:()=>b,df:()=>v,p$:()=>T,_T:()=>m,e7:()=>B,pX:()=>y,ow:()=>w,hM:()=>j,z1:()=>g,jR:()=>x});var r=n(3189),l=n(50981),i=n(59092),a=(n(99122),n(12049),n(53151),n(89008),n(79336));let o=a.env.S3_ENDPOINT||"",s=a.env.S3_REGION||"auto",f=a.env.S3_ACCESS_KEY_ID||"",u=a.env.S3_SECRET_ACCESS_KEY||"";new i.Y({forcePathStyle:!0,region:s,endpoint:o,credentials:{accessKeyId:f,secretAccessKey:u}}),n(97798),n(79336);var c=n(79336);let h=()=>c.env.NEXT_PUBLIC_OBJECT_STORAGE_TYPE?c.env.NEXT_PUBLIC_OBJECT_STORAGE_TYPE:"r2";var d=n(91225),p=n(40965);let m=e=>"".concat(e.hash),y=()=>"library.json",g=e=>"r2"===h()?"".concat(e.hash,"/").concat((0,l.Xw)(e.title),".").concat(r.Rg[e.format]):"s3"===h()?"".concat(e.hash,"/").concat(e.hash,".").concat(r.Rg[e.format]):"",w=e=>"".concat(e.hash,"/").concat((0,l.Xw)(e.title),".").concat(r.Rg[e.format]),v=e=>"".concat(e.hash,"/cover.png"),b=e=>"".concat(e.hash,"/config.json"),B=e=>(((0,l.Gz)(e)||(0,l.em)(e))&&(e=decodeURI(e)),e.replace(/\\/g,"/").split("/").pop().split("?")[0]),E=e=>{var t;return(null==(t=e.replace(/\\/g,"/").split("/").pop())?void 0:t.split(".").slice(0,-1).join("."))||""},A={updatedAt:0},F=e=>{let t=(0,l.gl)();if(!e)return"";if("string"==typeof e)return e;let n=Object.keys(e);return e[t]||e[n[0]]},x=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(t=t||(0,l.gl)(),e)?new Intl.ListFormat("en",{style:"narrow",type:"unit"}):new Intl.ListFormat(t,{style:"long",type:"conjunction"})},C=e=>{try{let t="string"==typeof e?e:null==e?void 0:e[0];return t?t.split("-")[0]:""}catch(e){return""}},I=(e,t)=>{let n=C(t)||"en";return Array.isArray(e)?x("zh"===n,n).format(e.map(e=>"string"==typeof e?e:F(null==e?void 0:e.name))):"string"==typeof e?e:F(null==e?void 0:e.name)},_=e=>"string"==typeof e?e:F(e),z=e=>"string"==typeof e?e:F(e),P=e=>p.Lq[e]||e.toUpperCase(),S=e=>Array.isArray(e)?e.map(P).join(", "):P(e||""),j=e=>Array.isArray(e)?e[0]:e,D=e=>{if(!e)return;let t=(0,l.gl)();try{return new Date(e).toLocaleDateString(t,{year:"numeric",month:"long",day:"numeric"})}catch(e){return}},R=e=>e?Array.isArray(e)?e.join(", "):e:"",k=e=>null===e?"":new Intl.NumberFormat("en",{style:"unit",unit:"byte",unitDisplay:"narrow",notation:"compact",compactDisplay:"short"}).format(e),T=(e,t)=>{let n=e.format,{section:r,pageinfo:l}=t;return"PDF"===n?r?r.current+1:0:l?l.current+1:0},M=e=>{switch(e){case"horizontal-tb":return"ltr";case"horizontal-rl":case"vertical-rl":return"rtl";default:return"auto"}},Z=e=>{let t=j(e)||"";return(0,d.i)(t)}}}]);