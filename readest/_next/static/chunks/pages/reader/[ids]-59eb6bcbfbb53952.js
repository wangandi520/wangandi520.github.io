(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1340],{30082:(e,t,n)=>{"use strict";n.d(t,{Ed:()=>i,LB:()=>u,Mp:()=>r,S$:()=>d,ZA:()=>o,i1:()=>s,ot:()=>h,ov:()=>l});var a=n(32450);async function l(e){return await (0,a.lA)("plugin:native-bridge|copy_uri_to_path",{payload:e})}async function s(e){await (0,a.lA)("plugin:native-bridge|use_background_audio",{payload:e})}async function i(e){return await (0,a.lA)("plugin:native-bridge|install_package",{payload:e})}async function r(e){return await (0,a.lA)("plugin:native-bridge|set_system_ui_visibility",{payload:e})}async function o(){return await (0,a.lA)("plugin:native-bridge|get_status_bar_height")}let c=null;async function d(){if(c)return c;let e=await (0,a.lA)("plugin:native-bridge|get_sys_fonts_list");return c=e,e}async function u(e){await (0,a.lA)("plugin:native-bridge|intercept_keys",{payload:e})}async function h(e){await (0,a.lA)("plugin:native-bridge|lock_screen_orientation",{payload:e})}},39602:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>st});var a=n(33736),l=n(55584),s=n(27876),i=n(76171),r=n(21816),o=n(11733),c=n(3638),d=n(91844),u=n(49445),h=n(64371),m=n(82606),f=n(29803);function p(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function g(e){let{r:t,g:n,b:a}=(0,m.A)(e).toRgb(),l=p(t/255),s=p(n/255),i=p(a/255),r=Math.cbrt(.4122214708*l+.5363325363*s+.0514459929*i),o=Math.cbrt(.2119034982*l+.6806995451*s+.1073969566*i),c=Math.cbrt(.0883024619*l+.2817188376*s+.6299787005*i),d=1.9779984951*r-2.428592205*o+.4505937099*c,u=.0259040371*r+.7827717662*o-.808675766*c,h=Math.sqrt(d*d+u*u),f=180/Math.PI*Math.atan2(u,d);f<0&&(f+=360);let g=(100*(.2104542553*r+.793617785*o-.0040720468*c)).toFixed(4),x=h.toFixed(6),b=f.toFixed(6);return"".concat(g,"% ").concat(x," ").concat(b)}let x=e=>(0,m.A)(e).isDark()?"100% 0 0":"0% 0 0",b=e=>{let{bg:t,fg:n,primary:a}=e;return{"base-100":t,"base-200":(0,m.A)(t).darken(5).toHexString(),"base-300":(0,m.A)(t).darken(12).toHexString(),"base-content":n,neutral:(0,m.A)(t).darken(15).desaturate(20).toHexString(),"neutral-content":(0,m.A)(n).lighten(20).desaturate(20).toHexString(),primary:a,secondary:(0,m.A)(a).lighten(20).toHexString(),accent:(0,m.A)(a).analogous()[1].toHexString()}},v=e=>{let{bg:t,fg:n,primary:a}=e;return{"base-100":t,"base-200":(0,m.A)(t).lighten(5).toHexString(),"base-300":(0,m.A)(t).lighten(12).toHexString(),"base-content":n,neutral:(0,m.A)(t).lighten(15).desaturate(20).toHexString(),"neutral-content":(0,m.A)(n).darken(20).desaturate(20).toHexString(),primary:a,secondary:(0,m.A)(a).darken(20).toHexString(),accent:(0,m.A)(a).triad()[1].toHexString()}},w=[{name:"default",label:(0,f.Gg)("Default"),colors:{light:b({fg:"#171717",bg:"#ffffff",primary:"#0066cc"}),dark:v({fg:"#e0e0e0",bg:"#222222",primary:"#77bbee"})}},{name:"gray",label:(0,f.Gg)("Gray"),colors:{light:b({fg:"#222222",bg:"#e0e0e0",primary:"#4488cc"}),dark:v({fg:"#c6c6c6",bg:"#444444",primary:"#88ccee"})}},{name:"sepia",label:(0,f.Gg)("Sepia"),colors:{light:b({fg:"#5b4636",bg:"#f1e8d0",primary:"#008b8b"}),dark:v({fg:"#ffd595",bg:"#342e25",primary:"#48d1cc"})}},{name:"grass",label:(0,f.Gg)("Grass"),colors:{light:b({fg:"#232c16",bg:"#d7dbbd",primary:"#177b4d"}),dark:v({fg:"#d8deba",bg:"#333627",primary:"#a6d608"})}},{name:"cherry",label:(0,f.Gg)("Cherry"),colors:{light:b({fg:"#4e1609",bg:"#f0d1d5",primary:"#de3838"}),dark:v({fg:"#e5c4c8",bg:"#462f32",primary:"#ff646e"})}},{name:"sky",label:(0,f.Gg)("Sky"),colors:{light:b({fg:"#262d48",bg:"#cedef5",primary:"#2d53e5"}),dark:v({fg:"#babee1",bg:"#282e47",primary:"#ff646e"})}},{name:"solarized",label:(0,f.Gg)("Solarized"),colors:{light:b({fg:"#586e75",bg:"#fdf6e3",primary:"#268bd2"}),dark:v({fg:"#93a1a1",bg:"#002b36",primary:"#268bd2"})}},{name:"gruvbox",label:(0,f.Gg)("Gruvbox"),colors:{light:b({fg:"#3c3836",bg:"#fbf1c7",primary:"#076678"}),dark:v({fg:"#ebdbb2",bg:"#282828",primary:"#83a598"})}},{name:"nord",label:(0,f.Gg)("Nord"),colors:{light:b({fg:"#2e3440",bg:"#eceff4",primary:"#5e81ac"}),dark:v({fg:"#d8dee9",bg:"#2e3440",primary:"#88c0d0"})}},{name:"contrast",label:(0,f.Gg)("Contrast"),colors:{light:b({fg:"#000000",bg:"#ffffff",primary:"#4488cc"}),dark:v({fg:"#ffffff",bg:"#000000",primary:"#88ccee"})}},{name:"sunset",label:(0,f.Gg)("Sunset"),colors:{light:b({fg:"#423126",bg:"#fff7f0",primary:"#fe6b64"}),dark:v({fg:"#f6e1d7",bg:"#3c2b25",primary:"#ff9c94"})}}],y=e=>"\n    --b1: ".concat(g(e["base-100"]),";\n    --b2: ").concat(g(e["base-200"]),";\n    --b3: ").concat(g(e["base-300"]),";\n    --bc: ").concat(g(e["base-content"]),";\n    \n    --p: ").concat(g(e.primary),";\n    --pc: ").concat(x(e.primary),";\n    \n    --s: ").concat(g(e.secondary),";\n    --sc: ").concat(x(e.secondary),";\n    \n    --a: ").concat(g(e.accent),";\n    --ac: ").concat(x(e.accent),";\n    \n    --n: ").concat(g(e.neutral),";\n    --nc: ").concat(g(e["neutral-content"]),";\n    \n    --in: 69.37% 0.047 231;\n    --inc: 100% 0 0;\n    --su: 78.15% 0.12 160;\n    --suc: 100% 0 0;\n    --wa: 90.69% 0.123 84;\n    --wac: 0% 0 0;\n    --er: 70.9% 0.184 22;\n    --erc: 100% 0 0;\n  "),j=e=>{let t=b(e.colors.light),n=v(e.colors.dark),a="".concat(e.name,"-light"),l="".concat(e.name,"-dark"),s='\n    [data-theme="'.concat(a,'"] {\n      ').concat(y(t),'\n    }\n    \n    [data-theme="').concat(l,'"] {\n      ').concat(y(n),"\n    }\n    \n    :root {\n      --").concat(a,": 1;\n      --").concat(l,": 1;\n    }\n  "),i=document.createElement("style");i.id="theme-".concat(a,"-styles"),i.textContent=s;let r=document.getElementById(i.id);return r&&r.remove(),document.head.appendChild(i),{light:a,dark:l}},N=(e,t,n,a,l,s,i,r,o)=>{let c=["Georgia","Times New Roman"],d=[e,...h.H0.filter(t=>t!==e&&t!==l&&!c.includes(t)),...l!==e?[l]:[],...h.az.filter(t=>t!==e&&t!==l),...c.filter(e=>h.H0.includes(e)&&!c.includes(l)),...h.o6],u=[t,...h.Z4.filter(e=>e!==t&&e!==l),...l!==t?[l]:[],...h.Yk.filter(e=>e!==t&&e!==l),...h.o6],m=[n,...h.nh.filter(e=>e!==n)];return"\n    html {\n      --serif: ".concat(d.map(e=>'"'.concat(e,'"')).join(", "),", serif;\n      --sans-serif: ").concat(u.map(e=>'"'.concat(e,'"')).join(", "),", sans-serif;\n      --monospace: ").concat(m.map(e=>'"'.concat(e,'"')).join(", "),", monospace;\n    }\n    html, body {\n      font-family: var(").concat("serif"===a.toLowerCase()?"--serif":"--sans-serif",") ").concat(o?"!important":"",";\n      font-size: ").concat(s,"px !important;\n      font-weight: ").concat(r,';\n    }\n    font[size="1"] {\n      font-size: ').concat(i,'px;\n    }\n    font[size="2"] {\n      font-size: ').concat(1.5*i,'px;\n    }\n    font[size="3"] {\n      font-size: ').concat(s,'px;\n    }\n    font[size="4"] {\n      font-size: ').concat(1.2*s,'px;\n    }\n    font[size="5"] {\n      font-size: ').concat(1.5*s,'px;\n    }\n    font[size="6"] {\n      font-size: ').concat(2*s,'px;\n    }\n    font[size="7"] {\n      font-size: ').concat(3*s,'px;\n    }\n    /* hardcoded inline font size */\n    [style*="font-size: 16px"], [style*="font-size:16px"] {\n      font-size: 1rem !important;\n    }\n    body * {\n      ').concat(o?"font-family: revert !important;":"","\n    }\n    \n  ")},k=(e,t,n)=>{let{bg:a,fg:l,primary:s,isDarkMode:i}=n;return"\n    html {\n      --theme-bg-color: ".concat(a,";\n      --theme-fg-color: ").concat(l,";\n      --theme-primary-color: ").concat(s,";\n      color-scheme: ").concat(i?"dark":"light",";\n    }\n    html, body {\n      color: ").concat(l,";\n    }\n    div, p, span, pre {\n      ").concat(e?"background-color: ".concat(a," !important;"):"","\n    }\n    a:any-link {\n      ").concat(e?"color: ".concat(s,";"):i?"color: lightblue;":"","\n      text-decoration: none;\n    }\n    p:has(img), span:has(img) {\n      background-color: ").concat(a,";\n    }\n    body.pbg {\n      ").concat(i?"background-color: ".concat(a," !important;"):"","\n    }\n    img {\n      ").concat(i&&t?"filter: invert(100%);":"","\n    }\n    /* inline images */\n    p img, span img, sup img {\n      mix-blend-mode: ").concat(i?"screen":"multiply",';\n    }\n    /* override inline hardcoded text color */\n    *[style*="color: rgb(0,0,0)"], *[style*="color: rgb(0, 0, 0)"],\n    *[style*="color: #000"], *[style*="color: #000000"], *[style*="color: black"],\n    *[style*="color:rgb(0,0,0)"], *[style*="color:rgb(0, 0, 0)"],\n    *[style*="color:#000"], *[style*="color:#000000"], *[style*="color:black"] {\n      color: ').concat(l," !important;\n    }\n    /* for the Gutenberg eBooks */\n    #pg-header * {\n      color: inherit !important;\n    }\n    .x-ebookmaker, .x-ebookmaker-cover, .x-ebookmaker-coverpage {\n      background-color: unset !important;\n    }\n    /* for the Feedbooks eBooks */\n    .chapterHeader, .chapterHeader * {\n      border-color: unset;\n      background-color: ").concat(a," !important;\n    }\n  ")},S=(e,t,n,a,l,s,i,r,o,c,d)=>'\n  @namespace epub "http://www.idpf.org/2007/ops";\n  html {\n    --default-text-align: '.concat(i?"justify":"start",';\n    hanging-punctuation: allow-end last;\n    orphans: 2;\n    widows: 2;\n  }\n  [align="left"] { text-align: left; }\n  [align="right"] { text-align: right; }\n  [align="center"] { text-align: center; }\n  [align="justify"] { text-align: justify; }\n  :is(hgroup, header) p {\n      text-align: unset;\n      hyphens: unset;\n  }\n  pre {\n      white-space: pre-wrap !important;\n      tab-size: 2;\n  }\n  html[has-background], body[has-background] {\n    --background-set: var(--theme-bg-color);\n  }\n  html, body {\n    ').concat("auto"===c?"":"writing-mode: ".concat(c," !important;"),"\n    text-align: var(--default-text-align);\n    max-height: unset;\n  }\n  html {\n    background-color: var(--theme-bg-color, transparent);\n    background: var(--background-set, none);\n  }\n  body {\n    overflow: unset;\n    zoom: ").concat(o,";\n  }\n  svg, img {\n    height: auto;\n    width: auto;\n    background-color: transparent !important;\n  }\n  p, li, blockquote, dd, div:not(:has(*:not(b, a, em, i, strong, u, span))) {\n    line-height: ").concat(n," ").concat(e?"!important":"",";\n    word-spacing: ").concat(a,"px ").concat(e?"!important":"",";\n    letter-spacing: ").concat(l,"px ").concat(e?"!important":"",";\n    text-indent: ").concat(d?1.2*s:s,"em ").concat(e?"!important":"",";\n    ").concat(i?"text-align: justify ".concat(e?"!important":"",";"):"","\n    ").concat(!i&&e?"text-align: unset !important;":"",";\n    -webkit-hyphens: ").concat(r?"auto":"manual",";\n    hyphens: ").concat(r?"auto":"manual",";\n    -webkit-hyphenate-limit-before: 3;\n    -webkit-hyphenate-limit-after: 2;\n    -webkit-hyphenate-limit-lines: 2;\n    hanging-punctuation: allow-end last;\n    widows: 2;\n  }\n  p:has(> img:only-child), p:has(> span:only-child > img:only-child) {\n    text-indent: unset !important;\n  }\n  p {\n    ").concat(d?"margin-left: ".concat(t,"em ").concat(e?"!important":"",";"):"","\n    ").concat(d?"margin-right: ".concat(t,"em ").concat(e?"!important":"",";"):"","\n    ").concat(!d?"margin-top: ".concat(t,"em ").concat(e?"!important":"",";"):"","\n    ").concat(!d?"margin-bottom: ".concat(t,"em ").concat(e?"!important":"",";"):"","\n  }\n  div {\n    ").concat(d&&e?"margin-left: ".concat(t,"em !important;"):"","\n    ").concat(d&&e?"margin-right: ".concat(t,"em !important;"):"","\n    ").concat(!d&&e?"margin-top: ".concat(t,"em !important;"):"","\n    ").concat(!d&&e?"margin-bottom: ".concat(t,"em !important;"):"",'\n  }\n\n  pre {\n    white-space: pre-wrap !important;\n  }\n\n  .epubtype-footnote,\n  aside[epub|type~="endnote"],\n  aside[epub|type~="footnote"],\n  aside[epub|type~="note"],\n  aside[epub|type~="rearnote"] {\n    display: none;\n  }\n\n  /* Now begins really dirty hacks to fix some badly designed epubs */\n  img.pi {\n    ').concat(d?"transform: rotate(90deg);":"","\n    ").concat(d?"transform-origin: center;":"","\n    ").concat(d?"height: 2em;":"","\n    ").concat(d?"width: ".concat(n,"em;"):"","\n    ").concat(d?"vertical-align: unset;":"","\n  }\n\n  .duokan-footnote-content,\n  .duokan-footnote-item {\n    display: none;\n  }\n\n  .calibre {\n    color: unset;\n  }\n\n  /* inline images without dimension */\n  p > img, span > img, sup img {\n    height: 1em;\n  }\n  p:has(> img:only-child) img, span:has(> img:only-child) img {\n    height: auto;\n  }\n\n  /* workaround for some badly designed epubs */\n  div.left *, p.left * { text-align: left; }\n  div.right *, p.right * { text-align: right; }\n  div.center *, p.center * { text-align: center; }\n  div.justify *, p.justify * { text-align: justify; }\n\n  .nonindent, .noindent {\n    text-indent: unset !important;\n  }\n"),C=()=>"\n  .duokan-footnote-content,\n  .duokan-footnote-item {\n    display: block !important;\n  }\n\n  body {\n    padding: 1em !important;\n  }\n\n  a:any-link {\n    text-decoration: none;\n  }\n\n  ol {\n    margin: 0;\n    padding: 0;\n  }\n\n  p, li, blockquote, dd {\n    margin: unset !important;\n    text-indent: unset !important;\n  }\n",A=()=>"\n  .translation-block-wrapper {\n    display: block !important;\n    margin: 0.5em 0 !important;\n  }\n  .translation-target.hidden {\n    display: none !important;\n  }\n",E=()=>{let e="auto",t="default",n=!1,a=[];t=localStorage.getItem("themeColor")||"default",e=localStorage.getItem("themeMode")||"auto",a=JSON.parse(localStorage.getItem("customThemes")||"[]"),n=window.matchMedia("(prefers-color-scheme: dark)").matches;let l="dark"===e||"auto"===e&&n,s=w.find(e=>e.name===t);if(!s){let e=a.find(e=>e.name===t);e&&(s={name:e.name,label:e.label,colors:{light:b(e.colors.light),dark:v(e.colors.dark)}})}s||(s=w[0]);let i=l?s.colors.dark:s.colors.light;return{bg:i["base-100"],fg:i["base-content"],primary:i.primary,palette:i,isDarkMode:l}},L=(e,t)=>{t||(t=E());let n=S(e.overrideLayout,e.paragraphMargin,e.lineHeight,e.wordSpacing,e.letterSpacing,e.textIndent,e.fullJustification,e.hyphenation,e.zoomLevel/100,e.writingMode,e.vertical),a=["ios","android"].includes((0,f.Ox)()),l=N(e.serifFont,e.sansSerifFont,e.monospaceFont,e.defaultFont,e.defaultCJKFont,e.defaultFontSize*(a?1.25:1),e.minimumFontSize,e.fontWeight,e.overrideFont),s=k(e.overrideColor,e.invertImgColorInDark,t),i=A(),r=e.userStylesheet;return"".concat(n,"\n").concat(l,"\n").concat(s,"\n").concat(i,"\n").concat(r)},T=(e,t,n,a)=>{let l=["ios","android"].includes((0,f.Ox)())?1.25:1,s=t*(1-e.gapPercent/100),i=n-2*e.marginPx;return a=(a=a.replace(/([^{]+)({[^}]+})/g,(e,t,n)=>{let a=/text-align\s*:\s*center\s*[;$]/.test(n),l=/text-indent\s*:\s*0(?:\.0+)?(?:px|em|rem|%)?\s*[;$]/.test(n);return a?(n=n.replace(/(text-align\s*:\s*center)(\s*;|\s*$)/g,"$1 !important$2"),l&&(n=n.replace(/(text-indent\s*:\s*0(?:\.0+)?(?:px|em|rem|%)?)(\s*;|\s*$)/g,"$1 !important$2")),t+n):e})).replace(/font-size\s*:\s*xx-small/gi,"font-size: 0.6rem").replace(/font-size\s*:\s*x-small/gi,"font-size: 0.75rem").replace(/font-size\s*:\s*small/gi,"font-size: 0.875rem").replace(/font-size\s*:\s*medium/gi,"font-size: 1rem").replace(/font-size\s*:\s*large/gi,"font-size: 1.2rem").replace(/font-size\s*:\s*x-large/gi,"font-size: 1.5rem").replace(/font-size\s*:\s*xx-large/gi,"font-size: 2rem").replace(/font-size\s*:\s*xxx-large/gi,"font-size: 3rem").replace(/font-size\s*:\s*(\d+(?:\.\d+)?)px/gi,(e,t)=>{let n=parseFloat(t)/l/16;return"font-size: ".concat(n,"rem")}).replace(/font-size\s*:\s*(\d+(?:\.\d+)?)pt/gi,(e,t)=>{let n=parseFloat(t)/l/12;return"font-size: ".concat(n,"rem")}).replace(/(\d*\.?\d+)vw/gi,(e,t)=>parseFloat(t)*s/100+"px").replace(/(\d*\.?\d+)vh/gi,(e,t)=>parseFloat(t)*i/100+"px").replace(/[\s;]color\s*:\s*black/gi,"color: var(--theme-fg-color)").replace(/[\s;]color\s*:\s*#000000/gi,"color: var(--theme-fg-color)").replace(/[\s;]color\s*:\s*#000/gi,"color: var(--theme-fg-color)").replace(/[\s;]color\s*:\s*rgb\(0,\s*0,\s*0\)/gi,"color: var(--theme-fg-color)")};var M=n(74615);let D=()=>localStorage&&localStorage.getItem("themeMode")||"auto",R=()=>localStorage&&localStorage.getItem("themeColor")||"default",z=(0,u.v)((e,t)=>{let n=D(),a=R(),l=window.matchMedia("(prefers-color-scheme: dark)").matches,s=E();{let n=window.matchMedia("(prefers-color-scheme: dark)");n.addEventListener("change",()=>{let a=t().themeMode,l="dark"===a||"auto"===a&&n.matches;e({systemIsDarkMode:n.matches,isDarkMode:l})})}return{themeMode:n,themeColor:a,systemIsDarkMode:l,isDarkMode:"dark"===n||"auto"===n&&l,themeCode:s,systemUIVisible:!1,statusBarHeight:24,showSystemUI:()=>e({systemUIVisible:!0}),dismissSystemUI:()=>e({systemUIVisible:!1}),setStatusBarHeight:t=>e({statusBarHeight:t}),getIsDarkMode:()=>t().isDarkMode,setThemeMode:n=>{localStorage&&localStorage.setItem("themeMode",n);let a="dark"===n||"auto"===n&&t().systemIsDarkMode;document.documentElement.setAttribute("data-theme","".concat(t().themeColor,"-").concat(a?"dark":"light")),e({themeMode:n,isDarkMode:a}),e({themeCode:E()})},setThemeColor:n=>{localStorage&&localStorage.setItem("themeColor",n),document.documentElement.setAttribute("data-theme","".concat(n,"-").concat(t().isDarkMode?"dark":"light")),e({themeColor:n}),e({themeCode:E()})},updateAppTheme:e=>{if((0,M.hx)()){var n;let{palette:a}=t().themeCode;null==(n=document.querySelector('meta[name="theme-color"]'))||n.setAttribute("content",a[e])}},saveCustomTheme:async(e,t,n,a)=>{let l=t.globalReadSettings.customThemes||[],s=l.findIndex(e=>e.name===n.name);a?s>-1&&l.splice(s,1):s>-1?l[s]=n:l.push(n),t.globalReadSettings.customThemes=l,localStorage.setItem("customThemes",JSON.stringify(l));let i=await e.getAppService();await i.saveSettings(t)}}}),P=(0,u.v)(e=>({settings:{},isFontLayoutSettingsDialogOpen:!1,isFontLayoutSettingsGlobal:!0,setSettings:t=>e({settings:t}),saveSettings:async(e,t)=>{let n=await e.getAppService();await n.saveSettings(t)},setFontLayoutSettingsDialogOpen:t=>e({isFontLayoutSettingsDialogOpen:t}),setFontLayoutSettingsGlobal:t=>e({isFontLayoutSettingsGlobal:t})}));var I=n(30082);let B=function(){let{systemUIVisible:e=!0,appThemeColor:t="base-100"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{appService:n}=(0,i.D)(),{settings:a}=P(),{themeColor:l,isDarkMode:s,showSystemUI:r,dismissSystemUI:o,updateAppTheme:c,setStatusBarHeight:u}=z();(0,d.useEffect)(()=>{c(t),(null==n?void 0:n.isMobileApp)&&(e?r():o(),(0,I.Mp)({visible:e,darkMode:s})),(null==n?void 0:n.isAndroidApp)&&(0,I.ZA)().then(e=>{e.height&&e.height>0&&u(e.height/window.devicePixelRatio)})},[n,s]),(0,d.useEffect)(()=>{var e,t;let n=null!=(t=null==(e=a.globalReadSettings)?void 0:e.customThemes)?t:[];n.forEach(e=>{j(e)}),localStorage.setItem("customThemes",JSON.stringify(n))},[a]),(0,d.useEffect)(()=>{let e=s?"dark":"light";document.documentElement.setAttribute("data-theme","".concat(l,"-").concat(e)),document.documentElement.style.setProperty("color-scheme",e)},[l,s])};var _=n(23471);let V=(e,t)=>{for(let n of e){if(n.href===t)return[n];if(n.subitems){let e=V(n.subitems,t);if(e.length)return[n,...e]}}return[]},F=(e,t)=>{let n=0,a=e.length-1,l=null;for(;n<=a;){let s=Math.floor((n+a)/2),i=e[s].cfi||"",r=_.HY.compare(i,t);if(0===r)return e[s];r<0?(l=e[s],n=s+1):a=s-1}return l},O=(e,t)=>{let n=(null==e?void 0:e.toc)||[],a=(null==e?void 0:e.sections)||[];if(!n.length||!a.length)return;let l=a.map(e=>"no"!=e.linear&&e.size>0?e.size:0),s=0,i=l.reduce((e,t)=>(e.push(s),s+=t,e),[]),r=i[i.length-1]||0;a.forEach((e,t)=>{e.location={current:Math.floor(i[t]/1500),next:Math.floor((i[t]+l[t])/1500),total:Math.floor(r/1500)}});let o=a.reduce((e,t)=>(e[t.id]=t,e),{});W(e,n,a,o),t&&H(n)},W=function(e,t,n,a){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return t.forEach(s=>{var i;if(null!=s.id||(s.id=l++),s.href){let l=e.splitTOCHref(s.href)[0],i=a[l];i&&(s.cfi=i.cfi,(l===s.href||t.length<=n.length)&&(s.location=i.location))}s.subitems&&(l=W(e,s.subitems,n,a,l))}),l},H=e=>{e.sort((e,t)=>e.location&&t.location?e.location.current-t.location.current:0)},K=(0,u.v)((e,t)=>({library:[],currentBookshelf:[],checkOpenWithBooks:(0,M.uO)(),checkLastOpenBooks:(0,M.uO)(),getVisibleLibrary:()=>t().library.filter(e=>!e.deletedAt),setCurrentBookshelf:t=>{e({currentBookshelf:t})},setCheckOpenWithBooks:t=>e({checkOpenWithBooks:t}),setCheckLastOpenBooks:t=>e({checkLastOpenBooks:t}),setLibrary:t=>e({library:t}),updateBook:async(n,a)=>{let l=await n.getAppService(),{library:s}=t(),i=s.findIndex(e=>e.hash===a.hash);-1!==i&&(s[i]=a),e({library:[...s]}),l.saveLibraryBooks(s)}})),U=(0,u.v)((e,t)=>({booksData:{},getBookData:e=>{let n=e.split("-")[0];return t().booksData[n]||null},getConfig:e=>{var n;if(!e)return null;let a=e.split("-")[0];return(null==(n=t().booksData[a])?void 0:n.config)||null},setConfig:(t,n)=>{e(e=>{var a;let l=t.split("-")[0],s=(null==(a=e.booksData[l])?void 0:a.config)||{};return Object.assign(s,n),{booksData:{...e.booksData,[l]:{...e.booksData[l],config:s}}}})},saveConfig:async(e,t,n,a)=>{let l=await e.getAppService(),{library:s,setLibrary:i}=K.getState(),r=s.findIndex(e=>e.hash===t.split("-")[0]);if(-1==r)return;let o=s.splice(r,1)[0];o.progress=n.progress,o.updatedAt=Date.now(),s.unshift(o),i(s),n.updatedAt=Date.now(),await l.saveBookConfig(o,n,a),await l.saveLibraryBooks(s)},updateBooknotes:(t,n)=>{let a;return e(e=>{let l=t.split("-")[0],s=e.booksData[l];if(!s)return e;let i=Array.from(new Map(n.map(e=>["".concat(e.id,"-").concat(e.type,"-").concat(e.cfi),e])).values());return a={...s.config,updatedAt:Date.now(),booknotes:i},{booksData:{...e.booksData,[l]:{...s,config:{...s.config,updatedAt:Date.now(),booknotes:i}}}}}),a}}));var G=n(94074);let Y=(0,u.v)((e,t)=>({viewStates:{},bookKeys:[],hoveredBookKey:null,setBookKeys:t=>e({bookKeys:t}),setHoveredBookKey:t=>e({hoveredBookKey:t}),getView:e=>{var n;return e&&(null==(n=t().viewStates[e])?void 0:n.view)||null},setView:(t,n)=>e(e=>({viewStates:{...e.viewStates,[t]:{...e.viewStates[t],view:n}}})),getViews:()=>Object.values(t().viewStates).map(e=>e.view),getViewsById:e=>{let{viewStates:n}=t();return Object.values(n).filter(t=>t.key.startsWith(e)).map(e=>e.view)},clearViewState:t=>{e(e=>{let n={...e.viewStates};return delete n[t],{viewStates:n}})},getViewState:e=>t().viewStates[e]||null,initViewState:async function(t,n,a){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=U.getState().booksData[n];e(e=>({viewStates:{...e.viewStates,[a]:{key:"",view:null,isPrimary:!1,loading:!0,error:null,progress:null,ribbonVisible:!1,ttsEnabled:!1,viewSettings:null}}}));try{var i,r,o,c,d;if(!s){let e=await t.getAppService(),{settings:l}=P.getState(),{library:s}=K.getState(),i=s.find(e=>e.hash===n);if(!i)throw Error("Book not found");let{file:u,config:h}=await e.loadBookContent(i,l);console.log("Loading book",a);let{book:m}=await new _.xb(u).open({allowScript:null==(r=h.viewSettings)?void 0:r.allowScript});O(m,null!=(c=null==(o=h.viewSettings)?void 0:o.sortedTOC)&&c),i.primaryLanguage=null!=(d=i.primaryLanguage)?d:(0,G.hM)(m.metadata.language),U.setState(e=>({booksData:{...e.booksData,[n]:{id:n,book:i,file:u,config:h,bookDoc:m}}}))}let u=(null==(i=U.getState().booksData[n])?void 0:i.config).viewSettings;e(e=>({viewStates:{...e.viewStates,[a]:{...e.viewStates[a],key:a,view:null,isPrimary:l,loading:!1,error:null,progress:null,ribbonVisible:!1,ttsEnabled:!1,viewSettings:JSON.parse(JSON.stringify(u))}}}))}catch(t){console.error(t),e(e=>({viewStates:{...e.viewStates,[a]:{...e.viewStates[a],key:"",view:null,isPrimary:!1,loading:!1,error:"Failed to load book.",progress:null,ribbonVisible:!1,ttsEnabled:!1,viewSettings:null}}}))}},getViewSettings:e=>{var n;return(null==(n=t().viewStates[e])?void 0:n.viewSettings)||null},setViewSettings:(n,a)=>{let l=n.split("-")[0],s=U.getState().booksData[l],i=t().viewStates[n];i&&s&&(i.isPrimary&&U.setState(e=>({booksData:{...e.booksData,[l]:{...s,config:{...s.config,updatedAt:Date.now(),viewSettings:a}}}})),e(e=>({viewStates:{...e.viewStates,[n]:{...e.viewStates[n],viewSettings:a}}})))},getProgress:e=>{var n;return(null==(n=t().viewStates[e])?void 0:n.progress)||null},setProgress:(t,n,a,l,s,i,r)=>e(e=>{var o;let c=t.split("-")[0],d=U.getState().booksData[c],u=e.viewStates[t];if(!u||!d)return e;let h=[(null!=(o=s.next)?o:s.current)+1,s.total],{library:m,setLibrary:f}=K.getState(),p=m.findIndex(e=>e.hash===c);if(-1!==p){let e=[...m],t=e[p];e[p]={...t,progress:h,updatedAt:Date.now()},f(e)}let g=d.config,x={...d.config,updatedAt:Date.now(),progress:h,location:n};return U.setState(e=>({booksData:{...e.booksData,[c]:{...d,config:u.isPrimary?x:g}}})),{viewStates:{...e.viewStates,[t]:{...u,progress:{...u.progress,location:n,sectionHref:null==a?void 0:a.href,sectionLabel:null==a?void 0:a.label,sectionId:null==a?void 0:a.id,section:l,pageinfo:s,timeinfo:i,range:r}}}}}),setBookmarkRibbonVisibility:(t,n)=>e(e=>({viewStates:{...e.viewStates,[t]:{...e.viewStates[t],ribbonVisible:n}}})),setTTSEnabled:(t,n)=>e(e=>({viewStates:{...e.viewStates,[t]:{...e.viewStates[t],ttsEnabled:n}}}))})),q=(0,u.v)(e=>({sideBarBookKey:null,sideBarWidth:"",isSideBarVisible:!1,isSideBarPinned:!1,setSideBarBookKey:t=>e({sideBarBookKey:t}),setSideBarWidth:t=>e({sideBarWidth:t}),toggleSideBar:()=>e(e=>({isSideBarVisible:!e.isSideBarVisible})),toggleSideBarPin:()=>e(e=>({isSideBarPinned:!e.isSideBarPinned})),setSideBarVisible:t=>e({isSideBarVisible:t}),setSideBarPin:t=>e({isSideBarPinned:t})})),X=(0,u.v)((e,t)=>({notebookWidth:"",isNotebookVisible:!1,isNotebookPinned:!1,notebookNewAnnotation:null,notebookEditAnnotation:null,notebookAnnotationDrafts:{},setNotebookWidth:t=>e({notebookWidth:t}),toggleNotebook:()=>e(e=>({isNotebookVisible:!e.isNotebookVisible})),toggleNotebookPin:()=>e(e=>({isNotebookPinned:!e.isNotebookPinned})),setNotebookVisible:t=>e({isNotebookVisible:t}),setNotebookPin:t=>e({isNotebookPinned:t}),setNotebookNewAnnotation:t=>e({notebookNewAnnotation:t}),setNotebookEditAnnotation:t=>e({notebookEditAnnotation:t}),saveNotebookAnnotationDraft:(t,n)=>e(e=>({notebookAnnotationDrafts:{...e.notebookAnnotationDrafts,[t]:n}})),getNotebookAnnotationDraft:e=>t().notebookAnnotationDrafts[e]}));var J=n(72101);class Z{on(e,t){this.asyncListeners.has(e)||this.asyncListeners.set(e,new Set),this.asyncListeners.get(e).add(t)}off(e,t){var n;null==(n=this.asyncListeners.get(e))||n.delete(t)}async dispatch(e,t){let n=this.asyncListeners.get(e);if(n){let a=new CustomEvent(e,{detail:t});for(let e of n)await e(a)}}onSync(e,t){this.syncListeners.has(e)||this.syncListeners.set(e,[]),this.syncListeners.get(e).push(t)}offSync(e,t){let n=this.syncListeners.get(e);n&&this.syncListeners.set(e,n.filter(e=>e!==t))}dispatchSync(e,t){let n=this.syncListeners.get(e);if(n){let a=new CustomEvent(e,{detail:t});for(let e of[...n].reverse())if(e(a))return!0}return!1}constructor(){(0,J._)(this,"syncListeners",void 0),(0,J._)(this,"asyncListeners",void 0),this.syncListeners=new Map,this.asyncListeners=new Map}}let $=new Z,Q=e=>"VolumeUp"===e||"VolumeDown"===e?$.dispatch("native-key-down",{keyName:e}):"Back"===e&&$.dispatchSync("native-key-down",{keyName:e}),ee=(0,u.v)((e,t)=>({volumeKeysIntercepted:!1,backKeyIntercepted:!1,volumeKeysInterceptionCount:0,backKeyInterceptionCount:0,acquireVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:n}=t();0==n&&(window.onNativeKeyDown=Q,(0,I.LB)({volumeKeys:!0}),e({volumeKeysIntercepted:!0})),e({volumeKeysInterceptionCount:n+1})},releaseVolumeKeyInterception:()=>{let{volumeKeysInterceptionCount:n}=t();n<=1?((0,I.LB)({volumeKeys:!1}),e({volumeKeysIntercepted:!1,volumeKeysInterceptionCount:0})):e({volumeKeysInterceptionCount:n-1})},acquireBackKeyInterception:()=>{let{backKeyInterceptionCount:n}=t();0==n&&(window.onNativeKeyDown=Q,(0,I.LB)({backKey:!0}),e({backKeyIntercepted:!0})),e({backKeyInterceptionCount:n+1})},releaseBackKeyInterception:()=>{let{backKeyInterceptionCount:n}=t();n<=1?((0,I.LB)({backKey:!1}),e({backKeyIntercepted:!1,backKeyInterceptionCount:0})):e({backKeyInterceptionCount:n-1})}}));var et=n(39962);let en=e=>{let t=(0,d.useRef)(null),n=(0,d.useRef)(null);(0,d.useEffect)(()=>{let a=async()=>{try{"wakeLock"in navigator&&(t.current=await navigator.wakeLock.request("screen"),t.current.addEventListener("release",()=>{t.current=null}),console.log("Wake lock acquired"))}catch(e){console.info("Failed to acquire wake lock:",e)}},l=()=>{t.current&&(t.current.release(),t.current=null,console.log("Wake lock released"))},s=()=>{document.hidden?l():a()};return e?a():t.current&&l(),(0,M.hx)()&&e?document.addEventListener("visibilitychange",s):(0,M.uO)()&&e&&(n.current=(0,et.getCurrentWindow)().onFocusChanged(e=>{let{payload:t}=e;t?a():l()})),()=>{l(),(0,M.hx)()&&e&&document.removeEventListener("visibilitychange",s),n.current&&n.current.then(e=>e())}},[e])};var ea=n(50071);let el=()=>{let e=window.open;globalThis.open=function(t,n,a){return(0,M.uO)()?((0,ea.CZ)((null==t?void 0:t.toString())||""),null):e(t,n,a)}},es=[{family:"Bitter",weights:"ital,wght@0,100..900;1,100..900"},{family:"Fira Code",weights:"wght@300..700"},{family:"Literata",weights:"ital,opsz,wght@0,7..72,200..900;1,7..72,200..900"},{family:"Merriweather",weights:"ital,opsz,wght@0,18..144,300..900;1,18..144,300..900"},{family:"Noto Sans",weights:"ital,wght@0,100..900;1,100..900"},{family:"Open Sans",weights:"ital,wght@0,300..800;1,300..800"},{family:"Roboto",weights:"ital,wght@0,100..900;1,100..900"},{family:"Vollkorn",weights:"ital,wght@0,400..900;1,400..900"}],ei=[{family:"LXGW WenKai TC",weights:""},{family:"Noto Sans SC",weights:""},{family:"Noto Sans TC",weights:""},{family:"Noto Serif JP",weights:""}],er=()=>'\n  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?'.concat(es.map(e=>{let{family:t,weights:n}=e;return"family=".concat(encodeURIComponent(t)).concat(n?":".concat(n):"")}).join("&"),'&display=swap" crossorigin="anonymous">\n'),eo=()=>'\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/misans-webfont@1.0.4/misans-l3/misans-l3/result.min.css" crossorigin="anonymous">\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cn-fontsource-lxgw-wen-kai-gb-screen@1.0.6/font.min.css" crossorigin="anonymous">\n  <link rel=\'stylesheet\' href=\'https://fontsapi.zeoseven.com/431/main/result.css\' crossorigin="anonymous"/>\n  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?'.concat(ei.map(e=>{let{family:t,weights:n}=e;return"family=".concat(encodeURIComponent(t)).concat(n?":".concat(n):"")}).join("&"),'&display=swap" crossorigin="anonymous">\n'),ec=()=>'\n  @font-face {\n    font-family: "FangSong";\n    font-display: swap;\n    src: local("Fang Song"), local("FangSong"), local("Noto Serif CJK"), local("Source Han Serif SC VF"), url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.eot");\n    src: url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.eot?#iefix") format("embedded-opentype"),\n    url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.woff2") format("woff2"),\n    url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.woff") format("woff"),\n    url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.ttf") format("truetype"),\n    url("https://db.onlinewebfonts.com/t/2ecbfe1d9bfc191c6f15c0ccc23cbd43.svg#FangSong") format("svg");\n  }\n  @font-face {\n    font-family: "Kaiti";\n    font-display: swap;\n    src: local("Kai"), local("KaiTi"), local("AR PL UKai"), local("LXGW WenKai GB Screen"), url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.eot");\n    src: url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.eot?#iefix")format("embedded-opentype"),\n    url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.woff2")format("woff2"),\n    url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.woff")format("woff"),\n    url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.ttf")format("truetype"),\n    url("https://db.onlinewebfonts.com/t/1ee9941f1b8c128110ca4307dda59917.svg#STKaiti")format("svg");\n  }\n  @font-face {\n    font-family: "Heiti";\n    font-display: swap;\n    src: local("Hei"), local("SimHei"), local("WenQuanYi Zen Hei"), local("Source Han Sans SC VF"), url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.eot");\n    src: url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.eot?#iefix")format("embedded-opentype"),\n    url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.woff2")format("woff2"),\n    url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.woff")format("woff"),\n    url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.ttf")format("truetype"),\n    url("https://db.onlinewebfonts.com/t/a4948b9d43a91468825a5251df1ec58d.svg#WenQuanYi Micro Hei")format("svg");\n  }\n  @font-face {\n    font-family: "XiHeiti";\n    font-display: swap;\n    src: local("PingFang SC"), local("Microsoft YaHei"), local("WenQuanYi Micro Hei"), local("FZHei-B01"), url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.eot");\n    src: url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.eot?#iefix")format("embedded-opentype"),\n    url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.woff2")format("woff2"),\n    url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.woff")format("woff"),\n    url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.ttf")format("truetype"),\n    url("https://db.onlinewebfonts.com/t/4f0b783ba4a1b381fc7e7af81ecab481.svg#STHeiti J Light")format("svg");\n}\n',ed=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t||(0,f.ii)(),a=er();if(n){let t=e.createElement("style");t.textContent=ec(),e.head.appendChild(t),a="".concat(a,"\n").concat(eo())}Array.from(new DOMParser().parseFromString(a,"text/html").head.children).forEach(t=>{if("LINK"===t.tagName){let n=e.createElement("link");n.rel=t.getAttribute("rel")||"",n.href=t.getAttribute("href")||"",n.crossOrigin=t.getAttribute("crossorigin")||"",e.head.appendChild(n)}})};var eu=n(16570),eh=n.n(eu);let em={rE:"0.9.55"};var ef=n(70398),ep=n(44440),eg=n(41791),ex=n(93344),eb=n(77636);ef.Ay.use(eg.A).use(ex.A).use(ep.r9).init({supportedLngs:["en",...eb.options.lngs],fallbackLng:{"zh-HK":["zh-TW","en"],kk:["ru","en"],ky:["ru","en"],tk:["ru","en"],uz:["ru","en"],ug:["ru","en"],tt:["ru","en"],default:["en"]},ns:eb.options.ns,defaultNS:eb.options.defaultNs,backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"},detection:{order:["querystring","localStorage","navigator"],caches:["localStorage"]},keySeparator:!1,nsSeparator:!1,interpolation:{escapeValue:!1},react:{useSuspense:!1}}),ef.Ay.on("languageChanged",e=>{console.log("Language changed to",e)});let ev=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"translation",{t}=(0,ep.Bd)(e);return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(e,{defaultValue:e,...n})}};var ew=n(99674),ey=n.n(ew),ej=n(17037),eN=n(65842),ek=n(88782),eS=n(70842),eC=n(61750);let eA={DAILY_QUOTA_EXCEEDED:"Daily Quota Exceeded"},eE="translations",eL={},eT={},eM=()=>new Promise((e,t)=>{if(!window.indexedDB){console.warn("IndexedDB not supported. Using in-memory cache only."),t(Error("IndexedDB not supported"));return}let n=indexedDB.open("TranslationCache",1);n.onerror=e=>{console.error("IndexedDB error:",e),t(Error("Could not open IndexedDB"))},n.onsuccess=t=>{e(t.target.result)},n.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(eE)){let e=t.createObjectStore(eE,{keyPath:"key"});e.createIndex("provider","provider",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}}}),eD=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t,n=await eM(),a=n.transaction(eE,"readonly"),l=a.objectStore(eE);if(e.onlyLoadProviders&&e.onlyLoadProviders.length>0){let t=e.onlyLoadProviders.map(e=>new Promise(t=>{let n=l.index("provider").getAll(e);n.onsuccess=()=>{t(n.result)},n.onerror=()=>{t([])}})),n=(await Promise.all(t)).flat();eR(n,e)}else(t=l.getAll()).onsuccess=()=>{let n=t.result;eR(n,e)},t.onerror=e=>{console.error("Error loading cache from IndexedDB:",e)};a.oncomplete=()=>{n.close()}}catch(e){console.error("Failed to load cache from IndexedDB:",e)}},eR=(e,t)=>{let n=e;if(t.maxAge){let e=Date.now()-t.maxAge;n=n.filter(t=>t.timestamp>=e)}t.onlyLoadLanguages&&(t.onlyLoadLanguages.source&&t.onlyLoadLanguages.source.length>0&&(n=n.filter(e=>t.onlyLoadLanguages.source.includes(e.sourceLang))),t.onlyLoadLanguages.target&&t.onlyLoadLanguages.target.length>0&&(n=n.filter(e=>t.onlyLoadLanguages.target.includes(e.targetLang)))),t.maxEntries&&n.length>t.maxEntries&&(n.sort((e,t)=>t.timestamp-e.timestamp),n=n.slice(0,t.maxEntries)),n.forEach(e=>{eL[e.key]=e.translation,eT[e.key]=e.timestamp})},ez=(e,t,n,a)=>"".concat(a,":").concat(t,":").concat(n,":").concat(e),eP=async(e,t,n,a)=>{if(!(null==e?void 0:e.trim()))return null;let l=ez(e,t,n,a);if(eL[l])return eL[l];try{let e=await eM(),t=e.transaction(eE,"readonly"),n=t.objectStore(eE).get(l);return new Promise(a=>{n.onsuccess=()=>{let e=n.result;e?(eL[l]=e.translation,eT[l]=e.timestamp,a(e.translation)):a(null)},n.onerror=()=>{a(null)},t.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error accessing IndexedDB:",e),null}},eI=async(e,t,n,a,l)=>{if(!(null==e?void 0:e.trim())||!t)return;let s=ez(e,n,a,l),i=Date.now();eL[s]=t,eT[s]=i;try{let r=await eM(),o=r.transaction(eE,"readwrite");return o.objectStore(eE).put({key:s,translation:t,timestamp:i,provider:l,sourceLang:n,targetLang:a,originalText:e}),new Promise((e,t)=>{o.oncomplete=()=>{r.close(),e()},o.onerror=e=>{console.error("Error storing in IndexedDB:",e),t(Error("Failed to store in IndexedDB"))}})}catch(e){console.error("Error accessing IndexedDB:",e)}},eB=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxAge:t,maxEntries:n,maxSizeInBytes:a,dryRun:l=!1}=e;if(!t&&!n&&!a)return 0;try{let e=await eM(),s=e.transaction(eE,l?"readonly":"readwrite"),i=s.objectStore(eE),r=i.getAll();return new Promise(o=>{r.onsuccess=()=>{let e=r.result,s=[];if(t){let n=Date.now()-t,a=e.filter(e=>e.timestamp<n);s.push(...a)}if(n&&e.length>n){let t=[...e].sort((e,t)=>e.timestamp-t.timestamp).slice(0,e.length-n),a=new Set(s.map(e=>e.key));t.forEach(e=>{a.has(e.key)||s.push(e)})}if(a){let t=0;if(e.forEach(e=>{let n=JSON.stringify(e);t+=n.length}),t>a){let n=e.filter(e=>!s.some(t=>t.key===e.key)).sort((e,t)=>e.timestamp-t.timestamp),l=t-a,i=new Set(s.map(e=>e.key));for(let e of n){if(l<=0)break;if(!i.has(e.key)){let t=JSON.stringify(e),n=2*t.length;s.push(e),i.add(e.key),l-=n}}}}let c=s.length;!l&&c>0&&s.forEach(e=>{i.delete(e.key),delete eL[e.key],delete eT[e.key]}),o(c)},r.onerror=()=>{o(0)},s.oncomplete=()=>{e.close()}})}catch(e){return console.error("Error pruning cache:",e),0}},e_=null;(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{preload:t=!0,preloadOptions:n={maxAge:6048e5,maxEntries:1e3},autoPrune:a=!0,pruneInterval:l=36e5,pruneOptions:s={maxAge:2592e6,maxEntries:1e4,maxSizeInBytes:0xa00000}}=e;t&&await eD(n);let i=null;return a&&(await eB(s),i=window.setInterval(async()=>{await eB(s)},l)),()=>{null!==i&&clearInterval(i)}})().then(e=>{e_=e}),window.addEventListener("beforeunload",()=>{e_&&e_()});let eV={zh:e=>e.replace(/--/g,"⸺").replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1"),es:e=>e.replace(/\?([A-ZÁÉÍÓÚÑÜ])/g,"? $1").replace(/\!([A-ZÁÉÍÓÚÑÜ])/g,"! $1"),fr:e=>e.replace(/\s+([!?:;])/g," $1").replace(/([!?:;])\s+/g,"$1 "),ja:e=>e.replace(/\s+([。、！？])/g,"$1").replace(/([。、！？])\s+/g,"$1")},eF=e=>e.replace(/\s+/g," ").replace(/\s+([.,!?;:])/g,"$1").trim();function eO(e,t){let n=function(e){let t=eV[e.split("-")[0].toLowerCase()];return t?e=>t(eF(e)):eF}(t);return e.map(n)}var eW=n(49682);let eH=(e,t)=>{{let n=t||new Date().toISOString().split("T")[0];localStorage.setItem("translationDailyUsage",JSON.stringify({[n]:e}))}},eK=(0,M.L1)()+"/deepl/translate",eU={name:"deepl",label:(0,f.Gg)("DeepL"),authRequired:!0,quotaExceeded:!1,translate:async function(e,t,n,a){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=eU.authRequired,i={"Content-Type":"application/json"},r="free";if(a&&(r=(0,eW.l3)(a),i.Authorization="Bearer ".concat(a)),s&&!a)throw Error("Authentication token is required for DeepL translation");let o=JSON.stringify({text:e,source_lang:t.toUpperCase(),target_lang:n.toUpperCase(),use_cache:l}),c=h.Vz[r];try{let t=await fetch(eK,{method:"POST",headers:i,body:o});if(!t.ok){let e=await t.json();if(e&&e.error&&e.error===eA.DAILY_QUOTA_EXCEEDED)throw eH(c),eU.quotaExceeded=!0,Error(eA.DAILY_QUOTA_EXCEEDED);throw Error("Translation failed with status ".concat(t.status))}let n=await t.json();if(!n||!n.translations)throw Error("Invalid response from translation service");return e.map((e,t)=>{var a;if(!(null==e?void 0:e.trim().length))return e;let l=null==(a=n.translations)?void 0:a[t];return(null==l?void 0:l.daily_usage)&&(eH(l.daily_usage),eU.quotaExceeded=n.daily_usage>=c),(null==l?void 0:l.text)||e})}catch(e){throw e}}},eG=e=>RegExp("[\\p{Script=Han}\\p{Script=Hiragana}\\p{Script=Katakana}\\p{Script=Hangul}]","u").test(null!=e?e:""),eY=e=>!!e&&["zh","ja","ko"].includes(e.split("-")[0].toLowerCase()),eq=e=>({en:"en-US",fr:"fr-FR",de:"de-DE",es:"es-ES",it:"it-IT",ja:"ja-JP",ko:"ko-KR",pt:"pt-PT",ar:"ar-SA",nl:"nl-NL",pl:"pl-PL",tr:"tr-TR",id:"id-ID",ru:"ru-RU",uk:"uk-UA",zh:"zh-Hans","zh-hans":"zh-Hans","zh-hant":"zh-Hant"})[e]||e,eX=e=>{let t={"zh-CN":"zh-Hans","zh-TW":"zh-Hant","zh-HK":"zh-Hant"};return e.startsWith("zh")?t[e]||"zh-Hans":t[e]||e.split("-")[0].toLowerCase()},eJ=e=>e?e.split("-")[0].toLowerCase():"",eZ=(e,t)=>!!e&&!!t&&eJ(e)===eJ(t),e$=null,eQ=async()=>{let e=Date.now();if(e$&&e$.expiresAt>e)return e$.token;try{let t=(0,M.uO)()?ek.h:window.fetch,n=await t("https://edge.microsoft.com/translate/auth",{method:"GET",headers:{"User-Agent":"Mozilla/5.0"}});if(!n.ok)throw Error("Failed to get auth token: ".concat(n.status));let a=await n.text();return e$={token:a,expiresAt:e+48e4},a}catch(e){throw console.error("Error getting Microsoft translation auth token:",e),e}},e0={name:"azure",label:(0,f.Gg)("Azure Translator"),translate:async(e,t,n)=>{if(!e.length)return[];let a=[],l=t?eq(t.toLowerCase()):"",s=eq(n.toLowerCase()),i=e.map(async(e,t)=>{if(!(null==e?void 0:e.trim().length)){a[t]=e;return}let n=new URLSearchParams({to:s,"api-version":"3.0"});l&&"auto"!==l&&n.append("from",l);let i=await eQ(),r=(0,M.uO)()?ek.h:window.fetch,o=await r("".concat("https://api-edge.cognitive.microsofttranslator.com/translate","?").concat(n.toString()),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i)},body:JSON.stringify([{Text:e}])});if(!o.ok)throw Error("Translation failed with status ".concat(o.status));let c=await o.json();Array.isArray(c)&&c.length>0&&c[0].translations?a[t]=c[0].translations[0].text||e:a[t]=e});return await Promise.all(i),a}},e1={name:"google",label:(0,f.Gg)("Google Translate"),translate:async(e,t,n)=>{if(!e.length)return[];let a=[],l=e.map(async(e,l)=>{if(!(null==e?void 0:e.trim().length)){a[l]=e;return}let s=new URL("https://translate.googleapis.com/translate_a/single");s.searchParams.append("client","gtx"),s.searchParams.append("dt","t"),s.searchParams.append("sl",t.toLowerCase()||"auto"),s.searchParams.append("tl",n.toLowerCase()),s.searchParams.append("q",e);let i=(0,M.uO)()?ek.h:window.fetch,r=await i(s.toString());if(!r.ok)throw Error("Translation failed with status ".concat(r.status));let o=await r.json();if(Array.isArray(o)&&Array.isArray(o[0])){let t=o[0].filter(e=>Array.isArray(e)&&e[0]).map(e=>e[0]).join("");a[l]=t||e}else a[l]=e});return await Promise.all(l),a}};function e2(e,t){if(e!==t.name)throw Error('Translator name "'.concat(e,'" does not match implementation name "').concat(t.name,'"'));return t}let e4=e2("deepl",eU),e3=[e4,e2("azure",e0),e2("google",e1)],e8=e=>e3.find(t=>t.name===e),e5=()=>e3;function e6(){let{provider:e="deepl",sourceLang:t="AUTO",targetLang:n="EN",enablePolishing:a=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=ev(),{token:i}=(0,s.A)(),[r,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(e),[h,m]=(0,d.useState)(()=>e8(e)),[f]=(0,d.useState)(()=>e5());return(0,d.useEffect)(()=>{o(!1)},[e,t,n]),(0,d.useEffect)(()=>{let t=e5().filter(e=>(!e.authRequired||!!i)&&!e.quotaExceeded),n=(t.find(t=>t.name===e)||t[0]).name;m(e8(n)),u(n)},[e]),{translate:(0,d.useCallback)(async(e,s)=>{var r;let d=(null==s?void 0:s.source)||t,h=(null==s?void 0:s.target)||n,m=null!=(r=null==s?void 0:s.useCache)&&r;if(0===e.length||e.every(e=>!(null==e?void 0:e.trim())))return e;let p=[],g=[];if(await Promise.all(e.map(async(e,t)=>{(null==e?void 0:e.trim())&&(await eP(e,d,h,c)||(p.push(e),g.push(t)))})),0===p.length){let t=await Promise.all(e.map(e=>eP(e,d,h,c).then(t=>t||e)));return a?eO(t,h):t}o(!0);try{let t=f.find(e=>e.name===c);if(!t)throw Error("No translator found for provider: ".concat(c));let n=await t.translate(p,d,h,i,m);await Promise.all(p.map(async(e,t)=>eI(e,n[t]||"",d,h,c)));let l=[...e];return g.forEach((e,t)=>{l[e]=n[t]||""}),await Promise.all(l.map(async(t,n)=>{if(!g.includes(n)){let t=e[n];if(!(null==t?void 0:t.trim()))return;let a=await eP(t,d,h,c);a&&(l[n]=a)}})),o(!1),a?eO(l,h):l}catch(e){throw e instanceof Error&&e.message.includes(eA.DAILY_QUOTA_EXCEEDED)&&($.dispatch("toast",{message:l("Daily translation quota reached. Select another translate service to proceed."),type:"error"}),u("azure")),o(!1),e instanceof Error?e:Error(String(e))}},[c,t,n,h,i]),translator:h,translators:f,loading:r}}var e9=n(24143),e7=n(19860),te=n(29018);let tt=(e,t)=>{let n=(0,d.useRef)(!1),a=(0,d.useRef)(0),l=(0,d.useRef)(0),s=(0,d.useRef)(0),i=(0,d.useRef)(0),r=(0,d.useRef)(0);return{handleDragStart:(0,d.useCallback)(o=>{n.current=!0,"touches"in o?(l.current=o.touches[0].clientY,a.current=o.touches[0].clientX):(l.current=o.clientY,a.current=o.clientX),r.current=performance.now();let c=t=>{if(n.current){let n=0,a=0,l=0,r=0;if("touches"in t&&t.touches.length>0){let e=t.touches[0];l=e.clientX,r=e.clientY}else l=t.clientX,r=t.clientY;n=l-s.current,a=r-i.current,s.current=l,i.current=r,e({clientX:l,clientY:r,deltaX:n,deltaY:a})}},d=e=>{n.current=!1;let s=0,i=0,o=0,u=0,h=performance.now()-r.current;if("touches"in e){let t=e.changedTouches[0];o=t.clientX,u=t.clientY}else o=e.clientX,u=e.clientY;s=o-a.current;let m=(i=u-l.current)/h;t&&t({velocity:m,deltaT:h,clientX:o,clientY:u,deltaX:s,deltaY:i}),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",d)};window.addEventListener("mousemove",c,{passive:!0}),window.addEventListener("mouseup",d),window.addEventListener("touchmove",c,{passive:!0}),window.addEventListener("touchend",d)},[e,t])}};var tn=n(96672),ta=n(20673),tl=n(10279);let ts=e=>{let{id:t,isOpen:n,children:l,snapHeight:s,header:r,title:o,className:u,bgClassName:h,boxClassName:m,contentClassName:f,onClose:p}=e,{appService:g}=(0,i.D)(),{systemUIVisible:x,statusBarHeight:b}=z(),{acquireBackKeyInterception:v,releaseBackKeyInterception:w}=ee(),[y,j]=(0,d.useState)(!s),[N]=(0,d.useState)(()=>"rtl"===(0,tl.A)()),k=(0,d.useRef)(null),S=(0,tn.D)(22),C=window.innerWidth<640,A=e=>{if(e instanceof CustomEvent){if("Back"===e.detail.keyName)return p(),!0}else"Escape"===e.key&&p();return!1};(0,d.useEffect)(()=>{if(n)return j(!s),window.addEventListener("keydown",A),(null==g?void 0:g.isAndroidApp)&&(v(),$.onSync("native-key-down",A)),()=>{window.removeEventListener("keydown",A),(null==g?void 0:g.isAndroidApp)&&(w(),$.offSync("native-key-down",A))}},[n]);let{handleDragStart:E}=tt(e=>{if(!C||!k.current)return;let t=k.current.querySelector(".modal-box"),n=k.current.querySelector(".overlay"),a=e.clientY/window.innerHeight,l=Math.max(0,Math.min(1,a));t&&n&&(t.style.height="100%",t.style.transform="translateY(".concat(100*l,"%)"),n.style.opacity="".concat(1-a),j(e.clientY<44),t.style.transition="padding-top 0.3s ease-out")},e=>{if(!C||!k.current)return;let t=k.current.querySelector(".modal-box"),n=k.current.querySelector(".overlay");if(!t||!n)return;let a=s?1-s+.2:.5;if(e.velocity>.5||e.velocity>=0&&e.clientY>=window.innerHeight*a){let a=.15/Math.max(e.velocity,.5);t.style.height="100%",t.style.transition="transform ".concat(a,"s ease-out"),t.style.transform="translateY(100%)",n.style.transition="opacity ".concat(a,"s ease-out"),n.style.opacity="0",p(),setTimeout(()=>{t.style.transform="translateY(0%)"},300)}else s&&e.clientY>window.innerHeight*(s?1-s-.2:.5)&&e.clientY<window.innerHeight*a?(n.style.transition="opacity 0.3s ease-out",n.style.opacity="".concat(1-s),t.style.height="".concat(100*s,"%"),t.style.bottom="0",t.style.transition="transform 0.3s ease-out",t.style.transform=""):(j(!0),t.style.height="100%",t.style.transition="transform 0.3s ease-out",t.style.transform="translateY(0%)",n.style.opacity="0");(null==g?void 0:g.hasHaptics)&&(0,ta._q)("medium")});return(0,a.jsxs)("dialog",{ref:k,id:null!=t?t:"dialog",open:n,className:(0,c.A)("modal sm:min-w-90 z-50 h-full w-full !items-start !bg-transparent sm:w-full sm:!items-center",u),dir:N?"rtl":void 0,children:[(0,a.jsx)("div",{className:(0,c.A)("overlay fixed inset-0 z-10 bg-black/50 sm:bg-black/20",h),onClick:p}),(0,a.jsxs)("div",{className:(0,c.A)("modal-box settings-content absolute z-20 flex flex-col rounded-none rounded-tl-2xl rounded-tr-2xl p-0 sm:rounded-2xl","h-full max-h-full w-full max-w-full",window.innerWidth<window.innerHeight?"sm:h-[50%] sm:w-3/4":"sm:h-[65%] sm:w-1/2 sm:max-w-[600px]",m),style:{paddingTop:(null==g?void 0:g.hasSafeAreaInset)&&y?"max(env(safe-area-inset-top), ".concat(x?b:0,"px)"):"0px",...(null==g?void 0:g.isMobile)?{height:s?"".concat(100*s,"%"):"100%",bottom:0}:{}},children:[(0,a.jsx)("div",{className:(0,c.A)("drag-handle h-10 max-h-10 min-h-10 w-full cursor-row-resize items-center justify-center","transition-padding-top flex duration-300 ease-out sm:hidden"),onMouseDown:E,onTouchStart:E,children:(0,a.jsx)("div",{className:"bg-base-content/50 h-1 w-10 rounded-full"})}),(0,a.jsx)("div",{className:"dialog-header bg-base-100 sticky top-1 z-10 flex items-center justify-between px-4",children:r||(0,a.jsxs)("div",{className:"flex h-11 w-full items-center justify-between",children:[(0,a.jsx)("button",{tabIndex:-1,onClick:p,className:"btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden",children:N?(0,a.jsx)(te.ree,{size:S}):(0,a.jsx)(te.VR3,{size:S})}),(0,a.jsx)("div",{className:"z-15 pointer-events-none absolute inset-0 flex h-11 items-center justify-center",children:(0,a.jsx)("span",{className:"line-clamp-1 text-center font-bold",children:null!=o?o:""})}),(0,a.jsx)("button",{tabIndex:-1,onClick:p,className:"bg-base-300/65 btn btn-ghost btn-circle ml-auto hidden h-6 min-h-6 w-6 focus:outline-none sm:flex",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})}),(0,a.jsx)("div",{className:(0,c.A)("text-base-content my-2 flex-grow overflow-y-auto px-6 sm:px-[10%]",f),children:l})]})]})},ti=e=>{var t;let{version:n}=e,l=ev(),[s,r]=(0,d.useState)("EN"),{translate:o}=e6({provider:"azure",sourceLang:"AUTO",targetLang:s}),{appService:u}=(0,i.D)(),m=(0,e9.useSearchParams)(),p=em.rE,g=null!=(t=null!=n?n:null==m?void 0:m.get("version"))?t:"",[x,b]=(0,d.useState)(null),[v,w]=(0,d.useState)(!1),[y,j]=(0,d.useState)(g),[N,k]=(0,d.useState)([]),[S,C]=(0,d.useState)(null),[A,E]=(0,d.useState)(null),[L,T]=(0,d.useState)(!1),[M,D]=(0,d.useState)(null);(0,d.useEffect)(()=>{r((0,f.JK)())},[]),(0,d.useEffect)(()=>{let e=async()=>{let e=await (0,ej.z)();e&&b(e)},t=async()=>{let e=await (0,ek.h)(h.GM),t=await e.json();if(ey().gt(t.version,em.rE)){var n;let e=(0,eN.zJ)(),a=null==(n=t.platforms["aarch64"===e?"android-arm64":"android-universal"])?void 0:n.url,l=null==u?void 0:u.fs.getPrefix("Cache"),s="".concat(l,"/Readest_").concat(t.version,"_").concat("aarch64"===e?"arm64":"universal",".apk");b({currentVersion:em.rE,version:t.version,date:t.date,body:t.notes,downloadAndInstall:async e=>{await new Promise(async(t,n)=>{let l=0,i=0;await (0,e7.e2)(a,s,n=>{e&&(!i&&n.total?e({event:"Started",data:{contentLength:i=n.total}}):l>0&&n.progress===n.total&&(console.log("APK downloaded to",s),null==e||e({event:"Finished"}),setTimeout(()=>{t()},1e3)),e({event:"Progress",data:{chunkLength:n.progress-l}}),l=n.progress)}).catch(e=>{console.error("Download failed:",e),n(e)})});let t=await (0,I.Ed)({path:s});t.success?console.log("APK installed successfully"):console.error("Failed to install APK:",t.error)}})}};(async()=>{let n=(0,eN.NW)();["macos","windows","linux"].includes(n)?e():"android"===n&&t()})()},[]),(0,d.useEffect)(()=>{let e=async(e,t)=>{try{let n=await (0,ek.h)(h.V6),a=(await n.json()).releases;return Object.entries(a).filter(n=>{let[a]=n;return ey().gt(a,e)&&ey().lte(a,t)}).sort((e,t)=>{let[n]=e,[a]=t;return ey().rcompare(n,a)}).map(e=>{let[t,n]=e;return{version:t,date:new Date(n.date).toDateString(),notes:n.notes}})}catch(e){return console.error("Failed to fetch changelog:",e),[]}},t=e=>e.split(/(?:^|\s)\d+\.\s/).map(e=>e.trim()).filter(e=>e.length>0),n=async n=>{j(n.version);let a=await e(p,n.version);if(0===a.length){var l;a=[{version:n.version,date:new Date(n.date).toDateString(),notes:t(null!=(l=n.body)?l:"")}]}for(let e of a)try{e.notes=await o(e.notes,{useCache:!0})}catch(e){console.log("Failed to translate changelog:",e)}k(a)};x&&n(x)},[x]),(0,d.useEffect)(()=>{w(!0)},[]);let R=async()=>{var e;if(!x)return;let t=0,n=0,a=0;C(0),T(!0),await (null==(e=x.downloadAndInstall)?void 0:e.call(x,e=>{switch(e.event){case"Started":E(n=e.data.contentLength);break;case"Progress":D(t+=e.data.chunkLength),C(Math.floor(t/n*100)),t-a>=1048576&&(console.log("downloaded ".concat(t," bytes from ").concat(n)),a=t);break;case"Finished":console.log("download finished"),C(100)}})),console.log("package installed"),(null==u?void 0:u.isAndroidApp)||await (0,eC.b)()};return v&&y?(0,a.jsx)("div",{className:"bg-base-100 flex min-h-screen justify-center",children:(0,a.jsxs)("div",{className:"flex w-full max-w-2xl flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-center gap-4 sm:flex-row sm:items-start",children:[(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(eh(),{src:"/icon.png",alt:"Logo",className:"h-20 w-20",width:64,height:64})}),(0,a.jsxs)("div",{className:"text-base-content flex-grow text-sm",children:[(0,a.jsx)("h2",{className:"mb-4 text-center font-bold sm:text-start",children:l("A new version of Readest is Available!")}),(0,a.jsx)("p",{className:"mb-2",children:l("Readest {{newVersion}} is available (installed version {{currentVersion}}).",{newVersion:y,currentVersion:p})}),(0,a.jsx)("p",{className:"mb-2",children:l("Download and install now?")}),(0,a.jsxs)("div",{className:"flex w-full flex-row items-center justify-end gap-4",children:[null!==S&&(0,a.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,a.jsx)("progress",{className:"progress my-1 h-4 w-full",value:S,max:"100"}),(0,a.jsx)("p",{className:"text-base-content/75 flex items-center justify-center text-sm",children:S<100?l("Downloading {{downloaded}} of {{contentLength}}",{downloaded:M?"".concat(Math.floor(M/1024/1024)," MB"):"0 MB",contentLength:A?"".concat(Math.floor(A/1024/1024)," MB"):"0 MB"}):l("Download finished")})]}),(0,a.jsx)("div",{className:"card-actions",children:(0,a.jsx)("button",{className:(0,c.A)("btn btn-warning text-base-100 px-6 font-bold",(!x||L)&&"btn-disabled"),onClick:R,children:l("DOWNLOAD & INSTALL")})})]})]})]}),(0,a.jsxs)("div",{className:"text-base-content text-sm",children:[(0,a.jsx)("h3",{className:"mb-2 font-bold",children:l("Changelog:")}),(0,a.jsx)("div",{className:"bg-base-300 mb-4 rounded-lg px-4 pb-2 pt-4",children:N.length>0?N.map(e=>(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h4",{className:"mb-2 font-bold",children:[e.version," (",e.date,")"]}),(0,a.jsx)("ul",{className:"list-disc space-y-1 ps-6 text-sm",children:e.notes.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]},e.version)):(0,a.jsxs)("div",{className:"flex h-56 w-full flex-col gap-4",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-28"}),(0,a.jsx)("div",{className:"skeleton h-4 w-full"}),(0,a.jsx)("div",{className:"skeleton h-4 w-full"})]})})]})]})}):null},tr=(e,t)=>{let n=document.getElementById("updater_window");if(n){let a=new CustomEvent("setDialogVisibility",{detail:{visible:e,newVersion:t}});n.dispatchEvent(a)}},to=()=>{let e=ev(),[t,n]=(0,d.useState)(""),[l,s]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let e=e=>{let{visible:t,newVersion:a}=e.detail;s(t),a&&n(a)},t=document.getElementById("updater_window");return t&&t.addEventListener("setDialogVisibility",e),()=>{t&&t.removeEventListener("setDialogVisibility",e)}},[]),(0,a.jsx)(ts,{id:"updater_window",isOpen:l,title:e("Software Update"),onClose:()=>s(!1),boxClassName:"sm:!w-[80%] sm:h-auto",children:(0,a.jsx)(ti,{version:null!=t?t:void 0})})},tc="lastAppUpdateCheck",td=e=>{let t=new eS.wp("updater",{url:"/updater?version=".concat(e),title:"Software Update",width:626,height:406,center:!0,resizable:!0});t.once("tauri://created",()=>{console.log("new window created")}),t.once("tauri://error",e=>{console.error("error creating window",e)})},tu=async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=localStorage.getItem(tc),a=Date.now();if(t&&n&&a-parseInt(n,10)<1e3*h.L7)return!1;localStorage.setItem(tc,a.toString()),console.log("Checking for updates");let l=(0,eN.NW)();if(["macos","windows","linux"].includes(l)){let e=await (0,ej.z)();return e&&td(e.version),!!e}if("android"===l)try{let e=await (0,ek.h)(h.GM,{connectTimeout:5e3}),t=await e.json(),n=ey().gt(t.version,em.rE);return n&&("android-arm64"in t.platforms||"android-universal"in t.platforms)&&tr(!0,t.version),n}catch(e){throw console.warn("Failed to fetch Android update info",e),Error("Failed to fetch Android update info")}return!1},th=e=>{let t=navigator.userAgent;if(null==e?void 0:e.isAndroidApp){let e=t.match(/Chrome\/([0-9.]+)/);return e?"WebView ".concat(e[1]):"Android WebView"}if(null==e?void 0:e.isIOSApp){let e=t.match(/AppleWebKit\/([0-9.]+)/);return e?"WebView ".concat(e[1]):"iOS WebView"}if(null==e?void 0:e.isMacOSApp){let e=t.match(/AppleWebKit\/([0-9.]+)/);return e?"WebView ".concat(e[1]):"macOS WebView"}if((null==e?void 0:e.appPlatform)==="tauri"&&(null==e?void 0:e.osPlatform)==="windows"){let e=t.match(/Edg\/([0-9.]+)/);return e?"Edge ".concat(e[1]):"Edge WebView2"}if((null==e?void 0:e.appPlatform)==="tauri"&&(null==e?void 0:e.osPlatform)==="linux"){let e=t.match(/AppleWebKit\/([0-9.]+)/);return e?"WebView ".concat(e[1]):"Linux WebView"}else if(t.includes("CriOS")&&t.includes("Mobile/")&&t.includes("Safari")){let e=t.match(/CriOS\/([0-9.]+)/);return e?"Chrome ".concat(e[1]):"iOS Chrome"}else if(t.includes("FxiOS")&&t.includes("Mobile/")&&t.includes("Safari")){let e=t.match(/FxiOS\/([0-9.]+)/);return e?"Firefox ".concat(e[1]):"iOS Firefox"}else if(t.includes("Chrome")&&t.includes("AppleWebKit")&&t.includes("Macintosh")){let e=t.match(/Chrome\/([0-9.]+)/);return e?"Chrome ".concat(e[1]):"macOS Chrome"}else if(t.includes("Safari")&&t.includes("AppleWebKit")&&t.includes("Macintosh")){let e=t.match(/Safari\/([0-9.]+)/);return e?"Safari ".concat(e[1]):"macOS Safari"}else if(t.includes("Edg/")){let e=t.match(/Edg\/([0-9.]+)/);return e?"Edge ".concat(e[1]):"Edge WebView"}else if(t.includes("Firefox/")){let e=t.match(/Firefox\/([0-9.]+)/);return e?"Firefox ".concat(e[1]):"Firefox Gecko"}else if(t.includes("Chrome/")&&!t.includes("Chromium")){let e=t.match(/Chrome\/([0-9.]+)/);return e?"Chrome ".concat(e[1]):"Chrome"}else if(t.includes("Chromium/")){let e=t.match(/Chromium\/([0-9.]+)/);return e?"Chromium ".concat(e[1]):"Chromium"}else{if(!t.includes("MSIE "))return"Unknown";let e=t.match(/MSIE ([0-9.]+)/);return e?"IE ".concat(e[1]):"Internet Explorer"}},tm=e=>{let{href:t,children:n,...l}=e,s=async e=>{(0,M.uO)()&&(e.preventDefault(),await (0,ea.CZ)(t))};return(0,a.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",onClick:s,...l,children:n})},tf=e=>{let t=document.getElementById("about_window");if(t){let n=new CustomEvent("setDialogVisibility",{detail:{visible:e}});t.dispatchEvent(n)}},tp=()=>{let e=ev(),{appService:t}=(0,i.D)(),[n,l]=(0,d.useState)(null),[s,r]=(0,d.useState)(""),[o,c]=(0,d.useState)(!1);(0,d.useEffect)(()=>{r(th(t));let e=e=>{c(e.detail.visible)},n=document.getElementById("about_window");return n&&n.addEventListener("setDialogVisibility",e),()=>{n&&n.removeEventListener("setDialogVisibility",e)}},[]);let u=async()=>{l("checking");try{await tu(e,!1)?c(!1):l("updated")}catch(e){console.info("Error checking for updates:",e),l("error")}};return(0,a.jsx)(ts,{id:"about_window",isOpen:o,title:e("About Readest"),onClose:()=>{c(!1),l(null)},boxClassName:"sm:!w-96 sm:h-auto",children:(0,a.jsxs)("div",{className:"about-content flex h-full flex-col items-center justify-center",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 px-8",children:[(0,a.jsx)("div",{className:"mb-2 mt-8",children:(0,a.jsx)(eh(),{src:"/icon.png",alt:"App Logo",className:"h-20 w-20",width:64,height:64})}),(0,a.jsxs)("div",{className:"flex select-text flex-col items-center",children:[(0,a.jsx)("h2",{className:"mb-2 text-2xl font-bold",children:"Readest"}),(0,a.jsxs)("p",{className:"text-neutral-content text-center text-sm",children:[e("Version {{version}}",{version:em.rE})," ","(".concat(s,")")]})]}),(0,a.jsxs)("div",{className:"h-5",children:[(null==t?void 0:t.hasUpdater)&&!n&&(0,a.jsx)("span",{className:"badge badge-primary cursor-pointer p-1",onClick:u,children:e("Check Update")}),"updated"===n&&(0,a.jsx)("p",{className:"text-neutral-content mt-2 text-xs",children:e("Already the latest version")}),"checking"===n&&(0,a.jsx)("p",{className:"text-neutral-content mt-2 text-xs",children:e("Checking for updates...")}),"error"===n&&(0,a.jsx)("p",{className:"text-error mt-2 text-xs",children:e("Error checking for updates")})]})]}),(0,a.jsx)("div",{className:"divider py-16 sm:py-2"}),(0,a.jsxs)("div",{className:"flex flex-col items-center px-4 text-center",dir:"ltr",children:[(0,a.jsxs)("p",{className:"text-neutral-content text-sm",children:["\xa9 ",new Date().getFullYear()," Bilingify LLC. All rights reserved."]}),(0,a.jsxs)("p",{className:"text-neutral-content mt-2 text-xs",children:["This software is licensed under the"," ",(0,a.jsx)(tm,{href:"https://www.gnu.org/licenses/agpl-3.0.html",className:"text-blue-500 underline",children:"GNU Affero General Public License v3.0"}),". You are free to use, modify, and distribute this software under the terms of the AGPL v3 license. Please see the license for more details."]}),(0,a.jsxs)("p",{className:"text-neutral-content my-2 text-xs",children:["Source code is available at"," ",(0,a.jsx)(tm,{href:"https://github.com/readest/readest",className:"text-blue-500 underline",children:"GitHub"}),"."]})]})]})})},tg=()=>{let[e,t]=(0,d.useState)(""),n=(0,d.useRef)("info"),l=(0,d.useRef)(5e3),s=(0,d.useRef)(""),i=(0,d.useRef)(null),r={info:"toast-info toast-center toast-middle",success:"toast-success toast-top toast-end",warning:"toast-warning toast-top toast-end",error:"toast-error toast-top toast-end"};(0,d.useEffect)(()=>(i.current&&clearTimeout(i.current),i.current=setTimeout(()=>t(""),l.current),()=>{i.current&&clearTimeout(i.current)}),[e]);let o=async e=>{let{message:a,type:i="info",timeout:r,className:o=""}=e.detail;t(a),n.current=i,r&&(l.current=r),s.current=o};return(0,d.useEffect)(()=>($.on("toast",o),()=>{$.off("toast",o)}),[]),e&&(0,a.jsx)("div",{className:(0,c.A)("toast toast-center toast-middle z-50 w-auto max-w-screen-sm",r[n.current],r[n.current].includes("toast-top")&&"pt-[calc(44px+env(safe-area-inset-top))]"),children:(0,a.jsx)("div",{className:(0,c.A)("alert flex items-center justify-center",{info:"alert-primary border-base-300",success:"alert-success border-0",warning:"alert-warning border-0",error:"alert-error border-0"}[n.current]),children:(0,a.jsx)("span",{className:(0,c.A)("max-h-[50vh] min-w-32","overflow-y-auto text-center","info"===n.current?"max-w-[80vw]":"max-w-80 whitespace-normal break-words",s.current),children:e.split("\n").map((e,t)=>(0,a.jsxs)(d.Fragment,{children:[e||(0,a.jsx)(a.Fragment,{children:"\xa0"}),(0,a.jsx)("br",{})]},t))})})})};var tx=n(93354);let tb=()=>window.OPEN_WITH_FILES,tv=async()=>{let{getMatches:e}=await n.e(4413).then(n.bind(n,84413)),t=await e(),a=null==t?void 0:t.args,l=[];if(a)for(let e of["file1","file2","file3","file4"]){let t=a[e];t&&t.occurrences>0&&l.push(t.value)}return l},tw=async()=>{let e=await (0,tx.wB)();return e&&e.length>0?(console.log("Intent Open with URL:",e),e.map(e=>e.startsWith("file://")?decodeURI(e.replace("file://","")):e.startsWith("content://")?e:(console.info("Skip non-file URL:",e),null)).filter(e=>null!==e)):null},ty=async()=>{if((0,M.hx)())return[];let e=tb();return(!e||0===e.length)&&(0,M.Jd)()&&(e=await tv()),e&&0!==e.length||(e=await tw()),e};var tj=n(35415);let tN=async()=>{let e=(0,et.getCurrentWindow)(),t=await e.scaleFactor(),n=await e.outerPosition();return{x:n.x/t,y:n.y/t}},tk=async()=>{(0,et.getCurrentWindow)().minimize()},tS=async()=>{let e=(0,et.getCurrentWindow)();await e.isFullscreen()?(await e.setFullscreen(!1),await e.unmaximize()):(0,et.getCurrentWindow)().toggleMaximize()},tC=async()=>{(0,et.getCurrentWindow)().close()},tA=async e=>(0,et.getCurrentWindow)().listen(tj.es.WINDOW_CLOSE_REQUESTED,async()=>{await e(),console.log("exit app"),await (0,eC.N)(0)}),tE=async()=>{let e=(0,et.getCurrentWindow)(),t=await e.isFullscreen();await e.isMaximized()?await e.unmaximize():await e.setFullscreen(!t)},tL=async()=>{await $.dispatch("quit-app"),await (0,eC.N)(0)},tT=(e,t,n,a)=>{let l=t.join(h.Zk);if((0,M.hx)()&&!(0,M.xx)())e.push("/reader/".concat(l).concat(n?"?".concat(n):""),a);else{let t=new URLSearchParams(n||"");t.set("ids",l),e.push("/reader?".concat(t.toString()),a)}},tM=e=>{let t=window.location.pathname,n=window.location.search;e.push("/auth?redirect=".concat(encodeURIComponent("/auth"!==t?t+n:"/")))},tD=(e,t,n)=>{e.push("/library".concat(t?"?".concat(t):""),n)},tR=(0,u.v)((e,t)=>({parallelViews:[],setParallel:(t,n)=>{e(e=>{let a=[...e.parallelViews],l=a.find(e=>e.has(t)),s=a.find(e=>e.has(n));return l&&s?l!==s&&(l.forEach(e=>s.add(e)),a.splice(a.indexOf(l),1)):l?l.add(n):s?s.add(t):a.push(new Set([t,n])),{parallelViews:a}})},unsetParallel:(t,n)=>{e(e=>{let a=[...e.parallelViews],l=a.find(e=>e.has(t)&&e.has(n));if(l){l.delete(t),l.delete(n);let e=Array.from(l);e.length>0&&a.push(new Set(e)),a.splice(a.indexOf(l),1)}return{parallelViews:a}})},areParallels(e,n){let{parallelViews:a}=t();return a.some(t=>t.has(e)&&t.has(n))},getParallels(e){let{parallelViews:n}=t();return n.find(t=>t.has(e))||null}})),tz=()=>{let e=(0,e9.useRouter)(),t=(0,e9.useSearchParams)(),{envConfig:n}=(0,i.D)(),{bookKeys:a}=Y(),{setBookKeys:l,initViewState:s}=Y(),{sideBarBookKey:r,setSideBarBookKey:o}=q(),[c,u]=(0,d.useState)(!1),{setParallel:h}=tR();(0,d.useEffect)(()=>{if(c){let n=a.map(e=>e.split("-")[0]);n&&tT(e,n,(null==t?void 0:t.toString())||"",{scroll:!1}),u(!1)}},[a,c]);let m=(e,t,i)=>{let c="".concat(e,"-").concat((0,f.NF)());s(n,e,c,t),a.includes(c)||l([...a,c]),i&&h(r,c),o(c),u(!0)};return{bookKeys:a,appendBook:m,dismissBook:e=>{l(a.filter(t=>t!==e)),u(!0)},getNextBookKey:e=>{let t=(a.findIndex(t=>t===e)+1)%a.length;return a[t]},openParallelView:e=>{m(e,(null==r?void 0:r.split("-")[0])!=e,!0)}}},tP={onSwitchSideBar:["ctrl+Tab","opt+Tab","alt+Tab"],onToggleSideBar:["s"],onToggleNotebook:["n"],onToggleSearchBar:["ctrl+f","cmd+f"],onToggleScrollMode:["shift+j"],onToggleSelectMode:["shift+s"],onOpenFontLayoutSettings:["shift+f"],onReloadPage:["shift+r"],onToggleFullscreen:["F11"],onQuitApp:["ctrl+q","cmd+q"],onGoLeft:["ArrowLeft","PageUp","h"],onGoRight:["ArrowRight","PageDown","l"," "],onGoNext:["ArrowDown","j"],onGoPrev:["ArrowUp","k"],onGoHalfPageDown:["shift+ArrowDown","d"],onGoHalfPageUp:["shift+ArrowUp","u"],onGoBack:["shift+ArrowLeft","shift+h"],onGoForward:["shift+ArrowRight","shift+l"],onZoomIn:["ctrl+=","cmd+=","shift+="],onZoomOut:["ctrl+-","cmd+-","shift+-"],onResetZoom:["ctrl+0","cmd+0"],onSaveNote:["ctrl+Enter"],onCloseNote:["Escape"]},tI=()=>{if("undefined"==typeof localStorage)return tP;let e=JSON.parse(localStorage.getItem("customShortcuts")||"{}");return{...tP,...e}},tB=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,a]=(0,d.useState)(tI);(0,d.useEffect)(()=>{let e=()=>{a(tI())};return window.addEventListener("shortcutUpdate",e),()=>window.removeEventListener("shortcutUpdate",e)},[]);let l=e=>{let t=e.toLowerCase().split("+");return{ctrlKey:t.includes("ctrl"),altKey:t.includes("alt")||t.includes("opt"),metaKey:t.includes("meta")||t.includes("cmd"),shiftKey:t.includes("shift"),key:t.find(e=>!["ctrl","alt","opt","meta","cmd","shift"].includes(e))}},s=(e,t,n,a,s,i)=>{let r=l(e);return r.key===t.toLowerCase()&&r.ctrlKey===n&&r.altKey===a&&r.metaKey===s&&r.shiftKey===i},i=(t,a,l,i,r)=>{if("backspace"===t)return!0;for(let[o,c]of Object.entries(e)){let e=n[o];if(c&&(null==e?void 0:e.some(e=>s(e,t,a,l,i,r))))return c(),!0}return!1},r=e=>{let t=document.activeElement,n="INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable,a="TEXTAREA"===t.tagName&&t.classList.contains("note-editor");if(!n||a){if(e instanceof KeyboardEvent){let{key:t,ctrlKey:n,altKey:l,metaKey:s,shiftKey:r}=e;if(a&&!("Enter"===t&&n||"Escape"==t))return;i(t.toLowerCase(),n,l,s,r)&&e.preventDefault()}else if(e instanceof MessageEvent&&e.data&&"iframe-keydown"===e.data.type){let{key:t,ctrlKey:n,altKey:a,metaKey:l,shiftKey:s}=e.data;i(t.toLowerCase(),n,a,l,s)}}};(0,d.useEffect)(()=>(window.addEventListener("keydown",r),window.addEventListener("message",r),()=>{window.removeEventListener("keydown",r),window.removeEventListener("message",r)}),[n,...t])},t_=(e,t,n)=>{if(!e||!t)return;let a=e.renderer;if(!a.scrolled)return"left"===n?e.goLeft():e.goRight();{"rtl"===e.book.dir&&(n="left"===n?"right":"left");let{size:l}=a,s=t.showHeader&&t.showBarsOnScroll,i=t.showFooter&&t.showBarsOnScroll,r=l-t.scrollingOverlap-44*!!s-44*!!i;return"left"===n?e.prev(r):e.next(r)}},tV=(e,t,n)=>{let{appService:a}=(0,i.D)(),{getViewSettings:l}=Y(),{hoveredBookKey:s,setHoveredBookKey:r}=Y(),{acquireVolumeKeyInterception:o,releaseVolumeKeyInterception:c}=ee(),u=async i=>{if(i instanceof MessageEvent){if(i.data&&i.data.bookKey===e){var o,c,d,u;let h=l(e);if("iframe-single-click"===i.data.type){let l=n.current;if(l){let n,{screenX:o}=i.data,c=l.getBoundingClientRect(),d=((0,M.uO)()?(null==a?void 0:a.isMobile)?0:(await tN()).x:window.screenX)+c.left,u=d+c.width/2;if(!$.dispatchSync("iframe-single-click")){let n=d+.375*c.width,a=d+.625*c.width;if(h.disableClick||o>=n&&o<=a)r(s?null:e);else{if(s)return void r(null);!h.disableClick&&o>=u?h.swapClickArea?t_(t.current,h,"left"):t_(t.current,h,"right"):!h.disableClick&&o<u&&(h.swapClickArea?t_(t.current,h,"right"):t_(t.current,h,"left"))}}}}else if("iframe-wheel"!==i.data.type||h.scrolled)"iframe-mouseup"===i.data.type&&(3===i.data.button?null==(d=t.current)||d.history.back():4===i.data.button&&(null==(u=t.current)||u.history.forward()));else{let{deltaY:e}=i.data;e>0?null==(o=t.current)||o.next(1):e<0&&(null==(c=t.current)||c.prev(1))}}}else if(i instanceof CustomEvent){let{keyName:n}=i.detail,a=l(e);(null==a?void 0:a.volumeKeysToFlip)&&(r(""),"VolumeUp"===n?t_(t.current,a,"left"):"VolumeDown"===n&&t_(t.current,a,"right"))}else if("click"===i.type){let{clientX:n}=i,a=window.innerWidth,s=l(e);n<.5*a?t_(t.current,s,"left"):n>.5*a&&t_(t.current,s,"right")}};return(0,d.useEffect)(()=>{if(!(null==a?void 0:a.isMobileApp))return;let t=l(e);return(null==t?void 0:t.volumeKeysToFlip)?o():c(),$.on("native-key-down",u),()=>{c(),$.off("native-key-down",u)}},[]),{handlePageFlip:u,handleContinuousScroll:(n,a,s)=>{var i;let r=null==(i=t.current)?void 0:i.renderer,o=l(e);if(r&&o.scrolled&&o.continuousScroll){let e=()=>{r.start<=a&&a>s?setTimeout(()=>{var e;null==(e=t.current)||e.prev(r.start+1)},100):Math.ceil(r.end)-a>=r.viewSize&&a<-s&&setTimeout(()=>{var e;null==(e=t.current)||e.next(r.viewSize-Math.floor(r.end)+1)},100)};"mouse"===n?e():"touch"===n&&(r.size>=r.viewSize?e():r.addEventListener("relocate",()=>e(),{once:!0}))}}}},tF=e=>{var t,n;let{sideBarBookKey:a,bookKeys:l}=e,{getView:s,getViewSettings:i,setViewSettings:r}=Y(),{toggleSideBar:o,setSideBarBookKey:c}=q(),{setFontLayoutSettingsDialogOpen:d}=P(),{toggleNotebook:u}=X(),{getNextBookKey:m}=tz(),f=i(null!=a?a:""),p=(null!=(t=null==f?void 0:f.defaultFontSize)?t:16)*(null!=(n=null==f?void 0:f.lineHeight)?n:1.6)*3;tB({onSwitchSideBar:()=>{a&&c(m(a))},onToggleSideBar:o,onToggleNotebook:u,onToggleScrollMode:()=>{let e=i(null!=a?a:"");if(e&&a){var t;e.scrolled=!e.scrolled,r(a,e);let n=e.scrolled?"scrolled":"paginated";null==(t=s(a))||t.renderer.setAttribute("flow",n)}},onOpenFontLayoutSettings:()=>d(!0),onToggleSearchBar:()=>{$.dispatch("search",{term:""})},onReloadPage:()=>{window.location.reload()},onToggleFullscreen:async()=>{(0,M.uO)()&&await tE()},onQuitApp:async()=>{(0,M.uO)()&&await tL()},onGoLeft:()=>{let e=i(null!=a?a:"");t_(s(a),e,"left")},onGoRight:()=>{let e=i(null!=a?a:"");t_(s(a),e,"right")},onGoPrev:()=>{var e;null==(e=s(a))||e.prev(p)},onGoNext:()=>{var e;null==(e=s(a))||e.next(p)},onGoHalfPageDown:()=>{let e=s(a),t=i(null!=a?a:"");e&&t&&t.scrolled&&e.next(e.renderer.size/2)},onGoHalfPageUp:()=>{let e=s(a),t=i(null!=a?a:"");e&&t&&t.scrolled&&e.prev(e.renderer.size/2)},onGoBack:()=>{var e;null==(e=s(a))||e.history.back()},onGoForward:()=>{var e;null==(e=s(a))||e.history.forward()},onZoomIn:()=>{var e,t,n;if(!a)return;let l=s(a);if(!(null==l||null==(e=l.renderer)?void 0:e.setStyles))return;let o=i(a),c=o.zoomLevel+h.bL;o.zoomLevel=Math.min(c,h.ec),r(a,o),null==l||null==(t=(n=l.renderer).setStyles)||t.call(n,L(o))},onZoomOut:()=>{var e,t,n;if(!a)return;let l=s(a);if(!(null==l||null==(e=l.renderer)?void 0:e.setStyles))return;let o=i(a),c=o.zoomLevel-h.bL;o.zoomLevel=Math.max(c,h.cA),r(a,o),null==l||null==(t=(n=l.renderer).setStyles)||t.call(n,L(o))},onResetZoom:()=>{var e,t,n;if(!a)return;let l=s(a);if(!(null==l||null==(e=l.renderer)?void 0:e.setStyles))return;let o=i(a);o.zoomLevel=100,r(a,o),null==l||null==(t=(n=l.renderer).setStyles)||t.call(n,L(o))}},[a,l])},tO=e=>{let{title:t,message:n,onCancel:l,onConfirm:s}=e,i=ev();return(0,a.jsx)("div",{className:(0,c.A)("z-[100] flex justify-center px-4"),children:(0,a.jsxs)("div",{role:"alert",className:(0,c.A)("alert flex items-center justify-between","bg-base-300 rounded-lg border-none p-4 shadow-2xl","w-full max-w-[90vw] sm:max-w-[70vw] md:max-w-[50vw] lg:max-w-[40vw] xl:max-w-[40vw]","min-w-[70vw] flex-col sm:min-w-[40vw] sm:flex-row"),children:[(0,a.jsxs)("div",{className:"labels flex items-center space-x-2 self-start sm:space-x-4 sm:self-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-info h-6 w-6 shrink-0",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,a.jsx)("h3",{className:"text-start text-sm sm:text-center",children:t}),(0,a.jsx)("div",{className:"text-start text-xs sm:text-center",children:n})]})]}),(0,a.jsxs)("div",{className:"buttons flex flex-wrap items-center justify-end gap-2 self-end sm:max-w-[20vw] sm:self-center",children:[(0,a.jsx)("button",{className:"btn btn-sm btn-neutral",onClick:l,children:i("Cancel")}),(0,a.jsx)("button",{className:"btn btn-sm btn-warning",onClick:s,children:i("Confirm")})]})]})})},tW=e=>{let{loading:t}=e,n=ev();return t?(0,a.jsxs)("div",{className:(0,c.A)("absolute left-1/2 -translate-x-1/2 transform text-center","top-4 pt-[calc(env(safe-area-inset-top)+64px)]"),role:"status",children:[(0,a.jsx)("span",{className:"loading loading-dots loading-lg"}),(0,a.jsx)("span",{className:"hidden",children:n("Loading...")})]}):null},tH=e=>{let{mode:t="grid",book:n,isPreview:l}=e;return(0,a.jsxs)("div",{className:(0,c.A)("relative flex h-full w-full"),children:[(0,a.jsx)(eh(),{src:n.coverImageUrl,alt:n.title,fill:!0,className:"object-cover",onError:e=>{var t;e.target.style.display="none",null==(t=e.target.nextElementSibling)||t.classList.remove("invisible")}}),(0,a.jsxs)("div",{className:(0,c.A)("invisible absolute inset-0 rounded-none p-2","text-neutral-content text-center font-serif font-medium",l&&"bg-base-200/50"),children:[(0,a.jsx)("div",{className:"flex h-1/2 items-center justify-center",children:(0,a.jsx)("span",{className:(0,c.A)(l?"line-clamp-2":"grid"===t?"line-clamp-3":"line-clamp-2",l?"text-[0.5em]":"grid"===t?"text-lg":"text-sm"),children:(0,G.Ef)(n.title)})}),(0,a.jsx)("div",{className:"h-1/6"}),(0,a.jsx)("div",{className:"flex h-1/3 items-center justify-center",children:(0,a.jsx)("span",{className:(0,c.A)("text-neutral-content/50 line-clamp-1",l?"text-[0.4em]":"grid"===t?"text-base":"text-xs"),children:(0,G.kY)(n.author)})})]})]})},tK=e=>{let{book:t,isOpen:n,onClose:l,handleBookDownload:s,handleBookUpload:r,handleBookDelete:o}=e,u=ev(),[h,m]=(0,d.useState)(!1),[f,p]=(0,d.useState)(!1),[g,x]=(0,d.useState)(null),[b,v]=(0,d.useState)(null),{envConfig:w}=(0,i.D)(),{settings:y}=P();(0,d.useEffect)(()=>{let e=setTimeout(()=>m(!0),300);(async()=>{let n=await w.getAppService();try{let e=await n.fetchBookDetails(t,y),a=await n.getBookFileSize(t);x(e),v(a)}finally{e&&clearTimeout(e),m(!1)}})()},[t]);let j=()=>{x(null),l()},N=async()=>{j(),p(!1),o&&o(t)},k=async()=>{j(),s&&s(t)},S=async()=>{j(),r&&r(t)};return g?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)(ts,{title:u("Book Details"),isOpen:n,onClose:j,bgClassName:"sm:bg-black/50",boxClassName:"sm:min-w-[480px] sm:max-w-[480px] sm:h-auto sm:max-h-[90%]",contentClassName:"!px-6 !py-2",children:(0,a.jsx)("div",{className:"flex w-full select-text items-center justify-center",children:(0,a.jsxs)("div",{className:"relative w-full rounded-lg",children:[(0,a.jsxs)("div",{className:"mb-6 me-4 flex h-32 items-start",children:[(0,a.jsx)("div",{className:"me-10 aspect-[28/41] h-32 shadow-lg",children:(0,a.jsx)(tH,{mode:"list",book:t})}),(0,a.jsxs)("div",{className:"title-author flex h-32 flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-base-content mb-2 line-clamp-2 break-all text-lg font-bold",children:(0,G.Ef)(t.title)||u("Untitled")}),(0,a.jsx)("p",{className:"text-neutral-content line-clamp-1",children:(0,G.kY)(t.author,t.primaryLanguage)||u("Unknown")})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-x-4",children:[o&&(0,a.jsx)("button",{onClick:()=>{p(!0)},children:(0,a.jsx)(te.b6i,{className:"fill-red-500"})}),t.uploadedAt&&s&&(0,a.jsx)("button",{onClick:k,children:(0,a.jsx)(te.$no,{className:"fill-base-content"})}),t.downloadedAt&&r&&(0,a.jsx)("button",{onClick:S,children:(0,a.jsx)(te.E10,{className:"fill-base-content"})})]})]})]}),(0,a.jsxs)("div",{className:"text-base-content my-4",children:[(0,a.jsxs)("div",{className:"mb-4 grid grid-cols-2 gap-4 sm:grid-cols-3",children:[(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Publisher:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.ud)(g.publisher||"")||u("Unknown")})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Published:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.Yq)(g.published)||u("Unknown")})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Updated:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.Yq)(t.updatedAt)||""})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Added:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.Yq)(t.createdAt)||""})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Language:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.qq)(g.language)||u("Unknown")})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Subjects:")}),(0,a.jsx)("p",{className:"text-neutral-content line-clamp-3 text-sm",children:(0,G.QK)(g.subject)||u("Unknown")})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("Format:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:t.format||u("Unknown")})]}),(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)("span",{className:"font-bold",children:u("File Size:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm",children:(0,G.v7)(b)||u("Unknown")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-bold",children:u("Description:")}),(0,a.jsx)("p",{className:"text-neutral-content text-sm prose prose-sm",dangerouslySetInnerHTML:{__html:g.description||u("No description available")}})]})]})]})})}),f&&(0,a.jsx)("div",{className:(0,c.A)("fixed bottom-0 left-0 right-0 z-50 flex justify-center","pb-[calc(env(safe-area-inset-bottom)+16px)]"),children:(0,a.jsx)(tO,{title:u("Confirm Deletion"),message:u("Are you sure to delete the selected book?"),onCancel:()=>{p(!1)},onConfirm:N})})]}):h&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:(0,a.jsx)(tW,{loading:!0})})};var tU=n(45721),tG=n.n(tU),tY=n(9537),tq=n(65310),tX=n(32450);let tJ=(0,u.v)((e,t)=>({appService:void 0,isTrafficLightVisible:!1,shouldShowTrafficLight:!1,initializeTrafficLightStore:t=>{e({appService:t,isTrafficLightVisible:t.hasTrafficLight,shouldShowTrafficLight:t.hasTrafficLight})},setTrafficLightVisibility:async t=>{let{getCurrentWindow:a}=await Promise.resolve().then(n.bind(n,39962)),l=a();e({isTrafficLightVisible:!await l.isFullscreen()&&t,shouldShowTrafficLight:t}),(0,tX.lA)("set_traffic_lights",{visible:t,x:10,y:22})},initializeTrafficLightListeners:async()=>{let{getCurrentWindow:a}=await Promise.resolve().then(n.bind(n,39962)),l=a(),s=await l.listen("will-enter-fullscreen",()=>{e({isTrafficLightVisible:!1})}),i=await l.listen("will-exit-fullscreen",()=>{let{shouldShowTrafficLight:n}=t();e({isTrafficLightVisible:n})});e({unlistenEnterFullScreen:s,unlistenExitFullScreen:i})},cleanupTrafficLightListeners:()=>{let{unlistenEnterFullScreen:n,unlistenExitFullScreen:a}=t();n&&n(),a&&a(),e({unlistenEnterFullScreen:void 0,unlistenExitFullScreen:void 0})}})),tZ=e=>{let{className:t,menuClassName:n,buttonClassName:l,toggleButton:s,children:i,onToggle:r}=e,[o,u]=(0,d.useState)(!1),h=e=>{u(e),null==r||r(e)},m=(0,d.isValidElement)(i)?d.cloneElement(i,{setIsDropdownOpen:h,menuClassName:n}):i;return(0,a.jsxs)("div",{className:"dropdown-container",children:[o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-transparent",onClick:()=>h(!1)}),(0,a.jsxs)("div",{className:(0,c.A)("dropdown",t),children:[(0,a.jsx)("div",{tabIndex:-1,onClick:()=>{let e=!o;u(e),null==r||r(e)},className:(0,c.A)("dropdown-toggle",l,o&&"bg-base-300/50"),children:s}),o&&m]})]})},t$=e=>{let{label:t,description:n,buttonClass:l,labelClass:s,shortcut:i,disabled:r,noIcon:o=!1,Icon:d,children:u,onClick:h}=e,m=(0,tn.D)(16),f=(0,a.jsxs)("button",{className:(0,c.A)("hover:bg-base-300 text-base-content flex w-full flex-col items-center justify-center rounded-md p-1 py-[10px]",r&&"btn-disabled text-gray-400",l),onClick:h,disabled:r,children:[(0,a.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex min-w-0 items-center",children:[!o&&(0,a.jsx)("span",{style:{minWidth:"".concat(m,"px")},children:"function"==typeof d?(0,a.jsx)(d,{className:"text-base-content",size:m}):d}),(0,a.jsx)("span",{className:(0,c.A)("mx-2 flex-1 truncate text-base sm:text-sm",s),style:{minWidth:0},children:t})]}),i&&(0,a.jsx)("kbd",{className:(0,c.A)("border-base-300/40 bg-base-300/75 text-neutral-content hidden rounded-md border shadow-sm sm:flex","shrink-0 px-1.5 py-0.5 text-xs font-medium"),children:i})]}),(0,a.jsx)("div",{className:"flex w-full",children:n&&(0,a.jsx)("span",{className:"mt-1 truncate text-start text-xs text-gray-500",style:{minWidth:0,paddingInlineStart:o?"0":"".concat(m+8,"px")},children:n})})]});return u?(0,a.jsx)("ul",{className:"menu rounded-box m-0 p-0",children:(0,a.jsx)("li",{children:(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{className:"hover:bg-base-300 p-0 pr-3",children:f}),u]})})}):f},tQ=e=>{let{menuClassName:t,setIsDropdownOpen:n}=e,l=ev(),{getViewSettings:s,setViewSettings:i}=Y(),{getVisibleLibrary:r}=K(),{openParallelView:o}=tz(),{sideBarBookKey:u}=q(),m=s(u),[f,p]=d.useState((null==m?void 0:m.sortedTOC)||!1),g=e=>{o(e),null==n||n(!1)},x=(0,M.hx)();return(0,a.jsxs)("div",{tabIndex:0,className:(0,c.A)("book-menu dropdown-content border-base-100 z-20 shadow-2xl",t),children:[(0,a.jsx)(t$,{label:l("Parallel Read"),children:(0,a.jsx)("ul",{className:"max-h-60 overflow-y-auto",children:r().filter(e=>"PDF"!==e.format&&"CBZ"!==e.format).slice(0,20).map(e=>(0,a.jsx)(t$,{Icon:(0,a.jsx)(eh(),{src:e.coverImageUrl,alt:e.title,width:56,height:80,className:"aspect-auto max-h-8 max-w-4 rounded-sm shadow-md",onError:e=>{e.target.style.display="none"}}),label:e.title,labelClass:"max-w-36",onClick:()=>g(e.hash)},e.hash))})}),(0,a.jsx)(t$,{label:l("Export Annotations"),onClick:()=>{$.dispatch("export-annotations",{bookKey:u}),null==n||n(!1)}}),(0,a.jsx)(t$,{label:l("Sort TOC by Page"),Icon:f?te.g9_:void 0,onClick:()=>{if(p(e=>!e),null==n||n(!1),u){let e=s(u);e.sortedTOC=!f,i(u,e)}setTimeout(()=>window.location.reload(),100)}}),(0,a.jsx)(t$,{label:l("Reload Page"),shortcut:"Shift+R",onClick:()=>{window.location.reload(),null==n||n(!1)}}),(0,a.jsx)("hr",{className:"border-base-200 my-1"}),x&&(0,a.jsx)(t$,{label:l("Download Readest"),onClick:()=>{window.open(h.cP,"_blank"),null==n||n(!1)}}),(0,a.jsx)(t$,{label:l("About Readest"),onClick:()=>{tf(!0),null==n||n(!1)}})]})},t0=e=>{let{isPinned:t,isSearchBarVisible:n,onGoToLibrary:l,onClose:s,onTogglePin:i,onToggleSearchBar:r}=e,{isTrafficLightVisible:o}=tJ(),d=(0,tn.D)(14),u=(0,tn.D)(18),h=(0,tn.D)(22);return(0,a.jsxs)("div",{className:(0,c.A)("sidebar-header flex h-11 items-center justify-between pe-2",o?"pl-20":"ps-1.5"),dir:"ltr",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-8",children:[(0,a.jsx)("button",{onClick:s,className:"btn btn-ghost btn-circle flex h-6 min-h-6 w-6 hover:bg-transparent sm:hidden",children:(0,a.jsx)(te.VR3,{size:h})}),(0,a.jsx)("button",{className:"btn btn-ghost hidden h-8 min-h-8 w-8 p-0 sm:flex",onClick:l,children:(0,a.jsx)(tY.cNd,{className:"fill-base-content"})})]}),(0,a.jsxs)("div",{className:"flex min-w-24 max-w-32 items-center justify-between sm:size-[70%]",children:[(0,a.jsx)("button",{onClick:r,className:(0,c.A)("btn btn-ghost left-0 h-8 min-h-8 w-8 p-0",n?"bg-base-300":""),children:(0,a.jsx)(tq.CKj,{size:u,className:"text-base-content"})}),(0,a.jsx)(tZ,{className:(0,c.A)(window.innerWidth<640&&"dropdown-end","dropdown-bottom flex justify-center"),menuClassName:window.innerWidth<640?"no-triangle mt-1":"dropdown-center mt-3",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,a.jsx)(te.hCN,{className:"fill-base-content"}),children:(0,a.jsx)(tQ,{})}),(0,a.jsx)("div",{className:"right-0 hidden h-8 w-8 items-center justify-center sm:flex",children:(0,a.jsx)("button",{onClick:i,className:(0,c.A)("sidebar-pin-btn btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 sm:flex",t?"bg-base-300":"bg-base-300/65"),children:t?(0,a.jsx)(te.RR4,{size:d}):(0,a.jsx)(te.nDj,{size:d})})})]})]})};var t1=n(56899);let t2=e=>{let t=[],n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(a>15))for(let i of(e instanceof HTMLElement&&e.shadowRoot&&n(e.shadowRoot,a+1),"children"in e?Array.from(e.children):[])){var l,s;if("STYLE"===i.tagName||"LINK"===i.tagName)continue;if(i.shadowRoot&&n(i.shadowRoot,a+1),"IFRAME"===i.tagName){let e=i.contentDocument||(null==(s=i.contentWindow)?void 0:s.document);e&&e.body&&n(e.body,a+1)}let e=i.childNodes&&Array.from(i.childNodes).some(e=>{var t;return e.nodeType===Node.TEXT_NODE&&(null==(t=e.textContent)?void 0:t.trim())});0===i.children.length&&(null==(l=i.textContent)?void 0:l.trim())||e?t.push(i):i.children.length>0&&n(i,a+1)}};return n(e),t};function t4(e,t){let{getViewSettings:n}=Y(),a=n(e),l=(0,d.useRef)(null==a?void 0:a.translationEnabled),[s,i]=(0,d.useState)(null==a?void 0:a.translationProvider),[r,o]=(0,d.useState)(null==a?void 0:a.translateTargetLang),{translate:c}=e6({provider:s,targetLang:eX(r||(0,f.JK)())}),u=(0,d.useRef)(c),h=(0,d.useRef)(null),m=(0,d.useRef)([]),p=(0,d.useRef)([]),g=e=>{m.current.forEach(t=>{t.querySelectorAll(".translation-target").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})})};(0,d.useEffect)(()=>{u.current=c},[c]);let x=()=>{if(!t||!l.current)return;let e=v();h.current=e;let n=t2(t);console.log("Observing text nodes for translation:",n.length),p.current=n,n.forEach(t=>e.observe(t))},b=()=>{m.current.forEach(e=>{e.querySelectorAll(".translation-target").forEach(e=>e.remove())}),m.current=[],(null==a?void 0:a.translationEnabled)&&t&&y()},v=()=>new IntersectionObserver(e=>{let t=null,n=null;for(let a of e){if(!a.isIntersecting){n||(t=a.target);continue}let e=a.target;j(e),n=e}t&&j(t),n&&w(n,2)},{rootMargin:"1280px",threshold:0}),w=(e,t)=>{if(!p.current||t<=0)return;let n=p.current.indexOf(e);-1!==n&&p.current.slice(n+1,n+1+t).forEach((e,t)=>{setTimeout(()=>{j(e)},500*t)})},y=()=>{var e;let t=v();null==(e=h.current)||e.disconnect(),h.current=t,p.current.forEach(e=>t.observe(e))},j=async e=>{var t;if(!l.current)return;let n=null==(t=e.textContent)?void 0:t.trim();if(n&&!e.querySelector(".translation-target"))try{let t=(await u.current([n]))[0];if(!t||n===t)return;let a=document.createElement("font");a.className="translation-target ".concat(l.current?"":"hidden"),a.setAttribute("translation-element-mark","1"),a.setAttribute("lang",r||(0,f.JK)()),a.appendChild(document.createElement("br"));let s=document.createElement("font");s.className="translation-target translation-block-wrapper";let i=document.createElement("font");if(i.className="translation-target target-inner target-inner-theme-none",i.textContent=t,s.appendChild(i),a.appendChild(s),e.querySelector(".translation-target"))return;e.appendChild(a),m.current.push(e)}catch(e){console.warn("Translation failed:",e)}};(0,d.useEffect)(()=>{if(!a)return;let e=l.current!==a.translationEnabled,t=s!==a.translationProvider,n=r!==a.translateTargetLang;e&&(l.current=a.translationEnabled),t&&i(a.translationProvider),n&&o(a.translateTargetLang),e?(g(a.translationEnabled),l.current&&x()):(t||n)&&b()},[e,a,s,r]),(0,d.useEffect)(()=>{if(t&&l.current)return"renderer"in t?t.addEventListener("load",x):x(),()=>{var e;"renderer"in t&&t.removeEventListener("load",x),null==(e=h.current)||e.disconnect(),m.current=[]}},[t])}let t3=e=>(0,a.jsx)("svg",{viewBox:"0 0 8 10",width:"8",height:"10",className:(0,c.A)("text-base-content transform transition-transform",e?"rotate-90":"rotate-0"),style:{transformOrigin:"center"},fill:"currentColor",children:(0,a.jsx)("polygon",{points:"0 0, 8 5, 0 10"})}),t8=d.memo(e=>{let{flatItem:t,itemSize:n,isActive:l,onToggleExpand:s,onItemClick:i}=e,{item:r,depth:o}=t,u=(0,d.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),s(r)},[r,s]),h=(0,d.useCallback)(e=>{e.preventDefault(),i(r)},[r,i]);return(0,a.jsxs)("span",{role:"treeitem",tabIndex:-1,onClick:r.href?h:void 0,"aria-expanded":t.isExpanded?"true":"false","aria-selected":l?"true":"false","data-href":r.href?(0,f.aY)(r.href):void 0,className:(0,c.A)("flex w-full cursor-pointer items-center rounded-md py-4 sm:py-2",l?"sm:bg-base-300/85 sm:hover:bg-base-300 sm:text-base-content text-blue-500":"sm:hover:bg-base-300/85"),style:{height:n?"".concat(n,"px"):"auto",paddingInlineStart:"".concat((o+1)*12,"px")},children:[r.subitems&&(0,a.jsx)("span",{onClick:u,className:"inline-block cursor-pointer",style:{padding:"12px",margin:"-12px"},children:t3(t.isExpanded||!1)}),(0,a.jsx)("span",{className:"ms-2 truncate text-ellipsis",style:{maxWidth:"calc(100% - 24px)",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:r.label}),r.location&&(0,a.jsx)("span",{className:"text-base-content/50 ms-auto ps-1 text-xs sm:pe-1",children:r.location.current+1})]})});t8.displayName="TOCItemView";let t5=e=>{let{bookKey:t,flatItem:n,itemSize:l,activeHref:s,onToggleExpand:i,onItemClick:r}=e,o=s===n.item.href;return(0,a.jsx)("div",{className:(0,c.A)("border-base-300 w-full border-b sm:border-none","pe-4 ps-2 pt-[1px] sm:pe-2"),children:(0,a.jsx)(t8,{bookKey:t,flatItem:n,itemSize:l,isActive:o,onToggleExpand:i,onItemClick:r})})},t6=e=>{let{index:t,style:n,data:l}=e,{flatItems:s,bookKey:i,activeHref:r,itemSize:o,onToggleExpand:c,onItemClick:d}=l,u=s[t];return(0,a.jsx)("div",{style:n,children:(0,a.jsx)(t5,{bookKey:i,flatItem:u,itemSize:o-1,activeHref:r,onToggleExpand:c,onItemClick:d})})},t9=(e,t)=>(0,d.useMemo)(()=>{let n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=[];return e.forEach((e,s)=>{let i=t.has(e.href||"");l.push({item:e,depth:a,index:s,isExpanded:i}),e.subitems&&i&&l.push(...n(e.subitems,a+1))}),l};return n(e)},[e,t]),t7=e=>{let{bookKey:t,toc:n}=e,{getView:l,getProgress:s,getViewSettings:i}=Y(),{sideBarBookKey:r,isSideBarVisible:o}=q(),c=i(t),u=s(t),[h,m]=(0,d.useState)(new Set),[p,g]=(0,d.useState)(400),x=(0,d.useRef)(null),b=(0,d.useRef)(null),v=(0,d.useRef)(null);t4(t,x.current),(0,d.useEffect)(()=>{let e=()=>{if(x.current){let e=x.current.getBoundingClientRect(),t=x.current.closest(".scroll-container");if(t){let n=t.getBoundingClientRect();g(Math.max(400,n.height-(e.top-n.top)))}}};e(),window.addEventListener("resize",e);let t=null;if(x.current){let n=x.current.closest(".scroll-container");n&&(t=new ResizeObserver(e)).observe(n)}return()=>{window.removeEventListener("resize",e),t&&t.disconnect()}},[]);let w=(0,d.useMemo)(()=>(null==u?void 0:u.sectionHref)||null,[u]),y=t9(n,h),j=(0,d.useCallback)(e=>{let t=e.href||"";m(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})},[]),N=(0,d.useCallback)(e=>{if($.dispatch("navigate",{bookKey:t,href:e.href}),e.href){var n;null==(n=l(t))||n.goTo(e.href)}},[t,l]),k=(0,d.useCallback)((e,t)=>{m(new Set(V(e,t).map(e=>e.href).filter(Boolean)))},[]),S=(0,d.useCallback)(()=>{if(w){if(b.current){let e=y.findIndex(e=>e.item.href===w);-1!==e&&b.current.scrollToItem(e,"center")}if(v.current){var e;let t=w?(0,f.aY)(w):"",n=null==(e=v.current)?void 0:e.querySelector('[data-href="'.concat(t,'"]'));if(n){let e=n.getBoundingClientRect();e.top>=0&&e.bottom<=window.innerHeight||n.scrollIntoView({behavior:"instant",block:"center"}),n.setAttribute("aria-current","page")}}}},[w,y]),C=(0,d.useMemo)(()=>!(window.innerWidth>=640)||(null==c?void 0:c.translationEnabled)?57:37,[c]),A=(0,d.useMemo)(()=>({flatItems:y,itemSize:C,bookKey:t,activeHref:w,onToggleExpand:j,onItemClick:N}),[y,C,t,w,j,N]);return(0,d.useEffect)(()=>{if(!u||$.dispatchSync("tts-is-speaking")||r!==t||!o)return;let{sectionHref:e}=u;e&&k(n,e)},[n,u,r,o,t,k]),(0,d.useEffect)(()=>{y.length>0&&setTimeout(S,0)},[y,S]),(0,a.jsx)("div",{className:"rounded",ref:x,children:y.length>256?(0,a.jsx)(t1.Y1,{ref:b,width:"100%",height:p,itemCount:y.length,itemSize:C,itemData:A,overscanCount:20,children:t6}):(0,a.jsx)("div",{className:"pt-2",ref:v,children:y.map((e,n)=>(0,a.jsx)(t5,{bookKey:t,flatItem:e,activeHref:w,onToggleExpand:j,onItemClick:N},"static-row-".concat(n)))})})};var ne=n(28377),nt=n(46208);let nn=(e,t)=>{let n=(0,d.useRef)(null),[a,l]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{if(!n.current||!t)return;let{location:a}=t,s=ne.collapse(a),i=ne.collapse(a,!0),r=ne.compare(e,s)>=0&&0>=ne.compare(e,i);if(l(r),r){let e=n.current,t=e.getBoundingClientRect();t.top>=0&&t.bottom<=window.innerHeight||e.scrollIntoView({behavior:"smooth",block:"center"}),e.setAttribute("aria-current","page")}},[e,t,n]),{isCurrent:a,viewRef:n}},na=e=>{let{bookKey:t,item:n}=e,l=ev(),{envConfig:s}=(0,i.D)(),{settings:r}=P(),{getConfig:o,saveConfig:d,updateBooknotes:u}=U(),{getProgress:h,getView:m,getViewsById:f}=Y(),{setNotebookEditAnnotation:p,setNotebookVisible:g}=X(),x=(0,tn.D)(3),{text:b,cfi:v,note:w}=n,{isCurrent:y,viewRef:j}=nn(v,h(t));return(0,a.jsxs)("li",{ref:j,className:(0,c.A)("border-base-300 content group relative my-2 cursor-pointer rounded-lg p-2",y?"bg-base-300/85 hover:bg-base-300":"hover:bg-base-300/55 bg-base-100","transition-all duration-300 ease-in-out"),tabIndex:0,onClick:e=>{var n;e.preventDefault(),$.dispatch("navigate",{bookKey:t,cfi:v}),null==(n=m(t))||n.goTo(v),w&&g(!0)},children:[(0,a.jsxs)("div",{className:(0,c.A)("min-h-4 p-0 transition-all duration-300 ease-in-out"),style:{"--top-override":"0.7rem","--end-override":"0.3rem"},children:[n.note&&(0,a.jsx)("div",{className:"content prose prose-sm font-size-sm",dir:"auto",dangerouslySetInnerHTML:{__html:nt.xI.parse(n.note)}}),(0,a.jsxs)("div",{className:"flex items-start",children:[n.note&&(0,a.jsx)("div",{className:"me-2 mt-2.5 min-h-full self-stretch rounded-xl bg-gray-300",style:{minWidth:"".concat(x,"px")}}),(0,a.jsx)("div",{className:(0,c.A)("content font-size-sm line-clamp-3",n.note&&"mt-2"),children:(0,a.jsx)("span",{className:(0,c.A)("inline",n.note&&"content font-size-xs text-gray-500",("underline"===n.style||"squiggly"===n.style)&&"underline decoration-2","highlight"===n.style&&"bg-".concat(n.color,"-500 bg-opacity-40"),"underline"===n.style&&"decoration-".concat(n.color,"-400"),"squiggly"===n.style&&"decoration-wavy decoration-".concat(n.color,"-400")),children:b||""})})]})]}),(0,a.jsx)("div",{className:(0,c.A)("max-h-0 overflow-hidden p-0 text-xs","transition-[max-height] duration-300 ease-in-out","group-hover:max-h-8 group-hover:overflow-visible"),style:{"--bottom-override":0},onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"flex justify-end space-x-3 p-2",dir:"ltr",children:[n.note&&(0,a.jsx)("button",{className:(0,c.A)("btn btn-ghost content settings-content hover:bg-transparent","flex h-4 min-h-4 items-end p-0"),onClick:(e=>{g(!0),p(e)}).bind(null,n),children:(0,a.jsx)("div",{className:(0,c.A)("align-bottom text-blue-500","transition duration-300 ease-in-out","content font-size-sm","opacity-0 group-hover:opacity-100","hover:text-blue-600"),children:l("Edit")})}),(0,a.jsx)("button",{className:(0,c.A)("btn btn-ghost content settings-content hover:bg-transparent","flex h-4 min-h-4 items-end p-0"),onClick:(e=>{if(!t)return;let n=o(t);if(!n)return;let{booknotes:a=[]}=n;a.forEach(n=>{n.id===e.id&&(n.deletedAt=Date.now(),f(t.split("-")[0]).forEach(e=>null==e?void 0:e.addAnnotation(n,!0)))});let l=u(t,a);l&&d(s,t,l,r)}).bind(null,n),children:(0,a.jsx)("div",{className:(0,c.A)("align-bottom text-red-500","transition duration-300 ease-in-out","content font-size-sm","opacity-0 group-hover:opacity-100","hover:text-red-600"),children:l("Delete")})})]})})]})},nl=e=>{let{type:t,bookKey:n,toc:l}=e,{getConfig:s}=U(),{booknotes:i=[]}=s(n),r=i.filter(e=>e.type===t&&!e.deletedAt),o={};for(let e of r){let t=F(null!=l?l:[],e.cfi),n=(null==t?void 0:t.href)||"",a=(null==t?void 0:t.label)||"",s=(null==t?void 0:t.id)||0;o[n]||(o[n]={id:s,href:n,label:a,booknotes:[]}),o[n].booknotes.push(e)}Object.values(o).forEach(e=>{e.booknotes.sort((e,t)=>ne.compare(e.cfi,t.cfi))});let c=Object.values(o).sort((e,t)=>e.id-t.id);return(0,a.jsx)("div",{className:"rounded pt-2",children:(0,a.jsx)("ul",{role:"tree",className:"px-2",children:c.map(e=>(0,a.jsxs)("li",{className:"p-2",children:[(0,a.jsx)("h3",{className:"content font-size-base line-clamp-1 font-normal",children:e.label}),(0,a.jsx)("ul",{children:e.booknotes.map((e,t)=>(0,a.jsx)(na,{bookKey:n,item:e},"".concat(t,"-").concat(e.cfi)))})]},e.href))})})};var ns=n(54405),ni=n(39060);let nr=e=>{let{activeTab:t,onTabChange:n}=e,l=ev();return(0,a.jsxs)("div",{className:(0,c.A)("bottom-tab border-base-300/50 bg-base-200 relative flex w-full border-t"),dir:"ltr",children:[(0,a.jsx)("div",{className:(0,c.A)("bg-base-300 absolute bottom-1.5 start-1 h-[calc(100%-12px)] w-[calc(33.3%-8px)] rounded-lg","transform transition-transform duration-300","toc"===t&&"translate-x-0","annotations"===t&&"translate-x-[calc(100%+8px)]","bookmarks"===t&&"translate-x-[calc(200%+16px)]")}),["toc","annotations","bookmarks"].map(e=>(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-top z-50 m-1.5 flex-1 cursor-pointer rounded-md p-2","data-tip":"toc"===e?l("TOC"):"annotations"===e?l("Annotate"):l("Bookmark"),children:(0,a.jsx)("div",{className:(0,c.A)("flex h-6 items-center"),onClick:()=>n(e),children:"toc"===e?(0,a.jsx)(ns.Od7,{className:"mx-auto"}):"annotations"===e?(0,a.jsx)(ni.R5w,{className:"mx-auto"}):(0,a.jsx)(te.IEU,{className:"mx-auto"})})},e))]})},no=e=>{var t,n,l;let{bookDoc:s,sideBarBookKey:r}=e,{appService:o}=(0,i.D)(),u=(0,d.useRef)(null),{getConfig:h,setConfig:m}=U(),f=h(r),[p,g]=(0,d.useState)((null==f||null==(t=f.viewSettings)?void 0:t.sideBarTab)||"toc"),[x,b]=(0,d.useState)(!1),[v,w]=(0,d.useState)(p);return(0,d.useEffect)(()=>{let e,t=u.current;if(!t)return;let n=()=>{t.classList.remove("hidden-scrollbar")},a=()=>{t.classList.add("hidden-scrollbar")};a();let l=()=>{n(),clearTimeout(e),e=setTimeout(a,2e3)};return t.addEventListener("scroll",l),()=>{t.removeEventListener("scroll",l),clearTimeout(e)}},[]),(0,d.useEffect)(()=>{r&&g(h(r).viewSettings.sideBarTab)},[r]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,c.A)("sidebar-content flex h-full min-h-0 flex-grow flex-col shadow-inner","font-sans text-base font-normal sm:text-sm"),children:(0,a.jsxs)("div",{ref:u,className:(0,c.A)("scroll-container min-h-0 flex-1 overflow-y-auto transition-opacity duration-300 ease-in-out",{"opacity-0":x,"opacity-100":!x}),children:["toc"===v&&s.toc&&(0,a.jsx)(t7,{toc:s.toc,bookKey:r}),"annotations"===v&&(0,a.jsx)(nl,{type:"annotation",toc:null!=(n=s.toc)?n:[],bookKey:r}),"bookmarks"===v&&(0,a.jsx)(nl,{type:"bookmark",toc:null!=(l=s.toc)?l:[],bookKey:r})]})}),(0,a.jsx)("div",{className:(0,c.A)("flex-shrink-0",(null==o?void 0:o.hasSafeAreaInset)&&"pb-[calc(env(safe-area-inset-bottom)/2)]"),children:(0,a.jsx)(nr,{activeTab:p,onTabChange:e=>{b(!0);let t=setTimeout(()=>{b(!1),w(e),m(r,n),clearTimeout(t)},300);g(e);let n=h(r);n.viewSettings.sideBarTab=e}})})]})},nc=e=>{let{book:t}=e,{coverImageUrl:n,title:l,author:s}=t,i=ev(),{isDarkMode:r}=z(),o=(0,tn.D)(18);return(0,a.jsxs)("div",{className:"flex h-20 w-full items-center",children:[(0,a.jsx)(eh(),{src:n,alt:i("Book Cover"),width:56,height:80,className:(0,c.A)("me-4 aspect-auto max-h-16 w-[15%] max-w-12 rounded-sm object-cover shadow-md",r?"mix-blend-screen":"mix-blend-multiply"),onError:e=>{e.target.style.display="none"}}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h4",{className:"line-clamp-2 w-[90%] text-sm font-semibold",children:(0,G.Ef)(l)}),(0,a.jsx)("p",{className:"truncate text-xs opacity-75",children:(0,G.kY)(s)})]}),(0,a.jsx)("button",{className:"btn btn-ghost hover:bg-base-300 h-6 min-h-6 w-6 rounded-full p-0 transition-colors","aria-label":i("More Info"),children:(0,a.jsx)(te.k4P,{size:o,className:"fill-base-content",onClick:()=>{$.dispatchSync("show-book-details",t)}})})]})},nd=(e,t)=>{let{settings:n}=P(),{sideBarWidth:a,isSideBarVisible:l,isSideBarPinned:s,setSideBarWidth:i,setSideBarVisible:r,setSideBarPin:o,toggleSideBar:c,toggleSideBarPin:u}=q();return(0,d.useEffect)(()=>{i(e),o(t),r(t)},[]),{sideBarWidth:a,isSideBarPinned:s,isSideBarVisible:l,handleSideBarResize:e=>{i(e),n.globalReadSettings.sideBarWidth=e},handleSideBarTogglePin:()=>{u(),n.globalReadSettings.isSideBarPinned=!s,s&&l&&r(!1)},setSideBarVisible:r,toggleSideBar:c}};var nu=n(10374);let nh=e=>{let{label:t,isActive:n,onClick:l}=e;return(0,a.jsx)("button",{className:"hover:bg-base-300 flex w-full items-center justify-between rounded-md p-2",onClick:l,children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{style:{minWidth:"".concat((0,tn.n)(),"px")},children:n&&(0,a.jsx)(te.g9_,{className:"text-base-content"})}),(0,a.jsx)("span",{className:"ml-2",children:t})]})})},nm=e=>{let{searchConfig:t,menuClassName:n,onSearchConfigChanged:l,setIsDropdownOpen:s}=e,i=ev(),r=(e,n)=>{l({...t,[e]:n}),null==s||s(!1)};return(0,a.jsxs)("div",{tabIndex:0,className:(0,c.A)("book-menu dropdown-content dropdown-center border-base-200 z-20 w-56 border shadow-2xl",n),children:[(0,a.jsx)(nh,{label:i("Book"),isActive:"book"===t.scope,onClick:()=>r("scope","book")}),(0,a.jsx)(nh,{label:i("Chapter"),isActive:"section"===t.scope,onClick:()=>r("scope","section")}),(0,a.jsx)("hr",{className:"border-base-200 my-1"}),(0,a.jsx)(nh,{label:i("Match Case"),isActive:t.matchCase,onClick:()=>r("matchCase",!t.matchCase)}),(0,a.jsx)(nh,{label:i("Match Whole Words"),isActive:t.matchWholeWords,onClick:()=>r("matchWholeWords",!t.matchWholeWords)}),(0,a.jsx)(nh,{label:i("Match Diacritics"),isActive:t.matchDiacritics,onClick:()=>r("matchDiacritics",!t.matchDiacritics)})]})},nf=e=>{var t;let{isVisible:n,bookKey:l,searchTerm:s,onSearchResultChange:r}=e,o=ev(),{envConfig:u}=(0,i.D)(),{settings:h}=P(),{getBookData:m}=U(),{getConfig:f,saveConfig:p}=U(),{getView:g,getProgress:x}=Y(),[b,v]=(0,d.useState)(s),w=(0,d.useRef)(null),y=g(l),j=f(l),N=m(l),k=x(l),S=(null==(t=N.book)?void 0:t.primaryLanguage)||"en",C=j.searchConfig,A=(0,d.useRef)(""),E=(0,d.useRef)(!1),L=(0,d.useRef)(null),T=(0,tn.D)(12),M=(0,tn.D)(16);(0,d.useEffect)(()=>{R(b)},[l]),(0,d.useEffect)(()=>{v(s),R(s)},[s]),(0,d.useEffect)(()=>{n&&w.current&&w.current.focus()},[n]),(0,d.useEffect)(()=>{let e=e=>{"Escape"===e.key&&w.current&&w.current.blur()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),L.current&&clearTimeout(L.current)}},[]);let D=e=>{let t=eG(e)?1:2;return e.length>=t},R=e=>{D(e)?I(e):B()},z=function(){let{withRT:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>{if(t.nodeType===Node.ELEMENT_NODE){let n=t.tagName.toLowerCase();return"script"!==n&&"style"!==n&&(e||"rt"!==n)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}},I=async e=>{console.log("searching for:",e),E.current=!0;let{section:t}=k,n="section"===C.scope?t.current:void 0,a=await y.search({...C,index:n,query:e,acceptNode:z({withRT:!S.startsWith("ja")})}),l=[];for await(let t of a)"string"==typeof t?"done"===t&&(r([...l]),E.current=!1,console.log("search done"),A.current!==e&&D(A.current)&&I(A.current)):t.progress||(l.push(t),r([...l]))},B=()=>{r([]),null==y||y.clearSearch()};return(0,a.jsx)("div",{className:"relative p-2",children:(0,a.jsxs)("div",{className:"bg-base-100 flex h-8 items-center rounded-lg",children:[(0,a.jsx)("div",{className:"pl-3",children:(0,a.jsx)(nu.KSO,{size:M,className:"text-gray-500"})}),(0,a.jsx)("input",{ref:w,type:"text",value:b,spellCheck:!1,onChange:e=>{let t=e.target.value;v(t),L.current&&clearTimeout(L.current),L.current=setTimeout(()=>{E.current?A.current=t:R(t)},500)},placeholder:o("Search..."),className:"w-full bg-transparent p-2 font-sans text-sm font-light focus:outline-none"}),(0,a.jsx)("div",{className:"bg-base-300 flex h-8 w-8 items-center rounded-r-lg",children:(0,a.jsx)(tZ,{className:(0,c.A)(window.innerWidth<640&&"dropdown-end","dropdown-bottom flex justify-center"),menuClassName:window.innerWidth<640?"no-triangle mt-1":"dropdown-center mt-3",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0 rounded-none rounded-r-lg",toggleButton:(0,a.jsx)(nu.Vr3,{size:T,className:"text-gray-500"}),children:(0,a.jsx)(nm,{searchConfig:C,onSearchConfigChanged:e=>{j.searchConfig=e,p(u,l,j,h),R(b)}})})})]})})},np=e=>{let{bookKey:t,cfi:n,excerpt:l,onSelectResult:s}=e,{getProgress:i}=Y(),{isCurrent:r,viewRef:o}=nn(n,i(t));return(0,a.jsx)("li",{ref:o,className:(0,c.A)("my-2 cursor-pointer rounded-lg p-2 text-sm",r?"bg-base-300 hover:bg-gray-300/70":"hover:bg-base-300 bg-base-100"),onClick:()=>s(n),children:(0,a.jsxs)("div",{className:"line-clamp-3",children:[(0,a.jsx)("span",{className:"",children:l.pre}),(0,a.jsx)("span",{className:"font-bold text-red-500",children:l.match}),(0,a.jsx)("span",{className:"",children:l.post})]})})},ng=e=>{let{bookKey:t,results:n,onSelectResult:l}=e;return(0,a.jsx)("div",{className:"search-results overflow-y-auto p-2 font-sans text-sm font-light",children:(0,a.jsx)("ul",{className:"px-2",children:n.map((e,n)=>"subitems"in e?(0,a.jsxs)("ul",{children:[(0,a.jsx)("h3",{className:"line-clamp-1 font-normal",children:e.label}),(0,a.jsx)("ul",{children:e.subitems.map((e,n)=>(0,a.jsx)(np,{bookKey:t,cfi:e.cfi,excerpt:e.excerpt,onSelectResult:l},"".concat(n,"-").concat(e.cfi)))})]},"".concat(n,"-").concat(e.label)):(0,a.jsx)(np,{bookKey:t,cfi:e.cfi,excerpt:e.excerpt,onSelectResult:l},"".concat(n,"-").concat(e.cfi)))})})},nx=e=>{let{onGoToLibrary:t}=e,{appService:n}=(0,i.D)(),{updateAppTheme:l}=z(),{settings:s}=P(),{sideBarBookKey:r}=q(),{getBookData:o}=U(),{getView:u,getViewSettings:h}=Y(),[m,f]=(0,d.useState)(!1),[p,g]=(0,d.useState)(null),[x,b]=(0,d.useState)(""),v=window.innerWidth<640,{sideBarWidth:w,isSideBarPinned:y,isSideBarVisible:j,setSideBarVisible:N,handleSideBarResize:k,handleSideBarTogglePin:S}=nd(s.globalReadSettings.sideBarWidth,!v&&s.globalReadSettings.isSideBarPinned),C=async e=>{let{term:t}=e.detail;N(!0),f(!0),b(t)},A=async()=>{let e=document.querySelector(".sidebar-pin-btn");e&&"none"!==window.getComputedStyle(e).display||N(!1)};(0,d.useEffect)(()=>{j?l("base-200"):l("base-100")},[j]),(0,d.useEffect)(()=>($.on("search",C),$.on("navigate",A),()=>{$.off("search",C),$.off("navigate",A)}),[]);let{handleDragStart:E}=tt(e=>{if(!v)return;let t=e.clientY/window.innerHeight,n=Math.max(0,Math.min(1,t)),a=document.querySelector(".sidebar-container"),l=document.querySelector(".overlay");a&&l&&(a.style.top="".concat(100*n,"%"),l.style.opacity="".concat(1-t))},e=>{let t=document.querySelector(".sidebar-container"),a=document.querySelector(".overlay");if(t&&a)if(e.velocity>.5||e.velocity>=0&&e.clientY>=.5*window.innerHeight){let l=.15/Math.max(e.velocity,.5);t.style.transition="top ".concat(l,"s ease-out"),t.style.top="100%",a.style.transition="opacity ".concat(l,"s ease-out"),a.style.opacity="0",setTimeout(()=>N(!1),300),(null==n?void 0:n.hasHaptics)&&(0,ta._q)("medium")}else t.style.transition="top 0.3s ease-out",t.style.top="0%",a.style.transition="opacity 0.3s ease-out",a.style.opacity="0.8",(null==n?void 0:n.hasHaptics)&&(0,ta._q)("medium")}),{handleDragStart:L}=tt(e=>{let t=Math.max(.05,Math.min(.45,e.clientX/window.innerWidth));k("".concat(Math.round(1e4*t)/100,"%"))}),T=()=>{if(f(e=>!e),m){var e;g(null),b(""),null==(e=u(r))||e.clearSearch()}};if(tB({onToggleSearchBar:T},[r]),!r)return null;let M=h(r),D=o(r);if(!D||!D.book||!D.bookDoc)return null;let{book:R,bookDoc:I}=D,B=(0,G.jk)(I.metadata.language);return j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{dir:(null==M?void 0:M.rtl)&&"rtl"===B?"rtl":"ltr",style:{width:"".concat(w),maxWidth:"".concat(45,"%"),position:y?"relative":"absolute"},className:"jsx-d9775a1d85a5e0e "+((0,c.A)("sidebar-container bg-base-200 z-20 flex min-w-60 select-none flex-col",(null==n?void 0:n.isIOSApp)?"h-[100vh]":"h-full",(null==n?void 0:n.hasSafeAreaInset)&&"pt-[env(safe-area-inset-top)]",(null==n?void 0:n.hasRoundedWindow)&&"rounded-window-top-left rounded-window-bottom-left",!y&&"shadow-2xl")||""),children:[(0,a.jsx)(tG(),{id:"d9775a1d85a5e0e",children:"@media(max-width:640px){.sidebar-container.jsx-d9775a1d85a5e0e{width:100%;min-width:100%;-webkit-border-top-left-radius:16px;-moz-border-radius-topleft:16px;border-top-left-radius:16px;-webkit-border-top-right-radius:16px;-moz-border-radius-topright:16px;border-top-right-radius:16px}.sidebar-container.open.jsx-d9775a1d85a5e0e{top:0%}.overlay.jsx-d9775a1d85a5e0e{-webkit-transition:opacity.3s ease-in-out;-moz-transition:opacity.3s ease-in-out;-o-transition:opacity.3s ease-in-out;transition:opacity.3s ease-in-out}}"}),(0,a.jsxs)("div",{className:"jsx-d9775a1d85a5e0e flex-shrink-0",children:[v&&(0,a.jsx)("div",{onMouseDown:E,onTouchStart:E,className:"jsx-d9775a1d85a5e0e drag-handle flex h-10 w-full cursor-row-resize items-center justify-center",children:(0,a.jsx)("div",{className:"jsx-d9775a1d85a5e0e bg-base-content/50 h-1 w-10 rounded-full"})}),(0,a.jsx)(t0,{isPinned:y,isSearchBarVisible:m,onGoToLibrary:t,onClose:()=>N(!1),onTogglePin:S,onToggleSearchBar:T}),(0,a.jsx)("div",{className:"jsx-d9775a1d85a5e0e "+((0,c.A)("search-bar",{"search-bar-visible":m})||""),children:(0,a.jsx)(nf,{isVisible:m,bookKey:r,searchTerm:x,onSearchResultChange:g})}),(0,a.jsx)("div",{className:"jsx-d9775a1d85a5e0e border-base-300/50 border-b px-3",children:(0,a.jsx)(nc,{book:R})})]}),m&&p?(0,a.jsx)(ng,{bookKey:r,results:p,onSelectResult:e=>{var t;A(),null==(t=u(r))||t.goTo(e)}}):(0,a.jsx)(no,{bookDoc:I,sideBarBookKey:r}),(0,a.jsx)("div",{onMouseDown:L,className:"jsx-d9775a1d85a5e0e drag-bar absolute right-0 top-0 h-full w-0.5 cursor-col-resize"})]}),!y&&(0,a.jsx)("div",{className:"overlay fixed inset-0 z-10 bg-black/50 sm:bg-black/20",onClick:()=>{N(!1)}})]}):null};var nb=n(82508);let nv=e=>{let{isPinned:t,isSearchBarVisible:n,handleClose:l,handleTogglePin:s,handleToggleSearchBar:i}=e,r=ev(),o=(0,tn.D)(14);return(0,a.jsxs)("div",{className:"notebook-header relative flex h-11 items-center px-3",dir:"ltr",children:[(0,a.jsxs)("div",{className:"absolute inset-0 z-[-1] flex items-center justify-center space-x-2",children:[(0,a.jsx)(nb.yVo,{}),(0,a.jsx)("div",{className:"notebook-title hidden text-sm font-medium sm:flex",children:r("Notebook")})]}),(0,a.jsxs)("div",{className:"flex w-full items-center gap-x-4",children:[(0,a.jsx)("button",{onClick:s,className:(0,c.A)("btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 sm:flex",t?"bg-base-300":"bg-base-300/65"),children:t?(0,a.jsx)(te.RR4,{size:o}):(0,a.jsx)(te.nDj,{size:o})}),(0,a.jsx)("button",{onClick:l,className:"btn btn-ghost btn-circle flex h-6 min-h-6 w-6 hover:bg-transparent sm:hidden",children:(0,a.jsx)(te.VR3,{})})]}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-x-4",children:(0,a.jsx)("button",{onClick:i,className:(0,c.A)("btn btn-ghost h-8 min-h-8 w-8 p-0",n&&"bg-base-300"),children:(0,a.jsx)(tq.CKj,{})})})]})};var nw=n(84797);let ny=e=>{let{onSave:t,onEdit:n}=e,l=ev(),{notebookNewAnnotation:s,notebookEditAnnotation:i,setNotebookNewAnnotation:r,setNotebookEditAnnotation:o,saveNotebookAnnotationDraft:u,getNotebookAnnotationDraft:h}=X(),m=(0,d.useRef)(null),[f,p]=d.useState(""),g=(0,tn.D)(3);(0,d.useEffect)(()=>{m.current&&m.current.focus()},[m]),(0,d.useEffect)(()=>{if(i)p(i.note),m.current&&(m.current.value=i.note,m.current.focus(),x());else if(s){let e=b();if(e){let t=h((0,nw.Pr)(e))||"";p(t),m.current&&(m.current.value=t,m.current.focus(),x())}}},[s,i]);let x=()=>{m.current&&(m.current.style.height="auto",m.current.style.height="".concat(m.current.scrollHeight,"px"))},b=()=>(null==i?void 0:i.text)||(null==s?void 0:s.text)||"",v=()=>{m.current&&s?t(s,m.current.value):m.current&&i&&(i.note=m.current.value,n(i))};return tB({onSaveNote:()=>{m.current&&m.current.value&&v()},onCloseNote:()=>{s&&r(null),i&&o(null)}}),(0,a.jsxs)("div",{className:"content note-editor-container bg-base-100 mt-2 rounded-md p-2",children:[(0,a.jsx)("div",{className:"flex w-full justify-between space-x-2",children:(0,a.jsx)("div",{className:"relative w-full",children:(0,a.jsx)("textarea",{className:(0,c.A)("note-editor textarea textarea-ghost min-h-[1em] resize-none !outline-none","inset-0 w-full rounded-none border-0 bg-transparent p-0","content font-size-sm"),dir:"auto",ref:m,value:f,rows:1,spellCheck:!1,onChange:e=>{x(),p(e.currentTarget.value)},onBlur:()=>{if(m.current&&m.current.value){let e=b();e&&u((0,nw.Pr)(e),m.current.value)}},placeholder:l("Add your notes here...")})})}),(0,a.jsxs)("div",{className:"flex items-center pt-2",children:[(0,a.jsx)("div",{className:"me-2 mt-0.5 min-h-full self-stretch rounded-xl bg-gray-300",style:{minWidth:"".concat(g,"px")}}),(0,a.jsx)("div",{className:"content font-size-sm line-clamp-3",children:(0,a.jsx)("span",{className:"content font-size-xs text-gray-500",children:b()})})]}),(0,a.jsx)("div",{className:"flex justify-end p-2",dir:"ltr",children:(0,a.jsx)("button",{className:(0,c.A)("content btn btn-ghost font-size-sm hover:bg-transparent","flex h-[1.3em] min-h-[1.3em] items-end p-0",m.current&&m.current.value?"":"btn-disabled !bg-opacity-0"),onClick:v,children:(0,a.jsx)("div",{className:"font-size-sm pr-1 align-bottom text-blue-500",children:l("Save")})})})]})},nj=e=>{let{isVisible:t,bookKey:n,searchTerm:l,onSearchResultChange:s}=e,i=ev(),{getConfig:r}=U(),[o,c]=(0,d.useState)(l),u=(0,d.useRef)(null),h=(0,d.useRef)(null),m=(0,tn.D)(16),f=(0,tn.D)(12);(0,d.useEffect)(()=>{g(o)},[n]),(0,d.useEffect)(()=>{c(l),g(l)},[l]),(0,d.useEffect)(()=>{t&&u.current&&u.current.focus()},[t]),(0,d.useEffect)(()=>{let e=e=>{"Escape"===e.key&&u.current&&u.current.blur()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),h.current&&clearTimeout(h.current)}},[]);let p=(e,t)=>{if(!t.trim())return[];let n=t.toLowerCase();return e.filter(e=>{var t,a;let l=(null==(t=e.text)?void 0:t.toLowerCase().includes(n))||!1,s=(null==(a=e.note)?void 0:a.toLowerCase().includes(n))||!1;return l||s})},g=e=>{e.trim().length>=1?x(e):b()},x=e=>{let t=r(n);if(!t)return void b();let{booknotes:a=[]}=t;s(p(a.filter(e=>!e.deletedAt),e))},b=()=>{s(null)};return(0,a.jsx)("div",{className:"relative px-3 py-2",children:(0,a.jsxs)("div",{className:"bg-base-100 flex h-8 items-center rounded-lg",children:[(0,a.jsx)("div",{className:"pl-3",children:(0,a.jsx)(nu.KSO,{size:m,className:"text-gray-500"})}),(0,a.jsx)("input",{ref:u,type:"text",value:o,spellCheck:!1,onChange:e=>{let t=e.target.value;c(t),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{g(t)},300)},placeholder:i("Search notes and excerpts..."),className:"w-full bg-transparent p-2 font-sans text-sm font-light focus:outline-none"}),o&&(0,a.jsx)("div",{className:"bg-base-300 flex h-8 w-8 items-center rounded-r-lg",children:(0,a.jsx)("button",{onClick:()=>{c(""),g(""),u.current&&u.current.focus()},className:"btn btn-ghost h-8 min-h-8 w-8 rounded-none rounded-r-lg p-0",children:(0,a.jsx)(nu.QCr,{size:f,className:"text-gray-500"})})})]})})},nN=e=>{let{}=e,t=ev(),{updateAppTheme:n}=z(),{envConfig:l,appService:s}=(0,i.D)(),{settings:r}=P(),{sideBarBookKey:o}=q(),{notebookWidth:u,isNotebookVisible:h,isNotebookPinned:m}=X(),{notebookNewAnnotation:p,notebookEditAnnotation:g,setNotebookPin:x}=X(),{getBookData:b,getConfig:v,saveConfig:w,updateBooknotes:y}=U(),{getView:j,getViewSettings:N}=Y(),{setNotebookWidth:k,setNotebookVisible:S,toggleNotebookPin:C}=X(),{setNotebookNewAnnotation:A,setNotebookEditAnnotation:E}=X(),[L,T]=(0,d.useState)(!1),[M,D]=(0,d.useState)(null),[R,I]=(0,d.useState)(""),B=async()=>{let e=document.querySelector(".sidebar-pin-btn");e&&"none"!==window.getComputedStyle(e).display||S(!1)};(0,d.useEffect)(()=>{h?n("base-200"):n("base-100")},[h]),(0,d.useEffect)(()=>(k(r.globalReadSettings.notebookWidth),x(r.globalReadSettings.isNotebookPinned),S(r.globalReadSettings.isNotebookPinned),$.on("navigate",B),()=>{$.off("navigate",B)}),[]);let _=e=>{k(e),r.globalReadSettings.notebookWidth=e},V=(e,t)=>{if(!o)return;let{booknotes:n=[]}=v(o),a=n.findIndex(t=>t.id===e.id);if(-1===a)return;t?e.deletedAt=Date.now():e.updatedAt=Date.now(),n[a]=e;let s=y(o,n);s&&w(l,o,s,r),E(null)},{handleDragStart:F}=tt(e=>{let t=Math.max(.15,Math.min(.45,1-e.clientX/window.innerWidth));_("".concat(Math.round(1e4*t)/100,"%"))}),{booknotes:O=[]}=v(o)||{},W=O.filter(e=>"annotation"===e.type&&e.note&&!e.deletedAt).sort((e,t)=>t.createdAt-e.createdAt),H=O.filter(e=>"excerpt"===e.type&&e.text&&!e.deletedAt).sort((e,t)=>e.createdAt-t.createdAt),K=(0,d.useMemo)(()=>L&&M?M.filter(e=>"annotation"===e.type&&e.note&&!e.deletedAt):W,[W,M,L]),J=(0,d.useMemo)(()=>L&&M?M.filter(e=>"excerpt"===e.type&&e.text&&!e.deletedAt):H,[H,M,L]);if(!o)return null;let Z=b(o),Q=N(o);if(!Z||!Z.bookDoc)return null;let{bookDoc:ee}=Z,et=(0,G.jk)(ee.metadata.language),en=K.length>0||J.length>0,ea=W.length>0||H.length>0;return h?(0,a.jsxs)(a.Fragment,{children:[!m&&(0,a.jsx)("div",{className:"overlay fixed inset-0 z-10 bg-black/20",onClick:e=>{e.preventDefault(),e.stopPropagation(),S(!1),A(null),E(null)}}),(0,a.jsxs)("div",{dir:(null==Q?void 0:Q.rtl)&&"rtl"===et?"rtl":"ltr",style:{width:"".concat(u),maxWidth:"".concat(45,"%"),position:m?"relative":"absolute"},className:"jsx-a7d8f087f9a680d9 "+((0,c.A)("notebook-container bg-base-200 right-0 z-20 flex min-w-60 select-none flex-col","font-sans text-base font-normal sm:text-sm",(null==s?void 0:s.isIOSApp)?"h-[100vh]":"h-full",(null==s?void 0:s.hasSafeAreaInset)&&"pt-[env(safe-area-inset-top)]",(null==s?void 0:s.hasRoundedWindow)&&"rounded-window-top-right rounded-window-bottom-right",!m&&"shadow-2xl")||""),children:[(0,a.jsx)(tG(),{id:"a7d8f087f9a680d9",children:"@media(max-width:640px){.notebook-container.jsx-a7d8f087f9a680d9{width:100%;min-width:100%}}"}),(0,a.jsx)("div",{onMouseDown:F,className:"jsx-a7d8f087f9a680d9 drag-bar absolute left-0 top-0 h-full w-0.5 cursor-col-resize"}),(0,a.jsxs)("div",{className:"jsx-a7d8f087f9a680d9 flex-shrink-0",children:[(0,a.jsx)(nv,{isPinned:m,isSearchBarVisible:L,handleClose:()=>S(!1),handleTogglePin:()=>{C(),r.globalReadSettings.isNotebookPinned=!m},handleToggleSearchBar:()=>{T(e=>!e),L&&(D(null),I(""))}}),(0,a.jsx)("div",{className:"jsx-a7d8f087f9a680d9 "+((0,c.A)("search-bar",{"search-bar-visible":L})||""),children:(0,a.jsx)(nj,{isVisible:L,bookKey:o,searchTerm:R,onSearchResultChange:D})})]}),(0,a.jsxs)("div",{className:"jsx-a7d8f087f9a680d9 flex-grow overflow-y-auto px-3",children:[L&&M&&!en&&ea&&(0,a.jsx)("div",{className:"jsx-a7d8f087f9a680d9 flex h-32 items-center justify-center text-gray-500",children:(0,a.jsx)("p",{className:"jsx-a7d8f087f9a680d9 font-size-sm text-center",children:t("No notes match your search")})}),(0,a.jsx)("div",{dir:"ltr",className:"jsx-a7d8f087f9a680d9",children:J.length>0&&(0,a.jsxs)("p",{className:"jsx-a7d8f087f9a680d9 content font-size-base",children:[t("Excerpts"),L&&M&&(0,a.jsxs)("span",{className:"jsx-a7d8f087f9a680d9 font-size-xs ml-2 text-gray-500",children:["(",J.length,")"]})]})}),(0,a.jsx)("ul",{className:"jsx-a7d8f087f9a680d9 ",children:J.map((e,n)=>(0,a.jsx)("li",{className:"jsx-a7d8f087f9a680d9 my-2",children:(0,a.jsxs)("div",{tabIndex:0,className:"jsx-a7d8f087f9a680d9 collapse-arrow border-base-300 bg-base-100 collapse border",children:[(0,a.jsx)("div",{style:{"--top-override":"1.25rem","--end-override":"0.7rem"},className:"jsx-a7d8f087f9a680d9 "+((0,c.A)("collapse-title pe-8 text-sm font-medium","h-[2.5rem] min-h-[2.5rem] p-[0.6rem]")||""),children:(0,a.jsx)("p",{className:"jsx-a7d8f087f9a680d9 line-clamp-1",children:e.text||"Excerpt ".concat(n+1)})}),(0,a.jsxs)("div",{className:"jsx-a7d8f087f9a680d9 collapse-content font-size-xs select-text px-3 pb-0",children:[(0,a.jsx)("p",{className:"jsx-a7d8f087f9a680d9 hyphens-auto text-justify",children:e.text}),(0,a.jsx)("div",{dir:"ltr",className:"jsx-a7d8f087f9a680d9 flex justify-end",children:(0,a.jsx)("div",{onClick:V.bind(null,e,!0),className:"jsx-a7d8f087f9a680d9 font-size-xs cursor-pointer align-bottom text-red-500 hover:text-red-600",children:t("Delete")})})]})]})},"".concat(n,"-").concat(e.id)))}),(0,a.jsx)("div",{dir:"ltr",className:"jsx-a7d8f087f9a680d9",children:(p||K.length>0)&&(0,a.jsxs)("p",{className:"jsx-a7d8f087f9a680d9 content font-size-base",children:[t("Notes"),L&&M&&K.length>0&&(0,a.jsxs)("span",{className:"jsx-a7d8f087f9a680d9 font-size-xs ml-2 text-gray-500",children:["(",K.length,")"]})]})}),(p||g)&&!L&&(0,a.jsx)(ny,{onSave:(e,t)=>{if(!o)return;let n=j(o),a=v(o),s=null==n?void 0:n.getCFI(e.index,e.range);if(!s)return;let{booknotes:i=[]}=a,c={id:(0,f.NF)(),type:"annotation",cfi:s,note:t,text:e.text,createdAt:Date.now(),updatedAt:Date.now()};i.push(c);let d=y(o,i);d&&w(l,o,d,r),A(null)},onEdit:e=>V(e,!1)}),(0,a.jsx)("ul",{className:"jsx-a7d8f087f9a680d9",children:K.map((e,t)=>(0,a.jsx)(na,{bookKey:o,item:e},"".concat(t,"-").concat(e.cfi)))})]})]})]}):null},nk=e=>{let t=e.addAnnotation.bind(e);return e.addAnnotation=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t({value:e.cfi,...e},n)},e},nS=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{emitLast:!0},a=null,l=null;return function(){for(var s=arguments.length,i=Array(s),r=0;r<s;r++)i[r]=arguments[r];a&&clearTimeout(a),n.emitLast?(l=i,a=setTimeout(()=>{l&&(e(...l),l=null),a=null},t)):a=setTimeout(()=>{e(...i),a=null},t)}},nC=(e,t,n)=>{let{hoveredBookKey:a}=Y(),l=nS(n,500),s=nS(t,100),i=n=>{n instanceof MessageEvent?n.data&&n.data.bookKey===e&&("iframe-wheel"===n.data.type&&l("mouse",-n.data.deltaY,0),"iframe-wheel"===n.data.type?s(n):t(n)):"wheel"===n.type?l("mouse",-n.deltaY,0):t(n)};return(0,d.useEffect)(()=>(window.addEventListener("message",i),()=>{window.removeEventListener("message",i)}),[e,a]),{onClick:t,onWheel:i}},nA=(e,t)=>{let{hoveredBookKey:n,setHoveredBookKey:a,getViewSettings:l}=Y(),s=null,i=null,r=e=>{i=null;let t=e.targetTouches[0];t&&(s=t)},o=t=>{if(!s)return;let r=t.targetTouches[0];if(r&&(i=r),n&&i){let t=l(e),n=i.screenY-s.screenY,r=i.screenX-s.screenX;t.scrolled||t.vertical?a(null):Math.abs(r)>Math.abs(n)&&Math.abs(r)>10&&a(null)}},c=r=>{if(!s)return;let o=r.targetTouches[0];o&&(i=o);let c=window.innerWidth;if(i){let r=l(e),o=i.screenY-s.screenY,d=i.screenX-s.screenX;o<-10&&Math.abs(o)>Math.abs(d)&&Math.abs(d)<.3*c?r.scrolled||r.vertical||a(n?null:e):n&&a(null),t("touch",o,30)}s=null,i=null},u=t=>{t.data&&t.data.bookKey===e&&("iframe-touchstart"===t.data.type?r(t.data):"iframe-touchmove"===t.data.type?o(t.data):"iframe-touchend"===t.data.type&&c(t.data))};return(0,d.useEffect)(()=>(window.addEventListener("message",u),()=>{window.removeEventListener("message",u)}),[n]),{onTouchStart:r,onTouchMove:o,onTouchEnd:c}},nE=(e,t)=>{let n=null==t?void 0:t.onLoad,a=null==t?void 0:t.onRelocate,l=null==t?void 0:t.onLinkClick,s=null==t?void 0:t.onRendererRelocate,i=null==t?void 0:t.onDrawAnnotation,r=null==t?void 0:t.onShowAnnotation;(0,d.useEffect)(()=>{if(e)return n&&e.addEventListener("load",n),a&&e.addEventListener("relocate",a),l&&e.addEventListener("link",l),s&&e.renderer.addEventListener("relocate",s),i&&e.addEventListener("draw-annotation",i),r&&e.addEventListener("show-annotation",r),()=>{n&&e.removeEventListener("load",n),a&&e.removeEventListener("relocate",a),l&&e.removeEventListener("link",l),s&&e.renderer.removeEventListener("relocate",s),i&&e.removeEventListener("draw-annotation",i),r&&e.removeEventListener("show-annotation",r)}},[e])},nL={books:e=>{let{book_hash:t,format:n,title:a,author:l,group_id:s,group_name:i,tags:r,progress:o,created_at:c,updated_at:d,deleted_at:u,uploaded_at:h}=e;return{hash:t,format:n,title:a,author:l,groupId:s,groupName:i,tags:r,progress:o,createdAt:new Date(c).getTime(),updatedAt:new Date(d).getTime(),deletedAt:u?new Date(u).getTime():null,uploadedAt:h?new Date(h).getTime():null}},notes:e=>{let{book_hash:t,id:n,type:a,cfi:l,text:s,style:i,color:r,note:o,created_at:c,updated_at:d,deleted_at:u}=e;return{bookHash:t,id:n,type:a,cfi:l,text:s,style:i,color:r,note:o,createdAt:new Date(c).getTime(),updatedAt:new Date(d).getTime(),deletedAt:u?new Date(u).getTime():null}},configs:e=>{let{book_hash:t,progress:n,location:a,search_config:l,view_settings:s,updated_at:i}=e;return{bookHash:t,location:a,progress:n&&JSON.parse(n),searchConfig:l&&JSON.parse(l),viewSettings:s&&JSON.parse(s),updatedAt:new Date(i).getTime()}}},nT=e=>{let t=0;for(let n of e)n.updated_at&&(t=Math.max(t,new Date(n.updated_at).getTime())),n.deleted_at&&(t=Math.max(t,new Date(n.deleted_at).getTime()));return t};function nM(e){let t=(0,e9.useRouter)(),{settings:n,setSettings:a}=P(),{getConfig:l,setConfig:s}=U(),i=e?l(e):null,[r,c]=(0,d.useState)(!1),[u,h]=(0,d.useState)(!1),[m,f]=(0,d.useState)(!1),[p,g]=(0,d.useState)(null),[x,b]=(0,d.useState)(0),[v,w]=(0,d.useState)(0),[y,j]=(0,d.useState)(0),N=(0,d.useRef)(!1),[k,S]=(0,d.useState)(!1),[C,A]=(0,d.useState)({books:null,configs:null,notes:null}),[E,L]=(0,d.useState)(null),[T,M]=(0,d.useState)(null),[D,R]=(0,d.useState)(null),{syncClient:z}=(0,o.g)();(0,d.useEffect)(()=>{var e,t,a,l,s;if(!n||!i||N.current)return;N.current=!0;let r=null!=(e=n.lastSyncedAtBooks)?e:0,o=null!=(a=null!=(t=null==i?void 0:i.lastSyncedAtConfig)?t:n.lastSyncedAtConfigs)?a:0,c=null!=(s=null!=(l=null==i?void 0:i.lastSyncedAtNotes)?l:n.lastSyncedAtNotes)?s:0;b(r>0?r-6048e5:0),w(o>0?o-6048e5:0),j(c>0?c-6048e5:0)},[n,i]);let I=async(l,r,o,c,d)=>{c(!0),g(null);try{let t=await z.pullChanges(r,l,d);A({...C,[l]:t[l]});let n=t[l];if(!(null==n?void 0:n.length))return;let c=nT(n);o(c);let u=P.getState().settings;switch(l){case"books":u.lastSyncedAtBooks=c,a(u);break;case"configs":d?e&&i&&(i.lastSyncedAtConfig=c,s(e,i)):(u.lastSyncedAtConfigs=c,a(u));break;case"notes":d?e&&i&&(i.lastSyncedAtNotes=c,s(e,i)):(u.lastSyncedAtNotes=c,a(u))}}catch(e){console.error(e),e instanceof Error?(e.message.includes("Not authenticated")&&n.keepLogin&&(n.keepLogin=!1,a(n),tM(t)),g(e.message||"Error pulling ".concat(l))):g("Error pulling ".concat(l))}finally{c(!1)}},B=async e=>{S(!0),g(null);try{let t=await z.pushChanges(e);A(t)}catch(e){console.error(e),e instanceof Error?g(e.message||"Error pushing changes"):g("Error pushing changes")}finally{S(!1)}},_=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"both";("push"===t||"both"===t)&&(null==e?void 0:e.length)&&await B({books:e}),("pull"===t||"both"===t)&&await I("books",x,b,c)},V=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"both";("push"===n||"both"===n)&&(null==e?void 0:e.length)&&await B({configs:e}),("pull"===n||"both"===n)&&await I("configs",v,w,h,t)},F=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"both";("push"===n||"both"===n)&&(null==e?void 0:e.length)&&await B({notes:e}),("pull"===n||"both"===n)&&await I("notes",y,j,f,t)};return(0,d.useEffect)(()=>{if(!k&&C){let{books:e,configs:t,notes:n}=C,a=null==e?void 0:e.map(e=>nL.books(e)),l=null==t?void 0:t.map(e=>nL.configs(e)),s=null==n?void 0:n.map(e=>nL.notes(e));a&&L(a),l&&M(l),s&&R(s)}},[C,k]),{syncing:r||u||m,syncError:p,syncResult:C,syncedBooks:E,syncedConfigs:T,syncedNotes:D,lastSyncedAtBooks:x,lastSyncedAtNotes:y,lastSyncedAtConfigs:v,pullChanges:I,pushChanges:B,syncBooks:_,syncConfigs:V,syncNotes:F}}var nD=n(40459);let nR=e=>{let t=ev(),{getConfig:n,setConfig:a}=U(),{getView:l,getProgress:i}=Y(),{settings:r}=P(),{syncedConfigs:o,syncConfigs:c}=nM(e),{user:u}=(0,s.A)(),m=l(e),f=n(e),p=i(e),g=(0,d.useRef)(!1),x=(0,d.useRef)(!1),b=(e,t)=>{if(!t||!u)return;let n=e.split("-")[0],a={bookHash:n,...t},l=JSON.parse((0,nD.Lg)(a,r.globalViewSettings,h.e3));delete l.booknotes,c([l],n,"push")},v=e=>{u&&c([],e.split("-")[0],"pull")},w=()=>{if(g.current){let t=n(e);t&&t.progress&&t.progress[0]>0&&b(e,t)}else v(e)},y=t=>{let{bookKey:n}=t.detail;n===e&&w()};(0,d.useEffect)(()=>($.on("sync-book-progress",y),()=>{$.off("sync-book-progress",y)}),[e]);let j=(0,d.useCallback)(nS(()=>{w()},1e3*h.Uy),[]);(0,d.useEffect)(()=>{(null==p?void 0:p.location)&&u&&j()},[p]),(0,d.useEffect)(()=>{p&&!x.current&&(x.current=!0,v(e))},[p]),(0,d.useEffect)(()=>{if(!g.current&&o){g.current=!0;let n=o.filter(t=>t.bookHash===e.split("-")[0])[0];if(n){let l=null==f?void 0:f.location,s=n.location;a(e,n),s&&l&&0>_.HY.compare(l,s)&&m&&(m.goTo(s),$.dispatch("hint",{bookKey:e,message:t("Reading Progress Synced")}))}}},[o])},nz=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{emitLast:!0},a=0,l=null,s=null;return function(){for(var i=arguments.length,r=Array(i),o=0;o<i;o++)r[o]=arguments[o];let c=t-(Date.now()-a);c<=0?(l&&(clearTimeout(l),l=null),a=Date.now(),l=null,e(...r)):(s=r,l||(l=setTimeout(()=>{l=null,s&&n.emitLast&&(e(...s),s=null)},c)))}},nP=e=>{let{envConfig:t}=(0,i.D)(),{getConfig:n,saveConfig:a}=U(),{getProgress:l}=Y(),s=l(e),r=(0,d.useCallback)(nz(async()=>{let l=n(e),s=P.getState().settings;await a(t,e,l,s)},1e4),[]);(0,d.useEffect)(()=>{r()},[s,e])},nI=e=>{let{getViewSettings:t}=Y(),n=t(e),[a,l]=(0,d.useState)(null);(0,d.useEffect)(()=>{if(!n)return;a&&a.remove();let t=n.userStylesheet||"",s=document.createElement("style");return s.textContent=t.replace("foliate-view","#foliate-view-".concat(e)),document.head.appendChild(s),l(s),()=>{s.remove()}},[n])},nB=!h.bF||!["android","ios"].includes((0,f.Ox)()),n_=0,nV=null,nF=(e,t)=>{["Backspace","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),window.postMessage({type:"iframe-keydown",bookKey:e,key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},"*")},nO=(e,t)=>{nV=setTimeout(()=>{nV=null},h.dU),window.postMessage({type:"iframe-mousedown",bookKey:e,button:t.button,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY},"*")},nW=(e,t)=>{[3,4].includes(t.button)&&t.preventDefault(),window.postMessage({type:"iframe-mouseup",bookKey:e,button:t.button,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY},"*")},nH=(e,t)=>{window.postMessage({type:"iframe-wheel",bookKey:e,deltaMode:t.deltaMode,deltaX:t.deltaX,deltaY:t.deltaY,deltaZ:t.deltaZ,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY},"*")},nK=(e,t)=>{let n=Date.now();if(nB&&n-n_<h.wI){n_=n,window.postMessage({type:"iframe-double-click",bookKey:e,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY},"*");return}n_=n;let a=()=>{let n=t.target;for(;n;){if(["sup","a","audio","video"].includes(n.tagName.toLowerCase()))return;if(n.classList.contains("js_readerFooterNote")||n.classList.contains("zhangyue-footnote"))return void $.dispatch("footnote-popup",{bookKey:e,element:n,footnote:n.getAttribute("data-wr-footernote")||n.getAttribute("zy-footnote")||""});n=n.parentElement}nV&&window.postMessage({type:"iframe-single-click",bookKey:e,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY},"*")};nB?setTimeout(()=>{Date.now()-n_>=h.wI&&a()},h.wI):a()},nU=(e,t,n)=>{let a=t.targetTouches[0],l=[];a&&l.push({clientX:a.clientX,clientY:a.clientY,screenX:a.screenX,screenY:a.screenY}),window.postMessage({type:n,bookKey:e,targetTouches:l},"*")},nG=(e,t)=>{nU(e,t,"iframe-touchstart")},nY=(e,t)=>{nU(e,t,"iframe-touchmove")},nq=(e,t)=>{nU(e,t,"iframe-touchend")};var nX=n(89081);let nJ={"“":"﹃","”":"﹄","‘":"﹁","’":"﹂"},nZ=[{name:"punctuation",transform:async e=>{if(!0!==e.viewSettings.vertical)return e.content;let t=e.content;for(let[n,a]of Object.entries(nJ))t=e.reversePunctuationTransform?t.replace(RegExp(a,"g"),n):t.replace(RegExp(n,"g"),a);return t}},{name:"footnote",transform:async e=>{let t=e.content;return t.replace(/<aside\s+epub:type\s*=\s*["'](footnote|endnote|note|rearnote)["']([^>]*)>/gi,'<aside class="epubtype-footnote" epub:type="$1"$2>')}}],n$=async e=>{let t=e.content;for(let n of e.transformers.map(e=>nZ.find(t=>t.name===e)).filter(e=>!!e))try{t=await n.transform({...e,content:t})}catch(e){console.warn("Error in transformer ".concat(n.name,":"),e)}return t},nQ=e=>{let{bookKey:t,bookDoc:l,config:s}=e,{appService:r}=(0,i.D)(),o=(0,d.useRef)(null),c=(0,d.useRef)(null),u=(0,d.useRef)(!1),{getView:h,setView:m,setProgress:f}=Y(),{getViewSettings:p,setViewSettings:g}=Y(),{getParallels:x}=tR(),{getBookData:b}=U(),{themeCode:v,isDarkMode:w}=z(),[y,j]=(0,d.useState)("");(0,d.useEffect)(()=>{let e=setTimeout(()=>j(""),2e3);return()=>clearTimeout(e)},[y]),nI(t),nR(t),nP(t),t4(t,c.current);let N=e=>{let{width:n,height:a}=e;return e=>{let{detail:l}=e;l.data=Promise.resolve(l.data).then(e=>{let s=p(t);return s&&"text/css"===l.type?T(s,n,a,e):s&&"application/xhtml+xml"===l.type?Promise.resolve(n$({bookKey:t,viewSettings:s,content:e,transformers:["punctuation","footnote"]})):e}).catch(e=>(console.error(Error("Failed to load ".concat(l.name),{cause:e})),""))}},{handlePageFlip:k,handleContinuousScroll:S}=tV(t,c,o),C=nC(t,k,S),A=nA(t,S);return nE(c.current,{onLoad:e=>{let n=e.detail;if(console.log("doc index loaded:",n.index),n.doc){var a,l;let e=(null==(a=c.current)?void 0:a.renderer.setStyles)&&(0,_.u6)(n.doc),s=p(t),i=b(t);s.vertical=(null==e?void 0:e.vertical)||s.writingMode.includes("vertical")||!1,s.rtl=(null==e?void 0:e.rtl)||"rtl"===(0,tl.A)()||s.writingMode.includes("rl")||!1,g(t,{...s}),ed(n.doc,eY(null==(l=i.book)?void 0:l.primaryLanguage)),n.doc.isEventListenersAdded||(n.doc.isEventListenersAdded=!0,n.doc.addEventListener("keydown",nF.bind(null,t)),n.doc.addEventListener("mousedown",nO.bind(null,t)),n.doc.addEventListener("mouseup",nW.bind(null,t)),n.doc.addEventListener("click",nK.bind(null,t)),n.doc.addEventListener("wheel",nH.bind(null,t)),n.doc.addEventListener("touchstart",nG.bind(null,t)),n.doc.addEventListener("touchmove",nY.bind(null,t)),n.doc.addEventListener("touchend",nq.bind(null,t)))}},onRelocate:e=>{let n=e.detail;f(t,n.cfi,n.tocItem,n.section,n.location,n.time,n.range)},onRendererRelocate:e=>{let n=e.detail;if("scroll"!==n.reason&&"page"!==n.reason)return;let a=x(t);a&&a.size>0&&a.forEach(e=>{if(e!==t){var a,l;let t=null==(a=h(e))?void 0:a.renderer;t&&(null==(l=t.goTo)||l.call(t,{index:n.index,anchor:n.fraction}))}})}}),(0,d.useEffect)(()=>{if(c.current&&c.current.renderer){var e,n;let a=p(t);null==(e=(n=c.current.renderer).setStyles)||e.call(n,L(a))}},[v,w]),(0,d.useEffect)(()=>{u.current||(u.current=!0,(async()=>{var e,a,i,d,u;console.log("Opening book",t),await n.e(7182).then(n.bind(n,77182));let h=nk(document.createElement("foliate-view"));h.id="foliate-view-".concat(t),document.body.append(h),null==(e=o.current)||e.appendChild(h);let f=null==(a=o.current)?void 0:a.getBoundingClientRect(),g=(null==f?void 0:f.width)||window.innerWidth,x=(null==f?void 0:f.height)||window.innerHeight,b=p(t),v=b.writingMode;if(v){let e=(0,G.is)(v),t=(0,G.jk)(l.metadata.language);"auto"!==e?l.dir=e:"auto"!==t&&(l.dir=t)}await h.open(l),c.current=h,m(t,h);let{book:w}=h;null==(i=w.transformTarget)||i.addEventListener("data",N({width:g,height:x})),null==(d=(u=h.renderer).setStyles)||d.call(u,L(b));let y=b.scrolled,j=b.showHeader,k=b.showFooter,S=!j&&!k,C=S?b.compactMarginPx:b.marginPx,A=S?b.compactGapPercent:b.gapPercent,E=b.animated,T=b.maxColumnCount,M=(0,nX.Jt)(b),D=b.maxBlockSize,R=b.screenOrientation;(null==r?void 0:r.isMobileApp)&&await (0,I.ot)({orientation:R}),E?h.renderer.setAttribute("animated",""):h.renderer.removeAttribute("animated"),h.renderer.setAttribute("flow",y?"scrolled":"paginated"),h.renderer.setAttribute("margin","".concat(C,"px")),h.renderer.setAttribute("gap","".concat(A,"%")),h.renderer.setAttribute("max-column-count",T),h.renderer.setAttribute("max-inline-size","".concat(M,"px")),h.renderer.setAttribute("max-block-size","".concat(D,"px"));let z=s.location;z?await h.init({lastLocation:z}):await h.goToFraction(0)})())},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{ref:o,className:"foliate-viewer h-[100%] w-[100%]",...C,...A})})},n0=(e,t)=>e<=1?{columns:"1fr",rows:"1fr"}:2===e?t<1?{columns:"1fr",rows:"1fr 1fr"}:{columns:"1fr 1fr",rows:"1fr"}:3===e||4===e?{columns:"1fr 1fr",rows:"1fr 1fr"}:{columns:"1fr 1fr 1fr",rows:"1fr 1fr 1fr"},n1=e=>{let{section:t,showDoubleBorder:n,isScrolled:l,isVertical:s,horizontalGap:i,verticalMargin:r}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,c.A)("absolute left-0 right-0 top-0 z-10 h-[env(safe-area-inset-top)]",l&&!s&&"bg-base-100")}),(0,a.jsx)("div",{className:(0,c.A)("sectioninfo absolute flex items-center overflow-hidden","mt-[env(safe-area-inset-top)]",s?"writing-vertical-rl max-h-[85%]":"top-0 h-[44px]",l&&!s&&"bg-base-100"),style:s?{top:"".concat(1.5*r,"px"),left:"calc(100% - ".concat(i,"%)"),width:n?"32px":"".concat(i,"%"),height:"calc(100% - ".concat(2*r,"px)")}:{insetInlineStart:"".concat(i,"%"),width:"calc(100% - ".concat(2*i,"%)")},children:(0,a.jsx)("h2",{className:(0,c.A)("text-neutral-content text-center font-sans text-xs font-light",s?"":"line-clamp-1"),children:t||""})})]})},n2=e=>{let{onClick:t,ariaLabel:n,id:l,children:s}=e;return(0,a.jsx)("button",{id:l,onClick:t,className:"window-button text-base-content/85 hover:text-base-content","aria-label":n,children:s})},n4=e=>{let{className:t,headerRef:l,showMinimize:s=!0,showMaximize:r=!0,showClose:o=!0,onMinimize:u,onToggleMaximize:h,onClose:m}=e,f=(0,d.useRef)(null),{appService:p}=(0,i.D)(),g=async e=>{let t=e.target;if(t.closest(".btn")||t.closest(".window-button")||t.closest(".dropdown-container")||t.closest(".exclude-title-bar-mousedown"))return;let{getCurrentWindow:a}=await Promise.resolve().then(n.bind(n,39962));1===e.buttons&&(2===e.detail?a().toggleMaximize():a().startDragging())};(0,d.useEffect)(()=>{if(!(0,M.uO)())return;let e=null==l?void 0:l.current;return null==e||e.addEventListener("mousedown",g),()=>{null==e||e.removeEventListener("mousedown",g)}},[]);let x=async()=>{u?u():tk()},b=async()=>{h?h():tS()},v=async()=>{m?m():tC()};return(0,a.jsxs)("div",{ref:f,className:(0,c.A)("window-buttons flex h-8 items-center justify-end space-x-2",o||r||s?"visible":"hidden",t),children:[s&&(null==p?void 0:p.hasWindowBar)&&(0,a.jsx)(n2,{onClick:x,ariaLabel:"Minimize",id:"titlebar-minimize",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M20 14H4v-2h16"})})}),r&&(null==p?void 0:p.hasWindowBar)&&(0,a.jsx)(n2,{onClick:b,ariaLabel:"Maximize/Restore",id:"titlebar-maximize",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M4 4h16v16H4zm2 4v10h12V8z"})})}),o&&((null==p?void 0:p.hasWindowBar)||m)&&(0,a.jsx)(n2,{onClick:v,ariaLabel:"Close",id:"titlebar-close",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})};var n3=n(75947);let n8=e=>{let{icon:t,onClick:n,disabled:l=!1,tooltip:s,tooltipDirection:r="top",className:o}=e,{appService:d}=(0,i.D)();return(0,a.jsx)("div",{className:(0,c.A)("lg:tooltip z-50 h-8 min-h-8 w-8",s&&"lg:tooltip-".concat(r),{"tooltip-hidden":!s}),"data-tip":s,children:(0,a.jsx)("button",{className:(0,c.A)("btn btn-ghost h-8 min-h-8 w-8 p-0",(null==d?void 0:d.isMobileApp)&&"hover:bg-transparent",l&&"btn-disabled !bg-transparent opacity-50",o),onClick:l?void 0:n,disabled:l,children:t})})},n5=e=>{let{bookKey:t}=e,n=ev(),{sideBarBookKey:l,isSideBarVisible:s,setSideBarBookKey:i,toggleSideBar:r}=q(),{setHoveredBookKey:o}=Y();return(0,a.jsx)(n8,{icon:l===t&&s?(0,a.jsx)(n3.NJu,{className:"text-base-content"}):(0,a.jsx)(n3.ZXb,{className:"text-base-content"}),onClick:()=>{l===t?r():(i(t),s||r()),o("")},tooltip:n("Sidebar"),tooltipDirection:"bottom"})},n6=e=>{let{bookKey:t}=e,n=ev(),{envConfig:l}=(0,i.D)(),{settings:s}=P(),{getConfig:r,saveConfig:o,getBookData:c,updateBooknotes:u}=U(),{getProgress:h,setBookmarkRibbonVisibility:m}=Y(),p=r(t),g=h(t),x=c(t),[b,v]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let{booknotes:e=[]}=p||{},{location:n}=g||{};if(!n)return;let a=ne.collapse(n),l=ne.collapse(n,!0),s=e.filter(e=>"bookmark"===e.type&&!e.deletedAt).some(e=>ne.compare(a,e.cfi)*ne.compare(l,e.cfi)<=0);v(s),m(t,s)},[p,g]),(0,a.jsx)(n8,{icon:b?(0,a.jsx)(te.cgZ,{className:"text-base-content"}):(0,a.jsx)(te.DTu,{className:"text-base-content"}),onClick:()=>{let{booknotes:e=[]}=p,{location:n,range:a}=g;if(n)if(b){v(!1);let a=ne.collapse(n),i=ne.collapse(n,!0);e.forEach(e=>{"bookmark"===e.type&&ne.compare(a,e.cfi)*ne.compare(i,e.cfi)<=0&&(e.deletedAt=Date.now())});let r=u(t,e);r&&o(l,t,r,s)}else{var i;v(!0);let r=(null==a||null==(i=a.startContainer.textContent)?void 0:i.slice(0,128))||"",c=128===r.length?r+"...":r,d={id:(0,f.NF)(),type:"bookmark",cfi:n,text:c||"".concat((0,G.p$)(x.book,g)),note:"",createdAt:Date.now(),updatedAt:Date.now()},h=e.find(e=>"bookmark"===e.type&&e.cfi===n);h?(h.deletedAt=null,h.updatedAt=Date.now(),h.text=d.text):e.push(d);let m=u(t,e);m&&o(l,t,m,s)}},tooltip:n("Bookmark"),tooltipDirection:"bottom"})},n9=e=>{let{bookKey:t}=e,n=ev(),{appService:l}=(0,i.D)(),{setHoveredBookKey:s}=Y(),{sideBarBookKey:r,setSideBarBookKey:o}=q(),{isNotebookVisible:c,toggleNotebook:d}=X(),u=(0,tn.D)(16);return(0,a.jsx)(n8,{icon:(0,a.jsx)(nb.yVo,{size:u,className:"text-base-content"}),onClick:()=>{(null==l?void 0:l.isMobile)&&s(""),r===t?d():(o(t),c||d())},tooltip:n("Notebook"),tooltipDirection:"bottom"})};var n7=n(26778);let ae=()=>{let e=ev(),{setHoveredBookKey:t}=Y(),{isFontLayoutSettingsDialogOpen:n,setFontLayoutSettingsDialogOpen:l}=P();return(0,a.jsx)(n8,{icon:(0,a.jsx)(n7.Oui,{className:"text-base-content"}),onClick:()=>{t(""),l(!n)},tooltip:e("Font & Layout"),tooltipDirection:"bottom"})},at=async function(e,t,n,a){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5)||void 0===arguments[5]||arguments[5],{settings:i,isFontLayoutSettingsGlobal:r,setSettings:o,saveSettings:c}=P.getState(),{getView:d,getViewSettings:u,setViewSettings:h}=Y.getState(),{getConfig:m,saveConfig:f}=U.getState(),p=u(t),g=m(t);if(p[n]!==a&&(p[n]=a,s)){var x,b;let e=d(t);null==e||null==(x=(b=e.renderer).setStyles)||x.call(b,L(p))}h(t,p),r&&!l&&(i.globalViewSettings[n]=a,o(i)),await f(e,t,g,i),await c(e,i)},an=e=>{var t,n;let{bookKey:l}=e,s=ev(),{envConfig:r,appService:o}=(0,i.D)(),{getBookData:c}=U(),{getViewSettings:u,setViewSettings:h,setHoveredBookKey:m}=Y(),p=c(l),g=u(l),[x,b]=(0,d.useState)(g.translationEnabled),v=null==p||null==(t=p.book)?void 0:t.primaryLanguage,w=g.translateTargetLang;return(0,d.useEffect)(()=>{x!==g.translationEnabled&&((null==o?void 0:o.isMobile)&&m(""),at(r,l,"translationEnabled",x,!0,!1),g.translationEnabled=x,h(l,{...g}))},[x]),(0,a.jsx)(n8,{icon:(0,a.jsx)(n7.KgB,{className:x?"text-blue-500":"text-base-content"}),disabled:!p||(null==(n=p.book)?void 0:n.format)==="PDF"||eZ(v,w)||!w&&eZ(v,(0,f.JK)()),onClick:()=>b(!x),tooltip:s(x?"Disable Translation":"Enable Translation"),tooltipDirection:"bottom"})};var aa=n(69290);let al=e=>{let{bookKey:t,setIsDropdownOpen:n,onSetSettingsDialogOpen:l}=e,r=ev(),o=(0,e9.useRouter)(),{user:u}=(0,s.A)(),{envConfig:m,appService:f}=(0,i.D)(),{getConfig:p}=U(),{getView:g,getViewSettings:x,setViewSettings:b}=Y(),v=p(t),w=x(t),{themeMode:y,isDarkMode:j,setThemeMode:N}=z(),[k,S]=(0,d.useState)(w.scrolled),[C,A]=(0,d.useState)(w.zoomLevel),[E,T]=(0,d.useState)(w.invertImgColorInDark);(0,d.useEffect)(()=>{var e,n,a,l,s;k!==w.scrolled&&(w.scrolled=k,null==(e=g(t))||e.renderer.setAttribute("flow",k?"scrolled":"paginated"),null==(n=g(t))||n.renderer.setAttribute("max-inline-size","".concat((0,nX.Jt)(w),"px")),null==(l=g(t))||null==(a=(s=l.renderer).setStyles)||a.call(s,L(w)),b(t,w))},[k]),(0,d.useEffect)(()=>{at(m,t,"zoomLevel",C,!0,!0)},[C]),(0,d.useEffect)(()=>{E!==w.invertImgColorInDark&&at(m,t,"invertImgColorInDark",E,!0,!0)},[E]);let M=Math.max((null==v?void 0:v.lastSyncedAtConfig)||0,(null==v?void 0:v.lastSyncedAtNotes)||0);return(0,a.jsxs)("div",{tabIndex:0,className:"view-menu dropdown-content bgcolor-base-200 dropdown-right no-triangle border-base-200 z-20 mt-1 border shadow-2xl",children:[(0,a.jsxs)("div",{className:(0,c.A)("flex items-center justify-between rounded-md"),children:[(0,a.jsx)("button",{onClick:()=>A(e=>Math.max(e-h.bL,h.cA)),className:(0,c.A)("hover:bg-base-300 text-base-content rounded-full p-2",C<=h.cA&&"btn-disabled text-gray-400"),children:(0,a.jsx)(te.f5Z,{})}),(0,a.jsxs)("button",{className:(0,c.A)("hover:bg-base-300 text-base-content h-8 min-h-8 w-[50%] rounded-md p-1 text-center"),onClick:()=>A(100),children:[C,"%"]}),(0,a.jsx)("button",{onClick:()=>A(e=>Math.min(e+h.bL,h.ec)),className:(0,c.A)("hover:bg-base-300 text-base-content rounded-full p-2",C>=h.ec&&"btn-disabled text-gray-400"),children:(0,a.jsx)(te.gff,{})})]}),(0,a.jsx)("hr",{className:"border-base-300 my-1"}),(0,a.jsx)(t$,{label:r("Font & Layout"),shortcut:"Shift+F",onClick:()=>{null==n||n(!1),l(!0)}}),(0,a.jsx)(t$,{label:r("Scrolled Mode"),shortcut:"Shift+J",Icon:k?te.g9_:void 0,onClick:()=>S(!k)}),(0,a.jsx)("hr",{className:"border-base-300 my-1"}),(0,a.jsx)(t$,{label:u?M?r("Synced at {{time}}",{time:new Date(M).toLocaleString()}):r("Never synced"):r("Sign in to Sync"),Icon:u?te.Jtm:te.OdU,onClick:()=>{u?$.dispatch("sync-book-progress",{bookKey:t}):(tM(o),null==n||n(!1))}}),(0,a.jsx)("hr",{className:"border-base-300 my-1"}),(null==f?void 0:f.hasWindow)&&(0,a.jsx)(t$,{label:r("Fullscreen"),onClick:()=>{tE(),null==n||n(!1)}}),(0,a.jsx)(t$,{label:r("dark"===y?"Dark Mode":"light"===y?"Light Mode":"Auto Mode"),Icon:"dark"===y?aa.vVA:"light"===y?aa.q9U:n3.eV8,onClick:()=>{N("auto"===y?"light":"light"===y?"dark":"auto")}}),(0,a.jsx)(t$,{label:r("Invert Image In Dark Mode"),disabled:!j,Icon:E?te.g9_:void 0,onClick:()=>T(!E)})]})},as=e=>{let{bookKey:t,bookTitle:n,isTopLeft:l,isHoveredAnim:s,onCloseBook:r,onSetSettingsDialogOpen:o}=e,{appService:u}=(0,i.D)(),h=(0,d.useRef)(null),{isTrafficLightVisible:m,setTrafficLightVisibility:f,initializeTrafficLightStore:p,initializeTrafficLightListeners:g,cleanupTrafficLightListeners:x}=tJ(),[b,v]=(0,d.useState)(!1),{bookKeys:w,hoveredBookKey:y,setHoveredBookKey:j}=Y(),{systemUIVisible:N,statusBarHeight:k}=z(),{isSideBarVisible:S}=q(),C=(0,tn.D)(16);(0,d.useEffect)(()=>{if(null==u?void 0:u.hasTrafficLight)return p(u),g(),f(!0),()=>{x()}},[]),(0,d.useEffect)(()=>{(null==u?void 0:u.hasTrafficLight)&&f(S)},[S]);let A=y===t||b;return(0,a.jsxs)("div",{className:(0,c.A)("bg-base-100 absolute top-0 w-full",(null==u?void 0:u.hasSafeAreaInset)&&"pt-[env(safe-area-inset-top)]"),children:[(0,a.jsx)("div",{className:(0,c.A)("absolute top-0 z-10 hidden h-11 w-full sm:flex"),onMouseEnter:()=>!(null==u?void 0:u.isMobile)&&j(t),onTouchStart:()=>!(null==u?void 0:u.isMobile)&&j(t)}),(0,a.jsx)("div",{className:(0,c.A)("bg-base-100 absolute left-0 right-0 top-0 z-10 h-[env(safe-area-inset-top)]",A?"visible":"hidden"),style:{height:N?"max(env(safe-area-inset-top), ".concat(k,"px)"):""}}),(0,a.jsxs)("div",{ref:h,className:(0,c.A)("header-bar bg-base-100 absolute top-0 z-10 flex h-11 w-full items-center pr-4","shadow-xs transition-[opacity,margin-top] duration-300",m&&l&&!S?"pl-16":"pl-4",(null==u?void 0:u.hasRoundedWindow)&&"rounded-window-top-right",!S&&(null==u?void 0:u.hasRoundedWindow)&&"rounded-window-top-left",s&&"hover-bar-anim",A?"pointer-events-auto visible":"pointer-events-none opacity-0",b&&"header-bar-pinned"),style:{marginTop:N?"max(env(safe-area-inset-top), ".concat(k,"px)"):"env(safe-area-inset-top)"},onMouseLeave:()=>!(null==u?void 0:u.isMobile)&&j(""),children:[(0,a.jsxs)("div",{className:"sidebar-bookmark-toggler z-20 flex h-full items-center gap-x-4",children:[(0,a.jsx)("div",{className:"hidden sm:flex",children:(0,a.jsx)(n5,{bookKey:t})}),(0,a.jsx)(n6,{bookKey:t}),(0,a.jsx)(an,{bookKey:t})]}),(0,a.jsx)("div",{className:"header-title z-15 bg-base-100 pointer-events-none absolute inset-0 hidden items-center justify-center sm:flex",children:(0,a.jsx)("h2",{className:"line-clamp-1 max-w-[50%] text-center text-xs font-semibold",children:n})}),(0,a.jsxs)("div",{className:"bg-base-100 z-20 ml-auto flex h-full items-center space-x-4",children:[(0,a.jsx)(ae,{}),(0,a.jsx)(n9,{bookKey:t}),(0,a.jsx)(tZ,{className:"exclude-title-bar-mousedown dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0",toggleButton:(0,a.jsx)(ni.Pwf,{size:C}),onToggle:e=>{v(e),e||j("")},children:(0,a.jsx)(al,{bookKey:t,onSetSettingsDialogOpen:o})}),(0,a.jsx)(n4,{className:"window-buttons flex h-full items-center",headerRef:h,showMinimize:1==w.length&&!m&&(null==u?void 0:u.appPlatform)!=="web",showMaximize:1==w.length&&!m&&(null==u?void 0:u.appPlatform)!=="web",onClose:()=>{j(null),r(t)}})]})]})]})};var ai=n(1060),ar=n(18519);let ao=e=>{let{min:t=0,max:n=100,step:l=1,initialValue:s=50,heightPx:i=40,minLabel:r="",maxLabel:o="",bubbleElement:c,bubbleLabel:u="",className:h="",minClassName:m="",maxClassName:f="",bubbleClassName:p="",onChange:g}=e,[x,b]=(0,d.useState)(s),[v,w]=(0,d.useState)(!1),y=(0,d.useRef)(null);(0,d.useEffect)(()=>{let e=y.current;for(;e;){if("rtl"===e.getAttribute("dir")){w(!0);break}e=e.parentElement}},[]),(0,d.useEffect)(()=>{b(s)},[s]);let j=(x-t)/(n-t)*100;return(0,a.jsx)("div",{ref:y,className:"slider bg-base-200 mx-auto w-full rounded-xl ".concat(h),dir:v?"rtl":void 0,children:(0,a.jsxs)("div",{className:"relative",style:{height:"".concat(i,"px")},children:[(0,a.jsx)("div",{className:"bg-base-300/40 absolute h-full w-full rounded-full"}),(0,a.jsx)("div",{className:"bg-base-300 absolute h-full rounded-full",style:{width:j>0?"max(calc(".concat(j,"% + ").concat(i/2,"px), ").concat(i,"px)"):"0px",[v?"right":"left"]:0}}),(0,a.jsxs)("div",{className:"absolute inset-0 flex items-center justify-between px-4 text-sm",children:[(0,a.jsx)("span",{className:"ml-2 ".concat(m),children:r}),(0,a.jsx)("span",{className:"mr-2 ".concat(f),children:o})]}),(0,a.jsx)("div",{className:"pointer-events-none absolute top-0 z-10",style:{[v?"right":"left"]:"max(".concat(i/2,"px, calc(").concat(j,"%))"),transform:v?"translateX(calc(50%))":"translateX(calc(-50%))",height:"100%"},children:(0,a.jsx)("div",{className:"bg-base-200 flex h-full items-center justify-center rounded-full text-xs shadow-md ".concat(p),style:{width:"".concat(i,"px")},children:c||u})}),(0,a.jsx)("input",{type:"range",min:t,max:n,step:l,value:x,className:"absolute inset-0 h-full w-full cursor-pointer opacity-0",onChange:e=>{let t=parseInt(e.target.value,10);b(t),g&&g(t)}})]})})},ac=e=>{var t,n,l,s,r;let{bookKey:o,bookFormat:u,section:h,pageinfo:m,isHoveredAnim:f}=e,p=ev(),{envConfig:g,appService:x}=(0,i.D)(),{hoveredBookKey:b,setHoveredBookKey:v}=Y(),{getView:w,getViewState:y,getProgress:j,getViewSettings:N}=Y(),{isSideBarVisible:k,setSideBarVisible:S}=q(),[C,A]=d.useState(""),E=(0,tn.D)(28),L=(0,tn.D)(23),T=(0,tn.D)(18),M=(0,tn.D)(20),D=w(o),R=j(o),z=N(o),P=y(o),I=e=>{null==D||D.goToFraction(e/100)},B=()=>{t_(D,z,"left")},_=()=>{t_(D,z,"right")},V=()=>{(null==D?void 0:D.renderer.prevSection)&&(null==D||D.renderer.prevSection())},F=()=>{(null==D?void 0:D.renderer.nextSection)&&(null==D||D.renderer.nextSection())},O=()=>{null==D||D.history.back()},W=()=>{null==D||D.history.forward()},H=async()=>{D&&R&&($.dispatchSync("tts-is-speaking")?$.dispatch("tts-stop",{bookKey:o}):$.dispatch("tts-speak",{bookKey:o}))},K=e=>{A(C===e?"":e),"tts"===e?(v(""),H()):"toc"===e?(v(""),z&&(z.sideBarTab="toc"),S(!0)):"note"===e&&(v(""),S(!0),z&&(z.sideBarTab="annotations"))};(0,d.useEffect)(()=>{b!==o&&A("")},[b,o]);let U=b===o,G=null==P?void 0:P.ttsEnabled,X="PDF"===u?h:m,J=!!X,Z=J&&(null==X?void 0:X.total)>0&&(X.current+1)/X.total||0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,c.A)("absolute bottom-0 left-0 z-10 hidden w-full sm:flex sm:h-[52px]",(null==z?void 0:z.vertical)&&(null==z?void 0:z.scrolled)&&"sm:!bottom-3 sm:!h-7"),onMouseEnter:()=>!(null==x?void 0:x.isMobile)&&v(o),onTouchStart:()=>!(null==x?void 0:x.isMobile)&&v(o)}),(0,a.jsxs)("div",{className:(0,c.A)("footer-bar shadow-xs absolute bottom-0 z-50 flex w-full flex-col","sm:h-[52px] sm:justify-center","sm:bg-base-100 border-base-300/50 border-t sm:border-none","transition-[opacity,transform] duration-300",(null==x?void 0:x.hasRoundedWindow)&&"rounded-window-bottom-right",!k&&(null==x?void 0:x.hasRoundedWindow)&&"rounded-window-bottom-left",f&&"hover-bar-anim",(null==z?void 0:z.vertical)&&(null==z?void 0:z.scrolled)&&"sm:!bottom-3 sm:!h-7",U?"pointer-events-auto translate-y-0 opacity-100":"pointer-events-none translate-y-full opacity-0 sm:translate-y-0"),dir:(null==z?void 0:z.rtl)?"rtl":"ltr",onMouseLeave:()=>window.innerWidth>=640&&v(""),"aria-hidden":!U,children:[(0,a.jsxs)("div",{className:(0,c.A)("bg-base-200 absolute bottom-16 flex w-full flex-col items-center gap-y-8 px-4 transition-all sm:hidden","progress"===C?"pointer-events-auto translate-y-0 pb-4 pt-8 ease-out":"pointer-events-none invisible translate-y-full overflow-hidden pb-0 pt-0 ease-in"),style:{bottom:(null==x?void 0:x.hasSafeAreaInset)?"calc(env(safe-area-inset-bottom) + 64px)":"64px"},children:[(0,a.jsx)("div",{className:"flex w-full items-center justify-between gap-x-6",children:(0,a.jsx)(ao,{heightPx:E,bubbleLabel:"".concat(Math.round(100*Z),"%"),initialValue:J?100*Z:0,onChange:e=>I(e)})}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-6",children:[(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.AkA,{}):(0,a.jsx)(n7.Xc9,{}),onClick:(null==z?void 0:z.rtl)?F:V,tooltip:p((null==z?void 0:z.rtl)?"Next Section":"Previous Section")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.ye6,{}):(0,a.jsx)(n7.vMW,{}),onClick:(null==z?void 0:z.rtl)?_:B,tooltip:p((null==z?void 0:z.rtl)?"Next Page":"Previous Page")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.EaJ,{}):(0,a.jsx)(n7.cWs,{}),onClick:O,tooltip:p("Go Back"),disabled:!(null==D?void 0:D.history.canGoBack)}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.cWs,{}):(0,a.jsx)(n7.EaJ,{}),onClick:W,tooltip:p("Go Forward"),disabled:!(null==D?void 0:D.history.canGoForward)}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.vMW,{}):(0,a.jsx)(n7.ye6,{}),onClick:(null==z?void 0:z.rtl)?B:_,tooltip:p((null==z?void 0:z.rtl)?"Previous Page":"Next Page")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.Xc9,{}):(0,a.jsx)(n7.AkA,{}),onClick:(null==z?void 0:z.rtl)?V:F,tooltip:p((null==z?void 0:z.rtl)?"Previous Section":"Next Section")})]})]}),(0,a.jsxs)("div",{className:(0,c.A)("bg-base-200 absolute flex w-full flex-col items-center gap-y-8 px-4 transition-all sm:hidden","font"===C?"pointer-events-auto translate-y-0 pb-4 pt-8 ease-out":"pointer-events-none invisible translate-y-full overflow-hidden pb-0 pt-0 ease-in"),style:{bottom:(null==x?void 0:x.hasSafeAreaInset)?"calc(env(safe-area-inset-bottom) + 64px)":"64px"},children:[(0,a.jsx)(ao,{initialValue:null!=(t=null==z?void 0:z.defaultFontSize)?t:16,bubbleLabel:"".concat(null!=(n=null==z?void 0:z.defaultFontSize)?n:16),minLabel:"A",maxLabel:"A",minClassName:"text-xs",maxClassName:"text-base",onChange:e=>{at(g,o,"defaultFontSize",e)},min:8,max:30}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-6",children:[(0,a.jsx)(ao,{initialValue:((null!=(l=null==z?void 0:z.marginPx)?l:44)/88+(null!=(s=null==z?void 0:z.gapPercent)?s:5)/10)*50,bubbleElement:(0,a.jsx)(n3.sQu,{size:M}),minLabel:p("Small"),maxLabel:p("Large"),step:10,onChange:e=>{let t=Math.round(e/100*88),n=Math.round(e/100*10);at(g,o,"marginPx",t,!1,!1),at(g,o,"gapPercent",n,!1,!1),null==D||D.renderer.setAttribute("margin","".concat(t,"px")),null==D||D.renderer.setAttribute("gap","".concat(n,"%")),(null==z?void 0:z.scrolled)&&(null==D||D.renderer.setAttribute("flow","scrolled"))}}),(0,a.jsx)(ao,{initialValue:(null!=(r=null==z?void 0:z.lineHeight)?r:1.6)*10,bubbleElement:(0,a.jsx)(ar.ab_,{size:M}),minLabel:p("Small"),maxLabel:p("Large"),min:8,max:24,onChange:e=>{at(g,o,"lineHeight",e/10)}})]})]}),(0,a.jsxs)("div",{className:(0,c.A)("bg-base-200 z-50 mt-auto flex w-full justify-between px-8 py-4 sm:hidden",(null==x?void 0:x.hasSafeAreaInset)&&"pb-[calc(env(safe-area-inset-bottom)+16px)]"),children:[(0,a.jsx)(n8,{icon:(0,a.jsx)(ns.Od7,{size:L,className:""}),onClick:()=>K("toc")}),(0,a.jsx)(n8,{icon:(0,a.jsx)(ni.R5w,{className:""}),onClick:()=>K("note")}),(0,a.jsx)(n8,{icon:(0,a.jsx)(ar.ax0,{className:(0,c.A)("progress"===C&&"text-blue-500")}),onClick:()=>K("progress")}),(0,a.jsx)(n8,{icon:(0,a.jsx)(n7.b5M,{size:T,className:(0,c.A)("font"===C&&"text-blue-500")}),onClick:()=>K("font")}),(0,a.jsx)(n8,{icon:(0,a.jsx)(te.xs_,{className:G?"text-blue-500":""}),onClick:()=>K("tts")})]}),(0,a.jsxs)("div",{className:"hidden w-full items-center gap-x-4 px-4 sm:flex",children:[(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.AkA,{}):(0,a.jsx)(n7.Xc9,{}),onClick:(null==z?void 0:z.rtl)?F:V,tooltip:p((null==z?void 0:z.rtl)?"Next Section":"Previous Section")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.ye6,{}):(0,a.jsx)(n7.vMW,{}),onClick:(null==z?void 0:z.rtl)?_:B,tooltip:p((null==z?void 0:z.rtl)?"Next Page":"Previous Page")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.EaJ,{}):(0,a.jsx)(n7.cWs,{}),onClick:O,tooltip:p("Go Back"),disabled:!(null==D?void 0:D.history.canGoBack)}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.cWs,{}):(0,a.jsx)(n7.EaJ,{}),onClick:W,tooltip:p("Go Forward"),disabled:!(null==D?void 0:D.history.canGoForward)}),(0,a.jsx)("span",{className:"mx-2 text-center text-sm",children:J?"".concat(Math.round(100*Z),"%"):""}),(0,a.jsx)("input",{type:"range",className:"text-base-content mx-2 w-full",min:0,max:100,value:J?100*Z:0,onChange:e=>I(parseInt(e.target.value,10))}),(0,a.jsx)(n8,{icon:(0,a.jsx)(ai.tLl,{className:G?"text-blue-500":""}),onClick:H,tooltip:p("Speak")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.vMW,{}):(0,a.jsx)(n7.ye6,{}),onClick:(null==z?void 0:z.rtl)?B:_,tooltip:p((null==z?void 0:z.rtl)?"Previous Page":"Next Page")}),(0,a.jsx)(n8,{icon:(null==z?void 0:z.rtl)?(0,a.jsx)(n7.Xc9,{}):(0,a.jsx)(n7.AkA,{}),onClick:(null==z?void 0:z.rtl)?V:F,tooltip:p((null==z?void 0:z.rtl)?"Previous Section":"Next Section")})]})]})]})},ad=e=>{let{bookKey:t,bookFormat:n,section:l,pageinfo:s,timeinfo:r,horizontalGap:o,verticalMargin:d}=e,u=ev(),{appService:h}=(0,i.D)(),{getViewSettings:m}=Y(),f=m(t),p=f.vertical&&f.doubleBorder,g=f.scrolled,x=f.vertical,b=["PDF","CBZ"].includes(n)?l?x?"".concat(l.current+1," \xb7 ").concat(l.total):"".concat(l.current+1," / ").concat(l.total):"":s?u(x?"{{currentPage}} \xb7 {{totalPage}}":"Loc. {{currentPage}} / {{totalPage}}",{currentPage:s.current+1,totalPage:s.total}):"",v=r?u("{{time}} min left in chapter",{time:Math.round(r.section)}):"";return(0,a.jsxs)("div",{className:(0,c.A)("pageinfo absolute bottom-0 flex items-center justify-between","text-neutral-content font-sans text-xs font-extralight",x?"writing-vertical-rl":"h-12 w-full",g&&!x&&"bg-base-100"),style:x?{bottom:"".concat(1.5*d,"px"),left:p?"calc(".concat(o,"% - 32px)"):0,width:p?"32px":"".concat(o,"%"),height:"calc(100% - ".concat(3*d,"px)")}:{paddingInlineStart:"".concat(o,"%"),paddingInlineEnd:"".concat(o,"%"),paddingBottom:(null==h?void 0:h.hasSafeAreaInset)?"calc(env(safe-area-inset-bottom)*0.67)":0},children:[f.showRemainingTime&&(0,a.jsx)("span",{className:"text-start",children:v}),f.showPageNumber&&(0,a.jsx)("span",{className:"ms-auto text-end",children:b})]})},au=e=>{let{}=e;return(0,a.jsx)("div",{className:(0,c.A)("fixed inset-0 z-10 flex w-8 justify-center sm:w-6","h-[calc(env(safe-area-inset-top)+44px)]"),children:(0,a.jsx)("svg",{width:"100%",height:"100%",preserveAspectRatio:"none",viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",imageRendering:"optimizeQuality",children:(0,a.jsx)("polygon",{fill:"#F44336",points:"100 100, 50 78, 0 100, 0 0, 100 0"})})})};var ah=n(33527),am=n(3649),af=n(74554);let ap=e=>{let{className:t,label:n,value:l,onChange:s,min:i,max:r,step:o,disabled:u}=e,[h,m]=(0,d.useState)(l),f=o||1;return(0,d.useEffect)(()=>{m(l)},[l]),(0,a.jsxs)("div",{className:(0,c.A)("config-item",t),children:[(0,a.jsx)("span",{className:"text-base-content",children:n}),(0,a.jsxs)("div",{className:"text-base-content flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",inputMode:"decimal",value:h,onChange:e=>{let t=e.target.value;if(""===t||/^[1-9]\d*\.?\d*$|^0?\.?\d*$/.test(t)){let e=""===t?0:parseFloat(t);m(e),isNaN(e)||s(Math.max(i,Math.min(r,Math.round(10*e)/10)))}},onBlur:()=>{let e=Math.max(i,Math.min(r,h));m(e),s(e)},className:"input input-ghost settings-content text-base-content w-20 max-w-xs rounded border-0 bg-transparent px-3 py-1 text-right !outline-none",onFocus:e=>e.target.select()}),(0,a.jsx)("button",{onClick:()=>{let e=Math.round(10*Math.max(i,h-f))/10;m(e),s(e)},className:"btn btn-circle btn-sm ".concat(l<=i||u?"btn-disabled !bg-opacity-5":""),children:(0,a.jsx)(tq.QLg,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>{let e=Math.round(10*Math.min(r,h+f))/10;m(e),s(e)},className:"btn btn-circle btn-sm ".concat(l>=r||u?"btn-disabled !bg-opacity-5":""),children:(0,a.jsx)(tq.GGD,{className:"h-4 w-4"})})]})]})},ag=e=>{var t;let{family:n,selected:l,options:s,moreOptions:r,onSelect:o,onGetFontFamily:d}=e,u=ev(),{appService:h}=(0,i.D)(),m=(0,tn.D)(16),f=[...s,...null!=r?r:[]],p=null!=(t=f.find(e=>e.option===l))?t:f[0];return(0,a.jsxs)("div",{className:"dropdown dropdown-top",children:[(0,a.jsx)("button",{tabIndex:0,className:"btn btn-sm flex items-center px-[10px] font-normal normal-case sm:px-[20px]",onClick:e=>e.currentTarget.focus(),children:(0,a.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,a.jsx)("span",{className:"text-ellipsis",style:{fontFamily:d(p.option,null!=n?n:"")},children:p.label}),(0,a.jsx)(tq.wAb,{size:m})]})}),(0,a.jsxs)("ul",{tabIndex:0,className:(0,c.A)("dropdown-content bgcolor-base-200 no-triangle menu rounded-box absolute z-[1] mt-4 shadow","!sm:px-2 right-[-32px] w-[46vw] !px-1 sm:right-0 sm:w-44",(null==r?void 0:r.length)?"":"inline max-h-80 overflow-y-scroll"),children:[s.map(e=>{let{option:t,label:s}=e;return(0,a.jsx)("li",{onClick:()=>o(t),children:(0,a.jsxs)("div",{className:"flex w-full items-center overflow-hidden px-0 text-sm",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(m,"px")},children:l===t&&(0,a.jsx)(te.g9_,{className:"text-base-content",size:m})}),(0,a.jsx)("span",{style:{fontFamily:d(t,null!=n?n:"")},children:s||t})]})},t)}),r&&r.length>0&&(0,a.jsxs)("li",{className:"dropdown dropdown-left dropdown-top",children:[(0,a.jsxs)("div",{className:"flex items-center px-0 text-sm",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(m,"px")},children:(0,a.jsx)(tq.irw,{size:m})}),(0,a.jsx)("span",{children:u("System Fonts")})]}),(0,a.jsx)("ul",{tabIndex:0,className:(0,c.A)("dropdown-content bgcolor-base-200 menu rounded-box relative z-[1] shadow","!sm:px-2 !mr-4 mb-[-46px] inline max-h-80 w-[46vw] overflow-y-scroll !px-1 sm:w-[200px]"),children:r.map((e,t)=>(0,a.jsx)("li",{onClick:()=>o(e.option),children:(0,a.jsxs)("div",{className:"flex w-full items-center overflow-hidden px-0 text-sm",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(m,"px")},children:l===e.option&&(0,a.jsx)(te.g9_,{className:"text-base-content",size:m})}),(0,a.jsx)("span",{style:(null==h?void 0:h.isLinuxApp)?{}:{fontFamily:d(e.option,null!=n?n:"")},children:e.label||e.option})]})},"".concat(t,"-").concat(e.option)))})]})]})]})},ax=e=>Array.from(new Set([...e,...h.az,...h.Yk])).filter(e=>h._1.test(e)||h.EZ.test(e)).filter(e=>!h.GT.test(e)).sort((e,t)=>e.localeCompare(t)),ab=e=>/emoji|icons|symbol|dingbats|ornaments|webdings|wingdings|miuiex/i.test(e),av=(e,t)=>"'".concat(e,"', ").concat(t),aw=e=>!["android","linux"].includes((0,f.Ox)())||!h.O9.includes(e),ay=e=>{var t;let{className:n,family:l,label:s,options:i,moreOptions:r,selected:o,onSelect:d}=e,u=ev();return(0,a.jsxs)("div",{className:(0,c.A)("config-item",n),children:[(0,a.jsx)("span",{className:"min-w-10",children:s}),(0,a.jsx)(ag,{family:l,options:i.map(e=>({option:e,label:u(e)})),moreOptions:null!=(t=null==r?void 0:r.map(e=>({option:e,label:e})))?t:[],selected:o,onSelect:d,onGetFontFamily:av})]})},aj=e=>{let{bookKey:t}=e,n=ev(),{envConfig:l}=(0,i.D)(),{getView:s,getViewSettings:r}=Y(),o=r(t),c=s(t),u=[{option:"Serif",label:n("Serif Font")},{option:"Sans-serif",label:n("Sans-Serif Font")}],m=(0,f.Ox)(),p=[];switch(m){case"macos":p=h.pP;break;case"windows":p=h.Z$;break;case"linux":p=h.g9;break;case"ios":p=h.ZH;break;case"android":p=h.TJ}let[g,x]=(0,d.useState)(p),[b,v]=(0,d.useState)(o.defaultFontSize),[w,y]=(0,d.useState)(o.minimumFontSize),[j,N]=(0,d.useState)(o.overrideFont),[k,S]=(0,d.useState)(o.defaultFont),[C,A]=(0,d.useState)(o.defaultCJKFont),[E,L]=(0,d.useState)(o.serifFont),[T,D]=(0,d.useState)(o.sansSerifFont),[R,z]=(0,d.useState)(o.monospaceFont),[P,B]=(0,d.useState)(o.fontWeight),[_,V]=(0,d.useState)(()=>ax(g));return(0,d.useEffect)(()=>{V(e=>{let t=ax(g);return e.length!==t.length?t:e})},[g]),(0,d.useEffect)(()=>{(0,M.uO)()&&(0,I.S$)().then(e=>{if(e.error||0===Object.keys(e.fonts).length)return void console.error("Failed to get system fonts list:",e.error);let t=[];Object.entries(e.fonts).forEach(n=>{let[a,l]=n;!a||ab(a)||(1===Object.entries(e.fonts).filter(e=>{let[t,n]=e;return n===l}).length?t.push(l):t.push(a))}),x([...new Set(t)].sort((e,t)=>e.localeCompare(t)))})},[]),(0,d.useEffect)(()=>{at(l,t,"defaultFont",k)},[k]),(0,d.useEffect)(()=>{at(l,t,"defaultCJKFont",C)},[C]),(0,d.useEffect)(()=>{at(l,t,"defaultFontSize",b)},[b]),(0,d.useEffect)(()=>{at(l,t,"minimumFontSize",w)},[w]),(0,d.useEffect)(()=>{at(l,t,"fontWeight",P)},[P]),(0,d.useEffect)(()=>{at(l,t,"serifFont",E)},[E]),(0,d.useEffect)(()=>{at(l,t,"sansSerifFont",T)},[T]),(0,d.useEffect)(()=>{at(l,t,"monospaceFont",R)},[R]),(0,d.useEffect)(()=>{at(l,t,"overrideFont",j)},[j]),(0,a.jsxs)("div",{className:"my-4 w-full space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"",children:n("Override Book Font")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:j,onChange:()=>N(!j)})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Font Size")}),(0,a.jsx)("div",{className:"card border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsx)(ap,{label:n("Default Font Size"),value:b,onChange:v,min:w,max:120}),(0,a.jsx)(ap,{label:n("Minimum Font Size"),value:w,onChange:y,min:1,max:120})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Font Weight")}),(0,a.jsx)("div",{className:"card border-base-200 border shadow",children:(0,a.jsx)("div",{className:"divide-base-200 divide-y",children:(0,a.jsx)(ap,{label:n("Font Weight"),value:P,onChange:B,min:100,max:900,step:100})})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Font Family")}),(0,a.jsx)("div",{className:"card border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Default Font")}),(0,a.jsx)(ag,{options:u,selected:k,onSelect:S,onGetFontFamily:e=>{switch(e){case"Serif":return"'".concat(E,"', serif");case"Sans-serif":return"'".concat(T,"', sans-serif");case"Monospace":return"'".concat(R,"', monospace");default:return""}}})]}),((0,f.ii)()||(null==c?void 0:c.language.isCJK))&&(0,a.jsx)(ay,{className:"config-item-top",family:"serif",label:n("CJK Font"),options:_,selected:C,onSelect:A})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Font Face")}),(0,a.jsx)("div",{className:"card border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsx)(ay,{className:"config-item-top",family:"serif",label:n("Serif Font"),options:[...h.H0.filter(aw),...h.az],moreOptions:g,selected:E,onSelect:L}),(0,a.jsx)(ay,{family:"sans-serif",label:n("Sans-Serif Font"),options:[...h.Z4.filter(aw),...h.Yk],moreOptions:g,selected:T,onSelect:D}),(0,a.jsx)(ay,{className:"config-item-bottom",family:"monospace",label:n("Monospace Font"),options:h.nh,moreOptions:g,selected:R,onSelect:z})]})})]})]})},aN=e=>{var t,n;let{bookKey:l}=e,s=ev(),{envConfig:r}=(0,i.D)(),{getView:o,getViewSettings:c,setViewSettings:u}=Y(),{getBookData:m}=U(),p=o(l),g=m(l),x=c(l),[b,v]=(0,d.useState)(x.paragraphMargin),[w,y]=(0,d.useState)(x.lineHeight),[j,N]=(0,d.useState)(x.wordSpacing),[k,S]=(0,d.useState)(x.letterSpacing),[C,A]=(0,d.useState)(x.textIndent),[E,T]=(0,d.useState)(x.fullJustification),[M,D]=(0,d.useState)(x.hyphenation),[R,z]=(0,d.useState)(x.marginPx),[P,I]=(0,d.useState)(x.gapPercent),[B,_]=(0,d.useState)(x.compactMarginPx),[V,F]=(0,d.useState)(x.compactGapPercent),[O,W]=(0,d.useState)(x.maxColumnCount),[H,K]=(0,d.useState)(x.maxInlineSize),[q,X]=(0,d.useState)(x.maxBlockSize),[J,Z]=(0,d.useState)(x.writingMode),[$,Q]=(0,d.useState)(x.overrideLayout),[ee,et]=(0,d.useState)(x.doubleBorder),[en,ea]=(0,d.useState)(x.borderColor),[el,es]=(0,d.useState)(x.showHeader),[ei,er]=(0,d.useState)(x.showFooter),[eo,ec]=(0,d.useState)(x.showBarsOnScroll),[ed,eu]=(0,d.useState)(x.showRemainingTime),[eh,em]=(0,d.useState)(x.showPageNumber);(0,d.useEffect)(()=>{at(r,l,"paragraphMargin",b)},[b]),(0,d.useEffect)(()=>{at(r,l,"lineHeight",w)},[w]),(0,d.useEffect)(()=>{at(r,l,"wordSpacing",j)},[j]),(0,d.useEffect)(()=>{at(r,l,"letterSpacing",k)},[k]),(0,d.useEffect)(()=>{at(r,l,"textIndent",C)},[C]),(0,d.useEffect)(()=>{at(r,l,"fullJustification",E)},[E]),(0,d.useEffect)(()=>{at(r,l,"hyphenation",M)},[M]),(0,d.useEffect)(()=>{R!==x.marginPx&&(at(r,l,"marginPx",R,!1,!1),null==p||p.renderer.setAttribute("margin","".concat(R,"px")))},[R]),(0,d.useEffect)(()=>{B!==x.compactMarginPx&&(at(r,l,"compactMarginPx",B,!1,!1),null==p||p.renderer.setAttribute("margin","".concat(B,"px")))},[B]),(0,d.useEffect)(()=>{P!==x.gapPercent&&(at(r,l,"gapPercent",P,!1,!1),null==p||p.renderer.setAttribute("gap","".concat(P,"%")),x.scrolled&&(null==p||p.renderer.setAttribute("flow","scrolled")))},[P]),(0,d.useEffect)(()=>{V!==x.compactGapPercent&&(at(r,l,"compactGapPercent",V,!1,!1),null==p||p.renderer.setAttribute("gap","".concat(V,"%")),x.scrolled&&(null==p||p.renderer.setAttribute("flow","scrolled")))},[V]),(0,d.useEffect)(()=>{O!==x.maxColumnCount&&(at(r,l,"maxColumnCount",O,!1,!1),null==p||p.renderer.setAttribute("max-column-count",O),null==p||p.renderer.setAttribute("max-inline-size","".concat((0,nX.Jt)(x),"px")))},[O]),(0,d.useEffect)(()=>{H!==x.maxInlineSize&&(at(r,l,"maxInlineSize",H,!1,!1),null==p||p.renderer.setAttribute("max-inline-size","".concat((0,nX.Jt)(x),"px")))},[H]),(0,d.useEffect)(()=>{q!==x.maxBlockSize&&(at(r,l,"maxBlockSize",q,!1,!1),null==p||p.renderer.setAttribute("max-block-size","".concat(q,"px")))},[q]),(0,d.useEffect)(()=>{if(J===x.writingMode)return;let e=x.writingMode;if(J.includes("vertical")?x.vertical=!0:x.vertical=!1,at(r,l,"writingMode",J,!0),p){var t,n;null==(t=(n=p.renderer).setStyles)||t.call(n,L(x)),p.book.dir=(0,G.is)(J)}e!==J&&(["horizontal-rl","vertical-rl"].includes(J)||["horizontal-rl","vertical-rl"].includes(e))&&setTimeout(()=>window.location.reload(),100)},[J]),(0,d.useEffect)(()=>{$!==x.overrideLayout&&at(r,l,"overrideLayout",$)},[$]),(0,d.useEffect)(()=>{ee!==x.doubleBorder&&(ee&&x.vertical&&(x.gapPercent=Math.max(x.gapPercent,Math.ceil(4800/window.innerWidth)),I(x.gapPercent),u(l,x)),at(r,l,"doubleBorder",ee,!1,!1))},[ee]),(0,d.useEffect)(()=>{at(r,l,"borderColor",en,!1,!1)},[en]),(0,d.useEffect)(()=>{at(r,l,"showBarsOnScroll",eo,!1,!1)},[eo]),(0,d.useEffect)(()=>{at(r,l,"showRemainingTime",ed,!1,!1)},[ed]),(0,d.useEffect)(()=>{at(r,l,"showPageNumber",eh,!1,!1)},[eh]);let ef=()=>{let e=!el&&!ei,t=e?x.compactMarginPx:x.marginPx,n=e?x.compactGapPercent:x.gapPercent;null==p||p.renderer.setAttribute("margin","".concat(t,"px")),null==p||p.renderer.setAttribute("gap","".concat(n,"%")),x.scrolled&&(null==p||p.renderer.setAttribute("flow","scrolled"))};(0,d.useEffect)(()=>{el!==x.showHeader&&(el&&!x.vertical?(x.marginPx=Math.max(x.marginPx,44),z(x.marginPx),u(l,x)):el&&x.vertical&&(x.gapPercent=Math.max(x.gapPercent,Math.ceil(4800/window.innerWidth)),I(x.gapPercent),u(l,x)),at(r,l,"showHeader",el,!1,!1),ef())},[el]),(0,d.useEffect)(()=>{ei!==x.showFooter&&(ei&&!x.vertical?(x.marginPx=Math.max(x.marginPx,44),z(x.marginPx),u(l,x)):ei&&x.vertical&&(x.gapPercent=Math.max(x.gapPercent,Math.ceil(4800/window.innerWidth)),I(x.gapPercent),u(l,x)),at(r,l,"showFooter",ei,!1,!1),ef())},[ei]);let ep=(0,G.fM)(null==(n=g.bookDoc)||null==(t=n.metadata)?void 0:t.language),eg=h.tr.includes(ep)||(0,f.ii)();return(0,a.jsxs)("div",{className:"my-4 w-full space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"",children:s("Override Book Layout")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:$,onChange:()=>Q(!$)})]}),eg&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-medium",children:s("Writing Mode")}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":s("Default"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("auto"===J?"btn-active bg-base-300":""),onClick:()=>Z("auto"),children:(0,a.jsx)(te.ObO,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":s("Horizontal Direction"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("horizontal-tb"===J?"btn-active bg-base-300":""),onClick:()=>Z("horizontal-tb"),children:(0,a.jsx)(te.P9_,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":s("Vertical Direction"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("vertical-rl"===J?"btn-active bg-base-300":""),onClick:()=>Z("vertical-rl"),children:(0,a.jsx)(te.mRX,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":s("RTL Direction"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("horizontal-rl"===J?"btn-active bg-base-300":""),onClick:()=>Z("horizontal-rl"),children:(0,a.jsx)(n3.jvX,{})})})]})]}),x.vertical&&(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:s("Border Frame")}),(0,a.jsx)("div",{className:"card bg-base-100 border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Double Border")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:ee,onChange:()=>et(!ee)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Border Color")}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{className:"btn btn-circle btn-sm bg-red-300 hover:bg-red-500 ".concat("red"===en?"btn-active !bg-red-500":""),onClick:()=>ea("red")}),(0,a.jsx)("button",{className:"btn btn-circle btn-sm bg-black/50 hover:bg-black ".concat("black"===en?"btn-active !bg-black":""),onClick:()=>ea("black")})]})]})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:s("Paragraph")}),(0,a.jsx)("div",{className:"card bg-base-100 border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsx)(ap,{label:s("Paragraph Margin"),value:b,onChange:v,min:0,max:4,step:.2}),(0,a.jsx)(ap,{label:s("Line Spacing"),value:w,onChange:y,min:1,max:3,step:.1}),"zh"!==ep&&(0,a.jsx)(ap,{label:s("Word Spacing"),value:j,onChange:N,min:-4,max:8,step:.5}),(0,a.jsx)(ap,{label:s("Letter Spacing"),value:k,onChange:S,min:-2,max:4,step:.5}),(0,a.jsx)(ap,{label:s("Text Indent"),value:C,onChange:A,min:-2,max:4,step:1}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Full Justification")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:E,onChange:()=>T(!E)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Hyphenation")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:M,onChange:()=>D(!M)})]})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:s("Page")}),(0,a.jsx)("div",{className:"card bg-base-100 border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsx)(ap,{label:s("Vertical Margins (px)"),value:ei||el?R:B,onChange:ei||el?z:_,min:!x.vertical&&(ei||el)?44:0,max:88,step:4}),(0,a.jsx)(ap,{label:s("Horizontal Margins (%)"),value:ei||el?P:V,onChange:ei||el?I:F,min:x.vertical&&(ei||el)?Math.ceil(4800/window.innerWidth):0,max:30}),(0,a.jsx)(ap,{label:s("Maximum Number of Columns"),value:O,onChange:W,min:1,max:4}),(0,a.jsx)(ap,{label:s(x.vertical?"Maximum Column Height":"Maximum Column Width"),value:H,onChange:K,disabled:1===O||x.scrolled,min:400,max:9999,step:100}),(0,a.jsx)(ap,{label:s(x.vertical?"Maximum Column Width":"Maximum Column Height"),value:q,onChange:X,disabled:1===O||x.scrolled,min:400,max:9999,step:100})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:s("Header & Footer")}),(0,a.jsx)("div",{className:"card bg-base-100 border-base-200 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Show Header")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:el,onChange:()=>es(!el)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Show Footer")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:ei,onChange:()=>er(!ei)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Show Remaining Time")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:ed,disabled:!ei,onChange:()=>eu(!ed)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Show Page Number")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:eh,disabled:!ei,onChange:()=>em(!eh)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:s("Apply also in Scrolled Mode")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:eo,onChange:()=>ec(!eo)})]})]})})]})]})};var ak=n(36631),aS=n(88767);let aC=e=>{let{label:t,value:n,onChange:l}=e,[s,i]=(0,d.useState)(!1),r=(0,d.useRef)(null);return(0,d.useEffect)(()=>{function e(e){r.current&&!r.current.contains(e.target)&&i(!1)}return s?document.addEventListener("mousedown",e):document.removeEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[s]),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"mb-1 block text-sm font-medium",children:t}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"border-base-200 relative mr-2 flex h-7 w-8 cursor-pointer items-center justify-center overflow-hidden rounded border",style:{backgroundColor:n},onClick:()=>i(!s)}),(0,a.jsx)("input",{type:"text",value:n,spellCheck:!1,onChange:e=>l(e.target.value),className:"bg-base-100 text-base-content border-base-200 min-w-4 max-w-36 flex-1 rounded border p-1 font-mono text-sm"})]}),s&&(0,a.jsx)("div",{ref:r,className:"relative z-50 mt-2",children:(0,a.jsx)("div",{className:"absolute",children:(0,a.jsx)(aS.Xq,{width:"100%",color:n,onChange:e=>{l(e.hex)},disableAlpha:!0})})})]})},aA=e=>{let{customTheme:t,onSave:n,onDelete:l,onCancel:s}=e,i=ev(),{settings:r}=P(),o=h._C[Math.floor(Math.random()*h._C.length)],[u,m]=(0,d.useState)((null==t?void 0:t.colors.light.fg)||o.light.fg),[f,p]=(0,d.useState)((null==t?void 0:t.colors.light.bg)||o.light.bg),[g,x]=(0,d.useState)((null==t?void 0:t.colors.light.primary)||o.light.primary),[b,v]=(0,d.useState)((null==t?void 0:t.colors.dark.fg)||o.dark.fg),[w,y]=(0,d.useState)((null==t?void 0:t.colors.dark.bg)||o.dark.bg),[j,N]=(0,d.useState)((null==t?void 0:t.colors.dark.primary)||o.dark.primary),[k,S]=(0,d.useState)((null==t?void 0:t.label)||i("Custom")),C=e=>{let{textColor:t,backgroundColor:n,primaryColor:l,label:s}=e;return(0,a.jsxs)("div",{className:"mb-2 mt-4",children:[(0,a.jsx)("label",{className:"mb-1 block text-sm font-medium",children:s}),(0,a.jsx)("div",{className:"border-base-300 overflow-hidden rounded border p-2",style:{backgroundColor:n,color:t},children:(0,a.jsxs)("p",{className:"mb-2 whitespace-pre-line text-xs",children:[i("All the world's a stage,\nAnd all the men and women merely players;\nThey have their exits and their entrances,\nAnd one man in his time plays many parts,\nHis acts being seven ages.\n\n— William Shakespeare"),"\n\n",(0,a.jsx)("span",{className:"mt-4 cursor-pointer italic",style:{color:l},children:i("(from 'As You Like It', Act II)")})]})})]})},A=()=>({name:(0,nw.Pr)(k),label:k,colors:{light:{fg:u,bg:f,primary:g},dark:{fg:b,bg:w,primary:j}}});return(0,a.jsxs)("div",{className:"mt-6 rounded-lg",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("label",{className:"font-medium",children:i("Custom Theme")}),(0,a.jsxs)("div",{className:"flex w-[calc(50%-12px)] justify-between",children:[(0,a.jsx)("button",{className:"btn btn-ghost btn-sm text-base-content px-2",onClick:()=>n(A()),children:i("Save")}),r.globalReadSettings.customThemes.find(e=>e.name===(0,nw.Pr)(k))&&(0,a.jsx)("button",{className:(0,c.A)("btn btn-ghost btn-sm px-2"),onClick:()=>l(A()),children:i("Delete")}),(0,a.jsx)("button",{className:"btn btn-ghost btn-sm px-2",onClick:s,children:i("Cancel")})]})]}),(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("label",{className:"font-medium",children:i("Theme Name")}),(0,a.jsx)("input",{type:"text",value:k,onChange:e=>S(e.target.value),className:"bg-base-100 text-base-content border-base-200 w-[calc(50%-12px)] rounded border p-2 text-sm"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-base-200 rounded-lg p-3",children:[(0,a.jsx)("h3",{className:"mb-3 text-center font-medium",children:i("Light Mode")}),(0,a.jsx)(aC,{label:i("Text Color"),value:u,onChange:m}),(0,a.jsx)(aC,{label:i("Background Color"),value:f,onChange:p}),(0,a.jsx)(aC,{label:i("Link Color"),value:g,onChange:x}),(0,a.jsx)(C,{textColor:u,backgroundColor:f,primaryColor:g,label:i("Preview")})]}),(0,a.jsxs)("div",{className:"bg-base-300 rounded-lg p-3",children:[(0,a.jsx)("h3",{className:"mb-3 text-center font-medium",children:i("Dark Mode")}),(0,a.jsx)(aC,{label:i("Text Color"),value:b,onChange:v}),(0,a.jsx)(aC,{label:i("Background Color"),value:w,onChange:y}),(0,a.jsx)(aC,{label:i("Link Color"),value:j,onChange:N}),(0,a.jsx)(C,{textColor:b,backgroundColor:w,primaryColor:j,label:i("Preview")})]})]})]})},aE=e=>{let{bookKey:t}=e,n=ev(),{themeMode:l,themeColor:s,isDarkMode:r,setThemeMode:o,setThemeColor:c,saveCustomTheme:u}=z(),{envConfig:h}=(0,i.D)(),{settings:m,setSettings:f}=P(),{getViewSettings:p}=Y(),g=p(t),[x,y]=(0,d.useState)(g.invertImgColorInDark),N=(0,tn.D)(16),k=(0,tn.D)(24),[S,C]=(0,d.useState)(null),[A,E]=(0,d.useState)([]),[L,T]=(0,d.useState)(!1),[M,D]=(0,d.useState)(g.overrideColor);(0,d.useEffect)(()=>{x!==g.invertImgColorInDark&&at(h,t,"invertImgColorInDark",x)},[x]),(0,d.useEffect)(()=>{M!==g.overrideColor&&at(h,t,"overrideColor",M)},[M]),(0,d.useEffect)(()=>{var e;E((null!=(e=m.globalReadSettings.customThemes)?e:[]).map(e=>({name:e.name,label:e.label,colors:{light:b(e.colors.light),dark:v(e.colors.dark)},isCustomizale:!0})))},[m]);let R=e=>{let t=m.globalReadSettings.customThemes.find(t=>t.name===e);t&&(C(t),T(!0))};return(0,a.jsx)("div",{className:"my-4 w-full space-y-6",children:L?(0,a.jsx)(aA,{customTheme:S,onSave:e=>{j(e),u(h,m,e),f({...m}),c(e.name),T(!1)},onDelete:e=>{u(h,m,e,!0),f({...m}),c("default"),T(!1)},onCancel:()=>T(!1)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-medium",children:n("Theme Mode")}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Auto Mode"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("auto"===l?"btn-active bg-base-300":""),onClick:()=>o("auto"),children:(0,a.jsx)(n3.eV8,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Light Mode"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("light"===l?"btn-active bg-base-300":""),onClick:()=>o("light"),children:(0,a.jsx)(te.hGG,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Dark Mode"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("dark"===l?"btn-active bg-base-300":""),onClick:()=>o("dark"),children:(0,a.jsx)(te.NmZ,{})})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-medium",children:n("Invert Image In Dark Mode")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:x,disabled:!r,onChange:()=>y(!x)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"",children:n("Override Book Color")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:M,onChange:()=>D(!M)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Theme Color")}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[w.concat(A).map(e=>{let{name:t,label:l,colors:i,isCustomizale:o}=e;return(0,a.jsxs)("label",{className:"relative flex cursor-pointer flex-col items-center justify-center rounded-lg p-4 shadow-md ".concat(s===t?"ring-2 ring-indigo-500 ring-offset-2":""),style:{backgroundColor:r?i.dark["base-100"]:i.light["base-100"],color:r?i.dark["base-content"]:i.light["base-content"]},children:[(0,a.jsx)("input",{type:"radio",name:"theme",value:t,checked:s===t,onChange:()=>c(t),className:"hidden"}),s===t?(0,a.jsx)(te.EVU,{size:k}):(0,a.jsx)(te.d03,{size:k}),(0,a.jsx)("span",{children:n(l)}),o&&s===t&&(0,a.jsx)("button",{onClick:()=>R(t),children:(0,a.jsx)(ak._e3,{size:N,className:"absolute right-2 top-2"})})]},t)}),(0,a.jsxs)("label",{className:"relative flex cursor-pointer flex-col items-center justify-center rounded-lg border border-dashed p-4 shadow-md",onClick:()=>T(!0),children:[(0,a.jsx)(ni.enO,{size:k}),(0,a.jsx)("span",{children:n("Custom")})]})]})]})]})})},aL=e=>{let{toggleDropdown:t}=e,n=ev(),l=(0,tn.n)(),{isFontLayoutSettingsGlobal:s,setFontLayoutSettingsGlobal:i}=P();return(0,a.jsx)("div",{tabIndex:0,className:(0,c.A)("dropdown-content dropdown-right no-triangle border-base-200 z-20 mt-1 border shadow-2xl","text-base sm:text-sm"),children:(0,a.jsx)("button",{className:"hover:bg-base-200 text-base-content flex w-full items-center justify-between rounded-md p-1",onClick:()=>{i(!s),null==t||t()},children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(l,"px")},children:s&&(0,a.jsx)(te.g9_,{className:"text-base-content"})}),(0,a.jsx)("div",{className:"lg:tooltip","data-tip":n(s?"Apply to All Books":"Apply to This Book"),children:(0,a.jsx)("span",{className:"ml-2 whitespace-nowrap",children:n("Global Settings")})})]})})})},aT=e=>{var t;let{bookKey:n}=e,l=ev(),{envConfig:s,appService:r}=(0,i.D)(),{getView:o,getViewSettings:c}=Y(),{getBookData:u}=U(),{acquireVolumeKeyInterception:h,releaseVolumeKeyInterception:m}=ee(),f=u(n),p=c(n),[g,x]=(0,d.useState)(p.scrolled),[b,v]=(0,d.useState)(p.continuousScroll),[w,y]=(0,d.useState)(p.scrollingOverlap),[j,N]=(0,d.useState)(p.volumeKeysToFlip),[k,S]=(0,d.useState)(p.disableClick),[C,A]=(0,d.useState)(p.swapClickArea),[E,T]=(0,d.useState)(p.animated),[M,D]=(0,d.useState)(p.allowScript);return(0,d.useEffect)(()=>{var e,t,a,l,i;g!==p.scrolled&&(at(s,n,"scrolled",g),null==(e=o(n))||e.renderer.setAttribute("flow",g?"scrolled":"paginated"),null==(t=o(n))||t.renderer.setAttribute("max-inline-size","".concat((0,nX.Jt)(p),"px")),null==(l=o(n))||null==(a=(i=l.renderer).setStyles)||a.call(i,L(p)))},[g]),(0,d.useEffect)(()=>{at(s,n,"continuousScroll",b,!1,!1)},[b]),(0,d.useEffect)(()=>{w!==p.scrollingOverlap&&at(s,n,"scrollingOverlap",w,!1,!1)},[w]),(0,d.useEffect)(()=>{at(s,n,"volumeKeysToFlip",j,!1,!1),(null==r?void 0:r.isMobileApp)&&(j?h():m())},[j]),(0,d.useEffect)(()=>{at(s,n,"disableClick",k,!1,!1)},[k]),(0,d.useEffect)(()=>{at(s,n,"swapClickArea",C,!1,!1)},[C]),(0,d.useEffect)(()=>{var e,t;at(s,n,"animated",E,!1,!1),E?null==(e=o(n))||e.renderer.setAttribute("animated",""):null==(t=o(n))||t.renderer.removeAttribute("animated")},[E]),(0,d.useEffect)(()=>{p.allowScript!==M&&(at(s,n,"allowScript",M,!0,!1),setTimeout(()=>window.location.reload(),100))},[M]),(0,a.jsxs)("div",{className:"my-4 w-full space-y-6",children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:l("Scroll")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200 divide-y",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Scrolled Mode")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:g,onChange:()=>x(!g)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Continuous Scroll")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:b,onChange:()=>v(!b)})]}),(0,a.jsx)(ap,{label:l("Overlap Pixels"),value:w,onChange:y,disabled:!p.scrolled,min:0,max:200,step:10})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:l("Click")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Clicks for Page Flip")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:!k,onChange:()=>S(!k)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Swap Clicks Area")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:C,disabled:k,onChange:()=>A(!C)})]}),(null==r?void 0:r.isMobileApp)&&(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Volume Keys for Page Flip")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:j,onChange:()=>N(!j)})]})]})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:l("Animation")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsx)("div",{className:"divide-base-200 divide-y",children:(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:l("Paging Animation")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:E,onChange:()=>T(!E)})]})})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:l("Security")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsx)("div",{className:"divide-base-200 divide-y",children:(0,a.jsxs)("div",{className:"config-item !h-16",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"",children:l("Allow JavaScript")}),(0,a.jsx)("span",{className:"text-xs",children:l("Enable only if you trust the file.")})]}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:M,disabled:(null==(t=f.book)?void 0:t.format)!=="EPUB",onChange:()=>D(!M)})]})})})]})]})};function aM(e){let{value:t,onChange:n,options:l,className:s,disabled:i=!1}=e;return(0,a.jsx)("select",{value:t,onChange:n,className:(0,c.A)("select h-8 min-h-8 rounded-md border-none text-end text-sm","focus:outline-none focus:ring-0",s),disabled:i,style:{textAlignLast:"end"},children:l.map(e=>{let{value:t,label:n}=e;return(0,a.jsx)("option",{value:t,children:n},t)})})}let aD=e=>{let{bookKey:t}=e,n=ev(),{token:l}=(0,s.A)(),{envConfig:r}=(0,i.D)(),{getViewSettings:o,setViewSettings:u}=Y(),m=o(t),[f,p]=(0,d.useState)(m.translationEnabled),[g,x]=(0,d.useState)(m.translationProvider),[b,v]=(0,d.useState)(m.translateTargetLang),w=()=>{let e=Object.entries(h.hQ).map(e=>{let[t,n]=e;return{value:t,label:n}});return e.sort((e,t)=>e.label.localeCompare(t.label)),e.unshift({value:"",label:n("System Language")}),e},y=()=>e5().map(e=>{let t=e.label;return e.authRequired&&!l?t="".concat(t," (").concat(n("Login Required"),")"):e.quotaExceeded&&(t="".concat(t," (").concat(n("Quota Exceeded"),")")),{value:e.name,label:t}});return(0,d.useEffect)(()=>{f!==m.translationEnabled&&(at(r,t,"translationEnabled",f,!0,!1),m.translationEnabled=f,u(t,{...m}))},[f]),(0,a.jsxs)("div",{className:(0,c.A)("my-4 w-full space-y-6"),children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Language")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsx)("div",{className:"divide-base-200 divide-y",children:(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Interface Language")}),(0,a.jsx)(aM,{value:(()=>{let e=m.uiLanguage;return{value:e,label:""===e?n("Auto"):h.hQ[e]}})().value,onChange:e=>{let n=e.target.value;at(r,t,"uiLanguage",n,!1,!1),ef.Ay.changeLanguage(n||navigator.language)},options:w()})]})})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Translation")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsxs)("div",{className:"divide-base-200",children:[(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Enable Translation")}),(0,a.jsx)("input",{type:"checkbox",className:"toggle",checked:f,onChange:()=>p(!f)})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Translation Service")}),(0,a.jsx)(aM,{value:(()=>{var e;let t=y(),n=e5().filter(e=>(!e.authRequired||!!l)&&!e.quotaExceeded),a=n.find(e=>e.name===g)?g:null==(e=n[0])?void 0:e.name;return t.find(e=>e.value===a)||t[0]})().value,onChange:e=>{let n=e.target.value;x(n),at(r,t,"translationProvider",n,!1,!1),m.translationProvider=n,u(t,{...m})},options:y(),disabled:!f})]}),(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Translate To")}),(0,a.jsx)(aM,{value:(()=>{let e=w();return e.find(e=>e.value===b)||e[0]})().value,onChange:e=>{let n=e.target.value;v(n),at(r,t,"translateTargetLang",n,!1,!1),m.translateTargetLang=n,u(t,{...m})},options:w(),disabled:!f})]})]})})]})]})};var aR=n(4792),az=n.n(aR);let aP=e=>{e=e.replace(/\/\*[\s\S]*?\*\//g,"").trim();let t=/^[\s\n]*[-\w]+\s*:\s*[^;]+;?$/;if(!e)return{isValid:!1,error:"Empty CSS"};if((e.match(/{/g)||[]).length!==(e.match(/}/g)||[]).length)return{isValid:!1,error:"Unbalanced curly braces"};for(let n of e.split("}").map(e=>e.trim()).filter(Boolean)){let e=n.split("{").map(e=>e.trim());if(2!==e.length)return{isValid:!1,error:"Invalid CSS structure"};let[a,l]=e;if(!a)return{isValid:!1,error:"Missing selector"};if(!l)return{isValid:!1,error:"Missing declarations for selector: ".concat(a)};let s=l.split(";").map(e=>e.trim()).filter(Boolean);if(0===s.length)return{isValid:!1,error:"No valid properties for selector: ".concat(a)};for(let e of s){if(!e.includes(":"))return{isValid:!1,error:"Missing property or value: ".concat(e)};let[n,a]=e.split(":").map(e=>e.trim());if(!n)return{isValid:!1,error:"Missing property name: ".concat(e)};if(!a)return{isValid:!1,error:"Missing property value: ".concat(e)};if(!t.test(e.endsWith(";")?e:e+";"))return{isValid:!1,error:"Invalid property: ".concat(e)}}}return{isValid:!0,error:null}},aI=e=>{let{bookKey:t}=e,n=ev(),{envConfig:l,appService:s}=(0,i.D)(),{settings:r,isFontLayoutSettingsGlobal:o,setSettings:u}=P(),{getView:h,getViewSettings:m,setViewSettings:f}=Y(),p=m(t),[g,x]=(0,d.useState)(p.userStylesheet),[b,v]=(0,d.useState)(!0),[w,y]=(0,d.useState)(p.screenOrientation),[j,N]=(0,d.useState)(null),[k,S]=(0,d.useState)(!1),C=(0,d.useRef)(null),A=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()};return(0,d.useEffect)(()=>{at(l,t,"screenOrientation",w,!1,!1),(null==s?void 0:s.isMobileApp)&&(0,I.ot)({orientation:w})},[w]),(0,a.jsxs)("div",{className:(0,c.A)("my-4 w-full space-y-6",k&&"h-[50%] overflow-y-auto pb-[200px]"),children:[(null==s?void 0:s.isMobileApp)&&(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Screen")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow",children:(0,a.jsx)("div",{className:"divide-base-200 divide-y",children:(0,a.jsxs)("div",{className:"config-item",children:[(0,a.jsx)("span",{className:"",children:n("Orientation")}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Auto"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("auto"===w?"btn-active bg-base-300":""),onClick:()=>y("auto"),children:(0,a.jsx)(te.Q7t,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Portrait"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("portrait"===w?"btn-active bg-base-300":""),onClick:()=>y("portrait"),children:(0,a.jsx)(af.scQ,{})})}),(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":n("Landscape"),children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm ".concat("landscape"===w?"btn-active bg-base-300":""),onClick:()=>y("landscape"),children:(0,a.jsx)(af.KXi,{})})})]})]})})})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h2",{className:"mb-2 font-medium",children:n("Custom CSS")}),(0,a.jsx)("div",{className:"card border-base-200 bg-base-100 border shadow ".concat(j?"border-red-500":""),children:(0,a.jsxs)("div",{className:"relative p-1",children:[(0,a.jsx)("textarea",{ref:C,className:(0,c.A)("textarea textarea-ghost h-48 w-full border-0 p-3 text-base !outline-none sm:text-sm","placeholder:text-base-content/70"),placeholder:n("Enter your custom CSS here..."),spellCheck:"false",value:g,onFocus:()=>{(null==s?void 0:s.isAndroidApp)&&S(!0),setTimeout(()=>{var e;null==(e=C.current)||e.scrollIntoView({behavior:"instant",block:"center"})},300)},onBlur:()=>{(null==s?void 0:s.isAndroidApp)&&setTimeout(()=>{S(!1)},100)},onInput:A,onKeyDown:A,onKeyUp:A,onChange:e=>{let t=e.target.value;x(t),v(!1);try{let{isValid:e,error:n}=aP(t);if(t&&!e)throw Error(n||"Invalid CSS");N(null)}catch(e){e instanceof Error?N(e.message):N("Invalid CSS: Please check your input."),console.log("CSS Error:",e)}}}),(0,a.jsx)("button",{className:(0,c.A)("btn btn-ghost bg-base-200 absolute bottom-2 right-4 h-8 min-h-8 px-4 py-2",b?"hidden":"",j?"btn-disabled":""),onClick:()=>{var e,n,a;let l=az()(g,{indent:"  ",openbrace:"end-of-line",autosemicolon:!0});x(l),v(!0),p.userStylesheet=l,f(t,{...p}),o&&(r.globalViewSettings.userStylesheet=l,u(r)),null==(n=h(t))||null==(e=(a=n.renderer).setStyles)||e.call(a,L(p))},disabled:!!j,children:n("Apply")})]})}),j&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:j})]})]})},aB=e=>{var t;let{bookKey:n}=e,l=ev(),{appService:s}=(0,i.D)(),[r]=(0,d.useState)(()=>"rtl"===(0,tl.A)()),o=(0,d.useRef)(null),[u,h]=(0,d.useState)(!1),{setFontLayoutSettingsDialogOpen:m}=P(),f=[{tab:"Font",icon:n7.Oui,label:l("Font")},{tab:"Layout",icon:n7.oeo,label:l("Layout")},{tab:"Color",icon:ah.YK8,label:l("Color")},{tab:"Control",icon:am.Gqw,label:l("Behavior")},{tab:"Language",icon:n7.avg,label:l("Language")},{tab:"Custom",icon:af.pD3,label:l("Custom")}],[p,g]=(0,d.useState)(()=>{let e=localStorage.getItem("lastConfigPanel");return e&&f.some(t=>t.tab===e)?e:"Font"}),x=e=>{g(e),localStorage.setItem("lastConfigPanel",e)},b=()=>{m(!1)};return(0,d.useEffect)(()=>{let e=o.current;if(!e)return;let t=()=>{let t=(e.clientWidth-64)*.22;h(!Array.from(e.querySelectorAll("button")).some(e=>{let n=e.querySelector("span"),a=(null==n?void 0:n.textContent)||"",l=e.cloneNode(!0);l.style.position="absolute",l.style.visibility="hidden",l.style.width="auto";let s=l.querySelector("span");s&&(s.classList.remove("hidden"),s.textContent=a),document.body.appendChild(l);let i=l.scrollWidth;return document.body.removeChild(l),i>t}))};t();let n=new ResizeObserver(t);n.observe(e);let a=new MutationObserver(t);return a.observe(e,{subtree:!0,characterData:!0}),()=>{n.disconnect(),a.disconnect()}},[]),(0,a.jsxs)(ts,{isOpen:!0,onClose:b,className:"modal-open",boxClassName:(0,c.A)("sm:min-w-[520px]",(null==s?void 0:s.isMobile)&&"sm:max-w-[90%] sm:w-3/4"),snapHeight:(null==s?void 0:s.isMobile)?.7:void 0,header:(0,a.jsxs)("div",{className:"flex w-full flex-col items-center",children:[(0,a.jsx)("div",{className:"tab-title flex pb-2 text-base font-semibold sm:hidden",children:(null==(t=f.find(e=>e.tab===p))?void 0:t.label)||""}),(0,a.jsxs)("div",{className:"flex w-full flex-row items-center justify-between",children:[(0,a.jsx)("button",{tabIndex:-1,onClick:b,className:"btn btn-ghost btn-circle flex h-8 min-h-8 w-8 hover:bg-transparent focus:outline-none sm:hidden",children:r?(0,a.jsx)(te.ree,{}):(0,a.jsx)(te.VR3,{})}),(0,a.jsx)("div",{ref:o,className:(0,c.A)("dialog-tabs ms-1 flex h-10 w-full items-center gap-1 sm:ms-0"),children:f.map(e=>{let{tab:t,icon:n,label:l}=e;return(0,a.jsxs)("button",{"data-tab":t,className:(0,c.A)("btn btn-ghost text-base-content btn-sm gap-1 px-2",p===t?"btn-active":""),onClick:()=>x(t),children:[(0,a.jsx)(n,{className:"mr-0"}),(0,a.jsx)("span",{className:(0,c.A)(window.innerWidth<640&&"hidden",!(u||p===t)&&"hidden"),children:l})]},t)})}),(0,a.jsxs)("div",{className:"flex h-full items-center justify-end gap-x-2",children:[(0,a.jsx)(tZ,{className:"dropdown-bottom dropdown-end",buttonClassName:"btn btn-ghost h-8 min-h-8 w-8 p-0 flex items-center justify-center",toggleButton:(0,a.jsx)(ni.Pwf,{}),children:(0,a.jsx)(aL,{})}),(0,a.jsx)("button",{onClick:b,className:"bg-base-300/65 btn btn-ghost btn-circle hidden h-6 min-h-6 w-6 p-0 sm:flex",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"})})})]})]})]}),children:["Font"===p&&(0,a.jsx)(aj,{bookKey:n}),"Layout"===p&&(0,a.jsx)(aN,{bookKey:n}),"Color"===p&&(0,a.jsx)(aE,{bookKey:n}),"Control"===p&&(0,a.jsx)(aT,{bookKey:n}),"Language"===p&&(0,a.jsx)(aD,{bookKey:n}),"Custom"===p&&(0,a.jsx)(aI,{bookKey:n})]})};var a_=n(86532),aV=n(50776);let aF=e=>{let{user:t}=(0,s.A)(),{syncedNotes:n,syncNotes:a,lastSyncedAtNotes:l}=nM(e),{getConfig:i,setConfig:r}=U(),o=i(e),c=e.split("-")[0],u=()=>{var n;let a=i(e);if(!(null==a?void 0:a.location)||!t)return[];let s=(null!=(n=a.booknotes)?n:[]).filter(e=>{var t;return l<e.updatedAt||l<(null!=(t=e.deletedAt)?t:0)});return s.forEach(e=>{e.bookHash=c}),s},m=(0,d.useCallback)(nS(()=>{a(u(),c,"both")},1e3*h.u1),[l]);(0,d.useEffect)(()=>{(null==o?void 0:o.location)&&t&&m()},[o]),(0,d.useEffect)(()=>{if((null==n?void 0:n.length)&&o){var t;let a=n.filter(e=>e.bookHash===c);if(!a.length)return;let l=[...(null!=(t=o.booknotes)?t:[]).filter(e=>!a.some(t=>t.id===e.id)),...a.map(t=>{var n,a,l;let s=i(e),r=(null!=(n=null==s?void 0:s.booknotes)?n:[]).find(e=>e.id===t.id);return r?r.updatedAt<t.updatedAt||(null!=(a=r.deletedAt)?a:0)<(null!=(l=t.deletedAt)?l:0)?{...r,...t}:{...t,...r}:t})];r(e,{booknotes:l})}},[n])},aO=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=n*t.left+e.left,s=n*t.right+e.left;return{left:l,right:s,top:a*t.top+e.top,bottom:a*t.bottom+e.top}},aW=e=>{let{x:t,y:n}=e;return t>0&&n>0&&t<window.innerWidth&&n<window.innerHeight},aH=e=>{let t;for(t=e&&"object"==typeof e&&("tagName"in e)?e:e&&"object"==typeof e&&("collapse"in e)?e.commonAncestorContainer:e;t;){if(t.nodeType===Node.DOCUMENT_NODE){let e=t;if(e.defaultView&&e.defaultView.frameElement)return e.defaultView.frameElement}t=t.parentNode}return null},aK=(e,t,n)=>({x:Math.max(n,Math.min(e.x,t.right-n)),y:Math.max(n,Math.min(e.y,t.bottom-n))}),aU=function(e,t,n){var a,l,s,i;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=aH(e),c=(o?getComputedStyle(o).transform:"").match(/matrix\((.+)\)/),[d,,,u]=null!=(s=null==c||null==(l=c[1])||null==(a=l.split(/\s*,\s*/))?void 0:a.map(e=>parseFloat(e)))?s:[],h=null!=(i=null==o?void 0:o.getBoundingClientRect())?i:{top:0,left:0},m=Array.from(e.getClientRects()),f=aO(h,m[0],d,u),p=aO(h,m.at(-1),d,u);if(r){let e=f.left-t.left>t.right-f.right?"left":"right",a={point:aK({x:"left"===e?f.left-t.left-6:f.right-t.left+6,y:(f.top+f.bottom)/2-t.top},t,n),dir:e};return aW(a.point)?a:{point:{x:0,y:0},dir:e}}let g={point:{x:(f.left+f.right)/2-t.left,y:f.top-t.top-12},dir:"up"},x={point:{x:(p.left+p.right)/2-t.left,y:p.bottom-t.top+6},dir:"down"},b=aW(g.point),v=aW(x.point);return b||v?b?v?g.point.y>window.innerHeight-x.point.y?g:x:g:x:{point:{x:0,y:0}}},aG=(e,t,n,a,l)=>{let s={x:0,y:0};return"up"===e.dir?(s.x=e.point.x-n/2,s.y=e.point.y-a):"down"===e.dir?(s.x=e.point.x-n/2,s.y=e.point.y+6):"left"===e.dir?(s.x=e.point.x-n,s.y=e.point.y-a/2):"right"===e.dir&&(s.x=e.point.x+6,s.y=e.point.y-a/2),s.x<l&&(s.x=l),s.y<l&&(s.y=l),s.x+n>t.right-t.left-l&&(s.x=t.right-t.left-l-n),s.y+a>t.bottom-t.top-l&&(s.y=t.bottom-t.top-l-a),{point:s,dir:e.dir}},aY=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=e.cloneRange().cloneContents(),l=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,{acceptNode:e=>{let t=e.parentElement;return n.includes((null==t?void 0:t.tagName.toLowerCase())||"")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),s="";for(;t=l.nextNode();){var i;s+=null!=(i=t.nodeValue)?i:""}return s},aq=(e,t,n)=>{var a;let{appService:l}=(0,i.D)(),{getBookData:s}=U(),{getView:r,getViewSettings:o}=Y(),c=r(e),u=(null==(a=s(e).book)?void 0:a.primaryLanguage)||"en",h=(0,f.Ox)(),m=(0,d.useRef)(!1),p=(0,d.useRef)(!1),g=(0,d.useRef)(!1),x=(0,d.useRef)(!1),b=(0,d.useRef)(null),[v,w]=(0,d.useState)(!1),y=e=>e&&e.toString().trim().length>0&&e.rangeCount>0,j={bookKey:e,viewSettings:o(e),content:"",transformers:["punctuation"],reversePunctuationTransform:!0},N=async e=>(j.content=aY(e,u.startsWith("ja")?["rt"]:[]),await n$(j)),k=async function(n,a){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];g.current=!0,w(!0);let s=n.getRangeAt(0);l&&(n.removeAllRanges(),n.addRange(s)),t({key:e,text:await N(s),range:s,index:a})},S=async(n,a)=>{g.current=!0,w(!0);let l=n.getRangeAt(0);setTimeout(()=>{n.removeAllRanges(),setTimeout(async()=>{g.current&&(n.addRange(l),t({key:e,text:await N(l),range:l,index:a}))},40)},0)};return(0,d.useEffect)(()=>{if(g.current&&!b.current){var e;b.current=(null==c||null==(e=c.renderer)?void 0:e.start)||null}else g.current||(b.current=null)},[v]),(0,d.useEffect)(()=>{let e=()=>p.current?(p.current=!1,!0):g.current?(n(),g.current=!1,w(!1),null==c||c.deselect(),!0):!!m.current&&(n(),!0);return $.onSync("iframe-single-click",e),()=>{$.offSync("iframe-single-click",e)}},[]),{handleScroll:()=>{var t;let n=o(e);(null==l?void 0:l.isAndroidApp)&&!(null==n?void 0:n.scrolled)&&(null==c||null==(t=c.renderer)?void 0:t.containerPosition)&&b.current&&(console.warn("Keep container position",b.current),c.renderer.containerPosition=b.current)},handleTouchStart:()=>{x.current=!0},handleTouchEnd:()=>{x.current=!1},handlePointerup:(e,t)=>{let n=e.getSelection();y(n)&&("ios"===h?S(n,t):k(n,t,!0))},handleSelectionchange:(e,t)=>{let a=e.getSelection();if("ios"!==h){if(!y(a)){p.current||(n(),g.current=!1,w(!1)),m.current&&(p.current=!1);return}x.current&&"android"===h&&k(a,t,!1),p.current=!0}},handleShowPopup:e=>{setTimeout(()=>{e&&!m.current&&(p.current=!1),m.current=e},500*!["android","ios"].includes(h))},handleUpToPopup:()=>{p.current=!0}}},aX=e=>{let{width:t,height:n,minHeight:l,maxHeight:s,position:i,trianglePosition:r,children:o,className:u="",triangleClassName:h="",additionalStyle:m={}}=e,f=(0,d.useRef)(null),[p,g]=(0,d.useState)(i),[x,b]=(0,d.useState)(n||l||0),v=(0,tn.D)(10),w=window.innerHeight-2*v;return(null==r?void 0:r.dir)==="up"?w=r.point.y-v:(null==r?void 0:r.dir)==="down"&&(w=window.innerHeight-r.point.y-v),s=Math.min(s||w,w),l&&(l=Math.min(l,w)),(0,d.useEffect)(()=>{if(!f.current)return;let e=new ResizeObserver(e=>{for(let t of e){let e=t.contentRect.height;if(e!==x)return void b(e)}});return e.observe(f.current),()=>{e.disconnect()}},[]),(0,d.useEffect)(()=>{if(!f.current)return;if(!i||!r||"up"!==i.dir)return void g(i);let e=x||f.current.offsetHeight;g({...i,point:{...i.point,y:r.point.y-e}})},[i,r,x]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{id:"popup-container",ref:f,className:(0,c.A)("bg-base-300 absolute rounded-lg font-sans shadow-xl",u),style:{width:"".concat(t,"px"),height:n?"".concat(n,"px"):"auto",minHeight:l?"".concat(l,"px"):"none",maxHeight:s?"".concat(s,"px"):"none",left:"".concat(p?p.point.x:-999,"px"),top:"".concat(p?p.point.y:-999,"px"),...m},children:o}),(0,a.jsx)("div",{className:"triangle text-base-300 absolute ".concat(h),style:{left:(null==r?void 0:r.dir)==="left"||(null==r?void 0:r.dir)==="right"?"".concat(r.point.x,"px"):"".concat(r?r.point.x:-999,"px"),top:(null==r?void 0:r.dir)==="up"||(null==r?void 0:r.dir)==="down"?"".concat(r.point.y,"px"):"".concat(r?r.point.y:-999,"px"),borderLeft:(null==r?void 0:r.dir)==="right"?"none":(null==r?void 0:r.dir)==="left"?"6px solid":"6px solid transparent",borderRight:(null==r?void 0:r.dir)==="left"?"none":(null==r?void 0:r.dir)==="right"?"6px solid":"6px solid transparent",borderTop:(null==r?void 0:r.dir)==="down"?"none":(null==r?void 0:r.dir)==="up"?"6px solid":"6px solid transparent",borderBottom:(null==r?void 0:r.dir)==="up"?"none":(null==r?void 0:r.dir)==="down"?"6px solid":"6px solid transparent",transform:(null==r?void 0:r.dir)==="left"||(null==r?void 0:r.dir)==="right"?"translateY(-50%)":"translateX(-50%)"}})]})},aJ=e=>{let{showTooltip:t,tooltipText:n,Icon:l,onClick:s}=e,[i,r]=(0,d.useState)(!1);return(0,a.jsx)("div",{className:"lg:tooltip lg:tooltip-bottom","data-tip":!i&&t?n:null,children:(0,a.jsx)("button",{onClick:()=>{r(!0),s()},className:"flex h-8 min-h-8 w-8 items-center justify-center p-0",children:(0,a.jsx)(l,{})})})},aZ=["highlight","underline","squiggly"],a$=["red","violet","blue","green","yellow"],aQ=e=>{let{style:t,isVertical:n,selectedStyle:l,selectedColor:s,onHandleHighlight:i}=e,{settings:r,setSettings:o}=P(),u=r.globalReadSettings,[h,m]=d.useState(l),[f,p]=d.useState(s),g=(0,tn.D)(16),x=(0,tn.D)(18),b=(0,tn.D)(28),v=e=>{u.highlightStyle=e,o(r),m(e),p(u.highlightStyles[e]),i(!0)},w=e=>{u.highlightStyle=h,u.highlightStyles[h]=e,o(r),p(e),i(!0)};return(0,a.jsxs)("div",{className:(0,c.A)("highlight-options absolute flex items-center justify-between",n?"flex-col":"flex-row"),style:t,children:[(0,a.jsx)("div",{className:(0,c.A)("flex gap-2",n?"flex-col":"flex-row"),style:n?{width:b}:{height:b},children:aZ.map(e=>(0,a.jsx)("button",{onClick:()=>v(e),className:"flex items-center justify-center rounded-full bg-gray-700 p-0",style:{width:b,height:b,minHeight:b},children:(0,a.jsx)("div",{style:{width:g,height:"squiggly"===e?x:g},className:(0,c.A)("w-4 p-0 text-center leading-none","highlight"===e&&("highlight"===h?"bg-".concat(f,"-400"):"bg-gray-300"),("underline"===e||"squiggly"===e)&&"text-gray-300 underline decoration-2","underline"===e&&("underline"===h?"decoration-".concat(f,"-400"):"decoration-gray-300"),"squiggly"===e&&("squiggly"===h?"decoration-wavy decoration-".concat(f,"-400"):"decoration-gray-300 decoration-wavy")),children:"A"})},e))}),(0,a.jsx)("div",{className:(0,c.A)("flex items-center justify-center gap-2 rounded-3xl bg-gray-700",n?"flex-col py-2":"flex-row px-2"),style:n?{width:b}:{height:b},children:a$.map(e=>(0,a.jsx)("button",{onClick:()=>w(e),style:{width:g,height:g},className:(0,c.A)("rounded-full p-0",f!==e&&"bg-".concat(e,"-400")),children:f===e&&(0,a.jsx)(nu.A7C,{size:g,className:(0,c.A)("fill-".concat(e,"-400"))})},e))})]})},a0=e=>{let{dir:t,isVertical:n,buttons:l,position:s,trianglePosition:i,highlightOptionsVisible:r,selectedStyle:o,selectedColor:d,popupWidth:u,popupHeight:h,onHighlight:m}=e,f=(0,tn.D)(28),p=(0,tn.D)(16);return(0,a.jsxs)("div",{dir:t,children:[(0,a.jsx)(aX,{width:n?h:u,height:n?u:h,position:s,trianglePosition:i,className:"selection-popup bg-gray-600 text-white",triangleClassName:"text-gray-600",children:(0,a.jsx)("div",{className:(0,c.A)("selection-buttons flex items-center justify-between p-2",n?"flex-col":"flex-row"),style:{height:n?u:h},children:l.map((e,t)=>(0,a.jsx)(aJ,{showTooltip:!r,tooltipText:e.tooltipText,Icon:e.Icon,onClick:e.onClick},t))})}),r&&(0,a.jsx)(aQ,{isVertical:n,style:{width:"".concat(n?h:u,"px"),height:"".concat(n?u:h,"px"),...n?{left:"".concat(s.point.x+(f+p)*("left"===i.dir?-1:1),"px"),top:"".concat(s.point.y,"px")}:{left:"".concat(s.point.x,"px"),top:"".concat(s.point.y+(f+p)*("up"===i.dir?-1:1),"px")}},selectedStyle:o,selectedColor:d,onHandleHighlight:m})]})},a1=e=>{let{word:t,lang:n,position:l,trianglePosition:s,popupWidth:i,popupHeight:r}=e,[o,c]=(0,d.useState)(t),u=(0,d.useRef)(!1),h=e=>{let t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll('a[rel="mw:WikiLink"]').forEach(e=>{let t=e.getAttribute("title");t&&(e.addEventListener("click",e=>{e.preventDefault(),c(t),u.current=!1}),e.className="text-primary underline cursor-pointer")}),Array.from(t.childNodes)};return(0,d.useEffect)(()=>{if(u.current)return;u.current=!0;let e=document.querySelector("main"),t=document.querySelector("footer");(async(n,a)=>{e.innerHTML="",t.dataset.state="loading";try{let l=await fetch("https://en.wiktionary.org/api/rest_v1/page/definition/".concat(n));if(!l.ok)throw Error("Failed to fetch definitions");let s=await l.json(),i=a?s[a]||s.en:s[Object.keys(s)[0]];if(!i||0===i.length)throw Error("No results found");let r=document.createElement("hgroup"),o=document.createElement("h1");o.innerText=n,o.className="text-lg font-bold";let c=document.createElement("p");c.innerText=i[0].language,c.className="text-sm italic opacity-75",r.append(o,c),e.append(r),i.forEach(t=>{let{partOfSpeech:n,definitions:a}=t,l=document.createElement("h2");l.innerText=n,l.className="text-base font-semibold mt-4";let s=document.createElement("ol");s.className="pl-8 list-decimal",a.forEach(e=>{let{definition:t,examples:n}=e;if(!t)return;let a=document.createElement("li"),l=h(t);if(a.append(...l),n){let e=document.createElement("ul");e.className="pl-8 list-disc text-sm italic opacity-75",n.forEach(t=>{let n=document.createElement("li");n.innerHTML=t,e.appendChild(n)}),a.appendChild(e)}s.appendChild(a)}),e.appendChild(l),e.appendChild(s)}),t.dataset.state="loaded"}catch(i){console.error(i),t.dataset.state="error";let a=document.createElement("div");a.className="flex flex-col items-center justify-center w-full h-full text-center absolute inset-0";let l=document.createElement("h1");l.innerText="Error",l.className="text-lg font-bold";let s=document.createElement("p");s.innerHTML='Unable to load the word. Try searching directly on <a href="https://en.wiktionary.org/w/index.php?search='.concat(encodeURIComponent(n),'" target="_blank" rel="noopener noreferrer" class="text-primary underline">Wiktionary</a>.'),a.append(l,s),e.append(a)}})(o,"string"==typeof n?n:null==n?void 0:n[0])},[o,n]),(0,a.jsx)("div",{children:(0,a.jsx)(aX,{trianglePosition:s,width:i,height:r,position:l,className:"select-text",children:(0,a.jsxs)("div",{className:"flex h-full flex-col",children:[(0,a.jsx)("main",{className:"flex-grow overflow-y-auto p-4 font-sans"}),(0,a.jsx)("footer",{className:"mt-auto hidden data-[state=loaded]:block data-[state=error]:hidden data-[state=loading]:hidden",children:(0,a.jsx)("div",{className:"flex items-center px-4 py-2 text-sm opacity-60",children:"Source: Wiktionary (CC BY-SA)"})})]})})})},a2=e=>{let{text:t,lang:n,position:l,trianglePosition:s,popupWidth:i,popupHeight:r}=e,o=(0,d.useRef)(!1);return(0,d.useEffect)(()=>{if(o.current)return;o.current=!0;let e=document.querySelector("main"),a=document.querySelector("footer"),l=async(t,n)=>{e.innerHTML="",a.dataset.state="loading";try{let l=await fetch("https://".concat(n,".wikipedia.org/api/rest_v1/page/summary/").concat(encodeURIComponent(t)));if(!l.ok)throw Error("Failed to fetch Wikipedia summary");let s=await l.json(),i=document.createElement("hgroup");i.style.color="white",i.style.backgroundPosition="center center",i.style.backgroundSize="cover",i.style.backgroundColor="rgba(0, 0, 0, .4)",i.style.backgroundBlendMode="darken",i.style.borderRadius="6px",i.style.padding="12px",i.style.marginBottom="12px",i.style.minHeight="100px";let r=document.createElement("h1");if(r.innerHTML=s.titles.display,r.className="text-lg font-bold",i.append(r),s.description){let e=document.createElement("p");e.innerText=s.description,i.appendChild(e)}s.thumbnail&&(i.style.backgroundImage='url("'.concat(s.thumbnail.source,'")'));let o=document.createElement("div");o.innerHTML=s.extract_html,o.className="p-2 text-sm",o.dir=s.dir,e.append(i,o),a.dataset.state="loaded"}catch(r){console.error(r);let l=document.createElement("div"),s=document.createElement("h1");s.innerText="Error";let i=document.createElement("p");i.innerHTML='Unable to load the article. Try searching directly on <a href="https://'.concat(n,".wikipedia.org/w/index.php?search=").concat(encodeURIComponent(t),'" target="_blank" rel="noopener noreferrer" class="text-primary underline">Wikipedia</a>.'),l.append(s,i),e.appendChild(l),a.dataset.state="error"}},s="string"==typeof n?n:null==n?void 0:n[0];l(t,s?s.split("-")[0]:"en")},[t,n]),(0,a.jsx)("div",{children:(0,a.jsx)(aX,{width:i,height:r,position:l,trianglePosition:s,className:"select-text",children:(0,a.jsxs)("div",{className:"text-base-content flex h-full flex-col pt-2",children:[(0,a.jsx)("main",{className:"flex-grow overflow-y-auto px-2 font-sans"}),(0,a.jsx)("footer",{className:"mt-auto hidden data-[state=loaded]:block data-[state=error]:hidden data-[state=loading]:hidden",children:(0,a.jsx)("div",{className:"flex items-center px-4 py-2 text-sm opacity-60",children:"Source: Wikipedia (CC BY-SA)"})})]})})})},a4=["hi","vi"],a3=(()=>{let e={...h.hQ},t={};for(let[n,a]of Object.entries(e))a4.includes(n)||(t[eX(n).toUpperCase()]=a);return t})(),a8=e=>{var t;let{text:n,position:l,trianglePosition:i,popupWidth:r,popupHeight:o}=e,c=ev(),{token:u}=(0,s.A)(),{settings:h,setSettings:m}=P(),[f,p]=(0,d.useState)([]),[g,x]=(0,d.useState)("AUTO"),[b,v]=(0,d.useState)(h.globalReadSettings.translateTargetLang),[w,y]=(0,d.useState)(h.globalReadSettings.translationProvider),[j,N]=(0,d.useState)(null),[k,S]=(0,d.useState)(null),[C,A]=(0,d.useState)(!1),[E,L]=(0,d.useState)(null),{translate:T,translators:M}=e6({provider:w,sourceLang:g,targetLang:b});return(0,d.useEffect)(()=>{p(M.map(e=>{let t=e.label;return e.authRequired&&!u?t="".concat(t," (").concat(c("Login Required"),")"):e.quotaExceeded&&(t="".concat(t," (").concat(c("Quota Exceeded"),")")),{name:e.name,label:t}}))},[M]),(0,d.useEffect)(()=>{A(!0),(async()=>{L(null),N(null);try{let e=n.replaceAll("\n","").trim(),t=(await T([e]))[0];if(!t)throw Error("No translation found");N(t)}catch(e){console.error(e),u?L(c("Unable to fetch the translation. Try again later.")):L(c("Unable to fetch the translation. Please log in first and try again."))}finally{A(!1)}})()},[n,u,g,b,w]),(0,a.jsx)("div",{children:(0,a.jsxs)(aX,{trianglePosition:i,width:r,minHeight:o,maxHeight:720,position:l,className:"grid h-full select-text grid-rows-[1fr,auto,1fr] bg-gray-600 text-white",triangleClassName:"text-gray-600",children:[(0,a.jsxs)("div",{className:"overflow-y-auto p-4 font-sans",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-sm font-normal",children:c("Original Text")}),(0,a.jsx)(aM,{className:"bg-gray-600 text-white/75",value:g,onChange:e=>{x(e.target.value)},options:[{value:"AUTO",label:c("Auto Detect")},...Object.entries(a3).sort((e,t)=>e[1].localeCompare(t[1])).map(e=>{let[t,n]=e,a=k&&"AUTO"===g&&"AUTO"===t?"".concat(a3[k]||k," ")+c("(detected)"):n;return{value:t,label:a}})]})]}),(0,a.jsx)("p",{className:"text-base text-white/90",children:n})]}),(0,a.jsx)("div",{className:"mx-4 flex-shrink-0 border-t border-gray-500/30"}),(0,a.jsxs)("div",{className:"overflow-y-auto px-4 pb-8 pt-4 font-sans",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-sm font-normal",children:c("Translated Text")}),(0,a.jsx)(aM,{className:"bg-gray-600 text-white/75",value:b,onChange:e=>{h.globalReadSettings.translateTargetLang=e.target.value,m(h),v(e.target.value)},options:Object.entries(a3).sort((e,t)=>e[1].localeCompare(t[1])).map(e=>{let[t,n]=e;return{value:t,label:n}})})]}),C?(0,a.jsx)("p",{className:"text-base italic text-gray-500",children:c("Loading...")}):(0,a.jsx)("div",{children:E?(0,a.jsx)("p",{className:"text-base text-red-600",children:E}):(0,a.jsx)("p",{className:"text-base text-white/90",children:j||c("No translation available.")})})]}),(0,a.jsxs)("div",{className:"absolute bottom-0 flex h-8 w-full items-center justify-between bg-gray-600 px-4",children:[w&&!C&&(0,a.jsx)("div",{className:"text-xs opacity-60",children:E?"":c("Translated by {{provider}}.",{provider:null==(t=f.find(e=>e.name===w))?void 0:t.label})}),(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsx)(aM,{className:"bg-gray-600 text-white/75",value:w,onChange:e=>{let t=e.target.value,n=e5().filter(e=>(!e.authRequired||!!u)&&!e.quotaExceeded),a=n.find(e=>e.name===t)||n[0];a&&(h.globalReadSettings.translationProvider=a.name,m(h),y(a.name))},options:f.map(e=>{let{name:t,label:n}=e;return{value:t,label:n}})})})]})]})})},a5=e=>{var t,n;let{bookKey:l}=e,s=ev(),{envConfig:r,appService:o}=(0,i.D)(),{settings:c}=P(),{getConfig:u,saveConfig:m,getBookData:p,updateBooknotes:g}=U(),{getProgress:x,getView:b,getViewsById:v,getViewSettings:w}=Y(),{setNotebookVisible:y,setNotebookNewAnnotation:j}=X();aF(l);let N=(0,f.Ox)(),k=u(l),S=x(l),C=p(l),A=b(l),E=w(l),[L,T]=(0,d.useState)(null),[M,D]=(0,d.useState)(!1),[R,z]=(0,d.useState)(!1),[I,B]=(0,d.useState)(!1),[_,V]=(0,d.useState)(!1),[O,W]=(0,d.useState)(),[H,K]=(0,d.useState)(),[G,q]=(0,d.useState)(),[J,Z]=(0,d.useState)(),[Q,ee]=(0,d.useState)(!1),[et,en]=(0,d.useState)(c.globalReadSettings.highlightStyle),[ea,el]=(0,d.useState)(c.globalReadSettings.highlightStyles[et]),es=(0,tn.D)(10),ei=window.innerWidth-2*es,er=window.innerHeight-2*es,eo=Math.min(480,ei),ec=Math.min(300,er),ed=Math.min(480,ei),eu=Math.min(265,er),eh=Math.min((0,tn.D)(300),ei),em=(0,tn.D)(44),ef=()=>{T(null),D(!1),z(!1),B(!1),V(!1)},ep=()=>{ef(),null==A||A.deselect()},{handleScroll:eg,handleTouchStart:ex,handleTouchEnd:eb,handlePointerup:ew,handleSelectionchange:ey,handleShowPopup:ej,handleUpToPopup:eN}=aq(l,T,ef);nE(A,{onLoad:e=>{var t,n,a,l,s,i,r,c;let d=e.detail,{doc:u,index:h}=d;(null==(t=C.book)?void 0:t.format)!=="PDF"&&(null==A||null==(n=A.renderer)||n.addEventListener("scroll",eg),null==(a=d.doc)||a.addEventListener("touchstart",ex),null==(l=d.doc)||l.addEventListener("touchmove",()=>{D(!1)}),null==(s=d.doc)||s.addEventListener("touchend",eb),null==(i=d.doc)||i.addEventListener("pointerup",()=>ew(u,h)),null==(r=d.doc)||r.addEventListener("selectionchange",()=>ey(u,h)),(null==o?void 0:o.isMobile)&&(null==(c=d.doc)||c.addEventListener("contextmenu",e=>(e.preventDefault(),e.stopPropagation(),!1))))},onDrawAnnotation:e=>{let t=w(l),{draw:n,annotation:a,doc:s,range:i}=e.detail,{style:r,color:o}=a,c=o?h.Hj[o]:o;if("highlight"===r)n(aV.u.highlight,{color:c});else if(["underline","squiggly"].includes(r)){let{defaultView:e}=s,a=i.startContainer,l=1===a.nodeType?a:a.parentElement,{writingMode:o,lineHeight:d,fontSize:u}=e.getComputedStyle(l),h=parseFloat(d)||t.lineHeight*t.defaultFontSize,m=parseFloat(u)||t.defaultFontSize,f=t.vertical?(h-m-2)/2:2;n(aV.u[r],{writingMode:o,color:c,padding:f})}},onShowAnnotation:e=>{var t;let{value:n,index:a,range:s}=e.detail,{booknotes:i=[]}=u(l),r=i.filter(e=>"annotation"===e.type&&!e.deletedAt).find(e=>e.cfi===n);if(!r)return;let o={key:l,annotated:!0,text:null!=(t=r.text)?t:"",range:s,index:a};en(r.style),el(r.color),T(o),eN()}}),(0,d.useEffect)(()=>{ej(M||R||I||_)},[M,R,I,_]),(0,d.useEffect)(()=>($.on("export-annotations",eA),()=>{$.off("export-annotations",eA)}),[]),(0,d.useEffect)(()=>{if(ee(!!(L&&L.annotated)),L&&L.text.trim().length>0){let e=document.querySelector("#gridcell-".concat(l));if(!e)return;let t=e.getBoundingClientRect(),n=aU(L.range,t,es,E.vertical),a=aG(n,t,E.vertical?em:eh,E.vertical?eh:em,es);"down"===a.dir&&"android"===N&&(n.point.y+=0,a.point.y+=0);let s=aG(n,t,eo,ec,es),i=aG(n,t,ed,eu,es);0!=n.point.x&&0!=n.point.y&&(K(a),q(s),Z(i),W(n),ek())}},[L,l]),(0,d.useEffect)(()=>{if(!S)return;let{location:e}=S,t=ne.collapse(e),n=ne.collapse(e,!0),{booknotes:a=[]}=k,l=a.filter(e=>!e.deletedAt&&"annotation"===e.type&&e.style&&ne.compare(e.cfi,t)>=0&&0>=ne.compare(e.cfi,n));try{Promise.all(l.map(e=>null==A?void 0:A.addAnnotation(e)))}catch(e){console.error(e)}},[S]);let ek=()=>{D(!0),V(!1),z(!1),B(!1)},eS=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!L||!L.text)return;ee(!0);let{booknotes:t=[]}=k,n=null==A?void 0:A.getCFI(L.index,L.range);if(!n)return;let a=c.globalReadSettings.highlightStyle,s=c.globalReadSettings.highlightStyles[a],i={id:(0,f.NF)(),type:"annotation",cfi:n,style:a,color:s,text:L.text,note:"",createdAt:Date.now(),updatedAt:Date.now()},o=t.findIndex(e=>e.cfi===n&&"annotation"===e.type&&!e.deletedAt),d=v(l.split("-")[0]);-1!==o?(d.forEach(e=>null==e?void 0:e.addAnnotation(i,!0)),e?(i.id=t[o].id,t[o]=i,d.forEach(e=>null==e?void 0:e.addAnnotation(i))):(t[o].deletedAt=Date.now(),D(!1))):(t.push(i),d.forEach(e=>null==e?void 0:e.addAnnotation(i)),T({...L,annotated:!0}));let u=g(l,t);u&&m(r,l,u,c)},eC=async()=>{L&&L.text&&(D(!1),$.dispatch("tts-speak",{bookKey:l,range:L.range}))},eA=e=>{var t,n;let{bookKey:a}=e.detail;if(l!==a)return;let{bookDoc:i,book:r}=C;if(!i||!r||!i.toc)return;let{booknotes:c=[]}=u(l),d=c.filter(e=>!e.deletedAt);if(0===d.length)return void $.dispatch("toast",{type:"info",message:s("No annotations to export"),className:"whitespace-nowrap",timeout:2e3});let h={};for(let e of d){let t=F(null!=(n=i.toc)?n:[],e.cfi),a=(null==t?void 0:t.href)||"",l=(null==t?void 0:t.label)||"",s=(null==t?void 0:t.id)||0;h[a]||(h[a]={id:s,href:a,label:l,booknotes:[]}),h[a].booknotes.push(e)}Object.values(h).forEach(e=>{e.booknotes.sort((e,t)=>ne.compare(e.cfi,t.cfi))});let m=Object.values(h).sort((e,t)=>e.id-t.id),f=[];for(let e of(f.push("# ".concat(r.title)),f.push("**".concat(s("Author"),"**: ").concat(r.author||"")),f.push(""),f.push("**".concat(s("Exported from Readest"),"**: ").concat(new Date().toISOString().slice(0,10))),f.push(""),f.push("---"),f.push(""),f.push("## ".concat(s("Highlights & Annotations"))),f.push(""),m)){let t=e.label||s("Untitled");for(let n of(f.push("### ".concat(t)),e.booknotes))f.push('> "'.concat(n.text,'"')),n.note&&f.push("**".concat(s("Note"),"**:: ").concat(n.note)),f.push("");f.push("---"),f.push("")}let p=f.join("\n");if(null==(t=navigator.clipboard)||t.writeText(p),$.dispatch("toast",{type:"info",message:s("Copied to clipboard"),className:"whitespace-nowrap",timeout:2e3}),null==o?void 0:o.isMobile)return;let g=new Blob([p],{type:"text/markdown;charset=utf-8"}),x=URL.createObjectURL(g),b=document.createElement("a");b.href=x,b.download="".concat(r.title.replace(/\s+/g,"_"),".md"),b.click(),URL.revokeObjectURL(x)},eE=null==L?void 0:L.annotated,eL=[{tooltipText:s("Copy"),Icon:tq.nxz,onClick:()=>{var e;if(!L||!L.text)return;$.dispatch("toast",{type:"info",message:s("Copied to notebook"),className:"whitespace-nowrap",timeout:2e3});let{booknotes:t=[]}=k;L&&(null==(e=navigator.clipboard)||e.writeText(L.text));let n=null==A?void 0:A.getCFI(L.index,L.range);if(!n)return;let a={id:(0,f.NF)(),type:"excerpt",cfi:n,text:L.text,note:"",createdAt:Date.now(),updatedAt:Date.now()},i=t.findIndex(e=>e.cfi===n&&"excerpt"===e.type&&!e.deletedAt);-1!==i?t[i]=a:t.push(a);let d=g(l,t);d&&m(r,l,d,c),ep(),(null==o?void 0:o.isMobile)||y(!0)}},{tooltipText:eE?s("Delete Highlight"):s("Highlight"),Icon:eE?n7.WFf:ni.E9d,onClick:eS},{tooltipText:s("Annotate"),Icon:a_.ArI,onClick:()=>{if(!L||!L.text)return;let{sectionHref:e}=S;L.href=e,eS(!0),y(!0),j(L),ef()}},{tooltipText:s("Search"),Icon:tq.CKj,onClick:()=>{L&&L.text&&(D(!1),$.dispatch("search",{term:L.text}))}},{tooltipText:s("Dictionary"),Icon:n3.Bh3,onClick:()=>{L&&L.text&&(D(!1),z(!0))}},{tooltipText:s("Wikipedia"),Icon:nu.i86,onClick:()=>{L&&L.text&&(D(!1),B(!0))}},{tooltipText:s("Translate"),Icon:a_.Ifv,onClick:()=>{L&&L.text&&(D(!1),V(!0))}},{tooltipText:s("Speak"),Icon:ai.tLl,onClick:eC}];return(0,a.jsxs)("div",{children:[R&&O&&G&&(0,a.jsx)(a1,{word:null==L?void 0:L.text,lang:null==(t=C.bookDoc)?void 0:t.metadata.language,position:G,trianglePosition:O,popupWidth:eo,popupHeight:ec}),I&&O&&G&&(0,a.jsx)(a2,{text:null==L?void 0:L.text,lang:null==(n=C.bookDoc)?void 0:n.metadata.language,position:G,trianglePosition:O,popupWidth:eo,popupHeight:ec}),_&&O&&J&&(0,a.jsx)(a8,{text:null==L?void 0:L.text,position:J,trianglePosition:O,popupWidth:ed,popupHeight:eu}),M&&O&&H&&(0,a.jsx)(a0,{dir:E.rtl?"rtl":"ltr",isVertical:E.vertical,buttons:eL,position:H,trianglePosition:O,highlightOptionsVisible:Q,selectedStyle:et,selectedColor:ea,popupWidth:eh,popupHeight:em,onHighlight:eS})]})},a6=e=>new Set([...e?.getAttributeNS?.("http://www.idpf.org/2007/ops","type")?.split(" ")??[],...e?.attributes?.getNamedItem?.("epub:type")?.value?.split(" ")??[]]),a9=e=>new Set(e?.getAttribute?.("role")?.split(" ")),a7=e=>{if(e.matches("sup"))return!0;let{verticalAlign:t}=getComputedStyle(e);return"super"===t||"top"===t||"text-top"===t||/^\d/.test(t)},le=["biblioref","glossref","noteref"],lt=["doc-biblioref","doc-glossref","doc-noteref"],ln=e=>{let t=a6(e),n=a9(e);return{yes:lt.some(e=>n.has(e))||le.some(e=>t.has(e)),maybe:()=>!t.has("backlink")&&!n.has("doc-backlink")&&(a7(e)||1===e.children.length&&a7(e.children[0])||a7(e.parentElement))}},la=e=>{let t=a6(e),n=a9(e);return n.has("doc-biblioentry")||t.has("biblioentry")?"biblioentry":n.has("definition")||t.has("glossdef")?"definition":n.has("doc-endnote")||t.has("endnote")||t.has("rearnote")?"endnote":n.has("doc-footnote")||t.has("footnote")?"footnote":n.has("note")||t.has("note")?"note":null},ll="a, span, sup, sub, em, strong, i, b, small, big",ls=(e,t)=>{let n=t(e),a=n;for(;n.matches(ll);){let e=n.parentElement;if(!e)break;n=e}if(n===e.body){let e=a.nextElementSibling;if(e&&!e.matches(ll))return e;throw Error("Failed to extract footnote")}return n};class li extends EventTarget{detectFootnotes=!0;#e(e,{index:t,anchor:n},a){let l=document.createElement("foliate-view");return new Promise((s,i)=>{l.addEventListener("load",e=>{try{let{doc:t}=e.detail,i=n(t),r=la(i),o=i?.matches?.("aside")&&"footnote"===r;if(i){let e;i.startContainer?e=i:i.matches("li, aside")?(e=t.createRange()).selectNodeContents(i):i.closest("li")?(e=t.createRange()).selectNodeContents(i.closest("li")):(e=t.createRange()).selectNode(i);let n=e.extractContents();t.body.replaceChildren(),t.body.appendChild(n)}this.dispatchEvent(new CustomEvent("render",{detail:{view:l,href:a,type:r,hidden:o,target:i}})),s()}catch(e){i(e)}}),l.open(e).then(()=>this.dispatchEvent(new CustomEvent("before-render",{detail:{view:l}}))).then(()=>l.goTo(t)).catch(i)})}handle(e,t){let{a:n,href:a,follow:l}=t.detail,{yes:s,maybe:i}=ln(n);return s||l?(t.preventDefault(),Promise.resolve(e.resolveHref(a)).then(t=>this.#e(e,t,a))):this.detectFootnotes&&i()?(t.preventDefault(),Promise.resolve(e.resolveHref(a)).then(({index:t,anchor:n})=>this.#e(e,{index:t,anchor:e=>ls(e,n)},a))):void 0}}let lr=e=>{let{bookKey:t,bookDoc:n}=e,l=(0,d.useRef)(null),s=(0,d.useRef)(null),[i,r]=(0,d.useState)(),[o,c]=(0,d.useState)(),[u,h]=(0,d.useState)(!1),{getBookData:m}=U(),{getView:f,getViewSettings:p}=Y(),g=f(t),x=p(t),b=new li,[v,w]=(0,d.useState)(null),[y,j]=(0,d.useState)(360),[N,k]=(0,d.useState)(88),S=(e,t)=>Math.min(e,(t?window.innerWidth/2:window.innerHeight/2)-10-12);(0,d.useEffect)(()=>{let e=e=>{var a,i;let{view:r}=e.detail;r.addEventListener("link",e=>{var a;e.preventDefault();let{detail:l}=e;l.follow=!0,null==(a=b.handle(n,e))||a.catch(e=>{var n;console.warn(e),null==(n=f(t))||n.goTo(l.href)})}),r.addEventListener("load",e=>{var n;let{doc:a}=e.detail;ed(a,eY(null==(n=m(t).book)?void 0:n.primaryLanguage))}),s.current=r,null==(a=l.current)||a.replaceChildren(r);let{renderer:o}=r;o.setAttribute("flow","scrolled"),o.setAttribute("margin","0px"),o.setAttribute("gap","0%");let c=p(t),d={...E()},u=document.getElementById("popup-container");u&&(d.bg=getComputedStyle(u).backgroundColor);let h=L(c,d),g=C();null==(i=o.setStyles)||i.call(o,"".concat(h,"\n").concat(g))},a=e=>{let{view:n}=e.detail;n.addEventListener("relocate",()=>{let{renderer:e}=n;p(t).vertical?j(S(e.viewSize,!0)):k(S(e.viewSize,!1)),h(!0)})};return b.addEventListener("before-render",e),b.addEventListener("render",a),()=>{b.removeEventListener("before-render",e),b.removeEventListener("render",a)}},[g]),(0,d.useEffect)(()=>{x.vertical?(j(88),k(Math.max(360,window.innerHeight/4))):(j(Math.max(360,window.innerWidth/4)),k(88))},[x]),(0,d.useEffect)(()=>{i&&v&&c(aG(i,v,y,N,10))},[i,v,y,N]);let A=async e=>{var a;let l=e.detail,s=document.querySelector("#gridcell-".concat(t));if(!s)return;let i=s.getBoundingClientRect(),o=p(t),c=aU(l.a,i,10,o.vertical);w(i),r(c);let{a:d}=l;["duokan-footnote","footnote-link","footnote"].some(e=>d.classList.contains(e))&&(l.follow=!0),null==(a=b.handle(n,e))||a.catch(t=>{console.warn(t);let n=e.detail;null==g||g.goTo(n.href)})},T=()=>{var e;let t=null==(e=l.current)?void 0:e.querySelector("foliate-view");null==t||t.close(),null==t||t.remove()},M=()=>{T(),w(null),c(null),r(null),h(!1)},D=e=>{let{element:n,footnote:a}=e.detail,s=document.querySelector("#gridcell-".concat(t));if(!s)return;let i=s.getBoundingClientRect(),o=p(t),c=aU(n,i,10,o.vertical);if(l.current){let e=document.createElement("p");e.textContent=a,e.setAttribute("style","padding: 1em; hanging-punctuation: allow-end last;"),e.style.visibility="hidden",o.vertical?e.style.height="".concat(N,"px"):e.style.width="".concat(y,"px"),document.body.appendChild(e);let t=e.getBoundingClientRect();o.vertical?j(S(t.width,!0)):k(S(t.height,!1)),document.body.removeChild(e),e.style.visibility="visible",l.current.replaceChildren(e),w(i),r(c),h(!0)}};return nE(g,{onLinkClick:A}),(0,d.useEffect)(()=>(window.addEventListener("resize",M),$.on("footnote-popup",D),()=>{window.removeEventListener("resize",M),$.off("footnote-popup",D)}),[]),(0,d.useEffect)(()=>{if(s.current){var e;null==(e=l.current)||e.replaceChildren(s.current)}},[l]),(0,a.jsxs)("div",{children:[u&&(0,a.jsx)("div",{className:"fixed inset-0",onClick:M,onContextMenu:M}),(0,a.jsx)(aX,{width:y,height:N,position:u?o:void 0,trianglePosition:u?i:void 0,className:"select-text overflow-y-auto",children:(0,a.jsx)("div",{className:"",ref:l,style:{width:"".concat(y,"px"),height:"".concat(N,"px")}})})]})},lo=e=>{let{bookKey:t,showDoubleBorder:n,isScrolled:l,isVertical:s,horizontalGap:i,verticalMargin:r}=e,[o,u]=d.useState(null),h=(0,d.useRef)(2e3),m=(0,d.useRef)(null),f=e=>{let{message:n,bookKey:a,timeout:l=2e3}=e.detail;a===t&&(u(n),h.current=l)};return(0,d.useEffect)(()=>($.on("hint",f),()=>{$.off("hint",f)}),[]),(0,d.useEffect)(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>u(""),h.current),()=>{m.current&&clearTimeout(m.current)}),[o]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,c.A)("absolute left-0 right-0 top-0 z-10 h-[env(safe-area-inset-top)]",o?"bg-base-100":"bg-transparent")}),(0,a.jsx)("div",{className:(0,c.A)("hintinfo absolute flex items-center justify-end overflow-hidden ps-2","mt-[env(safe-area-inset-top)]",o?"bg-base-100":"bg-transparent",s?"writing-vertical-rl":"top-0 h-[44px]",l?s?"h-full":"w-full":s?"max-h-[50%]":"max-w-[50%]"),style:s?{bottom:"".concat(1.5*r,"px"),left:"calc(100% - ".concat(i,"%)"),width:n?"30px":"".concat(i,"%")}:{insetInlineEnd:"".concat(i,"%")},children:(0,a.jsx)("h2",{className:(0,c.A)("text-neutral-content text-center font-sans text-xs font-light"),children:o||""})})]})},lc=e=>{let{borderColor:t,horizontalGap:n,verticalMargin:l,showHeader:s,showFooter:i}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{border:"4px solid ".concat(t),height:"calc(100% - ".concat(2*l,"px + ").concat(20,"px)"),top:"calc(".concat(l,"px - ").concat(10,"px)"),left:"calc(".concat(n,"% - ").concat(32*!!i,"px - ").concat(10,"px)"),right:"calc(".concat(n,"% - ").concat(32*!!s,"px - ").concat(10,"px)")}}),(0,a.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{border:"1px solid ".concat(t),height:"calc(100% - ".concat(2*l,"px)"),top:"".concat(l,"px"),left:i?"".concat(n,"%"):"calc(".concat(n,"%)"),right:s?"".concat(n,"%"):"calc(".concat(n,"%)")}}),i&&(0,a.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{borderTop:"1px solid ".concat(t),borderBottom:"1px solid ".concat(t),borderLeft:"1px solid ".concat(t),width:"32px",height:"calc(100% - ".concat(2*l,"px)"),top:"".concat(l,"px"),left:"calc(".concat(n,"% - 32px)")}}),s&&(0,a.jsx)("div",{className:"borderframe pointer-events-none absolute",style:{borderTop:"1px solid ".concat(t),borderBottom:"1px solid ".concat(t),borderRight:"1px solid ".concat(t),width:"32px",height:"calc(100% - ".concat(2*l,"px)"),top:"".concat(l,"px"),left:"calc(100% - ".concat(n,"%)")}})]})};var ld=n(93912),lu=n(30714),lh=n(404);let lm=e=>e.replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," ").trimStart(),lf=e=>{var t,n;let a,l=e.match(/<speak[^>]*xml:lang="([^"]+)"[^>]*>/i),s=null!=(t=null==l?void 0:l[1])?t:"en";e=e.replace(/<speak[^>]*>/i,"").replace(/<\/speak>/i,"");let i="",r=[],o=null,c=s,d=[],u=/<(\/?)(\w+)([^>]*)>|([^<]+)/g;for(;null!==(a=u.exec(e));)if(a[4]){let e=a[4],t=lm(e);if(t&&o){let e=i.length;i+=t,r.push({offset:e,name:o,text:t,language:lp(t,c)||c})}else i+=lm(e)}else{let e="/"===a[1],t=a[2],l=a[3];if("mark"!==t||e){if("lang"===t)if(e)c=null!=(n=d.pop())?n:s;else{d.push(c);let e=null==l?void 0:l.match(/xml:lang="([^"]+)"/);e&&(c=e[1])}}else{let e=null==l?void 0:l.match(/name="([^"]+)"/);e&&(o=e[1])}}return{plainText:i,marks:r}},lp=(e,t)=>{if(!t||t.startsWith("en")){if(RegExp("[\\p{Script=Hangul}]","u").test(e))return"ko";else if(RegExp("[\\p{Script=Hiragana}\\p{Script=Katakana}]","u").test(e))return"ja";else if(RegExp("[\\p{Script=Han}]","u").test(e))return"zh"}return t},lg=e=>{let t=null,n=e.match(/xml:lang\s*=\s*"([^"]+)"/);if(n&&n[1]){let e=n[1].split("-");t=e.length>1?"".concat(e[0].toLowerCase(),"-").concat(e[1].toUpperCase()):e[0].toLowerCase()}return lp(e,t)};class lx{static normalizeLanguage(e){return e?e.toLowerCase().slice(0,2):"n/a"}static setPreferredVoice(e,t,n){if(!e||!t||!n)return;let a=this.getPreferences(),l=this.normalizeLanguage(t);a["".concat(e,"-").concat(l)]=n,localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(a))}static getPreferredVoice(e,t){let n=this.getPreferences(),a=this.normalizeLanguage(t);return n["".concat(e,"-").concat(a)]||null}static getPreferences(){let e=localStorage.getItem(this.LOCAL_STORAGE_KEY);return e?JSON.parse(e):{}}}(0,J._)(lx,"LOCAL_STORAGE_KEY","ttsPreferredVoices");let lb=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Eddy","Flo","Fred","Good News","Grandma","Grandpa","Jester","Junior","Kathy","Organ","Ralph","Reed","Rocko","Sandy","Shelley","Superstar","Trinoids","Whisper","Wobble","Zarvox"];async function*lv(e,t,n,a,l,s,i){let{marks:r}=lf(e),o=window.speechSynthesis,c=new SpeechSynthesisUtterance;for(let e of r){let{language:r}=e,d=r||t;s(d),i(e),c.text=e.text,c.rate=n(),c.pitch=a();let u=await l(d);u&&(c.voice=u),d&&(c.lang=d),yield{type:"boundary",speaking:!0,name:"sentence",mark:e.name};let h=await new Promise(e=>{c.onend=()=>e({type:"end",speaking:!1}),c.onerror=t=>e({type:"error",speaking:!1,error:t.error}),o.speak(c)});if(yield h,"error"===h.type)break}}var lw=new WeakMap,ly=new WeakMap,lj=new WeakMap,lN=new WeakMap,lk=new WeakMap,lS=new WeakMap,lC=new WeakMap;class lA{async init(){return(0,ld._)(this,lC)?await new Promise(e=>{let t=()=>{(0,lh._)(this,lS,(0,ld._)(this,lC).getVoices()),(0,ld._)(this,lS).length>0&&e()};(0,ld._)(this,lC).getVoices().length>0?t():void 0!==(0,ld._)(this,lC).onvoiceschanged?(0,ld._)(this,lC).onvoiceschanged=t:(console.warn("Voiceschanged event not supported."),e())}):this.available=!1,this.available}async *speak(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)return;let a=lg(e)||"en";for await(let n of("en"===a&&(0,ld._)(this,lw)&&"en"!==(0,ld._)(this,lw)&&(a=(0,ld._)(this,lw)),lv(e,a,()=>(0,ld._)(this,lj),()=>(0,ld._)(this,lN),this.getVoiceFromLang,e=>(0,lh._)(this,ly,e),e=>{var t;return null==(t=this.controller)?void 0:t.dispatchSpeakMark(e)}))){var l,s,i,r,o;if(t.aborted){console.log("TTS aborted"),yield{code:"error",message:"Aborted"};return}"boundary"===n.type?yield{code:"boundary",mark:null!=(l=n.mark)?l:"",message:"".concat(null!=(s=n.name)?s:"Unknown"," ").concat(null!=(i=n.charIndex)?i:0,"/").concat(null!=(r=n.charLength)?r:0)}:"error"===n.type?yield{code:"error",message:null!=(o=n.error)?o:"Unknown error"}:"end"===n.type&&(yield{code:"end",message:"Speech finished"})}}async pause(){(0,ld._)(this,lC).pause()}async resume(){(0,ld._)(this,lC).resume()}async stop(){(0,ld._)(this,lC).cancel()}setPrimaryLang(e){(0,lh._)(this,lw,e)}async setRate(e){(0,lh._)(this,lj,e)}async setPitch(e){(0,lh._)(this,lN,e)}async setVoice(e){let t=(0,ld._)(this,lS).find(t=>t.voiceURI===e);t&&(0,lh._)(this,lk,t)}async getAllVoices(){return(0,ld._)(this,lS).map(e=>({id:e.voiceURI,name:e.name,lang:e.lang,disabled:!this.available}))}async getVoices(e){let t="en"===e&&(0,f.YK)(e)||e,n=e=>!e.includes("com.apple")||e.includes("com.apple.voice.compact"),a=(0,ld._)(this,lS).filter(n=>n.lang.startsWith(t)||"en"===e&&["en-US","en-GB"].includes(n.lang)).filter(e=>n(e.voiceURI||"")).filter(e=>!1===lb.some(t=>e.name.includes(t))),l=new Set,s=a.map(e=>({id:e.voiceURI,name:e.name,lang:e.lang})).filter(e=>!l.has(e.id)&&(l.add(e.id),!0));return s.forEach(e=>{e.disabled=!this.available}),s}getGranularities(){return["sentence"]}getVoiceId(){var e,t;return null!=(t=null==(e=(0,ld._)(this,lk))?void 0:e.voiceURI)?t:""}getSpeakingLang(){return(0,ld._)(this,ly)}constructor(e){(0,J._)(this,"controller",void 0),(0,lu._)(this,lw,{writable:!0,value:"en"}),(0,lu._)(this,ly,{writable:!0,value:""}),(0,lu._)(this,lj,{writable:!0,value:1}),(0,lu._)(this,lN,{writable:!0,value:1}),(0,lu._)(this,lk,{writable:!0,value:null}),(0,lu._)(this,lS,{writable:!0,value:[]}),(0,lu._)(this,lC,{writable:!0,value:window.speechSynthesis}),(0,J._)(this,"available",!0),(0,J._)(this,"getVoiceFromLang",async e=>{let t=lx.getPreferredVoice("web-speech",e),n=(0,ld._)(this,lS).find(e=>e.voiceURI===t);if(n)(0,lh._)(this,lk,n);else{var a,l;let t=null!=(l=null==(a=(await this.getVoices(e))[0])?void 0:a.id)?l:"";(0,lh._)(this,lk,(0,ld._)(this,lS).find(e=>e.voiceURI===t)||null)}return(0,ld._)(this,lk)}),this.controller=e}}var lE=n(65447),lL=n(35335),lT=n(97384);class lM{get(e){if(!this.map.has(e))return;let t=this.map.get(e);return this.map.delete(e),this.map.set(e,t),t}set(e,t){if(this.map.has(e))this.map.delete(e);else if(this.map.size===this.capacity){let e=this.map.keys().next().value;e&&this.map.delete(e)}this.map.set(e,t)}has(e){return this.map.has(e)}delete(e){return this.map.delete(e)}clear(){this.map.clear()}size(){return this.map.size}entries(){return Array.from(this.map).reverse()}constructor(e){if((0,J._)(this,"capacity",void 0),(0,J._)(this,"map",void 0),e<=0)throw Error("LRUCache capacity must be greater than 0");this.capacity=e,this.map=new Map}}let lD=e=>{let t=JSON.stringify(e);return(0,lT.md5)(t)};var lR=new WeakSet;class lz{async create(e){return(0,lE._)(this,lR,lP).call(this,e)}async createAudio(e){let t=lD(e);if(lz.audioCache.has(t))return new Blob([lz.audioCache.get(t)],{type:"audio/mpeg"});try{let n=await this.create(e),a=await n.arrayBuffer();return lz.audioCache.set(t,a),new Blob([a],{type:"audio/mpeg"})}catch(e){throw e}}constructor(){(0,lL._)(this,lR)}}async function lP(e){let{lang:t,text:n,voice:a,rate:l}=e,s=(0,f.oq)(),i="".concat("wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1","?ConnectionId=").concat(s,"&TrustedClientToken=").concat("6A5AA1D4EAFF4E9FB37E23D68491D6F4"),r=new Date().toString(),o=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),c=(e,t)=>{let n="";for(let t of Object.keys(e))n+="".concat(t,": ").concat(e[t],"\r\n");return"".concat(n,"\r\n").concat(t)},d=e=>{let t=e.split("\n"),n={},a="",l=0;for(l=0;l<t.length;l++){let e=t[l].trim();if(!e)break;let a=e.indexOf(":");if(-1===a)continue;let s=e.slice(0,a).trim(),i=e.slice(a+1).trim();n[s]=i}for(l+=1;l<t.length;l++)a+=t[l]+"\n";return{headers:n,body:a}},u=c({"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":s,"X-Timestamp":r},((e,t,n,a)=>{let l=t.replace(/^<break\b[^>]*>/i,"");return'\n        <speak version="1.0" xml:lang="'.concat(e,'">\n          <voice name="').concat(n,'">\n            <prosody rate="').concat(a,'">\n              ').concat(l,"\n            </prosody>\n          </voice>\n        </speak>\n      ")})(t,n,a,l)),h=c({"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":r},o);return new Promise((e,t)=>{let n=new WebSocket(i);n.binaryType="arraybuffer";let a=new ArrayBuffer(0);n.addEventListener("open",()=>{n.send(h),n.send(u)}),n.addEventListener("message",l=>{if("string"==typeof l.data){let{headers:s}=d(l.data);if("turn.end"===s.Path){if(n.close(),!a.byteLength)return t(Error("No audio data received."));e(new Response(a))}}else if(l.data instanceof ArrayBuffer){let e=new DataView(l.data).getInt16(0);if(l.data.byteLength>e+2){let t=l.data.slice(2+e),n=new Uint8Array(a.byteLength+t.byteLength);n.set(new Uint8Array(a),0),n.set(new Uint8Array(t),a.byteLength),a=n.buffer}}}),n.addEventListener("close",()=>{a.byteLength||t(Error("No audio data received."))}),n.addEventListener("error",()=>{n.close(),t(Error("WebSocket error occurred."))})})}(0,J._)(lz,"voices",Object.entries({"af-ZA":["af-ZA-AdriNeural","af-ZA-WillemNeural"],"am-ET":["am-ET-AmehaNeural","am-ET-MekdesNeural"],"ar-AE":["ar-AE-FatimaNeural","ar-AE-HamdanNeural"],"ar-BH":["ar-BH-AliNeural","ar-BH-LailaNeural"],"ar-DZ":["ar-DZ-AminaNeural","ar-DZ-IsmaelNeural"],"ar-EG":["ar-EG-SalmaNeural","ar-EG-ShakirNeural"],"ar-IQ":["ar-IQ-BasselNeural","ar-IQ-RanaNeural"],"ar-JO":["ar-JO-SanaNeural","ar-JO-TaimNeural"],"ar-KW":["ar-KW-FahedNeural","ar-KW-NouraNeural"],"ar-LB":["ar-LB-LaylaNeural","ar-LB-RamiNeural"],"ar-LY":["ar-LY-ImanNeural","ar-LY-OmarNeural"],"ar-MA":["ar-MA-JamalNeural","ar-MA-MounaNeural"],"ar-OM":["ar-OM-AbdullahNeural","ar-OM-AyshaNeural"],"ar-QA":["ar-QA-AmalNeural","ar-QA-MoazNeural"],"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"ar-SY":["ar-SY-AmanyNeural","ar-SY-LaithNeural"],"ar-TN":["ar-TN-HediNeural","ar-TN-ReemNeural"],"ar-YE":["ar-YE-MaryamNeural","ar-YE-SalehNeural"],"az-AZ":["az-AZ-BabekNeural","az-AZ-BanuNeural"],"bg-BG":["bg-BG-BorislavNeural","bg-BG-KalinaNeural"],"bn-BD":["bn-BD-NabanitaNeural","bn-BD-PradeepNeural"],"bn-IN":["bn-IN-BashkarNeural","bn-IN-TanishaaNeural"],"bs-BA":["bs-BA-GoranNeural","bs-BA-VesnaNeural"],"ca-ES":["ca-ES-EnricNeural","ca-ES-JoanaNeural"],"cs-CZ":["cs-CZ-AntoninNeural","cs-CZ-VlastaNeural"],"cy-GB":["cy-GB-AledNeural","cy-GB-NiaNeural"],"da-DK":["da-DK-ChristelNeural","da-DK-JeppeNeural"],"de-AT":["de-AT-IngridNeural","de-AT-JonasNeural"],"de-CH":["de-CH-JanNeural","de-CH-LeniNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-FlorianMultilingualNeural","de-DE-KatjaNeural","de-DE-KillianNeural","de-DE-SeraphinaMultilingualNeural"],"el-GR":["el-GR-AthinaNeural","el-GR-NestorasNeural"],"en-AU":["en-AU-NatashaNeural","en-AU-WilliamNeural"],"en-CA":["en-CA-ClaraNeural","en-CA-LiamNeural"],"en-GB":["en-GB-LibbyNeural","en-GB-MaisieNeural","en-GB-RyanNeural","en-GB-SoniaNeural","en-GB-ThomasNeural"],"en-HK":["en-HK-SamNeural","en-HK-YanNeural"],"en-IE":["en-IE-ConnorNeural","en-IE-EmilyNeural"],"en-IN":["en-IN-NeerjaExpressiveNeural","en-IN-NeerjaNeural","en-IN-PrabhatNeural"],"en-KE":["en-KE-AsiliaNeural","en-KE-ChilembaNeural"],"en-NG":["en-NG-AbeoNeural","en-NG-EzinneNeural"],"en-NZ":["en-NZ-MitchellNeural","en-NZ-MollyNeural"],"en-PH":["en-PH-JamesNeural","en-PH-RosaNeural"],"en-SG":["en-SG-LunaNeural","en-SG-WayneNeural"],"en-TZ":["en-TZ-ElimuNeural","en-TZ-ImaniNeural"],"en-US":["en-US-AnaNeural","en-US-AndrewMultilingualNeural","en-US-AndrewNeural","en-US-AriaNeural","en-US-AvaMultilingualNeural","en-US-AvaNeural","en-US-BrianMultilingualNeural","en-US-BrianNeural","en-US-ChristopherNeural","en-US-EmmaMultilingualNeural","en-US-EmmaNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-AR":["es-AR-ElenaNeural","es-AR-TomasNeural"],"es-BO":["es-BO-MarceloNeural","es-BO-SofiaNeural"],"es-CL":["es-CL-CatalinaNeural","es-CL-LorenzoNeural"],"es-CO":["es-CO-GonzaloNeural","es-CO-SalomeNeural"],"es-CR":["es-CR-JuanNeural","es-CR-MariaNeural"],"es-CU":["es-CU-BelkysNeural","es-CU-ManuelNeural"],"es-DO":["es-DO-EmilioNeural","es-DO-RamonaNeural"],"es-EC":["es-EC-AndreaNeural","es-EC-LuisNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural","es-ES-XimenaNeural"],"es-US":["es-US-AlonsoNeural","es-US-PalomaNeural"],"fr-BE":["fr-BE-CharlineNeural","fr-BE-GerardNeural"],"fr-CA":["fr-CA-AntoineNeural","fr-CA-JeanNeural","fr-CA-SylvieNeural","fr-CA-ThierryNeural"],"fr-CH":["fr-CH-ArianeNeural","fr-CH-FabriceNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural","fr-FR-RemyMultilingualNeural","fr-FR-VivienneMultilingualNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-HyunsuMultilingualNeural","ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural","pt-BR-ThalitaMultilingualNeural"],"pt-PT":["pt-PT-DuarteNeural","pt-PT-RaquelNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural"],"zh-HK":["zh-HK-HiuGaaiNeural","zh-HK-HiuMaanNeural","zh-HK-WanLungNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-HsiaoYuNeural","zh-TW-YunJheNeural"]}).flatMap(e=>{let[t,n]=e;return n.map(e=>({name:e.replace("".concat(t,"-"),"").replace("Neural",""),id:e,lang:t}))})),(0,J._)(lz,"audioCache",new lM(200));var lI=new WeakMap,lB=new WeakMap,l_=new WeakMap,lV=new WeakMap,lF=new WeakMap,lO=new WeakMap,lW=new WeakMap,lH=new WeakMap,lK=new WeakMap,lU=new WeakMap,lG=new WeakMap;class lY{async init(){(0,lh._)(this,lO,lz.voices);try{await (0,ld._)(this,lW).create({lang:"en",text:"test",voice:"en-US-AriaNeural",rate:1,pitch:1}),this.available=!0}catch(e){this.available=!1}return this.available}async *speak(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{marks:a}=lf(e),l=lg(e)||"en";if("en"===l&&(0,ld._)(this,lI)&&"en"!==(0,ld._)(this,lI)&&(l=(0,ld._)(this,lI)),n){for(let e=0;e<Math.min(2,a.length);e++){let t=a[e],{language:n}=t,s=n||l,i=await this.getVoiceIdFromLang(s);await (0,ld._)(this,lW).createAudio(this.getPayload(s,t.text,i)).catch(t=>{console.warn("Error preloading mark",e,t)})}a.length>2&&(async()=>{for(let e=2;e<a.length;e++){let t=a[e];try{let{language:e}=t,n=e||l,a=await this.getVoiceIdFromLang(n);await (0,ld._)(this,lW).createAudio(this.getPayload(n,t.text,a))}catch(t){console.warn("Error preloading mark (bg)",e,t)}}})(),yield{code:"end",message:"Preload finished"};return}for(let e of(await this.stopInternal(),a)){if(t.aborted){yield{code:"error",message:"Aborted"};break}try{var s;let{language:n}=e,a=n||l,i=await this.getVoiceIdFromLang(a);(0,lh._)(this,lB,a);let r=await (0,ld._)(this,lW).createAudio(this.getPayload(a,e.text,i)),o=URL.createObjectURL(r);(0,lh._)(this,lH,new Audio(o));let c=(0,ld._)(this,lH);c.setAttribute("x-webkit-airplay","deny"),c.preload="auto",null==(s=this.controller)||s.dispatchSpeakMark(e),yield{code:"boundary",message:"Start chunk: ".concat(e.name),mark:e.name};let d=await new Promise(n=>{let a=()=>{c.onended=null,c.onerror=null,c.pause(),c.src="",URL.revokeObjectURL(o)};if(c.onended=()=>{a(),t.aborted?n({code:"error",message:"Aborted"}):n({code:"end",message:"Chunk finished: ".concat(e.name)})},c.onerror=e=>{a(),console.warn("Audio playback error:",e),n({code:"error",message:"Audio playback error"})},t.aborted){a(),n({code:"error",message:"Aborted"});return}(0,lh._)(this,lK,!0),c.play().catch(e=>{a(),console.error("Failed to play audio:",e),n({code:"error",message:"Playback failed: "+e.message})})});yield d}catch(t){if(t instanceof Error&&"No audio data received."===t.message){console.warn("No audio data received for:",e.text),yield{code:"end",message:"Chunk finished: ".concat(e.name)};continue}console.log("Error:",t),yield{code:"error",message:t instanceof Error?t.message:String(t)};break}await this.stopInternal()}}async pause(){(0,ld._)(this,lK)&&(0,ld._)(this,lH)&&((0,lh._)(this,lU,(0,ld._)(this,lH).currentTime-(0,ld._)(this,lG)),await (0,ld._)(this,lH).pause(),(0,lh._)(this,lK,!1))}async resume(){!(0,ld._)(this,lK)&&(0,ld._)(this,lH)&&(await (0,ld._)(this,lH).play(),(0,lh._)(this,lK,!0),(0,lh._)(this,lG,(0,ld._)(this,lH).currentTime-(0,ld._)(this,lU)))}async stop(){await this.stopInternal()}async stopInternal(){if((0,lh._)(this,lK,!1),(0,lh._)(this,lU,0),(0,lh._)(this,lG,0),(0,ld._)(this,lH)){var e,t;(0,ld._)(this,lH).pause(),(0,ld._)(this,lH).currentTime=0,(null==(e=(0,ld._)(this,lH))?void 0:e.onended)&&(0,ld._)(this,lH).onended(new Event("stopped")),(null==(t=(0,ld._)(this,lH).src)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL((0,ld._)(this,lH).src),(0,ld._)(this,lH).src="",(0,lh._)(this,lH,null)}}setPrimaryLang(e){(0,lh._)(this,lI,e)}async setRate(e){(0,lh._)(this,l_,e)}async setPitch(e){(0,lh._)(this,lV,e)}async setVoice(e){let t=(0,ld._)(this,lO).find(t=>t.id===e);t&&(0,lh._)(this,lF,t)}async getAllVoices(){return(0,ld._)(this,lO).forEach(e=>{e.disabled=!this.available}),(0,ld._)(this,lO)}async getVoices(e){let t="en"===e&&(0,f.YK)(e)||e;return(await this.getAllVoices()).filter(n=>n.lang.startsWith(t)||"en"===e&&["en-US","en-GB"].includes(n.lang)).sort((e,t)=>{let n=e.lang.split("-")[1]||"",a=t.lang.split("-")[1]||"";return n===a?e.name<t.name?-1:+(e.name>t.name):"CN"===n?-1:"CN"===a?1:"TW"===n?-1:"TW"===a?1:"HK"===n?-1:"HK"===a?1:"US"===n?-1:"US"===a?1:"GB"===n?-1:"GB"===a?1:e.name<t.name?-1:+(e.name>t.name)})}getGranularities(){return["sentence"]}getVoiceId(){var e;return(null==(e=(0,ld._)(this,lF))?void 0:e.id)||""}getSpeakingLang(){return(0,ld._)(this,lB)}constructor(e){(0,J._)(this,"controller",void 0),(0,lu._)(this,lI,{writable:!0,value:"en"}),(0,lu._)(this,lB,{writable:!0,value:""}),(0,lu._)(this,l_,{writable:!0,value:1}),(0,lu._)(this,lV,{writable:!0,value:1}),(0,lu._)(this,lF,{writable:!0,value:null}),(0,lu._)(this,lO,{writable:!0,value:[]}),(0,lu._)(this,lW,{writable:!0,value:void 0}),(0,lu._)(this,lH,{writable:!0,value:null}),(0,lu._)(this,lK,{writable:!0,value:!1}),(0,lu._)(this,lU,{writable:!0,value:0}),(0,lu._)(this,lG,{writable:!0,value:0}),(0,J._)(this,"available",!0),(0,J._)(this,"getPayload",(e,t,n)=>({lang:e,text:t,voice:n,rate:(0,ld._)(this,l_),pitch:(0,ld._)(this,lV)})),(0,J._)(this,"getVoiceIdFromLang",async e=>{let t="en-US-AriaNeural",n=lx.getPreferredVoice("edge-tts",e),a=(0,ld._)(this,lO).find(e=>e.id===n);return(0,lh._)(this,lF,a||(await this.getVoices(e))[0]||null),(0,ld._)(this,lF)&&(t=(0,ld._)(this,lF).id),t}),this.controller=e,(0,lh._)(this,lW,new lz)}}var lq=n(26885),lX=new WeakMap,lJ=new WeakMap,lZ=new WeakMap,l$=new WeakSet,lQ=new WeakSet;class l0 extends EventTarget{async init(){await this.ttsWebClient.init(),await this.ttsEdgeClient.init()?this.ttsClient=this.ttsEdgeClient:this.ttsClient=this.ttsWebClient,this.ttsWebVoices=await this.ttsWebClient.getAllVoices(),this.ttsEdgeVoices=await this.ttsEdgeClient.getAllVoices()}async initViewTTS(){let e=this.view.language.isCJK?"sentence":"word",t=this.ttsClient.getGranularities();t.includes(e)||(e=t[0]),await this.view.initTTS(e)}async preloadSSML(e){if(e)for await(let t of(await this.ttsClient.speak(e,new AbortController().signal,!0)));}async preloadNextSSML(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=this.view.tts;if(!t)return;let n=0;for(let a=0;a<e;a++){let e=(0,lE._)(this,l$,l1).call(this,t.next());this.preloadSSML(e),e&&n++}for(let e=0;e<n;e++)t.prev()}async speak(e){await this.initViewTTS(),(0,lE._)(this,lQ,l2).call(this,e).catch(e=>this.error(e)),this.preloadNextSSML()}play(){"playing"!==this.state?this.start():this.pause()}async start(){var e,t;await this.initViewTTS();let n=this.state.includes("paused")?null==(e=this.view.tts)?void 0:e.resume():null==(t=this.view.tts)?void 0:t.start();this.state.includes("paused")&&this.resume(),(0,lE._)(this,lQ,l2).call(this,n),this.preloadNextSSML()}async pause(){this.state="paused",await this.ttsClient.pause().catch(e=>this.error(e))}async resume(){this.state="playing",await this.ttsClient.resume().catch(e=>this.error(e))}async stop(){(0,ld._)(this,lJ)&&(0,ld._)(this,lJ).abort(),await this.ttsClient.stop().catch(e=>this.error(e)),(0,ld._)(this,lZ)&&await (0,ld._)(this,lZ).catch(e=>this.error(e)),this.state="stopped"}async backward(){var e,t;await this.initViewTTS(),"playing"===this.state?(await this.stop(),(0,lE._)(this,lQ,l2).call(this,null==(e=this.view.tts)?void 0:e.prev())):(await this.stop(),this.state="backward-paused",null==(t=this.view.tts)||t.prev(!0))}async forward(){var e,t;await this.initViewTTS(),"playing"===this.state?(await this.stop(),(0,lE._)(this,lQ,l2).call(this,null==(e=this.view.tts)?void 0:e.next()),this.preloadNextSSML()):(await this.stop(),this.state="forward-paused",null==(t=this.view.tts)||t.next(!0))}async setLang(e){this.ttsLang=e,this.setPrimaryLang(e)}async setPrimaryLang(e){this.ttsEdgeClient.setPrimaryLang(e),this.ttsWebClient.setPrimaryLang(e)}async setRate(e){this.state="setrate-paused",this.ttsRate=e,await this.ttsClient.setRate(this.ttsRate)}async getVoices(e){let t=await this.ttsWebClient.getVoices(e);return[...await this.ttsEdgeClient.getVoices(e),...t]}async setVoice(e,t){this.state="setvoice-paused",this.ttsEdgeVoices.find(t=>(""===e||t.id===e)&&!t.disabled)?(this.ttsClient=this.ttsEdgeClient,await this.ttsClient.setRate(this.ttsRate),lx.setPreferredVoice("edge-tts",t,e)):(this.ttsClient=this.ttsWebClient,await this.ttsClient.setRate(this.ttsRate),lx.setPreferredVoice("web-speech",t,e)),await this.ttsClient.setVoice(e)}getVoiceId(){return this.ttsClient.getVoiceId()}getSpeakingLang(){return this.ttsClient.getSpeakingLang()}dispatchSpeakMark(e){this.dispatchEvent(new CustomEvent("tts-speak-mark",{detail:e}))}error(e){console.error(e),this.state="stopped"}async kill(){await this.stop()}constructor(e){super(),(0,lL._)(this,l$),(0,lL._)(this,lQ),(0,J._)(this,"state","stopped"),(0,J._)(this,"view",void 0),(0,lu._)(this,lX,{writable:!0,value:0}),(0,lu._)(this,lJ,{writable:!0,value:null}),(0,lu._)(this,lZ,{writable:!0,value:null}),(0,J._)(this,"ttsLang",""),(0,J._)(this,"ttsRate",1),(0,J._)(this,"ttsClient",void 0),(0,J._)(this,"ttsWebClient",void 0),(0,J._)(this,"ttsEdgeClient",void 0),(0,J._)(this,"ttsWebVoices",[]),(0,J._)(this,"ttsEdgeVoices",[]),this.ttsWebClient=new lA(this),this.ttsEdgeClient=new lY(this),this.ttsClient=this.ttsWebClient,this.view=e}}function l1(e){if(e)return e=e.replace(/<emphasis[^>]*>([^<]+)<\/emphasis>/g,"$1").replace(/[–—]/g,",").replace("<break/>"," ").replace(/\.{3,}/g,"   ").replace(/……/g,"  ").replace(/·/g," ")}async function l2(e){await this.stop(),(0,lh._)(this,lJ,new AbortController);let{signal:t}=(0,ld._)(this,lJ);(0,lh._)(this,lZ,new Promise(async(n,a)=>{try{if(console.log("TTS speak"),this.state="playing",e=(0,lE._)(this,l$,l1).call(this,await e),await this.preloadSSML(e),e)(0,lh._)(this,lX,0);else{(0,lq._)(this,lX).value++,10>(0,ld._)(this,lX)&&"playing"===this.state&&(n(),await this.view.next(),await this.forward()),console.log("no SSML, skipping for",(0,ld._)(this,lX));return}let{plainText:a,marks:s}=lf(e);if(!a||0===s.length)return n(),await this.forward();let i=await this.ttsClient.speak(e,t),r="boundary";for await(let{code:e,mark:a}of i){if(t.aborted)return void n();if(a&&"playing"===this.state){var l;let e=null==(l=this.view.tts)?void 0:l.setMark(a);this.dispatchEvent(new CustomEvent("tts-highlight-mark",{detail:e}))}r=e}"end"===r&&"playing"===this.state&&(n(),await this.forward()),n()}catch(e){t.aborted?n():a(e)}finally{(0,lh._)(this,lJ,null),(0,lh._)(this,lZ,null)}})),await (0,ld._)(this,lZ).catch(e=>this.error(e))}let l4=e=>[{label:e("No Timeout"),value:0},{label:e("{{value}} minute",{value:1}),value:60},{label:e("{{value}} minutes",{value:3}),value:180},{label:e("{{value}} minutes",{value:5}),value:300},{label:e("{{value}} minutes",{value:10}),value:600},{label:e("{{value}} minutes",{value:20}),value:1200},{label:e("{{value}} minutes",{value:30}),value:1800},{label:e("{{value}} minutes",{value:45}),value:2700},{label:e("{{value}} hour",{value:1}),value:3600},{label:e("{{value}} hours",{value:2}),value:7200},{label:e("{{value}} hours",{value:3}),value:10800},{label:e("{{value}} hours",{value:4}),value:14400},{label:e("{{value}} hours",{value:6}),value:21600},{label:e("{{value}} hours",{value:8}),value:28800}],l3=e=>{let t=Date.now();if(e>t){let n=Math.floor((e-t)/1e3),a=60*Math.floor(n/3600)+Math.floor(n%3600/60),l=n%60;return"".concat(a,":").concat(l<10?"0":"").concat(l)}return""},l8=e=>{var t,n;let{bookKey:l,ttsLang:s,isPlaying:r,timeoutOption:o,timeoutTimestamp:u,onTogglePlay:h,onBackward:m,onForward:f,onSetRate:p,onGetVoices:g,onSetVoice:x,onGetVoiceId:b,onSelectTimeout:v}=e,w=ev(),{envConfig:y}=(0,i.D)(),{getViewSettings:j,setViewSettings:N}=Y(),{settings:k,setSettings:S,saveSettings:C}=P(),A=j(l),[E,L]=(0,d.useState)([]),[T,M]=(0,d.useState)(null!=(t=null==A?void 0:A.ttsRate)?t:1),[D,R]=(0,d.useState)(null!=(n=null==A?void 0:A.ttsVoice)?n:""),[z,I]=(0,d.useState)(()=>l3(u)),B=(0,tn.n)(),_=(0,tn.D)(32),V=(0,tn.D)(48),F=(e,t)=>{x(e,t),R(e);let n=j(l);n.ttsVoice=e,N(l,n)},O=e=>{let t=Date.now();e>0&&e<t?(v(l,0),I("")):e>0&&I(l3(e))};(0,d.useEffect)(()=>{setTimeout(()=>{O(u)},1e3)},[u,z]),(0,d.useEffect)(()=>{R(b())},[]),(0,d.useEffect)(()=>{(async()=>{L(await g(s))})()},[s]);let W=l4(w);return(0,a.jsxs)("div",{className:"flex w-full flex-col items-center justify-center gap-2 rounded-2xl p-4",children:[(0,a.jsxs)("div",{className:"flex w-full flex-col items-center gap-0.5",children:[(0,a.jsx)("input",{className:"range",type:"range",min:0,max:3,step:"0.1",value:T,onChange:e=>{let t=parseFloat(e.target.value);M(t=Math.max(.2,Math.min(3,t))),p(t);let n=j(l);n.ttsRate=t,k.globalViewSettings.ttsRate=t,N(l,n),S(k),C(y,k)}}),(0,a.jsxs)("div",{className:"grid w-full grid-cols-7 text-xs",children:[(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"}),(0,a.jsx)("span",{className:"text-center",children:"|"})]}),(0,a.jsxs)("div",{className:"grid w-full grid-cols-7 text-xs",children:[(0,a.jsx)("span",{className:"text-center",children:w("Slow")}),(0,a.jsx)("span",{className:"text-center"}),(0,a.jsx)("span",{className:"text-center",children:"1.0"}),(0,a.jsx)("span",{className:"text-center",children:"1.5"}),(0,a.jsx)("span",{className:"text-center",children:"2.0"}),(0,a.jsx)("span",{className:"text-center"}),(0,a.jsx)("span",{className:"text-center",children:w("Fast")})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-2",children:[(0,a.jsx)("button",{onClick:m,className:"rounded-full p-1",children:(0,a.jsx)(te.N_V,{size:_})}),(0,a.jsx)("button",{onClick:h,className:"rounded-full p-1",children:r?(0,a.jsx)(te.mbB,{size:V,className:"fill-primary"}):(0,a.jsx)(te.Egk,{size:V,className:"fill-primary"})}),(0,a.jsx)("button",{onClick:f,className:"rounded-full p-1",children:(0,a.jsx)(te.xbA,{size:_})}),(0,a.jsxs)("div",{className:"dropdown dropdown-top",children:[(0,a.jsxs)("button",{tabIndex:0,className:"flex flex-col items-center justify-center rounded-full p-1",children:[(0,a.jsx)(te.vH2,{size:_}),z&&(0,a.jsx)("span",{className:(0,c.A)("absolute bottom-0 left-1/2 w-12 translate-x-[-50%] translate-y-[80%] px-1","bg-primary/80 text-base-100 rounded-full text-center text-xs"),children:z})]}),(0,a.jsx)("ul",{tabIndex:0,className:(0,c.A)("dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow","mt-4 inline max-h-96 w-[200px] overflow-y-scroll"),children:W.map((e,t)=>(0,a.jsx)("li",{onClick:()=>v(l,e.value),children:(0,a.jsxs)("div",{className:"flex items-center px-2",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(B,"px")},children:o===e.value&&(0,a.jsx)(te.g9_,{className:"text-base-content"})}),(0,a.jsx)("span",{className:(0,c.A)("text-base sm:text-sm"),children:e.label})]})},"".concat(t,"-").concat(e.value)))})]}),(0,a.jsxs)("div",{className:"dropdown dropdown-top",children:[(0,a.jsx)("button",{tabIndex:0,className:"rounded-full p-1",children:(0,a.jsx)(n7.DBM,{size:_})}),(0,a.jsx)("ul",{tabIndex:0,className:(0,c.A)("dropdown-content bgcolor-base-200 no-triangle menu menu-vertical rounded-box absolute right-0 z-[1] shadow","mt-4 inline max-h-96 w-[250px] overflow-y-scroll"),children:E.map((e,t)=>(0,a.jsx)("li",{onClick:()=>!e.disabled&&F(e.id,e.lang),children:(0,a.jsxs)("div",{className:"flex items-center px-2",children:[(0,a.jsx)("span",{style:{minWidth:"".concat(B,"px")},children:D===e.id&&(0,a.jsx)(te.g9_,{className:"text-base-content"})}),(0,a.jsx)("span",{className:(0,c.A)("text-base sm:text-sm",e.disabled&&"text-gray-400"),children:e.name})]})},"".concat(t,"-").concat(e.id)))})]})]})]})},l5=e=>{let{isPlaying:t,ttsInited:n,onClick:l}=e;return(0,a.jsxs)("div",{className:(0,c.A)("relative h-full w-full",n?"cursor-pointer":"cursor-not-allowed"),onClick:l,children:[(0,a.jsx)("div",{className:"absolute inset-0 overflow-hidden rounded-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500",children:(0,a.jsx)("div",{className:"absolute -inset-full bg-gradient-to-r from-blue-500 via-emerald-500 to-violet-500",style:{animation:t&&n?"moveGradient 2s alternate infinite":"none"}})}),(0,a.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center",children:[(0,a.jsx)("style",{children:"\n          @keyframes moveGradient {\n            0% { transform: translate(0, 0); }\n            100% { transform: translate(25%, 25%); }\n          }\n          @keyframes bounce {\n            0%, 100% { transform: scaleY(1); }\n            50% { transform: scaleY(0.6); }\n          }\n        "}),(0,a.jsx)("div",{className:"flex items-end space-x-1",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"w-1 rounded-t bg-white",style:{height:"16px",animationName:t?"bounce":"none",animationDuration:t?"".concat(1+.1*e,"s"):"0s",animationTimingFunction:"ease-in-out",animationIterationCount:"infinite",animationDelay:"".concat(.1*e,"s")}},e))})]})]})},l6=()=>{let e=ev(),{appService:t}=(0,i.D)(),{getBookData:n}=U(),{getView:l,getProgress:s,getViewSettings:r}=Y(),{setViewSettings:o,setTTSEnabled:u}=Y(),[h,m]=(0,d.useState)(""),[f,p]=(0,d.useState)("en"),[g,x]=(0,d.useState)(!1),[b,v]=(0,d.useState)(!1),[w,y]=(0,d.useState)(!1),[j,N]=(0,d.useState)(!1),[k,S]=(0,d.useState)(),[C,A]=(0,d.useState)(),[E,L]=(0,d.useState)(0),[T,M]=(0,d.useState)(0),[D,R]=(0,d.useState)(null),z=r(h),P=(0,tn.D)(10),B=Math.min(window.innerWidth-2*P,(0,tn.D)(282)),V=(0,tn.D)(160),F=(0,d.useRef)(null),O=(0,d.useRef)(null),W=(0,d.useRef)(null),[H,K]=(0,d.useState)(null),[G,q]=(0,d.useState)(!1),X=()=>{O.current||(O.current=document.createElement("audio"),O.current.setAttribute("x-webkit-airplay","deny"),O.current.addEventListener("play",()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=null,navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("stop",null),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null))}),O.current.preload="auto",O.current.loop=!0,O.current.src="data:audio/mp3;base64,//MkxAAHiAICWABElBeKPL/RANb2w+yiT1g/gTok//lP/W/l3h8QO/OCdCqCW2Cw//MkxAQHkAIWUAhEmAQXWUOFW2dxPu//9mr60ElY5sseQ+xxesmHKtZr7bsqqX2L//MkxAgFwAYiQAhEAC2hq22d3///9FTV6tA36JdgBJoOGgc+7qvqej5Zu7/7uI9l//MkxBQHAAYi8AhEAO193vt9KGOq+6qcT7hhfN5FTInmwk8RkqKImTM55pRQHQSq//MkxBsGkgoIAABHhTACIJLf99nVI///yuW1uBqWfEu7CgNPWGpUadBmZ////4sL//MkxCMHMAH9iABEmAsKioqKigsLCwtVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVV//MkxCkECAUYCAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",O.current.play())},J=()=>{if(O.current)try{O.current.pause(),O.current.currentTime=0,O.current.removeAttribute("src"),O.current.src="",O.current.load(),O.current=null,console.log("Unblock audio released")}catch(e){console.warn("Error releasing unblock audio:",e)}};(0,d.useEffect)(()=>()=>{W.current&&(W.current.kill(),W.current=null)},[]),(0,d.useEffect)(()=>($.on("tts-speak",Z),$.on("tts-stop",Q),$.onSync("tts-is-speaking",ee),()=>{$.off("tts-speak",Z),$.off("tts-stop",Q),$.offSync("tts-is-speaking",ee)}),[]),(0,d.useEffect)(()=>{if(!H||!h)return;let e=n(h);if(!e||!e.book)return;let{title:a,author:i,coverImageUrl:c}=e.book,d=e=>{let{sectionLabel:n}=s(h)||{},l=e.detail;(null==t?void 0:t.isMobileApp)&&"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:l.text,artist:n||a,album:i,artwork:[{src:c||"/icon.png",sizes:"512x512",type:"image/png"}]}))},u=e=>{let t=e.detail,n=l(h),a=s(h),i=r(h);if(!t||!n||!a||!i)return;let{location:c}=a,{index:d}=n.resolveCFI(c),u=null==n?void 0:n.getCFI(d,t);u&&(i.ttsLocation=u||"",o(h,i))};return H.addEventListener("tts-speak-mark",d),H.addEventListener("tts-highlight-mark",u),()=>{H.removeEventListener("tts-speak-mark",d),H.removeEventListener("tts-highlight-mark",u)}},[H,h]);let Z=async a=>{var i,o;let{bookKey:c,range:d}=a.detail,h=l(c),f=s(c),g=r(c),b=n(c);if(!h||!f||!g||!b||!b.book)return;if((null==(i=b.book)?void 0:i.format)==="PDF")return void $.dispatch("toast",{message:e("TTS not supported for PDF"),type:"warning"});let v=d||f.range;if(g.ttsLocation){let{location:e}=f,t=g.ttsLocation,n=_.HY.collapse(e),a=_.HY.collapse(e,!0);if(_.HY.compare(n,t)*_.HY.compare(a,t)<=0){let{index:e,anchor:n}=h.resolveCFI(t),{doc:a}=h.renderer.getContents().find(t=>t.index=e)||{};a&&(v=n(a)||v)}}let w=b.book.primaryLanguage;m(c),W.current&&(W.current.stop(),W.current=null),u(c,!0),y(!0);try{(null==t?void 0:t.isIOSApp)&&await (0,I.i1)({enabled:!0}),(null==t?void 0:t.isMobile)&&X(),q(!1);let e=new l0(h);await e.init(),await e.initViewTTS();let n=null==(o=h.tts)?void 0:o.from(v);if(n){let t=lg(n)||"en";"en"===t&&w&&"en"!==w&&(t=w.split("-")[0]),x(!0),p(t),e.setLang(t),e.setRate(g.ttsRate),e.speak(n),W.current=e,K(e)}q(!0)}catch(t){$.dispatch("toast",{message:e("TTS not supported in this device"),type:"error"}),console.error(t)}},Q=async e=>{let{bookKey:t}=e.detail;W.current&&el(t)},ee=()=>!!W.current,et=async()=>{let e=W.current;e&&(g?(x(!1),v(!0),await e.pause()):b&&(x(!0),v(!1),"paused"===e.state?await e.resume():await e.start()))},en=async()=>{let e=W.current;e&&await e.backward()},ea=async()=>{let e=W.current;e&&await e.forward()},el=async e=>{let n=W.current;if(n){var a;await n.stop(),W.current=null,K(null),null==(a=l(e))||a.deselect(),x(!1),N(!1),y(!1)}(null==t?void 0:t.isIOSApp)&&await (0,I.i1)({enabled:!1}),(null==t?void 0:t.isMobile)&&J(),u(e,!1)},es=(0,d.useCallback)(nz(async e=>{let t=W.current;t&&("playing"===t.state?(await t.stop(),await t.setRate(e),await t.start()):await t.setRate(e))},3e3),[]),ei=(0,d.useCallback)(nz(async(e,t)=>{let n=W.current;n&&("playing"===n.state?(await n.stop(),await n.setVoice(e,t),await n.start()):await n.setVoice(e,t))},3e3),[]),er=async e=>{let t=W.current;return t?t.getVoices(e):[]},eo=()=>{if(F.current){var e;let t=F.current.getBoundingClientRect(),n=(null==(e=F.current.parentElement)?void 0:e.getBoundingClientRect())||document.documentElement.getBoundingClientRect(),a={dir:"up",point:{x:t.left+t.width/2-n.left,y:t.top-12}};S(aG(a,n,B,V,P)),A(a)}},ec=()=>{N(!1)};return(0,d.useEffect)(()=>{if(!F.current||!j)return;let e=F.current.parentElement;if(!e)return;let t=new ResizeObserver(()=>{eo()});return t.observe(e),()=>{t.disconnect()}},[j]),(0,a.jsxs)(a.Fragment,{children:[j&&(0,a.jsx)("div",{className:"fixed inset-0",onClick:ec,onContextMenu:ec}),w&&(0,a.jsx)("div",{ref:F,className:(0,c.A)("absolute h-12 w-12",(null==z?void 0:z.rtl)?"left-6":"right-6",(null==t?void 0:t.hasSafeAreaInset)?"bottom-[calc(env(safe-area-inset-bottom)+70px)]":"bottom-[70px] sm:bottom-14"),children:(0,a.jsx)(l5,{isPlaying:g,ttsInited:G,onClick:()=>{eo(),!j&&W.current&&p(W.current.getSpeakingLang()||f),N(e=>!e)}})}),j&&k&&C&&G&&(0,a.jsx)(aX,{width:B,height:V,position:k,trianglePosition:C,className:"bg-base-200 flex shadow-lg",children:(0,a.jsx)(l8,{bookKey:h,ttsLang:f,isPlaying:g,timeoutOption:E,timeoutTimestamp:T,onTogglePlay:et,onBackward:en,onForward:ea,onSetRate:es,onGetVoices:er,onSetVoice:ei,onGetVoiceId:()=>{let e=W.current;return e?e.getVoiceId():""},onSelectTimeout:(e,t)=>{L(t),D&&clearTimeout(D),t>0?(R(setTimeout(()=>{el(e)},1e3*t)),M(Date.now()+1e3*t)):M(0)}})})]})},l9=e=>{let{bookKeys:t,onCloseBook:n}=e,{appService:l}=(0,i.D)(),{getConfig:s,getBookData:r}=U(),{getProgress:o,getViewState:u,getViewSettings:h,hoveredBookKey:m}=Y(),{isSideBarVisible:f,sideBarBookKey:p}=q(),{isFontLayoutSettingsDialogOpen:g,setFontLayoutSettingsDialogOpen:x}=P(),b=n0(t.length,window.innerWidth/window.innerHeight);return(0,d.useEffect)(()=>{if(!p)return;let e=r(p);e&&e.book&&(document.title=e.book.title)},[p]),(0,a.jsxs)("div",{className:(0,c.A)("relative grid h-full flex-grow"),style:{gridTemplateColumns:b.columns,gridTemplateRows:b.rows},children:[t.map((e,i)=>{var d;let p=r(e),b=s(e),v=o(e),w=h(e),{book:y,bookDoc:j}=p||{};if(!y||!b||!j||!w)return null;let{section:N,pageinfo:k,timeinfo:S,sectionLabel:C}=v||{},A=null==(d=u(e))?void 0:d.ribbonVisible,E=w.gapPercent,L=w.marginPx,T=w.scrolled,M=w.showBarsOnScroll,D=w.showHeader&&(!T||M),R=w.showFooter&&(!T||M);return(0,a.jsxs)("div",{id:"gridcell-".concat(e),className:(0,c.A)("relative h-full w-full overflow-hidden",0===i&&!(null==w?void 0:w.scrolled)&&(null==l?void 0:l.hasSafeAreaInset)&&"pt-[env(safe-area-inset-top)]",!f&&(null==l?void 0:l.hasRoundedWindow)&&"rounded-window"),children:[A&&!m&&(0,a.jsx)(au,{width:"".concat(E,"%")}),(0,a.jsx)(as,{bookKey:e,bookTitle:y.title,isTopLeft:0===i,isHoveredAnim:t.length>2,onCloseBook:n,onSetSettingsDialogOpen:x}),(0,a.jsx)(nQ,{bookKey:e,bookDoc:j,config:b}),w.vertical&&w.scrolled&&(0,a.jsxs)(a.Fragment,{children:[(R||w.doubleBorder)&&(0,a.jsx)("div",{className:"bg-base-100 absolute left-0 top-0 h-full",style:{width:"calc(".concat(E,"%)"),height:"calc(100% - ".concat(L,"px)")}}),(D||w.doubleBorder)&&(0,a.jsx)("div",{className:"bg-base-100 absolute right-0 top-0 h-full",style:{width:"calc(".concat(E,"%)"),height:"calc(100% - ".concat(L,"px)")}})]}),w.vertical&&w.doubleBorder&&(0,a.jsx)(lc,{showHeader:D,showFooter:R,borderColor:w.borderColor,horizontalGap:E,verticalMargin:L}),D&&(0,a.jsx)(n1,{section:C,showDoubleBorder:w.vertical&&w.doubleBorder,isScrolled:w.scrolled,isVertical:w.vertical,horizontalGap:E,verticalMargin:L}),(0,a.jsx)(lo,{bookKey:e,showDoubleBorder:w.vertical&&w.doubleBorder,isScrolled:w.scrolled,isVertical:w.vertical,horizontalGap:E,verticalMargin:L}),R&&(0,a.jsx)(ad,{bookKey:e,bookFormat:y.format,section:N,pageinfo:k,timeinfo:S,horizontalGap:E,verticalMargin:L}),(0,a.jsx)(a5,{bookKey:e}),(0,a.jsx)(lr,{bookKey:e,bookDoc:j}),(0,a.jsx)(ac,{bookKey:e,bookFormat:y.format,section:N,pageinfo:k,isHoveredAnim:!1}),g&&(0,a.jsx)(aB,{bookKey:e,config:b})]},e)}),(0,a.jsx)(l6,{})]})},l7=e=>{let{ids:t,settings:n}=e,l=(0,e9.useRouter)(),s=(0,e9.useSearchParams)(),{envConfig:r,appService:o}=(0,i.D)(),{bookKeys:u,dismissBook:m,getNextBookKey:p}=tz(),{sideBarBookKey:g,setSideBarBookKey:x}=q(),{saveSettings:b}=P(),{getConfig:v,getBookData:w,saveConfig:y}=U(),{getView:j,setBookKeys:N}=Y(),{initViewState:k,getViewState:S,clearViewState:C}=Y(),[A,E]=(0,d.useState)(null),L=(0,d.useRef)(!1),[T,D]=(0,d.useState)(!1);tF({sideBarBookKey:g,bookKeys:u}),(0,d.useEffect)(()=>{if(L.current)return;L.current=!0;let e=(t||(null==s?void 0:s.get("ids"))||"").split(h.Zk).filter(Boolean).map(e=>"".concat(e,"-").concat((0,f.NF)()));N(e);let n=new Set;console.log("Initialize books",e),e.forEach((e,t)=>{let a=e.split("-")[0],l=!n.has(a);n.add(a),S(e)||(k(r,a,e,l).catch(t=>{console.log("Error initializing book",e,t)}),0===t&&x(e))}),$.onSync("show-book-details",e=>(E(e.detail),!0))},[]),(0,d.useEffect)(()=>{if(u&&u.length>0){let e=P.getState().settings;e.lastOpenBooks=u.map(e=>e.split("-")[0]),b(r,e)}return(0,M.uO)()&&tA(B),window.addEventListener("beforeunload",B),$.on("quit-app",B),()=>{window.removeEventListener("beforeunload",B),$.off("quit-app",B)}},[u]);let R=async e=>{let t=v(e),{book:n}=w(e)||{},{isPrimary:a}=S(e)||{};if(a&&n&&t){$.dispatch("sync-book-progress",{bookKey:e});let n=P.getState().settings;await y(r,e,t,n)}},z=async e=>{console.log("Closing book",e);try{var t,n;null==(t=j(e))||t.close(),null==(n=j(e))||n.remove()}catch(t){console.info("Error closing book",e)}$.dispatch("tts-stop",{bookKey:e}),await R(e),C(e)},I=()=>{b(r,n),tD(l)},B=async()=>{let e=P.getState().settings;await Promise.all(u.map(e=>z(e))),await b(r,e)},_=async e=>{z(e),g===e&&x(p(g)),m(e),0==u.filter(t=>t!==e).length&&(!((await ty()||[]).length>0)||(null==o?void 0:o.isMobile)?I():tC())};if(!u||0===u.length)return null;let V=w(u[0]);return V&&V.book&&V.bookDoc?(0,a.jsxs)("div",{className:(0,c.A)("flex",(null==o?void 0:o.isIOSApp)?"h-[100vh]":"h-dvh"),children:[(0,a.jsx)(nx,{onGoToLibrary:()=>{B(),tD(l)}}),(0,a.jsx)(l9,{bookKeys:u,onCloseBook:_}),(0,a.jsx)(nN,{}),A&&(0,a.jsx)(tK,{isOpen:!!A,book:A,onClose:()=>E(null)})]}):(setTimeout(()=>D(!0),300),T&&(0,a.jsx)("div",{className:(0,c.A)("hero hero-content",(null==o?void 0:o.isIOSApp)?"h-[100vh]":"h-dvh"),children:(0,a.jsx)(tW,{loading:!0})}))},se=e=>{let{ids:t}=e,{envConfig:n,appService:l}=(0,i.D)(),{setLibrary:s}=K(),{hoveredBookKey:r}=Y(),{settings:o,setSettings:u}=P(),{isSideBarVisible:h,setSideBarVisible:m}=q(),{isNotebookVisible:f,setNotebookVisible:p}=X(),{isDarkMode:g,showSystemUI:x,dismissSystemUI:b}=z(),{acquireBackKeyInterception:v,releaseBackKeyInterception:w}=ee(),[y,j]=(0,d.useState)(!1),N=(0,d.useRef)(!1);B({systemUIVisible:!1,appThemeColor:"base-100"}),en(o.screenWakeLock),(0,d.useEffect)(()=>{ed(document),el()},[]),(0,d.useEffect)(()=>{let e=()=>{(null==l?void 0:l.isMobileApp)&&!document.hidden&&(b(),(0,I.Mp)({visible:!1,darkMode:g}))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[l,g]);let k=e=>"Back"===e.detail.keyName&&(m(!1),p(!1),!0);return(0,d.useEffect)(()=>{if(null==l?void 0:l.isAndroidApp)return(h||f)&&(v(),$.onSync("native-key-down",k)),h||f||(w(),$.offSync("native-key-down",k)),()=>{(null==l?void 0:l.isAndroidApp)&&(w(),$.offSync("native-key-down",k))}},[h,f]),(0,d.useEffect)(()=>{N.current||(N.current=!0,(async()=>{let e=await n.getAppService();u(await e.loadSettings()),s(await e.loadLibraryBooks()),j(!0)})())},[]),(0,d.useEffect)(()=>{if(!(null==l?void 0:l.isMobileApp))return;let e=!!r;(0,I.Mp)({visible:e,darkMode:g}),e?x():b()},[r]),y&&o.globalReadSettings&&(0,a.jsx)("div",{className:(0,c.A)("reader-page bg-base-100 text-base-content select-none",!h&&(null==l?void 0:l.hasRoundedWindow)&&"rounded-window"),children:(0,a.jsxs)(d.Suspense,{children:[(0,a.jsx)(l7,{ids:t,settings:o}),(0,a.jsx)(tp,{}),(null==l?void 0:l.isAndroidApp)&&(0,a.jsx)(to,{}),(0,a.jsx)(tg,{})]})})};function st(){let e=(0,l.useRouter)().query.ids;return(0,a.jsx)(r.y,{children:(0,a.jsx)(i.L,{children:(0,a.jsx)(s.O,{children:(0,a.jsx)(o.n,{children:(0,a.jsx)(se,{ids:e})})})})})}},49991:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/reader/[ids]",function(){return n(39602)}])},50776:(e,t,n)=>{"use strict";n.d(t,{u:()=>l});let a=e=>document.createElementNS("http://www.w3.org/2000/svg",e);class l{#t=a("svg");#n=new Map;#a=null;constructor(e){this.#a=e,Object.assign(this.#t.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"})}get element(){return this.#t}get #l(){return/^((?!chrome|android).)*AppleWebKit/i.test(navigator.userAgent)&&!window.chrome&&window.getComputedStyle(this.#a.body).zoom||1}#s(e){let t=e.commonAncestorContainer,n=Array.from(t.querySelectorAll?.("p")||[]);if(0===n.length)return[e];let a=[];return n.forEach(t=>{let n=document.createRange();e.intersectsNode(t)&&(n.selectNodeContents(t),0>n.compareBoundaryPoints(Range.START_TO_START,e)&&n.setStart(e.startContainer,e.startOffset),n.compareBoundaryPoints(Range.END_TO_END,e)>0&&n.setEnd(e.endContainer,e.endOffset),a.push(n))}),a}add(e,t,n,a){this.#n.has(e)&&this.remove(e),"function"==typeof t&&(t=t(this.#t.getRootNode()));let l=this.#l,s=[];this.#s(t).forEach(e=>{let t=Array.from(e.getClientRects()).map(e=>({left:e.left*l,top:e.top*l,right:e.right*l,bottom:e.bottom*l,width:e.width*l,height:e.height*l}));s=s.concat(t)});let i=n(s,a);this.#t.append(i),this.#n.set(e,{range:t,draw:n,options:a,element:i,rects:s})}remove(e){this.#n.has(e)&&(this.#t.removeChild(this.#n.get(e).element),this.#n.delete(e))}redraw(){for(let e of this.#n.values()){let{range:t,draw:n,options:a,element:l}=e;this.#t.removeChild(l);let s=this.#l,i=[];this.#s(t).forEach(e=>{let t=Array.from(e.getClientRects()).map(e=>({left:e.left*s,top:e.top*s,right:e.right*s,bottom:e.bottom*s,width:e.width*s,height:e.height*s}));i=i.concat(t)});let r=n(i,a);this.#t.append(r),e.element=r,e.rects=i}}hitTest({x:e,y:t}){let n=Array.from(this.#n.entries());for(let a=n.length-1;a>=0;a--){let[l,s]=n[a];for(let{left:n,top:a,right:i,bottom:r}of s.rects)if(a<=t&&n<=e&&r>t&&i>e)return[l,s.range]}return[]}static underline(e,t={}){let{color:n="red",width:l=2,padding:s=0,writingMode:i}=t,r=a("g");if(r.setAttribute("fill",n),"vertical-rl"===i||"vertical-lr"===i)for(let{right:t,top:n,height:i}of e){let e=a("rect");e.setAttribute("x",t-l/2+s),e.setAttribute("y",n),e.setAttribute("height",i),e.setAttribute("width",l),r.append(e)}else for(let{left:t,bottom:n,width:i}of e){let e=a("rect");e.setAttribute("x",t),e.setAttribute("y",n-l/2+s),e.setAttribute("height",l),e.setAttribute("width",i),r.append(e)}return r}static strikethrough(e,t={}){let{color:n="red",width:l=2,writingMode:s}=t,i=a("g");if(i.setAttribute("fill",n),"vertical-rl"===s||"vertical-lr"===s)for(let{right:t,left:n,top:s,height:r}of e){let e=a("rect");e.setAttribute("x",(t+n)/2),e.setAttribute("y",s),e.setAttribute("height",r),e.setAttribute("width",l),i.append(e)}else for(let{left:t,top:n,bottom:s,width:r}of e){let e=a("rect");e.setAttribute("x",t),e.setAttribute("y",(n+s)/2),e.setAttribute("height",l),e.setAttribute("width",r),i.append(e)}return i}static squiggly(e,t={}){let{color:n="red",width:l=2,padding:s=0,writingMode:i}=t,r=a("g");r.setAttribute("fill","none"),r.setAttribute("stroke",n),r.setAttribute("stroke-width",l);let o=1.5*l;if("vertical-rl"===i||"vertical-lr"===i)for(let{right:t,top:n,height:i}of e){let e=a("path"),c=Math.round(i/o/1.5),d=i/c,u=Array.from({length:c},(e,t)=>`l${t%2?-o:o} ${d}`).join("");e.setAttribute("d",`M${t-l/2+s} ${n}${u}`),r.append(e)}else for(let{left:t,bottom:n,width:i}of e){let e=a("path"),c=Math.round(i/o/1.5),d=i/c,u=Array.from({length:c},(e,t)=>`l${d} ${t%2?o:-o}`).join("");e.setAttribute("d",`M${t} ${n+l/2+s}${u}`),r.append(e)}return r}static highlight(e,t={}){let{color:n="red",padding:l=0}=t,s=a("g");for(let{left:t,top:i,height:r,width:o}of(s.setAttribute("fill",n),s.style.opacity="var(--overlayer-highlight-opacity, .3)",s.style.mixBlendMode="var(--overlayer-highlight-blend-mode, normal)",e)){let e=a("rect");e.setAttribute("x",t-l),e.setAttribute("y",i-l),e.setAttribute("height",r+2*l),e.setAttribute("width",o+2*l),s.append(e)}return s}static outline(e,t={}){let{color:n="red",width:l=3,padding:s=0,radius:i=3}=t,r=a("g");for(let{left:t,top:o,height:c,width:d}of(r.setAttribute("fill","none"),r.setAttribute("stroke",n),r.setAttribute("stroke-width",l),e)){let e=a("rect");e.setAttribute("x",t-s),e.setAttribute("y",o-s),e.setAttribute("height",c+2*s),e.setAttribute("width",d+2*s),e.setAttribute("rx",i),r.append(e)}return r}static copyImage([e],t={}){let{src:n}=t,l=a("image"),{left:s,top:i,height:r,width:o}=e;return l.setAttribute("href",n),l.setAttribute("x",s),l.setAttribute("y",i),l.setAttribute("height",r),l.setAttribute("width",o),l}}},77636:e=>{"use strict";e.exports={input:["src/**/*.{js,jsx,ts,tsx}","!src/**/*.test.{js,jsx,ts,tsx}"],output:".",options:{debug:!1,sort:!1,func:{list:["_"],extensions:[".js",".jsx",".ts",".tsx"]},lngs:["de","ja","es","fr","it","el","ko","uk","nl","pl","pt","ru","tr","hi","id","vi","ar","zh-CN","zh-TW"],ns:["translation"],defaultNs:"translation",defaultValue:"__STRING_NOT_TRANSLATED__",resource:{loadPath:"./public/locales/{{lng}}/{{ns}}.json",savePath:"./public/locales/{{lng}}/{{ns}}.json",jsonIndent:2,lineEnding:"\n"},keySeparator:!1,nsSeparator:!1,interpolation:{prefix:"{{",suffix:"}}"},metadata:{},allowDynamicKeys:!0,removeUnusedKeys:!0}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2115,3340,9154,5035,2866,422,9129,9887,1112,2156,1530,8019,1640,7756,4617,3205,2372,9359,4938,8815,636,6593,8792],()=>t(49991)),_N_E=e.O()}]);